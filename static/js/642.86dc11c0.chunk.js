(globalThis.webpackChunkwinbit32=globalThis.webpackChunkwinbit32||[]).push([[642],{99642:(t,r,n)=>{"use strict";n.d(r,{default:()=>s});var e=n(91760),i=n.n(e),o=n(78488),h=n(74248).Buffer,a=function(t,r,n,e){return new(n||(n=Promise))((function(i,o){function h(t){try{s(e.next(t))}catch(r){o(r)}}function a(t){try{s(e.throw(t))}catch(r){o(r)}}function s(t){var r;t.done?i(t.value):(r=t.value,r instanceof n?r:new n((function(t){t(r)}))).then(h,a)}s((e=e.apply(t,r||[])).next())}))};class s{constructor(t,r="CSM"){this.transport=t,t.decorateAppAPIMethods(this,["getAddress","sign","getAppConfiguration"],r)}getAppConfiguration(){return this.transport.send(85,0,0,0).then((t=>({test_mode:0!==t[0],version:t[1]+"."+t[2]+"."+t[3],device_locked:1===t[4],major:t[1]})))}serializePath(t){const r=h.alloc(20);return r.writeUInt32LE((2147483648|t[0])>>>0,0),r.writeUInt32LE((2147483648|t[1])>>>0,4),r.writeUInt32LE((2147483648|t[2])>>>0,8),r.writeUInt32LE(t[3],12),r.writeUInt32LE(t[4],16),r}serializeHRP(t){if(null==t||0===t.length||t.length>83)throw new Error("Invalid HRP");const r=h.alloc(1+t.length);return r.writeUInt8(t.length,0),r.write(t,1),r}getAddress(t,r,n){const e=i().fromString(t).toPathArray(),o=this.serializePath(e),a=h.concat([this.serializeHRP(r),o]);return this.transport.send(85,4,n?1:0,0,a,[36864]).then((t=>({address:h.from(t.slice(33,-2)).toString(),publicKey:h.from(t.slice(0,33)).toString("hex")})))}foreach(t,r){function n(t,e,i){return t>=e.length?i:r(e[t],t).then((function(r){return i.push(r),n(t+1,e,i)}))}return Promise.resolve().then((()=>n(0,t,[])))}sign(t,r){return a(this,void 0,void 0,(function*(){const n=i().fromString(t).toPathArray(),e=this.serializePath(n),a=[];a.push(e);const s=h.from(r);for(let t=0;t<s.length;t+=250){let r=t+250;t>s.length&&(r=s.length),a.push(s.slice(t,r))}let l={};return this.foreach(a,((t,r)=>this.transport.send(85,2,0===r?0:r+1===a.length?2:1,0,t,[36864,27014]).then((t=>l=t)))).then((()=>{const t=l.slice(-2),r=256*t[0]+t[1];let n=null;if(l.length>2&&(n=l.slice(0,l.length-2)),27014===r)throw new o.XN;return{signature:n,return_code:r}}))}))}}},91760:t=>{const r=2147483648;var n=function(t){if(!Array.isArray(t))throw new Error("Input must be an Array");if(0===t.length)throw new Error("Path must contain at least one level");for(var r=0;r<t.length;r++)if("number"!==typeof t[r])throw new Error("Path element is not a number");this.path=t};n.validatePathArray=function(t){try{return n.fromPathArray(t),!0}catch(r){return!1}},n.validateString=function(t,r){try{return n.fromString(t,r),!0}catch(e){return!1}},n.fromPathArray=function(t){return new n(t)},n.fromString=function(t,e){if(/^m\//i.test(t))t=t.slice(2);else if(e)throw new Error("Root element is required");for(var i=t.split("/"),o=new Array(i.length),h=0;h<i.length;h++){var a=/(\d+)([hH\']?)/.exec(i[h]);if(null===a)throw new Error("Invalid input");if(o[h]=parseInt(a[1],10),o[h]>=r)throw new Error("Invalid child index");if("h"===a[2]||"H"===a[2]||"'"===a[2])o[h]+=r;else if(0!=a[2].length)throw new Error("Invalid modifier")}return new n(o)},n.prototype.toPathArray=function(){return this.path},n.prototype.toString=function(t,n){for(var e=new Array(this.path.length),i=0;i<this.path.length;i++){var o=this.path[i];e[i]=o&r?(o&~r)+(n?"h":"'"):o}return(t?"":"m/")+e.join("/")},n.prototype.inspect=function(){return"BIPPath <"+this.toString()+">"},t.exports=n}}]);
//# sourceMappingURL=642.86dc11c0.chunk.js.map