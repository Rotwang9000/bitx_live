/*! For license information please see 553.3000b7ab.chunk.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkwinbit32=globalThis.webpackChunkwinbit32||[]).push([[553],{73553:(t,e,r)=>{r.d(e,{BrowserProvider:()=>In});var n={};r.r(n),r.d(n,{OG:()=>Wt,My:()=>Ut,Ph:()=>Mt,lX:()=>Ht,Id:()=>Zt,fg:()=>Kt,qj:()=>Vt,aT:()=>Dt,lq:()=>qt,z:()=>zt,Q5:()=>Xt});var s=r(50888),i=r(41322),a=r(37420),o=r(59799),c=r(23510),l=r(6045),u=r(90),h=r(78804),d=r(66435);const f=new Uint8Array(32);f.fill(0);const p=BigInt(-1),g=BigInt(0),y=BigInt(1),m=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const b=(0,u.up)(y,32),w=(0,u.up)(g,32),v={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},x=["name","version","chainId","verifyingContract","salt"];function A(t){return function(e){return(0,s.MR)("string"===typeof e,`invalid domain value for ${JSON.stringify(t)}`,`domain.${t}`,e),e}}const P={name:A("name"),version:A("version"),chainId:function(t){const e=(0,u.Ab)(t,"domain.chainId");return(0,s.MR)(e>=0,"invalid chain ID","domain.chainId",t),Number.isSafeInteger(e)?Number(e):(0,u.nD)(e)},verifyingContract:function(t){try{return(0,a.b)(t).toLowerCase()}catch(e){}(0,s.MR)(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",t)},salt:function(t){const e=(0,l.q5)(t,"domain.salt");return(0,s.MR)(32===e.length,'invalid domain value "salt"',"domain.salt",t),(0,l.c$)(e)}};function E(t){{const e=t.match(/^(u?)int(\d+)$/);if(e){const r=""===e[1],n=parseInt(e[2]);(0,s.MR)(n%8===0&&0!==n&&n<=256&&e[2]===String(n),"invalid numeric width","type",t);const i=(0,u.dK)(m,r?n-1:n),a=r?(i+y)*p:g;return function(e){const n=(0,u.Ab)(e,"value");return(0,s.MR)(n>=a&&n<=i,`value out-of-bounds for ${t}`,"value",n),(0,u.up)(r?(0,u.JJ)(n,256):n,32)}}}{const e=t.match(/^bytes(\d+)$/);if(e){const r=parseInt(e[1]);return(0,s.MR)(0!==r&&r<=32&&e[1]===String(r),"invalid bytes width","type",t),function(e){const n=(0,l.q5)(e);return(0,s.MR)(n.length===r,`invalid length for ${t}`,"value",e),function(t){const e=(0,l.q5)(t),r=e.length%32;return r?(0,l.xW)([e,f.slice(r)]):(0,l.c$)(e)}(e)}}}switch(t){case"address":return function(t){return(0,l.nx)((0,a.b)(t),32)};case"bool":return function(t){return t?b:w};case"bytes":return function(t){return(0,c.S)(t)};case"string":return function(t){return(0,d.id)(t)}}return null}function k(t,e){return`${t}(${e.map((({name:t,type:e})=>e+" "+t)).join(",")})`}function R(t){const e=t.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:t}}class I{primaryType;#t;get types(){return JSON.parse(this.#t)}#e;#r;constructor(t){this.#e=new Map,this.#r=new Map;const e=new Map,r=new Map,n=new Map,i={};Object.keys(t).forEach((s=>{i[s]=t[s].map((({name:e,type:r})=>{let{base:n,index:s}=R(r);return"int"!==n||t.int||(n="int256"),"uint"!==n||t.uint||(n="uint256"),{name:e,type:n+(s||"")}})),e.set(s,new Set),r.set(s,[]),n.set(s,new Set)})),this.#t=JSON.stringify(i);for(const o in i){const n=new Set;for(const a of i[o]){(0,s.MR)(!n.has(a.name),`duplicate variable name ${JSON.stringify(a.name)} in ${JSON.stringify(o)}`,"types",t),n.add(a.name);const i=R(a.type).base;(0,s.MR)(i!==o,`circular type reference to ${JSON.stringify(i)}`,"types",t);E(i)||((0,s.MR)(r.has(i),`unknown type ${JSON.stringify(i)}`,"types",t),r.get(i).push(o),e.get(o).add(i))}}const a=Array.from(r.keys()).filter((t=>0===r.get(t).length));(0,s.MR)(0!==a.length,"missing primary type","types",t),(0,s.MR)(1===a.length,`ambiguous primary types or unused types: ${a.map((t=>JSON.stringify(t))).join(", ")}`,"types",t),(0,h.n)(this,{primaryType:a[0]}),function i(a,o){(0,s.MR)(!o.has(a),`circular type reference to ${JSON.stringify(a)}`,"types",t),o.add(a);for(const t of e.get(a))if(r.has(t)){i(t,o);for(const e of o)n.get(e).add(t)}o.delete(a)}(this.primaryType,new Set);for(const[s,o]of n){const t=Array.from(o);t.sort(),this.#e.set(s,k(s,i[s])+t.map((t=>k(t,i[t]))).join(""))}}getEncoder(t){let e=this.#r.get(t);return e||(e=this.#n(t),this.#r.set(t,e)),e}#n(t){{const e=E(t);if(e)return e}const e=R(t).array;if(e){const t=e.prefix,r=this.getEncoder(t);return n=>{(0,s.MR)(-1===e.count||e.count===n.length,`array length mismatch; expected length ${e.count}`,"value",n);let i=n.map(r);return this.#e.has(t)&&(i=i.map(c.S)),(0,c.S)((0,l.xW)(i))}}const r=this.types[t];if(r){const e=(0,d.id)(this.#e.get(t));return t=>{const n=r.map((({name:e,type:r})=>{const n=this.getEncoder(r)(t[e]);return this.#e.has(r)?(0,c.S)(n):n}));return n.unshift(e),(0,l.xW)(n)}}(0,s.MR)(!1,`unknown type: ${t}`,"type",t)}encodeType(t){const e=this.#e.get(t);return(0,s.MR)(e,`unknown type: ${JSON.stringify(t)}`,"name",t),e}encodeData(t,e){return this.getEncoder(t)(e)}hashStruct(t,e){return(0,c.S)(this.encodeData(t,e))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,e,r){if(E(t))return r(t,e);const n=R(t).array;if(n)return(0,s.MR)(-1===n.count||n.count===e.length,`array length mismatch; expected length ${n.count}`,"value",e),e.map((t=>this._visit(n.prefix,t,r)));const i=this.types[t];if(i)return i.reduce(((t,{name:n,type:s})=>(t[n]=this._visit(s,e[n],r),t)),{});(0,s.MR)(!1,`unknown type: ${t}`,"type",t)}visit(t,e){return this._visit(this.primaryType,t,e)}static from(t){return new I(t)}static getPrimaryType(t){return I.from(t).primaryType}static hashStruct(t,e,r){return I.from(e).hashStruct(t,r)}static hashDomain(t){const e=[];for(const r in t){if(null==t[r])continue;const n=v[r];(0,s.MR)(n,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",t),e.push({name:r,type:n})}return e.sort(((t,e)=>x.indexOf(t.name)-x.indexOf(e.name))),I.hashStruct("EIP712Domain",{EIP712Domain:e},t)}static encode(t,e,r){return(0,l.xW)(["0x1901",I.hashDomain(t),I.from(e).hash(r)])}static hash(t,e,r){return(0,c.S)(I.encode(t,e,r))}static async resolveNames(t,e,r,n){t=Object.assign({},t);for(const a in t)null==t[a]&&delete t[a];const s={};t.verifyingContract&&!(0,l.Lo)(t.verifyingContract,20)&&(s[t.verifyingContract]="0x");const i=I.from(e);i.visit(r,((t,e)=>("address"!==t||(0,l.Lo)(e,20)||(s[e]="0x"),e)));for(const a in s)s[a]=await n(a);return t.verifyingContract&&s[t.verifyingContract]&&(t.verifyingContract=s[t.verifyingContract]),{domain:t,value:r=i.visit(r,((t,e)=>"address"===t&&s[e]?s[e]:e))}}static getPayload(t,e,r){I.hashDomain(t);const n={},i=[];x.forEach((e=>{const r=t[e];null!=r&&(n[e]=P[e](r),i.push({name:e,type:v[e]}))}));const a=I.from(e);e=a.types;const o=Object.assign({},e);return(0,s.MR)(null==o.EIP712Domain,"types must not contain EIP712Domain type","types.EIP712Domain",e),o.EIP712Domain=i,a.encode(r),{types:o,domain:n,primaryType:a.primaryType,message:a.visit(r,((t,e)=>{if(t.match(/^bytes(\d*)/))return(0,l.c$)((0,l.q5)(e));if(t.match(/^u?int/))return(0,u.Ab)(e).toString();switch(t){case"address":return e.toLowerCase();case"bool":return!!e;case"string":return(0,s.MR)("string"===typeof e,"invalid string","value",e),e}(0,s.MR)(!1,"unsupported type","type",t)}))}}}var N=r(55860),S=r(33206);function T(t){return async function(t,e){(0,s.vA)(null==e||!e.cancelled,"request cancelled before sending","CANCELLED");const r=t.url.split(":")[0].toLowerCase();(0,s.vA)("http"===r||"https"===r,`unsupported protocol ${r}`,"UNSUPPORTED_OPERATION",{info:{protocol:r},operation:"request"}),(0,s.vA)("https"===r||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let n=null;const i=new AbortController,a=setTimeout((()=>{n=(0,s.xz)("request timeout","TIMEOUT"),i.abort()}),t.timeout);e&&e.addListener((()=>{n=(0,s.xz)("request cancelled","CANCELLED"),i.abort()}));const o={method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:i.signal};let c;try{c=await fetch(t.url,o)}catch(d){if(clearTimeout(a),n)throw n;throw d}clearTimeout(a);const l={};c.headers.forEach(((t,e)=>{l[e.toLowerCase()]=t}));const u=await c.arrayBuffer(),h=null==u?null:new Uint8Array(u);return{statusCode:c.status,statusMessage:c.statusText,headers:l,body:h}}}T();let O=T();const B=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),L=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let F=!1;async function C(t,e){try{const e=t.match(B);if(!e)throw new Error("invalid data");return new H(200,"OK",{"content-type":e[1]||"text/plain"},e[2]?function(t){t=atob(t);const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return(0,l.q5)(e)}(e[3]):(r=e[3],(0,S.YW)(r.replace(/%([0-9a-f][0-9a-f])/gi,((t,e)=>String.fromCharCode(parseInt(e,16)))))))}catch(n){return new H(599,"BAD REQUEST (invalid data: URI)",{},null,new M(t))}var r}function _(t){return async function(e,r){try{const r=e.match(L);if(!r)throw new Error("invalid link");return new M(`${t}${r[2]}`)}catch(n){return new H(599,"BAD REQUEST (invalid IPFS URI)",{},null,new M(e))}}}const G={data:C,ipfs:_("https://gateway.ipfs.io/ipfs/")},U=new WeakMap;class ${#s;#i;constructor(t){this.#s=[],this.#i=!1,U.set(t,(()=>{if(!this.#i){this.#i=!0;for(const t of this.#s)setTimeout((()=>{t()}),0);this.#s=[]}}))}addListener(t){(0,s.vA)(!this.#i,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#s.push(t)}get cancelled(){return this.#i}checkSignal(){(0,s.vA)(!this.cancelled,"cancelled","CANCELLED",{})}}function D(t){if(null==t)throw new Error("missing signal; should not happen");return t.checkSignal(),t}class M{#a;#o;#c;#l;#u;#h;#d;#f;#p;#g;#y;#m;#b;#w;#v;get url(){return this.#h}set url(t){this.#h=String(t)}get body(){return null==this.#d?null:new Uint8Array(this.#d)}set body(t){if(null==t)this.#d=void 0,this.#f=void 0;else if("string"===typeof t)this.#d=(0,S.YW)(t),this.#f="text/plain";else if(t instanceof Uint8Array)this.#d=t,this.#f="application/octet-stream";else{if("object"!==typeof t)throw new Error("invalid body");this.#d=(0,S.YW)(JSON.stringify(t)),this.#f="application/json"}}hasBody(){return null!=this.#d}get method(){return this.#l?this.#l:this.hasBody()?"POST":"GET"}set method(t){null==t&&(t=""),this.#l=String(t).toUpperCase()}get headers(){const t=Object.assign({},this.#c);return this.#p&&(t.authorization=`Basic ${function(t){const e=(0,l.q5)(t);let r="";for(let n=0;n<e.length;n++)r+=String.fromCharCode(e[n]);return btoa(r)}((0,S.YW)(this.#p))}`),this.allowGzip&&(t["accept-encoding"]="gzip"),null==t["content-type"]&&this.#f&&(t["content-type"]=this.#f),this.body&&(t["content-length"]=String(this.body.length)),t}getHeader(t){return this.headers[t.toLowerCase()]}setHeader(t,e){this.#c[String(t).toLowerCase()]=String(e)}clearHeaders(){this.#c={}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let r=0;return{next:()=>{if(r<e.length){const n=e[r++];return{value:[n,t[n]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#p||null}setCredentials(t,e){(0,s.MR)(!t.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#p=`${t}:${e}`}get allowGzip(){return this.#o}set allowGzip(t){this.#o=!!t}get allowInsecureAuthentication(){return!!this.#a}set allowInsecureAuthentication(t){this.#a=!!t}get timeout(){return this.#u}set timeout(t){(0,s.MR)(t>=0,"timeout must be non-zero","timeout",t),this.#u=t}get preflightFunc(){return this.#g||null}set preflightFunc(t){this.#g=t}get processFunc(){return this.#y||null}set processFunc(t){this.#y=t}get retryFunc(){return this.#m||null}set retryFunc(t){this.#m=t}get getUrlFunc(){return this.#v||O}set getUrlFunc(t){this.#v=t}constructor(t){this.#h=String(t),this.#a=!1,this.#o=!0,this.#c={},this.#l="",this.#u=3e5,this.#w={slotInterval:250,maxAttempts:12},this.#v=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#d?(0,l.c$)(this.#d):"null"}>`}setThrottleParams(t){null!=t.slotInterval&&(this.#w.slotInterval=t.slotInterval),null!=t.maxAttempts&&(this.#w.maxAttempts=t.maxAttempts)}async#x(t,e,r,n,i){if(t>=this.#w.maxAttempts)return i.makeServerError("exceeded maximum retry limit");(0,s.vA)(q()<=e,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:n}),r>0&&await function(t){return new Promise((e=>setTimeout(e,t)))}(r);let a=this.clone();const o=(a.url.split(":")[0]||"").toLowerCase();if(o in G){const t=await G[o](a.url,D(n.#b));if(t instanceof H){let e=t;if(this.processFunc){D(n.#b);try{e=await this.processFunc(a,e)}catch(u){null!=u.throttle&&"number"===typeof u.stall||e.makeServerError("error in post-processing function",u).assertOk()}}return e}a=t}this.preflightFunc&&(a=await this.preflightFunc(a));const c=await this.getUrlFunc(a,D(n.#b));let l=new H(c.statusCode,c.statusMessage,c.headers,c.body,n);if(301===l.statusCode||302===l.statusCode){try{const r=l.headers.location||"";return a.redirect(r).#x(t+1,e,0,n,l)}catch(u){}return l}if(429===l.statusCode&&(null==this.retryFunc||await this.retryFunc(a,l,t))){const r=l.headers["retry-after"];let s=this.#w.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return"string"===typeof r&&r.match(/^[1-9][0-9]*$/)&&(s=parseInt(r)),a.clone().#x(t+1,e,s,n,l)}if(this.processFunc){D(n.#b);try{l=await this.processFunc(a,l)}catch(u){null!=u.throttle&&"number"===typeof u.stall||l.makeServerError("error in post-processing function",u).assertOk();let r=this.#w.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return u.stall>=0&&(r=u.stall),a.clone().#x(t+1,e,r,n,l)}}return l}send(){return(0,s.vA)(null==this.#b,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#b=new $(this),this.#x(0,q()+this.timeout,0,this,new H(0,"",{},null,this))}cancel(){(0,s.vA)(null!=this.#b,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const t=U.get(this);if(!t)throw new Error("missing signal; should not happen");t()}redirect(t){const e=this.url.split(":")[0].toLowerCase(),r=t.split(":")[0].toLowerCase();(0,s.vA)("GET"===this.method&&("https"!==e||"http"!==r)&&t.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(t)})`});const n=new M(t);return n.method="GET",n.allowGzip=this.allowGzip,n.timeout=this.timeout,n.#c=Object.assign({},this.#c),this.#d&&(n.#d=new Uint8Array(this.#d)),n.#f=this.#f,n}clone(){const t=new M(this.url);return t.#l=this.#l,this.#d&&(t.#d=this.#d),t.#f=this.#f,t.#c=Object.assign({},this.#c),t.#p=this.#p,this.allowGzip&&(t.allowGzip=!0),t.timeout=this.timeout,this.allowInsecureAuthentication&&(t.allowInsecureAuthentication=!0),t.#g=this.#g,t.#y=this.#y,t.#m=this.#m,t.#w=Object.assign({},this.#w),t.#v=this.#v,t}static lockConfig(){F=!0}static getGateway(t){return G[t.toLowerCase()]||null}static registerGateway(t,e){if("http"===(t=t.toLowerCase())||"https"===t)throw new Error(`cannot intercept ${t}; use registerGetUrl`);if(F)throw new Error("gateways locked");G[t]=e}static registerGetUrl(t){if(F)throw new Error("gateways locked");O=t}static createGetUrlFunc(t){return T()}static createDataGateway(){return C}static createIpfsGatewayFunc(t){return _(t)}}class H{#A;#P;#c;#d;#E;#k;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#d?(0,l.c$)(this.#d):"null"}>`}get statusCode(){return this.#A}get statusMessage(){return this.#P}get headers(){return Object.assign({},this.#c)}get body(){return null==this.#d?null:new Uint8Array(this.#d)}get bodyText(){try{return null==this.#d?"":(0,S._v)(this.#d)}catch(t){(0,s.vA)(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch(t){(0,s.vA)(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let r=0;return{next:()=>{if(r<e.length){const n=e[r++];return{value:[n,t[n]],done:!1}}return{value:void 0,done:!0}}}}constructor(t,e,r,n,s){this.#A=t,this.#P=e,this.#c=Object.keys(r).reduce(((t,e)=>(t[e.toLowerCase()]=String(r[e]),t)),{}),this.#d=null==n?null:new Uint8Array(n),this.#E=s||null,this.#k={message:""}}makeServerError(t,e){let r;r=t?`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${t})`:`CLIENT ESCALATED SERVER ERROR (${t=`${this.statusCode} ${this.statusMessage}`})`;const n=new H(599,r,this.headers,this.body,this.#E||void 0);return n.#k={message:t,error:e},n}throwThrottleError(t,e){null==e?e=-1:(0,s.MR)(Number.isInteger(e)&&e>=0,"invalid stall timeout","stall",e);const r=new Error(t||"throttling requests");throw(0,h.n)(r,{stall:e,throttle:!0}),r}getHeader(t){return this.headers[t.toLowerCase()]}hasBody(){return null!=this.#d}get request(){return this.#E}ok(){return""===this.#k.message&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:t,error:e}=this.#k;""===t&&(t=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let n=null;try{this.#d&&(n=(0,S._v)(this.#d))}catch(i){}(0,s.vA)(!1,t,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:e,info:{requestUrl:r,responseBody:n,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function q(){return(new Date).getTime()}const z="0x0000000000000000000000000000000000000000";var V=r(12235),Z=r(79205);const W=new Uint8Array(32);function j(t){return(0,s.MR)(0!==t.length,"invalid ENS name; empty component","comp",t),t}function J(t){const e=(0,S.YW)(function(t){try{if(0===t.length)throw new Error("empty label");return(0,Z.tt)(t)}catch(e){(0,s.MR)(!1,`invalid ENS name (${e.message})`,"name",t)}}(t)),r=[];if(0===t.length)return r;let n=0;for(let s=0;s<e.length;s++){46===e[s]&&(r.push(j(e.slice(n,s))),n=s+1)}return(0,s.MR)(n<e.length,"invalid ENS name; empty component","name",t),r.push(j(e.slice(n))),r}function K(t){(0,s.MR)("string"===typeof t,"invalid ENS name; not a string","name",t),(0,s.MR)(t.length,"invalid ENS name (empty label)","name",t);let e=W;const r=J(t);for(;r.length;)e=(0,c.S)((0,l.xW)([e,(0,c.S)(r.pop())]));return(0,l.c$)(e)}function Y(t,e){const r=null!=e?e:63;return(0,s.MR)(r<=255,"DNS encoded label cannot exceed 255","length",r),(0,l.c$)((0,l.xW)(J(t).map((e=>{(0,s.MR)(e.length<=r,`label ${JSON.stringify(t)} exceeds ${r} bytes`,"name",t);const n=new Uint8Array(e.length+1);return n.set(e,1),n[0]=n.length-1,n}))))+"00"}W.fill(0);var X=r(60556),Q=r(40614);class tt extends Q.Vw{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,Q.O8)(this.buffer)}update(t){(0,X.t2)(this);const{view:e,buffer:r,blockLen:n}=this,s=(t=(0,Q.ZJ)(t)).length;for(let i=0;i<s;){const a=Math.min(n-this.pos,s-i);if(a!==n)r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=(0,Q.O8)(t);for(;n<=s-i;i+=n)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){(0,X.t2)(this),(0,X.CG)(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:n,isLE:s}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let u=i;u<n;u++)e[u]=0;!function(t,e,r,n){if("function"===typeof t.setBigUint64)return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),a=Number(r>>s&i),o=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,a,n),t.setUint32(e+l,o,n)}(r,n-8,BigInt(8*this.length),s),this.process(r,0);const a=(0,Q.O8)(t),o=this.outputLen;if(o%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=o/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)a.setUint32(4*u,l[u],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:s,destroyed:i,pos:a}=this;return t.length=n,t.pos=a,t.finished=s,t.destroyed=i,n%e&&t.buffer.set(r),t}}const et=(t,e,r)=>t&e^t&r^e&r,rt=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),nt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),st=new Uint32Array(64);class it extends tt{constructor(){super(64,32,8,!1),this.A=0|nt[0],this.B=0|nt[1],this.C=0|nt[2],this.D=0|nt[3],this.E=0|nt[4],this.F=0|nt[5],this.G=0|nt[6],this.H=0|nt[7]}get(){const{A:t,B:e,C:r,D:n,E:s,F:i,G:a,H:o}=this;return[t,e,r,n,s,i,a,o]}set(t,e,r,n,s,i,a,o){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|s,this.F=0|i,this.G=0|a,this.H=0|o}process(t,e){for(let h=0;h<16;h++,e+=4)st[h]=t.getUint32(e,!1);for(let h=16;h<64;h++){const t=st[h-15],e=st[h-2],r=(0,Q.Ow)(t,7)^(0,Q.Ow)(t,18)^t>>>3,n=(0,Q.Ow)(e,17)^(0,Q.Ow)(e,19)^e>>>10;st[h]=n+st[h-7]+r+st[h-16]|0}let{A:r,B:n,C:s,D:i,E:a,F:o,G:c,H:l}=this;for(let h=0;h<64;h++){const t=l+((0,Q.Ow)(a,6)^(0,Q.Ow)(a,11)^(0,Q.Ow)(a,25))+((u=a)&o^~u&c)+rt[h]+st[h]|0,e=((0,Q.Ow)(r,2)^(0,Q.Ow)(r,13)^(0,Q.Ow)(r,22))+et(r,n,s)|0;l=c,c=o,o=a,a=i+t|0,i=s,s=n,n=r,r=t+e|0}var u;r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,o=o+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,n,s,i,a,o,c,l)}roundClean(){st.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const at=(0,Q.ld)((()=>new it));var ot=r(59473);const[ct,lt]=(()=>ot.Ay.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))))(),ut=new Uint32Array(80),ht=new Uint32Array(80);class dt extends tt{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:n,Ch:s,Cl:i,Dh:a,Dl:o,Eh:c,El:l,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[t,e,r,n,s,i,a,o,c,l,u,h,d,f,p,g]}set(t,e,r,n,s,i,a,o,c,l,u,h,d,f,p,g){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|n,this.Ch=0|s,this.Cl=0|i,this.Dh=0|a,this.Dl=0|o,this.Eh=0|c,this.El=0|l,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(t,e){for(let b=0;b<16;b++,e+=4)ut[b]=t.getUint32(e),ht[b]=t.getUint32(e+=4);for(let b=16;b<80;b++){const t=0|ut[b-15],e=0|ht[b-15],r=ot.Ay.rotrSH(t,e,1)^ot.Ay.rotrSH(t,e,8)^ot.Ay.shrSH(t,e,7),n=ot.Ay.rotrSL(t,e,1)^ot.Ay.rotrSL(t,e,8)^ot.Ay.shrSL(t,e,7),s=0|ut[b-2],i=0|ht[b-2],a=ot.Ay.rotrSH(s,i,19)^ot.Ay.rotrBH(s,i,61)^ot.Ay.shrSH(s,i,6),o=ot.Ay.rotrSL(s,i,19)^ot.Ay.rotrBL(s,i,61)^ot.Ay.shrSL(s,i,6),c=ot.Ay.add4L(n,o,ht[b-7],ht[b-16]),l=ot.Ay.add4H(c,r,a,ut[b-7],ut[b-16]);ut[b]=0|l,ht[b]=0|c}let{Ah:r,Al:n,Bh:s,Bl:i,Ch:a,Cl:o,Dh:c,Dl:l,Eh:u,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:m}=this;for(let b=0;b<80;b++){const t=ot.Ay.rotrSH(u,h,14)^ot.Ay.rotrSH(u,h,18)^ot.Ay.rotrBH(u,h,41),e=ot.Ay.rotrSL(u,h,14)^ot.Ay.rotrSL(u,h,18)^ot.Ay.rotrBL(u,h,41),w=u&d^~u&p,v=h&f^~h&g,x=ot.Ay.add5L(m,e,v,lt[b],ht[b]),A=ot.Ay.add5H(x,y,t,w,ct[b],ut[b]),P=0|x,E=ot.Ay.rotrSH(r,n,28)^ot.Ay.rotrBH(r,n,34)^ot.Ay.rotrBH(r,n,39),k=ot.Ay.rotrSL(r,n,28)^ot.Ay.rotrBL(r,n,34)^ot.Ay.rotrBL(r,n,39),R=r&s^r&a^s&a,I=n&i^n&o^i&o;y=0|p,m=0|g,p=0|d,g=0|f,d=0|u,f=0|h,({h:u,l:h}=ot.Ay.add(0|c,0|l,0|A,0|P)),c=0|a,l=0|o,a=0|s,o=0|i,s=0|r,i=0|n;const N=ot.Ay.add3L(P,k,I);r=ot.Ay.add3H(N,A,E,R),n=0|N}({h:r,l:n}=ot.Ay.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:s,l:i}=ot.Ay.add(0|this.Bh,0|this.Bl,0|s,0|i)),({h:a,l:o}=ot.Ay.add(0|this.Ch,0|this.Cl,0|a,0|o)),({h:c,l:l}=ot.Ay.add(0|this.Dh,0|this.Dl,0|c,0|l)),({h:u,l:h}=ot.Ay.add(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l:f}=ot.Ay.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=ot.Ay.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:m}=ot.Ay.add(0|this.Hh,0|this.Hl,0|y,0|m)),this.set(r,n,s,i,a,o,c,l,u,h,d,f,p,g,y,m)}roundClean(){ut.fill(0),ht.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ft=(0,Q.ld)((()=>new dt));const pt=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof global)return global;throw new Error("unable to locate global object")}();pt.crypto||pt.msCrypto;function gt(t){switch(t){case"sha256":return at.create();case"sha512":return ft.create()}(0,s.MR)(!1,"invalid hashing algorithm name","algorithm",t)}const yt=function(t){return gt("sha256").update(t).digest()},mt=function(t){return gt("sha512").update(t).digest()};let bt=yt,wt=mt,vt=!1,xt=!1;function At(t){const e=(0,l.q5)(t,"data");return(0,l.c$)(bt(e))}function Pt(t){const e=(0,l.q5)(t,"data");return(0,l.c$)(wt(e))}At._=yt,At.lock=function(){vt=!0},At.register=function(t){if(vt)throw new Error("sha256 is locked");bt=t},Object.freeze(At),Pt._=mt,Pt.lock=function(){xt=!0},Pt.register=function(t){if(xt)throw new Error("sha512 is locked");wt=t},Object.freeze(At);const Et="0x0000000000000000000000000000000000000000000000000000000000000000",kt=BigInt(0),Rt=BigInt(1),It=BigInt(2),Nt=BigInt(27),St=BigInt(28),Tt=BigInt(35),Ot={};function Bt(t){return(0,l.nx)((0,u.c4)(t),32)}class Lt{#R;#I;#N;#S;get r(){return this.#R}set r(t){(0,s.MR)(32===(0,l.pO)(t),"invalid r","value",t),this.#R=(0,l.c$)(t)}get s(){return this.#I}set s(t){(0,s.MR)(32===(0,l.pO)(t),"invalid s","value",t);const e=(0,l.c$)(t);(0,s.MR)(parseInt(e.substring(0,3))<8,"non-canonical s","value",e),this.#I=e}get v(){return this.#N}set v(t){const e=(0,u.WZ)(t,"value");(0,s.MR)(27===e||28===e,"invalid v","v",t),this.#N=e}get networkV(){return this.#S}get legacyChainId(){const t=this.networkV;return null==t?null:Lt.getChainId(t)}get yParity(){return 27===this.v?0:1}get yParityAndS(){const t=(0,l.q5)(this.s);return this.yParity&&(t[0]|=128),(0,l.c$)(t)}get compactSerialized(){return(0,l.xW)([this.r,this.yParityAndS])}get serialized(){return(0,l.xW)([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(t,e,r,n){(0,s.gk)(t,Ot,"Signature"),this.#R=e,this.#I=r,this.#N=n,this.#S=null}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this.s}", yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const t=new Lt(Ot,this.r,this.s,this.v);return this.networkV&&(t.#S=this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:null!=t?t.toString():null,r:this.r,s:this.s,v:this.v}}static getChainId(t){const e=(0,u.Ab)(t,"v");return e==Nt||e==St?kt:((0,s.MR)(e>=Tt,"invalid EIP-155 v","v",t),(e-Tt)/It)}static getChainIdV(t,e){return(0,u.Ab)(t)*It+BigInt(35+e-27)}static getNormalizedV(t){const e=(0,u.Ab)(t);return e===kt||e===Nt?27:e===Rt||e===St?28:((0,s.MR)(e>=Tt,"invalid v","v",t),e&Rt?27:28)}static from(t){function e(e,r){(0,s.MR)(e,r,"signature",t)}if(null==t)return new Lt(Ot,Et,Et,27);if("string"===typeof t){const r=(0,l.q5)(t,"signature");if(64===r.length){const t=(0,l.c$)(r.slice(0,32)),e=r.slice(32,64),n=128&e[0]?28:27;return e[0]&=127,new Lt(Ot,t,(0,l.c$)(e),n)}if(65===r.length){const t=(0,l.c$)(r.slice(0,32)),n=r.slice(32,64);e(0===(128&n[0]),"non-canonical s");const s=Lt.getNormalizedV(r[64]);return new Lt(Ot,t,(0,l.c$)(n),s)}e(!1,"invalid raw signature length")}if(t instanceof Lt)return t.clone();const r=t.r;e(null!=r,"missing r");const n=Bt(r),i=function(t,r){if(null!=t)return Bt(t);if(null!=r){e((0,l.Lo)(r,32),"invalid yParityAndS");const t=(0,l.q5)(r);return t[0]&=127,(0,l.c$)(t)}e(!1,"missing s")}(t.s,t.yParityAndS);e(0==(128&(0,l.q5)(i)[0]),"non-canonical s");const{networkV:a,v:o}=function(t,r,n){if(null!=t){const e=(0,u.Ab)(t);return{networkV:e>=Tt?e:void 0,v:Lt.getNormalizedV(e)}}if(null!=r)return e((0,l.Lo)(r,32),"invalid yParityAndS"),{v:128&(0,l.q5)(r)[0]?28:27};if(null!=n){switch((0,u.WZ)(n,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}e(!1,"invalid yParity")}e(!1,"missing v")}(t.v,t.yParityAndS,t.yParity),c=new Lt(Ot,n,i,o);return a&&(c.#S=a),e(null==t.yParity||(0,u.WZ)(t.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),e(null==t.yParityAndS||t.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}}BigInt(0);const Ft=BigInt(1),Ct=BigInt(2),_t=t=>t instanceof Uint8Array,Gt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Ut(t){if(!_t(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=Gt[t[r]];return e}function $t(t){if("string"!==typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function Dt(t){if("string"!==typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(e/2);for(let n=0;n<r.length;n++){const e=2*n,s=t.slice(e,e+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function Mt(t){return $t(Ut(t))}function Ht(t){if(!_t(t))throw new Error("Uint8Array expected");return $t(Ut(Uint8Array.from(t).reverse()))}function qt(t,e){return Dt(t.toString(16).padStart(2*e,"0"))}function zt(t,e){return qt(t,e).reverse()}function Vt(t,e,r){let n;if("string"===typeof e)try{n=Dt(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else{if(!_t(e))throw new Error(`${t} must be hex string or Uint8Array`);n=Uint8Array.from(e)}const s=n.length;if("number"===typeof r&&s!==r)throw new Error(`${t} expected ${r} bytes, got ${s}`);return n}function Zt(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let r=0;return t.forEach((t=>{if(!_t(t))throw new Error("Uint8Array expected");e.set(t,r),r+=t.length})),e}const Wt=t=>(Ct<<BigInt(t-1))-Ft,jt=t=>new Uint8Array(t),Jt=t=>Uint8Array.from(t);function Kt(t,e,r){if("number"!==typeof t||t<2)throw new Error("hashLen must be a number");if("number"!==typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!==typeof r)throw new Error("hmacFn must be a function");let n=jt(t),s=jt(t),i=0;const a=()=>{n.fill(1),s.fill(0),i=0},o=(...t)=>r(s,n,...t),c=(t=jt())=>{s=o(Jt([0]),t),n=o(),0!==t.length&&(s=o(Jt([1]),t),n=o())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const r=[];for(;t<e;){n=o();const e=n.slice();r.push(e),t+=n.length}return Zt(...r)};return(t,e)=>{let r;for(a(),c(t);!(r=e(l()));)c();return a(),r}}const Yt={bigint:t=>"bigint"===typeof t,function:t=>"function"===typeof t,boolean:t=>"boolean"===typeof t,string:t=>"string"===typeof t,stringOrUint8Array:t=>"string"===typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"===typeof t&&Number.isSafeInteger(t.outputLen)};function Xt(t,e,r={}){const n=(e,r,n)=>{const s=Yt[r];if("function"!==typeof s)throw new Error(`Invalid validator "${r}", expected function`);const i=t[e];if((!n||void 0!==i)&&!s(i,t))throw new Error(`Invalid param ${String(e)}=${i} (${typeof i}), expected ${r}`)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}const Qt=BigInt(0),te=BigInt(1),ee=BigInt(2),re=BigInt(3),ne=BigInt(4),se=BigInt(5),ie=BigInt(8);BigInt(9),BigInt(16);function ae(t,e){const r=t%e;return r>=Qt?r:e+r}function oe(t,e,r){if(r<=Qt||e<Qt)throw new Error("Expected power/modulo > 0");if(r===te)return Qt;let n=te;for(;e>Qt;)e&te&&(n=n*t%r),t=t*t%r,e>>=te;return n}function ce(t,e,r){let n=t;for(;e-- >Qt;)n*=n,n%=r;return n}function le(t,e){if(t===Qt||e<=Qt)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=ae(t,e),n=e,s=Qt,i=te,a=te,o=Qt;for(;r!==Qt;){const t=n/r,e=n%r,c=s-a*t,l=i-o*t;n=r,r=e,s=a,i=o,a=c,o=l}if(n!==te)throw new Error("invert: does not exist");return ae(s,e)}function ue(t){if(t%ne===re){const e=(t+te)/ne;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}if(t%ie===se){const e=(t-se)/ie;return function(t,r){const n=t.mul(r,ee),s=t.pow(n,e),i=t.mul(r,s),a=t.mul(t.mul(i,ee),s),o=t.mul(i,t.sub(a,t.ONE));if(!t.eql(t.sqr(o),r))throw new Error("Cannot find square root");return o}}return function(t){const e=(t-te)/ee;let r,n,s;for(r=t-te,n=0;r%ee===Qt;r/=ee,n++);for(s=ee;s<t&&oe(s,e,t)!==t-te;s++);if(1===n){const e=(t+te)/ne;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}const i=(r+te)/ee;return function(t,a){if(t.pow(a,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let o=n,c=t.pow(t.mul(t.ONE,s),r),l=t.pow(a,i),u=t.pow(a,r);for(;!t.eql(u,t.ONE);){if(t.eql(u,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(u);e<o&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const r=t.pow(c,te<<BigInt(o-e-1));c=t.sqr(r),l=t.mul(l,r),u=t.mul(u,c),o=e}return l}}(t)}const he=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function de(t,e){const r=void 0!==e?e:t.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function fe(t){if("bigint"!==typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function pe(t){const e=fe(t);return e+Math.ceil(e/2)}class ge extends Q.Vw{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,(0,X.tW)(t);const r=(0,Q.ZJ)(e);if(this.iHash=t.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return(0,X.t2)(this),this.iHash.update(t),this}digestInto(t){(0,X.t2)(this),(0,X.ee)(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:s,blockLen:i,outputLen:a}=this;return t.finished=n,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ye=(t,e,r)=>new ge(t,e).update(r).digest();ye.create=(t,e)=>new ge(t,e);const me=BigInt(0),be=BigInt(1);function we(t){return Xt(t.Fp,he.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Xt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...de(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:ve,aT:xe}=n,Ae={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Ae;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const r=t[1],n=t.subarray(2,r+2);if(!r||n.length!==r)throw new e("Invalid signature integer: wrong length");if(128&n[0])throw new e("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ve(n),l:t.subarray(r+2)}},toSig(t){const{Err:e}=Ae,r="string"===typeof t?xe(t):t;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||48!=r[0])throw new e("Invalid signature tag");if(r[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=Ae._parseInt(r.subarray(2)),{d:a,l:o}=Ae._parseInt(i);if(o.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:a}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,r=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},n=e(r(t.s)),s=e(r(t.r)),i=n.length/2,a=s.length/2,o=r(i),c=r(a);return`30${r(a+i+4)}02${c}${s}02${o}${n}`}},Pe=BigInt(0),Ee=BigInt(1),ke=(BigInt(2),BigInt(3));BigInt(4);function Re(t){const e=function(t){const e=we(t);Xt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof r||"bigint"!==typeof r.beta||"function"!==typeof r.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:r}=e,n=e.toBytes||((t,e,n)=>{const s=e.toAffine();return Zt(Uint8Array.from([4]),r.toBytes(s.x),r.toBytes(s.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:r.fromBytes(e.subarray(0,r.BYTES)),y:r.fromBytes(e.subarray(r.BYTES,2*r.BYTES))}});function i(t){const{a:n,b:s}=e,i=r.sqr(t),a=r.mul(i,t);return r.add(r.add(a,r.mul(t,n)),s)}if(!r.eql(r.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function a(t){return"bigint"===typeof t&&Pe<t&&t<e.n}function o(t){if(!a(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:s,n:i}=e;if(r&&"bigint"!==typeof t){if(t instanceof Uint8Array&&(t=Ut(t)),"string"!==typeof t||!r.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*n,"0")}let a;try{a="bigint"===typeof t?t:Mt(Vt("private key",t,n))}catch(c){throw new Error(`private key must be ${n} bytes, hex or bigint, not ${typeof t}`)}return s&&(a=ae(a,i)),o(a),a}const l=new Map;function u(t){if(!(t instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(t,e,n){if(this.px=t,this.py=e,this.pz=n,null==t||!r.isValid(t))throw new Error("x required");if(null==e||!r.isValid(e))throw new Error("y required");if(null==n||!r.isValid(n))throw new Error("z required")}static fromAffine(t){const{x:e,y:n}=t||{};if(!t||!r.isValid(e)||!r.isValid(n))throw new Error("invalid affine point");if(t instanceof h)throw new Error("projective point not allowed");const s=t=>r.eql(t,r.ZERO);return s(e)&&s(n)?h.ZERO:new h(e,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(h.fromAffine)}static fromHex(t){const e=h.fromAffine(s(Vt("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return h.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:n}=this.toAffine();if(!r.isValid(t)||!r.isValid(n))throw new Error("bad point: x or y not FE");const s=r.sqr(n),a=i(t);if(!r.eql(s,a))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(r.isOdd)return!r.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){u(t);const{px:e,py:n,pz:s}=this,{px:i,py:a,pz:o}=t,c=r.eql(r.mul(e,o),r.mul(i,s)),l=r.eql(r.mul(n,o),r.mul(a,s));return c&&l}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,s=r.mul(n,ke),{px:i,py:a,pz:o}=this;let c=r.ZERO,l=r.ZERO,u=r.ZERO,d=r.mul(i,i),f=r.mul(a,a),p=r.mul(o,o),g=r.mul(i,a);return g=r.add(g,g),u=r.mul(i,o),u=r.add(u,u),c=r.mul(t,u),l=r.mul(s,p),l=r.add(c,l),c=r.sub(f,l),l=r.add(f,l),l=r.mul(c,l),c=r.mul(g,c),u=r.mul(s,u),p=r.mul(t,p),g=r.sub(d,p),g=r.mul(t,g),g=r.add(g,u),u=r.add(d,d),d=r.add(u,d),d=r.add(d,p),d=r.mul(d,g),l=r.add(l,d),p=r.mul(a,o),p=r.add(p,p),d=r.mul(p,g),c=r.sub(c,d),u=r.mul(p,f),u=r.add(u,u),u=r.add(u,u),new h(c,l,u)}add(t){u(t);const{px:n,py:s,pz:i}=this,{px:a,py:o,pz:c}=t;let l=r.ZERO,d=r.ZERO,f=r.ZERO;const p=e.a,g=r.mul(e.b,ke);let y=r.mul(n,a),m=r.mul(s,o),b=r.mul(i,c),w=r.add(n,s),v=r.add(a,o);w=r.mul(w,v),v=r.add(y,m),w=r.sub(w,v),v=r.add(n,i);let x=r.add(a,c);return v=r.mul(v,x),x=r.add(y,b),v=r.sub(v,x),x=r.add(s,i),l=r.add(o,c),x=r.mul(x,l),l=r.add(m,b),x=r.sub(x,l),f=r.mul(p,v),l=r.mul(g,b),f=r.add(l,f),l=r.sub(m,f),f=r.add(m,f),d=r.mul(l,f),m=r.add(y,y),m=r.add(m,y),b=r.mul(p,b),v=r.mul(g,v),m=r.add(m,b),b=r.sub(y,b),b=r.mul(p,b),v=r.add(v,b),y=r.mul(m,v),d=r.add(d,y),y=r.mul(x,v),l=r.mul(w,l),l=r.sub(l,y),y=r.mul(w,m),f=r.mul(x,f),f=r.add(f,y),new h(l,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(h.ZERO)}wNAF(t){return f.wNAFCached(this,l,t,(t=>{const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(h.fromAffine)}))}multiplyUnsafe(t){const n=h.ZERO;if(t===Pe)return n;if(o(t),t===Ee)return this;const{endo:s}=e;if(!s)return f.unsafeLadder(this,t);let{k1neg:i,k1:a,k2neg:c,k2:l}=s.splitScalar(t),u=n,d=n,p=this;for(;a>Pe||l>Pe;)a&Ee&&(u=u.add(p)),l&Ee&&(d=d.add(p)),p=p.double(),a>>=Ee,l>>=Ee;return i&&(u=u.negate()),c&&(d=d.negate()),d=new h(r.mul(d.px,s.beta),d.py,d.pz),u.add(d)}multiply(t){o(t);let n,s,i=t;const{endo:a}=e;if(a){const{k1neg:t,k1:e,k2neg:o,k2:c}=a.splitScalar(i);let{p:l,f:u}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);l=f.constTimeNegate(t,l),d=f.constTimeNegate(o,d),d=new h(r.mul(d.px,a.beta),d.py,d.pz),n=l.add(d),s=u.add(p)}else{const{p:t,f:e}=this.wNAF(i);n=t,s=e}return h.normalizeZ([n,s])[0]}multiplyAndAddUnsafe(t,e,r){const n=h.BASE,s=(t,e)=>e!==Pe&&e!==Ee&&t.equals(n)?t.multiply(e):t.multiplyUnsafe(e),i=s(this,e).add(s(t,r));return i.is0()?void 0:i}toAffine(t){const{px:e,py:n,pz:s}=this,i=this.is0();null==t&&(t=i?r.ONE:r.inv(s));const a=r.mul(e,t),o=r.mul(n,t),c=r.mul(s,t);if(i)return{x:r.ZERO,y:r.ZERO};if(!r.eql(c,r.ONE))throw new Error("invZ was invalid");return{x:a,y:o}}isTorsionFree(){const{h:t,isTorsionFree:r}=e;if(t===Ee)return!0;if(r)return r(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:r}=e;return t===Ee?this:r?r(h,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),n(h,this,t)}toHex(t=!0){return Ut(this.toRawBytes(t))}}h.BASE=new h(e.Gx,e.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const d=e.nBitLength,f=function(t,e){const r=(t,e)=>{const r=e.negate();return t?r:e},n=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:r,unsafeLadder(e,r){let n=t.ZERO,s=e;for(;r>me;)r&be&&(n=n.add(s)),s=s.double(),r>>=be;return n},precomputeWindow(t,e){const{windows:r,windowSize:s}=n(e),i=[];let a=t,o=a;for(let n=0;n<r;n++){o=a,i.push(o);for(let t=1;t<s;t++)o=o.add(a),i.push(o);a=o.double()}return i},wNAF(e,s,i){const{windows:a,windowSize:o}=n(e);let c=t.ZERO,l=t.BASE;const u=BigInt(2**e-1),h=2**e,d=BigInt(e);for(let t=0;t<a;t++){const e=t*o;let n=Number(i&u);i>>=d,n>o&&(n-=h,i+=be);const a=e,f=e+Math.abs(n)-1,p=t%2!==0,g=n<0;0===n?l=l.add(r(p,s[a])):c=c.add(r(g,s[f]))}return{p:c,f:l}},wNAFCached(t,e,r,n){const s=t._WINDOW_SIZE||1;let i=e.get(t);return i||(i=this.precomputeWindow(t,s),1!==s&&e.set(t,n(i))),this.wNAF(s,i,r)}}}(h,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:a}}function Ie(t){const e=function(t){const e=we(t);return Xt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:r,n:n}=e,s=r.BYTES+1,i=2*r.BYTES+1;function a(t){return ae(t,n)}function o(t){return le(t,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=Re({...e,toBytes(t,e,n){const s=e.toAffine(),i=r.toBytes(s.x),a=Zt;return n?a(Uint8Array.from([e.hasEvenY()?2:3]),i):a(Uint8Array.from([4]),i,r.toBytes(s.y))},fromBytes(t){const e=t.length,n=t[0],a=t.subarray(1);if(e!==s||2!==n&&3!==n){if(e===i&&4===n){return{x:r.fromBytes(a.subarray(0,r.BYTES)),y:r.fromBytes(a.subarray(r.BYTES,2*r.BYTES))}}throw new Error(`Point of length ${e} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}{const t=Mt(a);if(!(Pe<(o=t)&&o<r.ORDER))throw new Error("Point is not on curve");const e=u(t);let s=r.sqrt(e);return 1===(1&n)!==((s&Ee)===Ee)&&(s=r.neg(s)),{x:t,y:s}}var o}}),d=t=>Ut(qt(t,e.nByteLength));function f(t){return t>n>>Ee}const p=(t,e,r)=>Mt(t.slice(e,r));class g{constructor(t,e,r){this.r=t,this.s=e,this.recovery=r,this.assertValidity()}static fromCompact(t){const r=e.nByteLength;return t=Vt("compactSignature",t,2*r),new g(p(t,0,r),p(t,r,2*r))}static fromDER(t){const{r:e,s:r}=Ae.toSig(Vt("DER",t));return new g(e,r)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r:n,s:s,recovery:i}=this,l=w(Vt("msgHash",t));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?n+e.n:n;if(u>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0===(1&i)?"02":"03",f=c.fromHex(h+d(u)),p=o(u),g=a(-l*p),y=a(s*p),m=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Dt(this.toDERHex())}toDERHex(){return Ae.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dt(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return l(t),!0}catch(e){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const t=pe(e.n);return function(t,e,r=!1){const n=t.length,s=fe(e),i=pe(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const a=ae(r?Mt(t):Ht(t),e-te)+te;return r?zt(a,s):qt(a,s)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function m(t){const e=t instanceof Uint8Array,r="string"===typeof t,n=(e||r)&&t.length;return e?n===s||n===i:r?n===2*s||n===2*i:t instanceof c}const b=e.bits2int||function(t){const r=Mt(t),n=8*t.length-e.nBitLength;return n>0?r>>BigInt(n):r},w=e.bits2int_modN||function(t){return a(b(t))},v=Wt(e.nBitLength);function x(t){if("bigint"!==typeof t)throw new Error("bigint expected");if(!(Pe<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return qt(t,e.nByteLength)}function A(t,n,s=P){if(["recovered","canonical"].some((t=>t in s)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=e;let{lowS:d,prehash:p,extraEntropy:y}=s;null==d&&(d=!0),t=Vt("msgHash",t),p&&(t=Vt("prehashed msgHash",i(t)));const m=w(t),v=l(n),A=[x(v),x(m)];if(null!=y){const t=!0===y?u(r.BYTES):y;A.push(Vt("extraEntropy",t))}const E=Zt(...A),k=m;return{seed:E,k2sig:function(t){const e=b(t);if(!h(e))return;const r=o(e),n=c.BASE.multiply(e).toAffine(),s=a(n.x);if(s===Pe)return;const i=a(r*a(k+s*v));if(i===Pe)return;let l=(n.x===s?0:2)|Number(n.y&Ee),u=i;return d&&f(i)&&(u=function(t){return f(t)?a(-t):t}(i),l^=1),new g(s,u,l)}}}const P={lowS:e.lowS,prehash:!1},E={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,r=!0){if(m(t))throw new Error("first arg must be private key");if(!m(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(l(t)).toRawBytes(r)},sign:function(t,r,n=P){const{seed:s,k2sig:i}=A(t,r,n),a=e;return Kt(a.hash.outputLen,a.nByteLength,a.hmac)(s,i)},verify:function(t,r,n,s=E){const i=t;if(r=Vt("msgHash",r),n=Vt("publicKey",n),"strict"in s)throw new Error("options.strict was renamed to lowS");const{lowS:l,prehash:u}=s;let h,d;try{if("string"===typeof i||i instanceof Uint8Array)try{h=g.fromDER(i)}catch(A){if(!(A instanceof Ae.Err))throw A;h=g.fromCompact(i)}else{if("object"!==typeof i||"bigint"!==typeof i.r||"bigint"!==typeof i.s)throw new Error("PARSE");{const{r:t,s:e}=i;h=new g(t,e)}}d=c.fromHex(n)}catch(P){if("PARSE"===P.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&h.hasHighS())return!1;u&&(r=e.hash(r));const{r:f,s:p}=h,y=w(r),m=o(p),b=a(y*m),v=a(f*m),x=c.BASE.multiplyAndAddUnsafe(d,b,v)?.toAffine();return!!x&&a(x.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function Ne(t){return{hash:t,hmac:(e,...r)=>ye(t,e,(0,Q.Id)(...r)),randomBytes:Q.po}}const Se=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Te=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Oe=BigInt(1),Be=BigInt(2),Le=(t,e)=>(t+e/Be)/e;function Fe(t){const e=Se,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),a=BigInt(23),o=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=ce(u,r,e)*u%e,d=ce(h,r,e)*u%e,f=ce(d,Be,e)*l%e,p=ce(f,s,e)*f%e,g=ce(p,i,e)*p%e,y=ce(g,o,e)*g%e,m=ce(y,c,e)*y%e,b=ce(m,o,e)*g%e,w=ce(b,r,e)*u%e,v=ce(w,a,e)*p%e,x=ce(v,n,e)*l%e,A=ce(x,Be,e);if(!Ce.eql(Ce.sqr(A),t))throw new Error("Cannot find square root");return A}const Ce=function(t,e,r=!1,n={}){if(t<=Qt)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:i}=de(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=ue(t),o=Object.freeze({ORDER:t,BITS:s,BYTES:i,MASK:Wt(s),ZERO:Qt,ONE:te,create:e=>ae(e,t),isValid:e=>{if("bigint"!==typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return Qt<=e&&e<t},is0:t=>t===Qt,isOdd:t=>(t&te)===te,neg:e=>ae(-e,t),eql:(t,e)=>t===e,sqr:e=>ae(e*e,t),add:(e,r)=>ae(e+r,t),sub:(e,r)=>ae(e-r,t),mul:(e,r)=>ae(e*r,t),pow:(t,e)=>function(t,e,r){if(r<Qt)throw new Error("Expected power > 0");if(r===Qt)return t.ONE;if(r===te)return e;let n=t.ONE,s=e;for(;r>Qt;)r&te&&(n=t.mul(n,s)),s=t.sqr(s),r>>=te;return n}(o,t,e),div:(e,r)=>ae(e*le(r,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>le(e,t),sqrt:n.sqrt||(t=>a(o,t)),invertBatch:t=>function(t,e){const r=new Array(e.length),n=e.reduce(((e,n,s)=>t.is0(n)?e:(r[s]=e,t.mul(e,n))),t.ONE),s=t.inv(n);return e.reduceRight(((e,n,s)=>t.is0(n)?e:(r[s]=t.mul(e,r[s]),t.mul(e,n))),s),r}(o,t),cmov:(t,e,r)=>r?e:t,toBytes:t=>r?zt(t,i):qt(t,i),fromBytes:t=>{if(t.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${t.length}`);return r?Ht(t):Mt(t)}});return Object.freeze(o)}(Se,void 0,void 0,{sqrt:Fe}),_e=function(t,e){const r=e=>Ie({...t,...Ne(e)});return Object.freeze({...r(e),create:r})}({a:BigInt(0),b:BigInt(7),Fp:Ce,n:Te,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Te,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Oe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,a=BigInt("0x100000000000000000000000000000000"),o=Le(i*t,e),c=Le(-n*t,e);let l=ae(t-o*r-c*s,e),u=ae(-o*n-c*i,e);const h=l>a,d=u>a;if(h&&(l=e-l),d&&(u=e-u),l>a||u>a)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},at);BigInt(0);_e.ProjectivePoint;class Ge{#T;constructor(t){(0,s.MR)(32===(0,l.pO)(t),"invalid private key","privateKey","[REDACTED]"),this.#T=(0,l.c$)(t)}get privateKey(){return this.#T}get publicKey(){return Ge.computePublicKey(this.#T)}get compressedPublicKey(){return Ge.computePublicKey(this.#T,!0)}sign(t){(0,s.MR)(32===(0,l.pO)(t),"invalid digest length","digest",t);const e=_e.sign((0,l.Lm)(t),(0,l.Lm)(this.#T),{lowS:!0});return Lt.from({r:(0,u.up)(e.r,32),s:(0,u.up)(e.s,32),v:e.recovery?28:27})}computeSharedSecret(t){const e=Ge.computePublicKey(t);return(0,l.c$)(_e.getSharedSecret((0,l.Lm)(this.#T),(0,l.q5)(e),!1))}static computePublicKey(t,e){let r=(0,l.q5)(t,"key");if(32===r.length){const t=_e.getPublicKey(r,!!e);return(0,l.c$)(t)}if(64===r.length){const t=new Uint8Array(65);t[0]=4,t.set(r,1),r=t}const n=_e.ProjectivePoint.fromHex(r);return(0,l.c$)(n.toRawBytes(e))}static recoverPublicKey(t,e){(0,s.MR)(32===(0,l.pO)(t),"invalid digest length","digest",t);const r=Lt.from(e);let n=_e.Signature.fromCompact((0,l.Lm)((0,l.xW)([r.r,r.s])));n=n.addRecoveryBit(r.yParity);const i=n.recoverPublicKey((0,l.Lm)(t));return(0,s.MR)(null!=i,"invalid signautre for digest","signature",e),"0x"+i.toHex(!1)}static addPoints(t,e,r){const n=_e.ProjectivePoint.fromHex(Ge.computePublicKey(t).substring(2)),s=_e.ProjectivePoint.fromHex(Ge.computePublicKey(e).substring(2));return"0x"+n.add(s).toHex(!!r)}}function Ue(t){let e=t.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function $e(t,e,r){let n=0;for(let s=0;s<r;s++)n=256*n+t[e+s];return n}function De(t,e,r,n){const i=[];for(;r<e+1+n;){const a=Me(t,r);i.push(a.result),r+=a.consumed,(0,s.vA)(r<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:t,length:n,offset:e})}return{consumed:1+n,result:i}}function Me(t,e){(0,s.vA)(0!==t.length,"data too short","BUFFER_OVERRUN",{buffer:t,length:0,offset:1});const r=e=>{(0,s.vA)(e<=t.length,"data short segment too short","BUFFER_OVERRUN",{buffer:t,length:t.length,offset:e})};if(t[e]>=248){const n=t[e]-247;r(e+1+n);const s=$e(t,e+1,n);return r(e+1+n+s),De(t,e,e+1+n,n+s)}if(t[e]>=192){const n=t[e]-192;return r(e+1+n),De(t,e,e+1,n)}if(t[e]>=184){const n=t[e]-183;r(e+1+n);const s=$e(t,e+1,n);r(e+1+n+s);return{consumed:1+n+s,result:(0,l.c$)(t.slice(e+1+n,e+1+n+s))}}if(t[e]>=128){const n=t[e]-128;r(e+1+n);return{consumed:1+n,result:(0,l.c$)(t.slice(e+1,e+1+n))}}return{consumed:1,result:Ue(t[e])}}function He(t){const e=(0,l.q5)(t,"data"),r=Me(e,0);return(0,s.MR)(r.consumed===e.length,"unexpected junk after rlp payload","data",t),r.result}function qe(t){const e=[];for(;t;)e.unshift(255&t),t>>=8;return e}function ze(t){if(Array.isArray(t)){let e=[];if(t.forEach((function(t){e=e.concat(ze(t))})),e.length<=55)return e.unshift(192+e.length),e;const r=qe(e.length);return r.unshift(247+r.length),r.concat(e)}const e=Array.prototype.slice.call((0,l.q5)(t,"object"));if(1===e.length&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const r=qe(e.length);return r.unshift(183+r.length),r.concat(e)}const Ve="0123456789abcdef";function Ze(t){let e="0x";for(const r of ze(t))e+=Ve[r>>4],e+=Ve[15&r];return e}function We(t,e){return function(t){let e;return e="string"===typeof t?Ge.computePublicKey(t,!1):t.publicKey,(0,a.b)((0,c.S)("0x"+e.substring(4)).substring(26))}(Ge.recoverPublicKey(t,e))}const je=BigInt(0),Je=BigInt(2),Ke=BigInt(27),Ye=BigInt(28),Xe=BigInt(35),Qe=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),tr=131072;function er(t,e){let r=t.toString(16);for(;r.length<2;)r="0"+r;return r+=At(e).substring(4),"0x"+r}function rr(t){return"0x"===t?null:(0,a.b)(t)}function nr(t,e){try{return(0,N.$)(t)}catch(r){(0,s.MR)(!1,r.message,e,t)}}function sr(t,e){return"0x"===t?0:(0,u.WZ)(t,e)}function ir(t,e){if("0x"===t)return je;const r=(0,u.Ab)(t,e);return(0,s.MR)(r<=Qe,"value exceeds uint size",e,r),r}function ar(t,e){const r=(0,u.Ab)(t,"value"),n=(0,u.c4)(r);return(0,s.MR)(n.length<=32,"value too large",`tx.${e}`,r),n}function or(t){return(0,N.$)(t).map((t=>[t.address,t.storageKeys]))}function cr(t,e){(0,s.MR)(Array.isArray(t),`invalid ${e}`,"value",t);for(let r=0;r<t.length;r++)(0,s.MR)((0,l.Lo)(t[r],32),"invalid ${ param } hash",`value[${r}]`,t[r]);return t}function lr(t,e){let r;try{if(r=sr(e[0],"yParity"),0!==r&&1!==r)throw new Error("bad yParity")}catch(o){(0,s.MR)(!1,"invalid yParity","yParity",e[0])}const n=(0,l.nx)(e[1],32),i=(0,l.nx)(e[2],32),a=Lt.from({r:n,s:i,yParity:r});t.signature=a}class ur{#O;#B;#L;#F;#C;#_;#G;#U;#$;#D;#M;#H;#q;#z;#V;#Z;get type(){return this.#O}set type(t){switch(t){case null:this.#O=null;break;case 0:case"legacy":this.#O=0;break;case 1:case"berlin":case"eip-2930":this.#O=1;break;case 2:case"london":case"eip-1559":this.#O=2;break;case 3:case"cancun":case"eip-4844":this.#O=3;break;default:(0,s.MR)(!1,"unsupported transaction type","type",t)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844"}return null}get to(){const t=this.#B;return null==t&&3===this.type?z:t}set to(t){this.#B=null==t?null:(0,a.b)(t)}get nonce(){return this.#F}set nonce(t){this.#F=(0,u.WZ)(t,"value")}get gasLimit(){return this.#C}set gasLimit(t){this.#C=(0,u.Ab)(t)}get gasPrice(){const t=this.#_;return null!=t||0!==this.type&&1!==this.type?t:je}set gasPrice(t){this.#_=null==t?null:(0,u.Ab)(t,"gasPrice")}get maxPriorityFeePerGas(){const t=this.#G;return null==t?2===this.type||3===this.type?je:null:t}set maxPriorityFeePerGas(t){this.#G=null==t?null:(0,u.Ab)(t,"maxPriorityFeePerGas")}get maxFeePerGas(){const t=this.#U;return null==t?2===this.type||3===this.type?je:null:t}set maxFeePerGas(t){this.#U=null==t?null:(0,u.Ab)(t,"maxFeePerGas")}get data(){return this.#L}set data(t){this.#L=(0,l.c$)(t)}get value(){return this.#$}set value(t){this.#$=(0,u.Ab)(t,"value")}get chainId(){return this.#D}set chainId(t){this.#D=(0,u.Ab)(t)}get signature(){return this.#M||null}set signature(t){this.#M=null==t?null:Lt.from(t)}get accessList(){const t=this.#H||null;return null==t?1===this.type||2===this.type||3===this.type?[]:null:t}set accessList(t){this.#H=null==t?null:(0,N.$)(t)}get maxFeePerBlobGas(){const t=this.#q;return null==t&&3===this.type?je:t}set maxFeePerBlobGas(t){this.#q=null==t?null:(0,u.Ab)(t,"maxFeePerBlobGas")}get blobVersionedHashes(){let t=this.#z;return null==t&&3===this.type?[]:t}set blobVersionedHashes(t){if(null!=t){(0,s.MR)(Array.isArray(t),"blobVersionedHashes must be an Array","value",t),t=t.slice();for(let e=0;e<t.length;e++)(0,s.MR)((0,l.Lo)(t[e],32),"invalid blobVersionedHash",`value[${e}]`,t[e])}this.#z=t}get blobs(){return null==this.#Z?null:this.#Z.map((t=>Object.assign({},t)))}set blobs(t){if(null==t)return void(this.#Z=null);const e=[],r=[];for(let n=0;n<t.length;n++){const i=t[n];if((0,l.f)(i)){(0,s.vA)(this.#V,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let t=(0,l.q5)(i);if((0,s.MR)(t.length<=tr,"blob is too large",`blobs[${n}]`,i),t.length!==tr){const e=new Uint8Array(tr);e.set(t),t=e}const a=this.#V.blobToKzgCommitment(t),o=(0,l.c$)(this.#V.computeBlobKzgProof(t,a));e.push({data:(0,l.c$)(t),commitment:(0,l.c$)(a),proof:o}),r.push(er(1,a))}else{const t=(0,l.c$)(i.commitment);e.push({data:(0,l.c$)(i.data),commitment:t,proof:(0,l.c$)(i.proof)}),r.push(er(1,t))}}this.#Z=e,this.#z=r}get kzg(){return this.#V}set kzg(t){this.#V=t}constructor(){this.#O=null,this.#B=null,this.#F=0,this.#C=je,this.#_=null,this.#G=null,this.#U=null,this.#L="0x",this.#$=je,this.#D=je,this.#M=null,this.#H=null,this.#q=null,this.#z=null,this.#Z=null,this.#V=null}get hash(){return null==this.signature?null:(0,c.S)(this.#W(!0,!1))}get unsignedHash(){return(0,c.S)(this.unsignedSerialized)}get from(){return null==this.signature?null:We(this.unsignedHash,this.signature)}get fromPublicKey(){return null==this.signature?null:Ge.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return null!=this.signature}#W(t,e){(0,s.vA)(!t||null!=this.signature,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const r=t?this.signature:null;switch(this.inferType()){case 0:return function(t,e){const r=[ar(t.nonce,"nonce"),ar(t.gasPrice||0,"gasPrice"),ar(t.gasLimit,"gasLimit"),t.to||"0x",ar(t.value,"value"),t.data];let n=je;if(t.chainId!=je)n=(0,u.Ab)(t.chainId,"tx.chainId"),(0,s.MR)(!e||null==e.networkV||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(t.signature){const e=t.signature.legacyChainId;null!=e&&(n=e)}if(!e)return n!==je&&(r.push((0,u.c4)(n)),r.push("0x"),r.push("0x")),Ze(r);let i=BigInt(27+e.yParity);return n!==je?i=Lt.getChainIdV(n,e.v):BigInt(e.v)!==i&&(0,s.MR)(!1,"tx.chainId/sig.v mismatch","sig",e),r.push((0,u.c4)(i)),r.push((0,u.c4)(e.r)),r.push((0,u.c4)(e.s)),Ze(r)}(this,r);case 1:return function(t,e){const r=[ar(t.chainId,"chainId"),ar(t.nonce,"nonce"),ar(t.gasPrice||0,"gasPrice"),ar(t.gasLimit,"gasLimit"),t.to||"0x",ar(t.value,"value"),t.data,or(t.accessList||[])];return e&&(r.push(ar(e.yParity,"recoveryParam")),r.push((0,u.c4)(e.r)),r.push((0,u.c4)(e.s))),(0,l.xW)(["0x01",Ze(r)])}(this,r);case 2:return function(t,e){const r=[ar(t.chainId,"chainId"),ar(t.nonce,"nonce"),ar(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ar(t.maxFeePerGas||0,"maxFeePerGas"),ar(t.gasLimit,"gasLimit"),t.to||"0x",ar(t.value,"value"),t.data,or(t.accessList||[])];return e&&(r.push(ar(e.yParity,"yParity")),r.push((0,u.c4)(e.r)),r.push((0,u.c4)(e.s))),(0,l.xW)(["0x02",Ze(r)])}(this,r);case 3:return function(t,e,r){const n=[ar(t.chainId,"chainId"),ar(t.nonce,"nonce"),ar(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ar(t.maxFeePerGas||0,"maxFeePerGas"),ar(t.gasLimit,"gasLimit"),t.to||z,ar(t.value,"value"),t.data,or(t.accessList||[]),ar(t.maxFeePerBlobGas||0,"maxFeePerBlobGas"),cr(t.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(n.push(ar(e.yParity,"yParity")),n.push((0,u.c4)(e.r)),n.push((0,u.c4)(e.s)),r)?(0,l.xW)(["0x03",Ze([n,r.map((t=>t.data)),r.map((t=>t.commitment)),r.map((t=>t.proof))])]):(0,l.xW)(["0x03",Ze(n)])}(this,r,e?this.blobs:null)}(0,s.vA)(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#W(!0,!0)}get unsignedSerialized(){return this.#W(!1,!1)}inferType(){const t=this.inferTypes();return t.indexOf(2)>=0?2:t.pop()}inferTypes(){const t=null!=this.gasPrice,e=null!=this.maxFeePerGas||null!=this.maxPriorityFeePerGas,r=null!=this.accessList,n=null!=this.#q||this.#z;null!=this.maxFeePerGas&&null!=this.maxPriorityFeePerGas&&(0,s.vA)(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),(0,s.vA)(!e||0!==this.type&&1!==this.type,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),(0,s.vA)(0!==this.type||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return null!=this.type?i.push(this.type):e?i.push(2):t?(i.push(1),r||i.push(0)):r?(i.push(1),i.push(2)):(n&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}clone(){return ur.from(this)}toJSON(){const t=t=>null==t?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:t(this.gasLimit),gasPrice:t(this.gasPrice),maxPriorityFeePerGas:t(this.maxPriorityFeePerGas),maxFeePerGas:t(this.maxFeePerGas),value:t(this.value),chainId:t(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(t){if(null==t)return new ur;if("string"===typeof t){const e=(0,l.q5)(t);if(e[0]>=127)return ur.from(function(t){const e=He(t);(0,s.MR)(Array.isArray(e)&&(9===e.length||6===e.length),"invalid field count for legacy transaction","data",t);const r={type:0,nonce:sr(e[0],"nonce"),gasPrice:ir(e[1],"gasPrice"),gasLimit:ir(e[2],"gasLimit"),to:rr(e[3]),value:ir(e[4],"value"),data:(0,l.c$)(e[5]),chainId:je};if(6===e.length)return r;const n=ir(e[6],"v"),i=ir(e[7],"r"),a=ir(e[8],"s");if(i===je&&a===je)r.chainId=n;else{let t=(n-Xe)/Je;t<je&&(t=je),r.chainId=t,(0,s.MR)(t!==je||n===Ke||n===Ye,"non-canonical legacy v","v",e[6]),r.signature=Lt.from({r:(0,l.nx)(e[7],32),s:(0,l.nx)(e[8],32),v:n})}return r}(e));switch(e[0]){case 1:return ur.from(function(t){const e=He((0,l.q5)(t).slice(1));(0,s.MR)(Array.isArray(e)&&(8===e.length||11===e.length),"invalid field count for transaction type: 1","data",(0,l.c$)(t));const r={type:1,chainId:ir(e[0],"chainId"),nonce:sr(e[1],"nonce"),gasPrice:ir(e[2],"gasPrice"),gasLimit:ir(e[3],"gasLimit"),to:rr(e[4]),value:ir(e[5],"value"),data:(0,l.c$)(e[6]),accessList:nr(e[7],"accessList")};return 8===e.length||lr(r,e.slice(8)),r}(e));case 2:return ur.from(function(t){const e=He((0,l.q5)(t).slice(1));(0,s.MR)(Array.isArray(e)&&(9===e.length||12===e.length),"invalid field count for transaction type: 2","data",(0,l.c$)(t));const r={type:2,chainId:ir(e[0],"chainId"),nonce:sr(e[1],"nonce"),maxPriorityFeePerGas:ir(e[2],"maxPriorityFeePerGas"),maxFeePerGas:ir(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:ir(e[4],"gasLimit"),to:rr(e[5]),value:ir(e[6],"value"),data:(0,l.c$)(e[7]),accessList:nr(e[8],"accessList")};return 9===e.length||lr(r,e.slice(9)),r}(e));case 3:return ur.from(function(t){let e=He((0,l.q5)(t).slice(1)),r="3",n=null;if(4===e.length&&Array.isArray(e[0])){r="3 (network format)";const t=e[1],i=e[2],a=e[3];(0,s.MR)(Array.isArray(t),"invalid network format: blobs not an array","fields[1]",t),(0,s.MR)(Array.isArray(i),"invalid network format: commitments not an array","fields[2]",i),(0,s.MR)(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),(0,s.MR)(t.length===i.length,"invalid network format: blobs/commitments length mismatch","fields",e),(0,s.MR)(t.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),n=[];for(let r=0;r<e[1].length;r++)n.push({data:t[r],commitment:i[r],proof:a[r]});e=e[0]}(0,s.MR)(Array.isArray(e)&&(11===e.length||14===e.length),`invalid field count for transaction type: ${r}`,"data",(0,l.c$)(t));const i={type:3,chainId:ir(e[0],"chainId"),nonce:sr(e[1],"nonce"),maxPriorityFeePerGas:ir(e[2],"maxPriorityFeePerGas"),maxFeePerGas:ir(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:ir(e[4],"gasLimit"),to:rr(e[5]),value:ir(e[6],"value"),data:(0,l.c$)(e[7]),accessList:nr(e[8],"accessList"),maxFeePerBlobGas:ir(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};n&&(i.blobs=n),(0,s.MR)(null!=i.to,`invalid address for transaction type: ${r}`,"data",t),(0,s.MR)(Array.isArray(i.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",t);for(let a=0;a<i.blobVersionedHashes.length;a++)(0,s.MR)((0,l.Lo)(i.blobVersionedHashes[a],32),`invalid blobVersionedHash at index ${a}: must be length 32`,"data",t);return 11===e.length||lr(i,e.slice(11)),i}(e))}(0,s.vA)(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const e=new ur;return null!=t.type&&(e.type=t.type),null!=t.to&&(e.to=t.to),null!=t.nonce&&(e.nonce=t.nonce),null!=t.gasLimit&&(e.gasLimit=t.gasLimit),null!=t.gasPrice&&(e.gasPrice=t.gasPrice),null!=t.maxPriorityFeePerGas&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas),null!=t.maxFeePerGas&&(e.maxFeePerGas=t.maxFeePerGas),null!=t.maxFeePerBlobGas&&(e.maxFeePerBlobGas=t.maxFeePerBlobGas),null!=t.data&&(e.data=t.data),null!=t.value&&(e.value=t.value),null!=t.chainId&&(e.chainId=t.chainId),null!=t.signature&&(e.signature=Lt.from(t.signature)),null!=t.accessList&&(e.accessList=t.accessList),null!=t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes),null!=t.kzg&&(e.kzg=t.kzg),null!=t.blobs&&(e.blobs=t.blobs),null!=t.hash&&((0,s.MR)(e.isSigned(),"unsigned transaction cannot define '.hash'","tx",t),(0,s.MR)(e.hash===t.hash,"hash mismatch","tx",t)),null!=t.from&&((0,s.MR)(e.isSigned(),"unsigned transaction cannot define '.from'","tx",t),(0,s.MR)(e.from.toLowerCase()===(t.from||"").toLowerCase(),"from mismatch","tx",t)),e}}var hr=r(49076);const dr="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const fr=BigInt(58);function pr(t){return t.match(/^ipfs:\/\/ipfs\//i)?t=t.substring(12):t.match(/^ipfs:\/\//i)?t=t.substring(7):(0,s.MR)(!1,"unsupported IPFS format","link",t),`https://gateway.ipfs.io/ipfs/${t}`}class gr{name;constructor(t){(0,h.n)(this,{name:t})}connect(t){return this}supportsCoinType(t){return!1}async encodeAddress(t,e){throw new Error("unsupported coin")}async decodeAddress(t,e){throw new Error("unsupported coin")}}const yr=new RegExp("^(ipfs)://(.*)$","i"),mr=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),yr,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class br{provider;address;name;#j;#J;constructor(t,e,r){(0,h.n)(this,{provider:t,address:e,name:r}),this.#j=null,this.#J=new V.NZ(e,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],t)}async supportsWildcard(){return null==this.#j&&(this.#j=(async()=>{try{return await this.#J.supportsInterface("0x9061b923")}catch(t){if((0,s.bJ)(t,"CALL_EXCEPTION"))return!1;throw this.#j=null,t}})()),await this.#j}async#K(t,e){e=(e||[]).slice();const r=this.#J.interface;e.unshift(K(this.name));let n=null;await this.supportsWildcard()&&(n=r.getFunction(t),(0,s.vA)(n,"missing fragment","UNKNOWN_ERROR",{info:{funcName:t}}),e=[Y(this.name,255),r.encodeFunctionData(n,e)],t="resolve(bytes,bytes)"),e.push({enableCcipRead:!0});try{const s=await this.#J[t](...e);return n?r.decodeFunctionResult(n,s)[0]:s}catch(i){if(!(0,s.bJ)(i,"CALL_EXCEPTION"))throw i}return null}async getAddress(t){if(null==t&&(t=60),60===t)try{const t=await this.#K("addr(bytes32)");return null==t||t===z?null:t}catch(i){if((0,s.bJ)(i,"CALL_EXCEPTION"))return null;throw i}if(t>=0&&t<2147483648){let e=t+2147483648;const r=await this.#K("addr(bytes32,uint)",[e]);if((0,l.Lo)(r,20))return(0,a.b)(r)}let e=null;for(const s of this.provider.plugins)if(s instanceof gr&&s.supportsCoinType(t)){e=s;break}if(null==e)return null;const r=await this.#K("addr(bytes32,uint)",[t]);if(null==r||"0x"===r)return null;const n=await e.decodeAddress(t,r);if(null!=n)return n;(0,s.vA)(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${t})`,info:{coinType:t,data:r}})}async getText(t){const e=await this.#K("text(bytes32,string)",[t]);return null==e||"0x"===e?null:e}async getContentHash(){const t=await this.#K("contenthash(bytes32)");if(null==t||"0x"===t)return null;const e=t.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const t="e3010170"===e[1]?"ipfs":"ipns",r=parseInt(e[4],16);if(e[5].length===2*r)return`${t}://${function(t){const e=(0,l.q5)(t);let r=(0,u.Dg)(e),n="";for(;r;)n=dr[Number(r%fr)]+n,r/=fr;for(let s=0;s<e.length&&!e[s];s++)n=dr[0]+n;return n}("0x"+e[2])}`}const r=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&64===r[1].length)return`bzz://${r[1]}`;(0,s.vA)(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:t}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const t=[{type:"name",value:this.name}];try{const r=await this.getText("avatar");if(null==r)return t.push({type:"!avatar",value:""}),{url:null,linkage:t};t.push({type:"avatar",value:r});for(let n=0;n<mr.length;n++){const s=r.match(mr[n]);if(null==s)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return t.push({type:"url",value:r}),{linkage:t,url:r};case"ipfs":{const e=pr(r);return t.push({type:"ipfs",value:r}),t.push({type:"url",value:e}),{linkage:t,url:e}}case"erc721":case"erc1155":{const n="erc721"===i?"tokenURI(uint256)":"uri(uint256)";t.push({type:i,value:r});const a=await this.getAddress();if(null==a)return t.push({type:"!owner",value:""}),{url:null,linkage:t};const o=(s[2]||"").split("/");if(2!==o.length)return t.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:t};const c=o[1],h=new V.NZ(o[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if("erc721"===i){const e=await h.ownerOf(c);if(a!==e)return t.push({type:"!owner",value:e}),{url:null,linkage:t};t.push({type:"owner",value:e})}else if("erc1155"===i){const e=await h.balanceOf(a,c);if(!e)return t.push({type:"!balance",value:"0"}),{url:null,linkage:t};t.push({type:"balance",value:e.toString()})}let d=await h[n](c);if(null==d||"0x"===d)return t.push({type:"!metadata-url",value:""}),{url:null,linkage:t};t.push({type:"metadata-url-base",value:d}),"erc1155"===i&&(d=d.replace("{id}",(0,u.up)(c,32).substring(2)),t.push({type:"metadata-url-expanded",value:d})),d.match(/^ipfs:/i)&&(d=pr(d)),t.push({type:"metadata-url",value:d});let f={};const p=await new M(d).send();p.assertOk();try{f=p.bodyJson}catch(e){try{t.push({type:"!metadata",value:p.bodyText})}catch(e){const r=p.body;return r&&t.push({type:"!metadata",value:(0,l.c$)(r)}),{url:null,linkage:t}}return{url:null,linkage:t}}if(!f)return t.push({type:"!metadata",value:""}),{url:null,linkage:t};t.push({type:"metadata",value:JSON.stringify(f)});let g=f.image;if("string"!==typeof g)return t.push({type:"!imageUrl",value:""}),{url:null,linkage:t};if(g.match(/^(https:\/\/|data:)/i));else{if(null==g.match(yr))return t.push({type:"!imageUrl-ipfs",value:g}),{url:null,linkage:t};t.push({type:"imageUrl-ipfs",value:g}),g=pr(g)}return t.push({type:"url",value:g}),{linkage:t,url:g}}}}}catch(e){}return{linkage:t,url:null}}static async getEnsAddress(t){const e=await t.getNetwork(),r=e.getPlugin("org.ethers.plugins.network.Ens");return(0,s.vA)(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:e}}),r.address}static async#Y(t,e){const r=await br.getEnsAddress(t);try{const n=new V.NZ(r,["function resolver(bytes32) view returns (address)"],t),s=await n.resolver(K(e),{enableCcipRead:!0});return s===z?null:s}catch(n){throw n}return null}static async fromName(t,e){let r=e;for(;;){if(""===r||"."===r)return null;if("eth"!==e&&"eth"===r)return null;const n=await br.#Y(t,r);if(null!=n){const s=new br(t,n,e);return r===e||await s.supportsWildcard()?s:null}r=r.split(".").slice(1).join(".")}}}const wr=BigInt(0);function vr(t,e){return function(r){return null==r?e:t(r)}}function xr(t,e){return r=>{if(e&&null==r)return null;if(!Array.isArray(r))throw new Error("not an array");return r.map((e=>t(e)))}}function Ar(t,e){return r=>{const n={};for(const a in t){let o=a;if(e&&a in e&&!(o in r))for(const t of e[a])if(t in r){o=t;break}try{const e=t[a](r[o]);void 0!==e&&(n[a]=e)}catch(i){const t=i instanceof Error?i.message:"not-an-error";(0,s.vA)(!1,`invalid value for value.${a} (${t})`,"BAD_DATA",{value:r})}}return n}}function Pr(t){return(0,s.MR)((0,l.Lo)(t,!0),"invalid data","value",t),t}function Er(t){return(0,s.MR)((0,l.Lo)(t,32),"invalid hash","value",t),t}const kr=Ar({address:a.b,blockHash:Er,blockNumber:u.WZ,data:Pr,index:u.WZ,removed:vr((function(t){switch(t){case!0:case"true":return!0;case!1:case"false":return!1}(0,s.MR)(!1,`invalid boolean; ${JSON.stringify(t)}`,"value",t)}),!1),topics:xr(Er),transactionHash:Er,transactionIndex:u.WZ},{index:["logIndex"]});const Rr=Ar({hash:vr(Er),parentHash:Er,parentBeaconBlockRoot:vr(Er,null),number:u.WZ,timestamp:u.WZ,nonce:vr(Pr),difficulty:u.Ab,gasLimit:u.Ab,gasUsed:u.Ab,stateRoot:vr(Er,null),receiptsRoot:vr(Er,null),blobGasUsed:vr(u.Ab,null),excessBlobGas:vr(u.Ab,null),miner:vr(a.b),prevRandao:vr(Er,null),extraData:Pr,baseFeePerGas:vr(u.Ab)},{prevRandao:["mixHash"]});const Ir=Ar({transactionIndex:u.WZ,blockNumber:u.WZ,transactionHash:Er,address:a.b,topics:xr(Er),data:Pr,index:u.WZ,blockHash:Er},{index:["logIndex"]});const Nr=Ar({to:vr(a.b,null),from:vr(a.b,null),contractAddress:vr(a.b,null),index:u.WZ,root:vr(l.c$),gasUsed:u.Ab,blobGasUsed:vr(u.Ab,null),logsBloom:vr(Pr),blockHash:Er,hash:Er,logs:xr((function(t){return Ir(t)})),blockNumber:u.WZ,cumulativeGasUsed:u.Ab,effectiveGasPrice:vr(u.Ab),blobGasPrice:vr(u.Ab,null),status:vr(u.WZ),type:vr(u.WZ,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function Sr(t){t.to&&(0,u.Ab)(t.to)===wr&&(t.to="0x0000000000000000000000000000000000000000");const e=Ar({hash:Er,index:vr(u.WZ,void 0),type:t=>"0x"===t||null==t?0:(0,u.WZ)(t),accessList:vr(N.$,null),blobVersionedHashes:vr(xr(Er,!0),null),blockHash:vr(Er,null),blockNumber:vr(u.WZ,null),transactionIndex:vr(u.WZ,null),from:a.b,gasPrice:vr(u.Ab),maxPriorityFeePerGas:vr(u.Ab),maxFeePerGas:vr(u.Ab),maxFeePerBlobGas:vr(u.Ab,null),gasLimit:u.Ab,to:vr(a.b,null),value:u.Ab,nonce:u.WZ,data:Pr,creates:vr(a.b,null),chainId:vr(u.Ab,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(t);if(null==e.to&&null==e.creates&&(e.creates=function(t){const e=(0,a.b)(t.from);let r=(0,u.Ab)(t.nonce,"tx.nonce").toString(16);return r="0"===r?"0x":r.length%2?"0x0"+r:"0x"+r,(0,a.b)((0,l.ZG)((0,c.S)(Ze([e,r])),12))}(e)),1!==t.type&&2!==t.type||null!=t.accessList||(e.accessList=[]),t.signature?e.signature=Lt.from(t.signature):e.signature=Lt.from(t),null==e.chainId){const t=e.signature.legacyChainId;null!=t&&(e.chainId=t)}return e.blockHash&&(0,u.Ab)(e.blockHash)===wr&&(e.blockHash=null),e}class Tr{name;constructor(t){(0,h.n)(this,{name:t})}clone(){return new Tr(this.name)}}class Or extends Tr{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(t,e){null==t&&(t=0),super(`org.ethers.network.plugins.GasCost#${t||0}`);const r={effectiveBlock:t};function n(t,n){let i=(e||{})[t];null==i&&(i=n),(0,s.MR)("number"===typeof i,`invalud value for ${t}`,"costs",e),r[t]=i}n("txBase",21e3),n("txCreate",32e3),n("txDataZero",4),n("txDataNonzero",16),n("txAccessListStorageKey",1900),n("txAccessListAddress",2400),(0,h.n)(this,r)}clone(){return new Or(this.effectiveBlock,this)}}class Br extends Tr{address;targetNetwork;constructor(t,e){super("org.ethers.plugins.network.Ens"),(0,h.n)(this,{address:t||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",targetNetwork:null==e?1:e})}clone(){return new Br(this.address,this.targetNetwork)}}class Lr extends Tr{#h;#X;get url(){return this.#h}get processFunc(){return this.#X}constructor(t,e){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#h=t,this.#X=e}clone(){return this}}const Fr=new Map;class Cr{#Q;#D;#tt;constructor(t,e){this.#Q=t,this.#D=(0,u.Ab)(e),this.#tt=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#Q}set name(t){this.#Q=t}get chainId(){return this.#D}set chainId(t){this.#D=(0,u.Ab)(t,"chainId")}matches(t){if(null==t)return!1;if("string"===typeof t){try{return this.chainId===(0,u.Ab)(t)}catch(e){}return this.name===t}if("number"===typeof t||"bigint"===typeof t){try{return this.chainId===(0,u.Ab)(t)}catch(e){}return!1}if("object"===typeof t){if(null!=t.chainId){try{return this.chainId===(0,u.Ab)(t.chainId)}catch(e){}return!1}return null!=t.name&&this.name===t.name}return!1}get plugins(){return Array.from(this.#tt.values())}attachPlugin(t){if(this.#tt.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#tt.set(t.name,t.clone()),this}getPlugin(t){return this.#tt.get(t)||null}getPlugins(t){return this.plugins.filter((e=>e.name.split("#")[0]===t))}clone(){const t=new Cr(this.name,this.chainId);return this.plugins.forEach((e=>{t.attachPlugin(e.clone())})),t}computeIntrinsicGas(t){const e=this.getPlugin("org.ethers.plugins.network.GasCost")||new Or;let r=e.txBase;if(null==t.to&&(r+=e.txCreate),t.data)for(let n=2;n<t.data.length;n+=2)"00"===t.data.substring(n,n+2)?r+=e.txDataZero:r+=e.txDataNonzero;if(t.accessList){const n=(0,N.$)(t.accessList);for(const t in n)r+=e.txAccessListAddress+e.txAccessListStorageKey*n[t].storageKeys.length}return r}static from(t){if(function(){if(Ur)return;function t(t,e,r){const n=function(){const n=new Cr(t,e);return null!=r.ensNetwork&&n.attachPlugin(new Br(null,r.ensNetwork)),n.attachPlugin(new Or),(r.plugins||[]).forEach((t=>{n.attachPlugin(t)})),n};Cr.register(t,n),Cr.register(e,n),r.altNames&&r.altNames.forEach((t=>{Cr.register(t,n)}))}Ur=!0,t("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),t("ropsten",3,{ensNetwork:3}),t("rinkeby",4,{ensNetwork:4}),t("goerli",5,{ensNetwork:5}),t("kovan",42,{ensNetwork:42}),t("sepolia",11155111,{ensNetwork:11155111}),t("holesky",17e3,{ensNetwork:17e3}),t("classic",61,{}),t("classicKotti",6,{}),t("arbitrum",42161,{ensNetwork:1}),t("arbitrum-goerli",421613,{}),t("arbitrum-sepolia",421614,{}),t("base",8453,{ensNetwork:1}),t("base-goerli",84531,{}),t("base-sepolia",84532,{}),t("bnb",56,{ensNetwork:1}),t("bnbt",97,{}),t("linea",59144,{ensNetwork:1}),t("linea-goerli",59140,{}),t("linea-sepolia",59141,{}),t("matic",137,{ensNetwork:1,plugins:[Gr("https://gasstation.polygon.technology/v2")]}),t("matic-amoy",80002,{}),t("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[Gr("https://gasstation-testnet.polygon.technology/v2")]}),t("optimism",10,{ensNetwork:1,plugins:[]}),t("optimism-goerli",420,{}),t("optimism-sepolia",11155420,{}),t("xdai",100,{ensNetwork:1})}(),null==t)return Cr.from("mainnet");if("number"===typeof t&&(t=BigInt(t)),"string"===typeof t||"bigint"===typeof t){const e=Fr.get(t);if(e)return e();if("bigint"===typeof t)return new Cr("unknown",t);(0,s.MR)(!1,"unknown network","network",t)}if("function"===typeof t.clone){return t.clone()}if("object"===typeof t){(0,s.MR)("string"===typeof t.name&&"number"===typeof t.chainId,"invalid network object name or chainId","network",t);const e=new Cr(t.name,t.chainId);return(t.ensAddress||null!=t.ensNetwork)&&e.attachPlugin(new Br(t.ensAddress,t.ensNetwork)),e}(0,s.MR)(!1,"invalid network","network",t)}static register(t,e){"number"===typeof t&&(t=BigInt(t));const r=Fr.get(t);r&&(0,s.MR)(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",t),Fr.set(t,e)}}function _r(t,e){const r=String(t);if(!r.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${t}`);const n=r.split(".");if(1===n.length&&n.push(""),2!==n.length)throw new Error(`invalid gwei value: ${t}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let t=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||t++,n[1]=t.toString()}return BigInt(n[0]+n[1])}function Gr(t){return new Lr(t,(async(t,e,r)=>{let n;r.setHeader("User-Agent","ethers");try{const[e,s]=await Promise.all([r.send(),t()]);n=e;const i=n.bodyJson.standard;return{gasPrice:s.gasPrice,maxFeePerGas:_r(i.maxFee,9),maxPriorityFeePerGas:_r(i.maxPriorityFee,9)}}catch(i){(0,s.vA)(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:n,error:i})}}))}let Ur=!1;var $r=r(24789);function Dr(t){return JSON.parse(JSON.stringify(t))}class Mr{#et;#rt;#nt;#st;constructor(t){this.#et=t,this.#rt=null,this.#nt=4e3,this.#st=-2}get pollingInterval(){return this.#nt}set pollingInterval(t){this.#nt=t}async#it(){try{const t=await this.#et.getBlockNumber();if(-2===this.#st)return void(this.#st=t);if(t!==this.#st){for(let e=this.#st+1;e<=t;e++){if(null==this.#rt)return;await this.#et.emit("block",e)}this.#st=t}}catch(t){}null!=this.#rt&&(this.#rt=this.#et._setTimeout(this.#it.bind(this),this.#nt))}start(){this.#rt||(this.#rt=this.#et._setTimeout(this.#it.bind(this),this.#nt),this.#it())}stop(){this.#rt&&(this.#et._clearTimeout(this.#rt),this.#rt=null)}pause(t){this.stop(),t&&(this.#st=-2)}resume(){this.start()}}class Hr{#et;#it;#at;constructor(t){this.#et=t,this.#at=!1,this.#it=t=>{this._poll(t,this.#et)}}async _poll(t,e){throw new Error("sub-classes must override this")}start(){this.#at||(this.#at=!0,this.#it(-2),this.#et.on("block",this.#it))}stop(){this.#at&&(this.#at=!1,this.#et.off("block",this.#it))}pause(t){this.stop()}resume(){this.start()}}class qr extends Hr{#ot;#ct;constructor(t,e){super(t),this.#ot=e,this.#ct=-2}pause(t){t&&(this.#ct=-2),super.pause(t)}async _poll(t,e){const r=await e.getBlock(this.#ot);null!=r&&(-2===this.#ct?this.#ct=r.number:r.number>this.#ct&&(e.emit(this.#ot,r.number),this.#ct=r.number))}}class zr extends Hr{#lt;constructor(t,e){super(t),this.#lt=Dr(e)}async _poll(t,e){throw new Error("@TODO")}}class Vr extends Hr{#ut;constructor(t,e){super(t),this.#ut=e}async _poll(t,e){const r=await e.getTransactionReceipt(this.#ut);r&&e.emit(this.#ut,r)}}class Zr{#et;#lt;#rt;#at;#st;constructor(t,e){this.#et=t,this.#lt=Dr(e),this.#rt=this.#it.bind(this),this.#at=!1,this.#st=-2}async#it(t){if(-2===this.#st)return;const e=Dr(this.#lt);e.fromBlock=this.#st+1,e.toBlock=t;const r=await this.#et.getLogs(e);if(0!==r.length)for(const n of r)this.#et.emit(this.#lt,n),this.#st=n.blockNumber;else this.#st<t-60&&(this.#st=t-60)}start(){this.#at||(this.#at=!0,-2===this.#st&&this.#et.getBlockNumber().then((t=>{this.#st=t})),this.#et.on("block",this.#rt))}stop(){this.#at&&(this.#at=!1,this.#et.off("block",this.#rt))}pause(t){this.stop(),t&&(this.#st=-2)}resume(){this.start()}}const Wr=BigInt(2);function jr(t){return t&&"function"===typeof t.then}function Jr(t,e){return t+":"+JSON.stringify(e,((t,e)=>{if(null==e)return"null";if("bigint"===typeof e)return`bigint:${e.toString()}`;if("string"===typeof e)return e.toLowerCase();if("object"===typeof e&&!Array.isArray(e)){const t=Object.keys(e);return t.sort(),t.reduce(((t,r)=>(t[r]=e[r],t)),{})}return e}))}class Kr{name;constructor(t){(0,h.n)(this,{name:t})}start(){}stop(){}pause(t){}resume(){}}function Yr(t){return(t=Array.from(new Set(t).values())).sort(),t}async function Xr(t,e){if(null==t)throw new Error("invalid event");if(Array.isArray(t)&&(t={topics:t}),"string"===typeof t)switch(t){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:t,tag:t}}if((0,l.Lo)(t,32)){const e=t.toLowerCase();return{type:"transaction",tag:Jr("tx",{hash:e}),hash:e}}if(t.orphan){const e=t;return{type:"orphan",tag:Jr("orphan",e),filter:(r=e,JSON.parse(JSON.stringify(r)))}}var r;if(t.address||t.topics){const r=t,n={topics:(r.topics||[]).map((t=>null==t?null:Array.isArray(t)?Yr(t.map((t=>t.toLowerCase()))):t.toLowerCase()))};if(r.address){const t=[],s=[],i=r=>{(0,l.Lo)(r)?t.push(r):s.push((async()=>{t.push(await(0,o.tG)(r,e))})())};Array.isArray(r.address)?r.address.forEach(i):i(r.address),s.length&&await Promise.all(s),n.address=Yr(t.map((t=>t.toLowerCase())))}return{filter:n,tag:Jr("event",n),type:"event"}}(0,s.MR)(!1,"unknown ProviderEvent","event",t)}function Qr(){return(new Date).getTime()}const tn={cacheTimeout:250,pollingInterval:4e3};class en{#ht;#tt;#dt;#ft;#pt;#gt;#yt;#mt;#bt;#wt;#vt;#xt;constructor(t,e){if(this.#xt=Object.assign({},tn,e||{}),"any"===t)this.#gt=!0,this.#pt=null;else if(t){const e=Cr.from(t);this.#gt=!1,this.#pt=Promise.resolve(e),setTimeout((()=>{this.emit("network",e,null)}),0)}else this.#gt=!1,this.#pt=null;this.#mt=-1,this.#yt=new Map,this.#ht=new Map,this.#tt=new Map,this.#dt=null,this.#ft=!1,this.#bt=1,this.#wt=new Map,this.#vt=!1}get pollingInterval(){return this.#xt.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#tt.values())}attachPlugin(t){if(this.#tt.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#tt.set(t.name,t.connect(this)),this}getPlugin(t){return this.#tt.get(t)||null}get disableCcipRead(){return this.#vt}set disableCcipRead(t){this.#vt=!!t}async#At(t){const e=this.#xt.cacheTimeout;if(e<0)return await this._perform(t);const r=Jr(t.method,t);let n=this.#yt.get(r);return n||(n=this._perform(t),this.#yt.set(r,n),setTimeout((()=>{this.#yt.get(r)===n&&this.#yt.delete(r)}),e)),await n}async ccipReadFetch(t,e,r){if(this.disableCcipRead||0===r.length||null==t.to)return null;const n=t.to.toLowerCase(),i=e.toLowerCase(),a=[];for(let c=0;c<r.length;c++){const e=r[c],l=e.replace("{sender}",n).replace("{data}",i),u=new M(l);-1===e.indexOf("{data}")&&(u.body={data:i,sender:n}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:c,urls:r});let h,d="unknown error";try{h=await u.send()}catch(o){a.push(o.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:o}});continue}try{const t=h.bodyJson;if(t.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:t}),t.data;t.message&&(d=t.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:t})}catch(o){}(0,s.vA)(h.statusCode<400||h.statusCode>=500,`response not found during CCIP fetch: ${d}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:t,info:{url:e,errorMessage:d}}),a.push(d)}(0,s.vA)(!1,`error encountered during CCIP fetch: ${a.map((t=>JSON.stringify(t))).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:t,info:{urls:r,errorMessages:a}})}_wrapBlock(t,e){return new $r.eB(function(t){const e=Rr(t);return e.transactions=t.transactions.map((t=>"string"===typeof t?t:Sr(t))),e}(t),this)}_wrapLog(t,e){return new $r.tG(function(t){return kr(t)}(t),this)}_wrapTransactionReceipt(t,e){return new $r.z5(function(t){return Nr(t)}(t),this)}_wrapTransactionResponse(t,e){return new $r.uI(Sr(t),this)}_detectNetwork(){(0,s.vA)(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(t){(0,s.vA)(!1,`unsupported method: ${t.method}`,"UNSUPPORTED_OPERATION",{operation:t.method,info:t})}async getBlockNumber(){const t=(0,u.WZ)(await this.#At({method:"getBlockNumber"}),"%response");return this.#mt>=0&&(this.#mt=t),t}_getAddress(t){return(0,o.tG)(t,this)}_getBlockTag(t){if(null==t)return"latest";switch(t){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return t}return(0,l.Lo)(t)?(0,l.Lo)(t,32)?t:(0,u.nD)(t):("bigint"===typeof t&&(t=(0,u.WZ)(t,"blockTag")),"number"===typeof t?t>=0?(0,u.nD)(t):this.#mt>=0?(0,u.nD)(this.#mt+t):this.getBlockNumber().then((e=>(0,u.nD)(e+t))):void(0,s.MR)(!1,"invalid blockTag","blockTag",t))}_getFilter(t){const e=(t.topics||[]).map((t=>null==t?null:Array.isArray(t)?Yr(t.map((t=>t.toLowerCase()))):t.toLowerCase())),r="blockHash"in t?t.blockHash:void 0,n=(t,n,s)=>{let i;switch(t.length){case 0:break;case 1:i=t[0];break;default:t.sort(),i=t}if(r&&(null!=n||null!=s))throw new Error("invalid filter");const a={};return i&&(a.address=i),e.length&&(a.topics=e),n&&(a.fromBlock=n),s&&(a.toBlock=s),r&&(a.blockHash=r),a};let s,i,a=[];if(t.address)if(Array.isArray(t.address))for(const o of t.address)a.push(this._getAddress(o));else a.push(this._getAddress(t.address));return"fromBlock"in t&&(s=this._getBlockTag(t.fromBlock)),"toBlock"in t&&(i=this._getBlockTag(t.toBlock)),a.filter((t=>"string"!==typeof t)).length||null!=s&&"string"!==typeof s||null!=i&&"string"!==typeof i?Promise.all([Promise.all(a),s,i]).then((t=>n(t[0],t[1],t[2]))):n(a,s,i)}_getTransactionRequest(t){const e=(0,$r.VS)(t),r=[];if(["to","from"].forEach((t=>{if(null==e[t])return;const n=(0,o.tG)(e[t],this);jr(n)?r.push(async function(){e[t]=await n}()):e[t]=n})),null!=e.blockTag){const t=this._getBlockTag(e.blockTag);jr(t)?r.push(async function(){e.blockTag=await t}()):e.blockTag=t}return r.length?async function(){return await Promise.all(r),e}():e}async getNetwork(){if(null==this.#pt){const t=(async()=>{try{const t=await this._detectNetwork();return this.emit("network",t,null),t}catch(e){throw this.#pt===t&&(this.#pt=null),e}})();return this.#pt=t,(await t).clone()}const t=this.#pt,[e,r]=await Promise.all([t,this._detectNetwork()]);return e.chainId!==r.chainId&&(this.#gt?(this.emit("network",r,e),this.#pt===t&&(this.#pt=Promise.resolve(r))):(0,s.vA)(!1,`network changed: ${e.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),e.clone()}async getFeeData(){const t=await this.getNetwork(),e=async()=>{const{_block:e,gasPrice:r,priorityFee:n}=await(0,h.k)({_block:this.#Pt("latest",!1),gasPrice:(async()=>{try{const t=await this.#At({method:"getGasPrice"});return(0,u.Ab)(t,"%response")}catch(t){}return null})(),priorityFee:(async()=>{try{const t=await this.#At({method:"getPriorityFee"});return(0,u.Ab)(t,"%response")}catch(t){}return null})()});let s=null,i=null;const a=this._wrapBlock(e,t);return a&&a.baseFeePerGas&&(i=null!=n?n:BigInt("1000000000"),s=a.baseFeePerGas*Wr+i),new $r.J9(r,s,i)},r=t.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){const t=new M(r.url),n=await r.processFunc(e,this,t);return new $r.J9(n.gasPrice,n.maxFeePerGas,n.maxPriorityFeePerGas)}return await e()}async estimateGas(t){let e=this._getTransactionRequest(t);return jr(e)&&(e=await e),(0,u.Ab)(await this.#At({method:"estimateGas",transaction:e}),"%response")}async#Et(t,e,r){(0,s.vA)(r<10,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},t,{blockTag:e,enableCcipRead:!0})});const n=(0,$r.VS)(t);try{return(0,l.c$)(await this._perform({method:"call",transaction:n,blockTag:e}))}catch(i){if(!this.disableCcipRead&&(0,s.E)(i)&&i.data&&r>=0&&"latest"===e&&null!=n.to&&"0x556f1830"===(0,l.ZG)(i.data,0,4)){const t=i.data,a=await(0,o.tG)(n.to,this);let c;try{c=function(t){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};(0,s.vA)((0,l.pO)(t)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const r=(0,l.ZG)(t,0,32);(0,s.vA)((0,l.ZG)(r,0,12)===(0,l.ZG)(ln,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=(0,l.ZG)(r,12);try{const r=[],n=(0,u.WZ)((0,l.ZG)(t,32,64)),s=(0,u.WZ)((0,l.ZG)(t,n,n+32)),i=(0,l.ZG)(t,n+32);for(let t=0;t<s;t++){const e=rn(i,32*t);if(null==e)throw new Error("abort");r.push(e)}e.urls=r}catch(i){(0,s.vA)(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const r=nn(t,64);if(null==r)throw new Error("abort");e.calldata=r}catch(i){(0,s.vA)(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}(0,s.vA)((0,l.ZG)(t,100,128)===(0,l.ZG)(ln,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=(0,l.ZG)(t,96,100);try{const r=nn(t,128);if(null==r)throw new Error("abort");e.extraData=r}catch(i){(0,s.vA)(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map((t=>e[t])),e}((0,l.ZG)(i.data,4))}catch(i){(0,s.vA)(!1,i.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:n,info:{data:t}})}(0,s.vA)(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:t,reason:"OffchainLookup",transaction:n,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const h=await this.ccipReadFetch(n,c.calldata,c.urls);(0,s.vA)(null!=h,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:n,info:{data:i.data,errorArgs:c.errorArgs}});const d={to:a,data:(0,l.xW)([c.selector,cn([h,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:d});try{const t=await this.#Et(d,e,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},d),result:t}),t}catch(i){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},d),error:i}),i}}throw i}}async#kt(t){const{value:e}=await(0,h.k)({network:this.getNetwork(),value:t});return e}async call(t){const{tx:e,blockTag:r}=await(0,h.k)({tx:this._getTransactionRequest(t),blockTag:this._getBlockTag(t.blockTag)});return await this.#kt(this.#Et(e,r,t.enableCcipRead?0:-1))}async#Rt(t,e,r){let n=this._getAddress(e),s=this._getBlockTag(r);return"string"===typeof n&&"string"===typeof s||([n,s]=await Promise.all([n,s])),await this.#kt(this.#At(Object.assign(t,{address:n,blockTag:s})))}async getBalance(t,e){return(0,u.Ab)(await this.#Rt({method:"getBalance"},t,e),"%response")}async getTransactionCount(t,e){return(0,u.WZ)(await this.#Rt({method:"getTransactionCount"},t,e),"%response")}async getCode(t,e){return(0,l.c$)(await this.#Rt({method:"getCode"},t,e))}async getStorage(t,e,r){const n=(0,u.Ab)(e,"position");return(0,l.c$)(await this.#Rt({method:"getStorage",position:n},t,r))}async broadcastTransaction(t){const{blockNumber:e,hash:r,network:n}=await(0,h.k)({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:t}),network:this.getNetwork()}),s=ur.from(t);if(s.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(s,n).replaceableTransaction(e)}async#Pt(t,e){if((0,l.Lo)(t,32))return await this.#At({method:"getBlock",blockHash:t,includeTransactions:e});let r=this._getBlockTag(t);return"string"!==typeof r&&(r=await r),await this.#At({method:"getBlock",blockTag:r,includeTransactions:e})}async getBlock(t,e){const{network:r,params:n}=await(0,h.k)({network:this.getNetwork(),params:this.#Pt(t,!!e)});return null==n?null:this._wrapBlock(n,r)}async getTransaction(t){const{network:e,params:r}=await(0,h.k)({network:this.getNetwork(),params:this.#At({method:"getTransaction",hash:t})});return null==r?null:this._wrapTransactionResponse(r,e)}async getTransactionReceipt(t){const{network:e,params:r}=await(0,h.k)({network:this.getNetwork(),params:this.#At({method:"getTransactionReceipt",hash:t})});if(null==r)return null;if(null==r.gasPrice&&null==r.effectiveGasPrice){const e=await this.#At({method:"getTransaction",hash:t});if(null==e)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=e.gasPrice}return this._wrapTransactionReceipt(r,e)}async getTransactionResult(t){const{result:e}=await(0,h.k)({network:this.getNetwork(),result:this.#At({method:"getTransactionResult",hash:t})});return null==e?null:(0,l.c$)(e)}async getLogs(t){let e=this._getFilter(t);jr(e)&&(e=await e);const{network:r,params:n}=await(0,h.k)({network:this.getNetwork(),params:this.#At({method:"getLogs",filter:e})});return n.map((t=>this._wrapLog(t,r)))}_getProvider(t){(0,s.vA)(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(t){return await br.fromName(this,t)}async getAvatar(t){const e=await this.getResolver(t);return e?await e.getAvatar():null}async resolveName(t){const e=await this.getResolver(t);return e?await e.getAddress():null}async lookupAddress(t){const e=K((t=(0,a.b)(t)).substring(2).toLowerCase()+".addr.reverse");try{const r=await br.getEnsAddress(this),n=new V.NZ(r,["function resolver(bytes32) view returns (address)"],this),s=await n.resolver(e);if(null==s||s===z)return null;const i=new V.NZ(s,["function name(bytes32) view returns (string)"],this),a=await i.name(e);return await this.resolveName(a)!==t?null:a}catch(r){if((0,s.bJ)(r,"BAD_DATA")&&"0x"===r.value)return null;if((0,s.bJ)(r,"CALL_EXCEPTION"))return null;throw r}return null}async waitForTransaction(t,e,r){const n=null!=e?e:1;return 0===n?this.getTransactionReceipt(t):new Promise((async(e,i)=>{let a=null;const o=async r=>{try{const s=await this.getTransactionReceipt(t);if(null!=s&&r-s.blockNumber+1>=n)return e(s),void(a&&(clearTimeout(a),a=null))}catch(s){console.log("EEE",s)}this.once("block",o)};null!=r&&(a=setTimeout((()=>{null!=a&&(a=null,this.off("block",o),i((0,s.xz)("timeout","TIMEOUT",{reason:"timeout"})))}),r)),o(await this.getBlockNumber())}))}async waitForBlock(t){(0,s.vA)(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(t){const e=this.#wt.get(t);e&&(e.timer&&clearTimeout(e.timer),this.#wt.delete(t))}_setTimeout(t,e){null==e&&(e=0);const r=this.#bt++,n=()=>{this.#wt.delete(r),t()};if(this.paused)this.#wt.set(r,{timer:null,func:n,time:e});else{const t=setTimeout(n,e);this.#wt.set(r,{timer:t,func:n,time:Qr()})}return r}_forEachSubscriber(t){for(const e of this.#ht.values())t(e.subscriber)}_getSubscriber(t){switch(t.type){case"debug":case"error":case"network":return new Kr(t.type);case"block":{const t=new Mr(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new qr(this,t.type);case"event":return new Zr(this,t.filter);case"transaction":return new Vr(this,t.hash);case"orphan":return new zr(this,t.filter)}throw new Error(`unsupported event: ${t.type}`)}_recoverSubscriber(t,e){for(const r of this.#ht.values())if(r.subscriber===t){r.started&&r.subscriber.stop(),r.subscriber=e,r.started&&e.start(),null!=this.#dt&&e.pause(this.#dt);break}}async#It(t,e){let r=await Xr(t,this);return"event"===r.type&&e&&e.length>0&&!0===e[0].removed&&(r=await Xr({orphan:"drop-log",log:e[0]},this)),this.#ht.get(r.tag)||null}async#Nt(t){const e=await Xr(t,this),r=e.tag;let n=this.#ht.get(r);if(!n){n={subscriber:this._getSubscriber(e),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#ht.set(r,n)}return n}async on(t,e){const r=await this.#Nt(t);return r.listeners.push({listener:e,once:!1}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#dt&&r.subscriber.pause(this.#dt)),this}async once(t,e){const r=await this.#Nt(t);return r.listeners.push({listener:e,once:!0}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#dt&&r.subscriber.pause(this.#dt)),this}async emit(t,...e){const r=await this.#It(t,e);if(!r||0===r.listeners.length)return!1;const n=r.listeners.length;return r.listeners=r.listeners.filter((({listener:r,once:n})=>{const s=new hr.z(this,n?null:r,t);try{r.call(this,...e,s)}catch(i){}return!n})),0===r.listeners.length&&(r.started&&r.subscriber.stop(),this.#ht.delete(r.tag)),n>0}async listenerCount(t){if(t){const e=await this.#It(t);return e?e.listeners.length:0}let e=0;for(const{listeners:r}of this.#ht.values())e+=r.length;return e}async listeners(t){if(t){const e=await this.#It(t);return e?e.listeners.map((({listener:t})=>t)):[]}let e=[];for(const{listeners:r}of this.#ht.values())e=e.concat(r.map((({listener:t})=>t)));return e}async off(t,e){const r=await this.#It(t);if(!r)return this;if(e){const t=r.listeners.map((({listener:t})=>t)).indexOf(e);t>=0&&r.listeners.splice(t,1)}return e&&0!==r.listeners.length||(r.started&&r.subscriber.stop(),this.#ht.delete(r.tag)),this}async removeAllListeners(t){if(t){const{tag:e,started:r,subscriber:n}=await this.#Nt(t);r&&n.stop(),this.#ht.delete(e)}else for(const[e,{started:r,subscriber:n}]of this.#ht)r&&n.stop(),this.#ht.delete(e);return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return this.off(t,e)}get destroyed(){return this.#ft}destroy(){this.removeAllListeners();for(const t of this.#wt.keys())this._clearTimeout(t);this.#ft=!0}get paused(){return null!=this.#dt}set paused(t){!!t!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(t){if(this.#mt=-1,null!=this.#dt){if(this.#dt==!!t)return;(0,s.vA)(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber((e=>e.pause(t))),this.#dt=!!t;for(const e of this.#wt.values())e.timer&&clearTimeout(e.timer),e.time=Qr()-e.time}resume(){if(null!=this.#dt){this._forEachSubscriber((t=>t.resume())),this.#dt=null;for(const t of this.#wt.values()){let e=t.time;e<0&&(e=0),t.time=Qr(),setTimeout(t.func,e)}}}}function rn(t,e){try{const r=nn(t,e);if(r)return(0,S._v)(r)}catch(r){}return null}function nn(t,e){if("0x"===t)return null;try{const r=(0,u.WZ)((0,l.ZG)(t,e,e+32)),n=(0,u.WZ)((0,l.ZG)(t,r,r+32));return(0,l.ZG)(t,r+32,r+32+n)}catch(r){}return null}function sn(t){const e=(0,u.c4)(t);if(e.length>32)throw new Error("internal; should not happen");const r=new Uint8Array(32);return r.set(e,32-e.length),r}function an(t){if(t.length%32===0)return t;const e=new Uint8Array(32*Math.ceil(t.length/32));return e.set(t),e}const on=new Uint8Array([]);function cn(t){const e=[];let r=0;for(let n=0;n<t.length;n++)e.push(on),r+=32;for(let n=0;n<t.length;n++){const s=(0,l.q5)(t[n]);e[n]=sn(r),e.push(sn(s.length)),e.push(an(s)),r+=32+32*Math.ceil(s.length/32)}return(0,l.xW)(e)}const ln="0x0000000000000000000000000000000000000000000000000000000000000000";function un(t,e){if(t.provider)return t.provider;(0,s.vA)(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function hn(t,e){let r=(0,$r.VS)(e);if(null!=r.to&&(r.to=(0,o.tG)(r.to,t)),null!=r.from){const e=r.from;r.from=Promise.all([t.getAddress(),(0,o.tG)(e,t)]).then((([t,e])=>((0,s.MR)(t.toLowerCase()===e.toLowerCase(),"transaction from mismatch","tx.from",e),t)))}else r.from=t.getAddress();return await(0,h.k)(r)}class dn{provider;constructor(t){(0,h.n)(this,{provider:t||null})}async getNonce(t){return un(this,"getTransactionCount").getTransactionCount(await this.getAddress(),t)}async populateCall(t){return await hn(this,t)}async populateTransaction(t){const e=un(this,"populateTransaction"),r=await hn(this,t);null==r.nonce&&(r.nonce=await this.getNonce("pending")),null==r.gasLimit&&(r.gasLimit=await this.estimateGas(r));const n=await this.provider.getNetwork();if(null!=r.chainId){const e=(0,u.Ab)(r.chainId);(0,s.MR)(e===n.chainId,"transaction chainId mismatch","tx.chainId",t.chainId)}else r.chainId=n.chainId;const i=null!=r.maxFeePerGas||null!=r.maxPriorityFeePerGas;if(null==r.gasPrice||2!==r.type&&!i?0!==r.type&&1!==r.type||!i||(0,s.MR)(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",t):(0,s.MR)(!1,"eip-1559 transaction do not support gasPrice","tx",t),2!==r.type&&null!=r.type||null==r.maxFeePerGas||null==r.maxPriorityFeePerGas)if(0===r.type||1===r.type){const t=await e.getFeeData();(0,s.vA)(null!=t.gasPrice,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),null==r.gasPrice&&(r.gasPrice=t.gasPrice)}else{const t=await e.getFeeData();if(null==r.type)if(null!=t.maxFeePerGas&&null!=t.maxPriorityFeePerGas)if(r.type=2,null!=r.gasPrice){const t=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=t,r.maxPriorityFeePerGas=t}else null==r.maxFeePerGas&&(r.maxFeePerGas=t.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=t.maxPriorityFeePerGas);else null!=t.gasPrice?((0,s.vA)(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),null==r.gasPrice&&(r.gasPrice=t.gasPrice),r.type=0):(0,s.vA)(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else 2!==r.type&&3!==r.type||(null==r.maxFeePerGas&&(r.maxFeePerGas=t.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=t.maxPriorityFeePerGas))}else r.type=2;return await(0,h.k)(r)}async estimateGas(t){return un(this,"estimateGas").estimateGas(await this.populateCall(t))}async call(t){return un(this,"call").call(await this.populateCall(t))}async resolveName(t){const e=un(this,"resolveName");return await e.resolveName(t)}async sendTransaction(t){const e=un(this,"sendTransaction"),r=await this.populateTransaction(t);delete r.from;const n=ur.from(r);return await e.broadcastTransaction(await this.signTransaction(n))}}class fn{#et;#St;#rt;#at;#Tt;#Ot;constructor(t){this.#et=t,this.#St=null,this.#rt=this.#it.bind(this),this.#at=!1,this.#Tt=null,this.#Ot=!1}_subscribe(t){throw new Error("subclasses must override this")}_emitResults(t,e){throw new Error("subclasses must override this")}_recover(t){throw new Error("subclasses must override this")}async#it(t){try{null==this.#St&&(this.#St=this._subscribe(this.#et));let t=null;try{t=await this.#St}catch(e){if(!(0,s.bJ)(e,"UNSUPPORTED_OPERATION")||"eth_newFilter"!==e.operation)throw e}if(null==t)return this.#St=null,void this.#et._recoverSubscriber(this,this._recover(this.#et));const r=await this.#et.getNetwork();if(this.#Tt||(this.#Tt=r),this.#Tt.chainId!==r.chainId)throw new Error("chaid changed");if(this.#Ot)return;const n=await this.#et.send("eth_getFilterChanges",[t]);await this._emitResults(this.#et,n)}catch(e){console.log("@TODO",e)}this.#et.once("block",this.#rt)}#Bt(){const t=this.#St;t&&(this.#St=null,t.then((t=>{this.#et.destroyed||this.#et.send("eth_uninstallFilter",[t])})))}start(){this.#at||(this.#at=!0,this.#it(-2))}stop(){this.#at&&(this.#at=!1,this.#Ot=!0,this.#Bt(),this.#et.off("block",this.#rt))}pause(t){t&&this.#Bt(),this.#et.off("block",this.#rt)}resume(){this.start()}}class pn extends fn{#Lt;constructor(t,e){var r;super(t),this.#Lt=(r=e,JSON.parse(JSON.stringify(r)))}_recover(t){return new Zr(t,this.#Lt)}async _subscribe(t){return await t.send("eth_newFilter",[this.#Lt])}async _emitResults(t,e){for(const r of e)t.emit(this.#Lt,t._wrapLog(r,t._network))}}class gn extends fn{async _subscribe(t){return await t.send("eth_newPendingTransactionFilter",[])}async _emitResults(t,e){for(const r of e)t.emit("pending",r)}}const yn="bigint,boolean,function,number,string,symbol".split(/,/g);function mn(t){if(null==t||yn.indexOf(typeof t)>=0)return t;if("function"===typeof t.getAddress)return t;if(Array.isArray(t))return t.map(mn);if("object"===typeof t)return Object.keys(t).reduce(((e,r)=>(e[r]=t[r],e)),{});throw new Error(`should not happen: ${t} (${typeof t})`)}function bn(t){return new Promise((e=>{setTimeout(e,t)}))}function wn(t){return t?t.toLowerCase():t}function vn(t){return t&&"number"===typeof t.pollingInterval}const xn={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class An extends dn{address;constructor(t,e){super(t),e=(0,a.b)(e),(0,h.n)(this,{address:e})}connect(t){(0,s.vA)(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const e=mn(t),r=[];if(e.from){const n=e.from;r.push((async()=>{const r=await(0,o.tG)(n,this.provider);(0,s.MR)(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=r})())}else e.from=this.address;if(null==e.gasLimit&&r.push((async()=>{e.gasLimit=await this.provider.estimateGas({...e,from:this.address})})()),null!=e.to){const t=e.to;r.push((async()=>{e.to=await(0,o.tG)(t,this.provider)})())}r.length&&await Promise.all(r);const n=this.provider.getRpcTransaction(e);return this.provider.send("eth_sendTransaction",[n])}async sendTransaction(t){const e=await this.provider.getBlockNumber(),r=await this.sendUncheckedTransaction(t);return await new Promise(((t,n)=>{const i=[1e3,100];let a=0;const o=async()=>{try{const n=await this.provider.getTransaction(r);if(null!=n)return void t(n.replaceableTransaction(e))}catch(c){if((0,s.bJ)(c,"CANCELLED")||(0,s.bJ)(c,"BAD_DATA")||(0,s.bJ)(c,"NETWORK_ERROR")||(0,s.bJ)(c,"UNSUPPORTED_OPERATION"))return null==c.info&&(c.info={}),c.info.sendTransactionHash=r,void n(c);if((0,s.bJ)(c,"INVALID_ARGUMENT")&&(a++,null==c.info&&(c.info={}),c.info.sendTransactionHash=r,a>10))return void n(c);this.provider.emit("error",(0,s.xz)("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:c}))}this.provider._setTimeout((()=>{o()}),i.pop()||4e3)};o()}))}async signTransaction(t){const e=mn(t);if(e.from){const r=await(0,o.tG)(e.from,this.provider);(0,s.MR)(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=r}else e.from=this.address;const r=this.provider.getRpcTransaction(e);return await this.provider.send("eth_signTransaction",[r])}async signMessage(t){const e="string"===typeof t?(0,S.YW)(t):t;return await this.provider.send("personal_sign",[(0,l.c$)(e),this.address.toLowerCase()])}async signTypedData(t,e,r){const n=mn(r),i=await I.resolveNames(t,e,n,(async t=>{const e=await(0,o.tG)(t);return(0,s.MR)(null!=e,"TypedData does not support null address","value",t),e}));return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(I.getPayload(i.domain,e,i.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const e="string"===typeof t?(0,S.YW)(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),(0,l.c$)(e)])}}class Pn extends en{#xt;#Ft;#Ct;#_t;#Gt;#Tt;#Ut;#$t(){if(this.#_t)return;const t=1===this._getOption("batchMaxCount")?0:this._getOption("batchStallTime");this.#_t=setTimeout((()=>{this.#_t=null;const t=this.#Ct;for(this.#Ct=[];t.length;){const e=[t.shift()];for(;t.length&&e.length!==this.#xt.batchMaxCount;){e.push(t.shift());if(JSON.stringify(e.map((t=>t.payload))).length>this.#xt.batchMaxSize){t.unshift(e.pop());break}}(async()=>{const t=1===e.length?e[0].payload:e.map((t=>t.payload));this.emit("debug",{action:"sendRpcPayload",payload:t});try{const r=await this._send(t);this.emit("debug",{action:"receiveRpcResult",result:r});for(const{resolve:t,reject:n,payload:i}of e){if(this.destroyed){n((0,s.xz)("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:i.method}));continue}const e=r.filter((t=>t.id===i.id))[0];if(null!=e)"error"in e?n(this.getRpcError(i,e)):t(e.result);else{const t=(0,s.xz)("missing response for request","BAD_DATA",{value:r,info:{payload:i}});this.emit("error",t),n(t)}}}catch(r){this.emit("debug",{action:"receiveRpcError",error:r});for(const{reject:t}of e)t(r)}})()}}),t)}constructor(t,e){super(t,e),this.#Ft=1,this.#xt=Object.assign({},xn,e||{}),this.#Ct=[],this.#_t=null,this.#Tt=null,this.#Ut=null;{let t=null;const e=new Promise((e=>{t=e}));this.#Gt={promise:e,resolve:t}}const r=this._getOption("staticNetwork");"boolean"===typeof r?((0,s.MR)(!r||"any"!==t,"staticNetwork cannot be used on special network 'any'","options",e),r&&null!=t&&(this.#Tt=Cr.from(t))):r&&((0,s.MR)(null==t||r.matches(t),"staticNetwork MUST match network object","options",e),this.#Tt=r)}_getOption(t){return this.#xt[t]}get _network(){return(0,s.vA)(this.#Tt,"network is not available yet","NETWORK_ERROR"),this.#Tt}async _perform(t){if("call"===t.method||"estimateGas"===t.method){let e=t.transaction;if(e&&null!=e.type&&(0,u.Ab)(e.type)&&null==e.maxFeePerGas&&null==e.maxPriorityFeePerGas){const r=await this.getFeeData();null==r.maxFeePerGas&&null==r.maxPriorityFeePerGas&&(t=Object.assign({},t,{transaction:Object.assign({},e,{type:void 0})}))}}const e=this.getRpcRequest(t);return null!=e?await this.send(e.method,e.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t){if(!0!==t)return t;if(this.#Tt)return this.#Tt}return this.#Ut?await this.#Ut:this.ready?(this.#Ut=(async()=>{try{const t=Cr.from((0,u.Ab)(await this.send("eth_chainId",[])));return this.#Ut=null,t}catch(t){throw this.#Ut=null,t}})(),await this.#Ut):(this.#Ut=(async()=>{const t={id:this.#Ft++,method:"eth_chainId",params:[],jsonrpc:"2.0"};let e;this.emit("debug",{action:"sendRpcPayload",payload:t});try{e=(await this._send(t))[0],this.#Ut=null}catch(r){throw this.#Ut=null,this.emit("debug",{action:"receiveRpcError",error:r}),r}if(this.emit("debug",{action:"receiveRpcResult",result:e}),"result"in e)return Cr.from((0,u.Ab)(e.result));throw this.getRpcError(t,e)})(),await this.#Ut)}_start(){null!=this.#Gt&&null!=this.#Gt.resolve&&(this.#Gt.resolve(),this.#Gt=null,(async()=>{for(;null==this.#Tt&&!this.destroyed;)try{this.#Tt=await this._detectNetwork()}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",(0,s.xz)("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await bn(1e3)}this.#$t()})())}async _waitUntilReady(){if(null!=this.#Gt)return await this.#Gt.promise}_getSubscriber(t){return"pending"===t.type?new gn(this):"event"===t.type?this._getOption("polling")?new Zr(this,t.filter):new pn(this,t.filter):"orphan"===t.type&&"drop-log"===t.filter.orphan?new Kr("orphan"):super._getSubscriber(t)}get ready(){return null==this.#Gt}getRpcTransaction(t){const e={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach((r=>{if(null==t[r])return;let n=r;"gasLimit"===r&&(n="gas"),e[n]=(0,u.nD)((0,u.Ab)(t[r],`tx.${r}`))})),["from","to","data"].forEach((r=>{null!=t[r]&&(e[r]=(0,l.c$)(t[r]))})),t.accessList&&(e.accessList=(0,N.$)(t.accessList)),t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes.map((t=>t.toLowerCase()))),e}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[wn(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[wn(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[wn(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[wn(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&null!=t.filter.address&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(wn):t.filter.address=wn(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,e){const{method:r}=t,{error:n}=e;if("eth_estimateGas"===r&&n.message){const e=n.message;if(!e.match(/revert/i)&&e.match(/insufficient funds/i))return(0,s.xz)("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:n}})}if("eth_call"===r||"eth_estimateGas"===r){const e=kn(n),s=i.y.getBuiltinCallException("eth_call"===r?"call":"estimateGas",t.params[0],e?e.data:null);return s.info={error:n,payload:t},s}const a=JSON.stringify(function(t){const e=[];return Rn(t,e),e}(n));if("string"===typeof n.message&&n.message.match(/user denied|ethers-user-denied/i)){const e={eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"};return(0,s.xz)("user rejected action","ACTION_REJECTED",{action:e[r]||"unknown",reason:"rejected",info:{payload:t,error:n}})}if("eth_sendRawTransaction"===r||"eth_sendTransaction"===r){const e=t.params[0];if(a.match(/insufficient funds|base fee exceeds gas limit/i))return(0,s.xz)("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:e,info:{error:n}});if(a.match(/nonce/i)&&a.match(/too low/i))return(0,s.xz)("nonce has already been used","NONCE_EXPIRED",{transaction:e,info:{error:n}});if(a.match(/replacement transaction/i)&&a.match(/underpriced/i))return(0,s.xz)("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:e,info:{error:n}});if(a.match(/only replay-protected/i))return(0,s.xz)("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:r,info:{transaction:e,info:{error:n}}})}let o=!!a.match(/the method .* does not exist/i);return o||n&&n.details&&n.details.startsWith("Unauthorized method:")&&(o=!0),o?(0,s.xz)("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:n,payload:t}}):(0,s.xz)("could not coalesce error","UNKNOWN_ERROR",{error:n,payload:t})}send(t,e){if(this.destroyed)return Promise.reject((0,s.xz)("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const r=this.#Ft++,n=new Promise(((n,s)=>{this.#Ct.push({resolve:n,reject:s,payload:{method:t,params:e,id:r,jsonrpc:"2.0"}})}));return this.#$t(),n}async getSigner(t){null==t&&(t=0);const e=this.send("eth_accounts",[]);if("number"===typeof t){const r=await e;if(t>=r.length)throw new Error("no such account");return new An(this,r[t])}const{accounts:r}=await(0,h.k)({network:this.getNetwork(),accounts:e});t=(0,a.b)(t);for(const n of r)if((0,a.b)(n)===t)return new An(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map((t=>new An(this,t)))}destroy(){this.#_t&&(clearTimeout(this.#_t),this.#_t=null);for(const{payload:t,reject:e}of this.#Ct)e((0,s.xz)("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));this.#Ct=[],super.destroy()}}class En extends Pn{#Dt;constructor(t,e){super(t,e);let r=this._getOption("pollingInterval");null==r&&(r=xn.pollingInterval),this.#Dt=r}_getSubscriber(t){const e=super._getSubscriber(t);return vn(e)&&(e.pollingInterval=this.#Dt),e}get pollingInterval(){return this.#Dt}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");this.#Dt=t,this._forEachSubscriber((t=>{vn(t)&&(t.pollingInterval=this.#Dt)}))}}function kn(t){if(null==t)return null;if("string"===typeof t.message&&t.message.match(/revert/i)&&(0,l.Lo)(t.data))return{message:t.message,data:t.data};if("object"===typeof t){for(const e in t){const r=kn(t[e]);if(r)return r}return null}if("string"===typeof t)try{return kn(JSON.parse(t))}catch(e){}return null}function Rn(t,e){if(null!=t){if("string"===typeof t.message&&e.push(t.message),"object"===typeof t)for(const r in t)Rn(t[r],e);if("string"===typeof t)try{return Rn(JSON.parse(t),e)}catch(r){}}}class In extends En{#E;constructor(t,e,r){const n=Object.assign({},null!=r?r:{},{batchMaxCount:1});(0,s.MR)(t&&t.request,"invalid EIP-1193 provider","ethereum",t),super(e,n),this.#E=async(e,r)=>{const n={method:e,params:r};this.emit("debug",{action:"sendEip1193Request",payload:n});try{const e=await t.request(n);return this.emit("debug",{action:"receiveEip1193Result",result:e}),e}catch(s){const t=new Error(s.message);throw t.code=s.code,t.data=s.data,t.payload=n,this.emit("debug",{action:"receiveEip1193Error",error:t}),t}}}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){(0,s.MR)(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const e=await this.#E(t.method,t.params||[]);return[{id:t.id,result:e}]}catch(e){return[{id:t.id,error:{code:e.code,data:e.data,message:e.message}}]}}getRpcError(t,e){switch((e=JSON.parse(JSON.stringify(e))).error.code||-1){case 4001:e.error.message=`ethers-user-denied: ${e.error.message}`;break;case 4200:e.error.message=`ethers-unsupported: ${e.error.message}`}return super.getRpcError(t,e)}async hasSigner(t){null==t&&(t=0);const e=await this.send("eth_accounts",[]);return"number"===typeof t?e.length>t:(t=t.toLowerCase(),0!==e.filter((e=>e.toLowerCase()===t)).length)}async getSigner(t){if(null==t&&(t=0),!await this.hasSigner(t))try{await this.#E("eth_requestAccounts",[])}catch(e){const t=e.payload;throw this.getRpcError(t,{id:t.id,error:e})}return await super.getSigner(t)}}}}]);
//# sourceMappingURL=553.3000b7ab.chunk.js.map