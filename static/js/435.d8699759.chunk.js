(globalThis.webpackChunkwinbit32=globalThis.webpackChunkwinbit32||[]).push([[435],{65435:(t,e,r)=>{"use strict";r.d(e,{default:()=>De});var n=r(6280),i=r.n(n),s=r(30566),o=r(56498),u=r(91760),a=r.n(u),c=r(2954),p=r.n(c),h=r(74248).Buffer;function l(t){const e=h.alloc(1+4*t.length);return e[0]=t.length,t.forEach(((t,r)=>{e.writeUInt32BE(t,1+4*r)})),e}function f(t){return l(t?w(t):[])}function d(t){return a().fromPathArray(t).toString()}function w(t){return a().fromString(t).toPathArray()}function g(t){const e=p().decode(t);return e.slice(e.length-33)}function m(t){const e=p().decode(t);return{chaincode:e.slice(13,45),pubkey:e.slice(e.length-33),version:e.readUInt32BE(0)}}var E=r(90316),y=r.n(E),S=r(74248).Buffer;function I(t){if(t>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");const e=S.alloc(8,0);for(let r=0;r<e.length;r++){const n=255&t;e[r]=n,t=(t-n)/256}return e}function v(t){let e=0;if(8!=t.length)throw new Error("Expected Bufffer of lenght 8");if(0!=t[7])throw new Error("Can't encode numbers > MAX_SAFE_INT");if(t[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let r=t.length-1;r>=0;r--)e=256*e+t[r];return e}class _{constructor(){this.bufs=[]}write(t,e){const r=S.alloc(t);e(r),this.bufs.push(r)}writeUInt8(t){this.write(1,(e=>e.writeUInt8(t,0)))}writeInt32(t){this.write(4,(e=>e.writeInt32LE(t,0)))}writeUInt32(t){this.write(4,(e=>e.writeUInt32LE(t,0)))}writeUInt64(t){const e=I(t);this.writeSlice(e)}writeVarInt(t){this.bufs.push(y().encode(t))}writeSlice(t){this.bufs.push(S.from(t))}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}buffer(){return S.concat(this.bufs)}}class T{constructor(t,e=0){this.buffer=t,this.offset=e}available(){return this.buffer.length-this.offset}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){return v(this.readSlice(8))}readVarInt(){const t=y().decode(this.buffer,this.offset);return this.offset+=y().decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}}const O=50,b=4294967295;var P=r(94946),N=r.n(P),A=r(51677),k=r.n(A);function R(t){return(new(N())).update(k()("sha256").update(t).digest()).digest()}var U=r(74248).Buffer;class x{constructor(t,e){this.psbt=t,this.masterFp=e}}class C extends x{spendingCondition(t){if(1!=t.length)throw new Error("Expected single key, got "+t.length);return this.singleKeyCondition(t[0])}setInput(t,e,r,n,i){if(1!=n.length)throw new Error("Expected single key, got "+n.length);if(1!=i.length)throw new Error("Expected single path, got "+i.length);this.setSingleKeyInput(t,e,r,n[0],i[0])}setOwnOutput(t,e,r,n){if(1!=r.length)throw new Error("Expected single key, got "+r.length);if(1!=n.length)throw new Error("Expected single path, got "+n.length);this.setSingleKeyOutput(t,e,r[0],n[0])}}class H extends C{singleKeyCondition(t){const e=new _,r=R(t);return e.writeSlice(U.from([118,169,20])),e.writeSlice(r),e.writeSlice(U.from([136,172])),{scriptPubKey:e.buffer()}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"pkh(@0)"}}class L extends C{singleKeyCondition(t){const e=t.slice(1),r=new _,n=this.getTaprootOutputKey(e);return r.writeSlice(U.from([81,32])),r.writeSlice(n),{scriptPubKey:r.buffer()}}setSingleKeyInput(t,e,r,n,i){const s=n.slice(1);this.psbt.setInputTapBip32Derivation(t,s,[],this.masterFp,i),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){const i=r.slice(1);this.psbt.setOutputTapBip32Derivation(t,i,[],this.masterFp,n)}getDescriptorTemplate(){return"tr(@0)"}hashTapTweak(t){const e=s.Et.sha256(U.from("TapTweak","utf-8"));return s.Et.sha256(U.concat([e,e,t]))}getTaprootOutputKey(t){if(32!=t.length)throw new Error("Expected 32 byte pubkey. Got "+t.length);const e=U.concat([U.from([2]),t]),r=this.hashTapTweak(t);return U.from((0,o.pointAddScalar)(e,r)).slice(1)}}class B extends C{singleKeyCondition(t){const e=new _,r=this.createRedeemScript(t),n=R(r);return e.writeSlice(U.from([169,20])),e.writeSlice(n),e.writeUInt8(135),{scriptPubKey:e.buffer(),redeemScript:r}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i);const s=r.cond.redeemScript,o=this.createRedeemScript(n);if(s&&!o.equals(s))throw new Error(`User-supplied redeemScript ${s.toString("hex")} doesn't\n       match expected ${o.toString("hex")} for input ${t}`);this.psbt.setInputRedeemScript(t,o),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputRedeemScript(t,e.redeemScript),this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"sh(wpkh(@0))"}createRedeemScript(t){const e=R(t);return U.concat([U.from("0014","hex"),e])}}class M extends C{singleKeyCondition(t){const e=new _,r=R(t);return e.writeSlice(U.from([0,20])),e.writeSlice(r),{scriptPubKey:e.buffer()}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"wpkh(@0)"}}var D=r(74248).Buffer;class ${constructor(t,e=s.Et.sha256){this.leaves=t,this.h=e;const r=this.calculateRoot(t);this.rootNode=r.root,this.leafNodes=r.leaves}getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(t){return this.leafNodes[t].hash}getProof(t){if(t>=this.leaves.length)throw Error("Index out of bounds");return F(this.leafNodes[t])}calculateRoot(t){const e=t.length;if(0==e)return{root:new K(void 0,void 0,D.alloc(32,0)),leaves:[]};if(1==e){const e=new K(void 0,void 0,t[0]);return{root:e,leaves:[e]}}const r=function(t){if(t<2)throw Error("Expected n >= 2");if(function(t){return 0==(t&t-1)}(t))return t/2;return 1<<Math.floor(Math.log2(t))}(e),n=this.calculateRoot(t.slice(0,r)),i=this.calculateRoot(t.slice(r)),s=n.root,o=i.root,u=this.hashNode(s.hash,o.hash),a=new K(s,o,u);return s.parent=a,o.parent=a,{root:a,leaves:n.leaves.concat(i.leaves)}}hashNode(t,e){return this.h(D.concat([D.from([1]),t,e]))}}function G(t,e=s.Et.sha256){return function(t,e,r){return r(D.concat([t,e]))}(D.from([0]),t,e)}class K{constructor(t,e,r){this.leftChild=t,this.rightChild=e,this.hash=r}isLeaf(){return void 0==this.leftChild}}function F(t){if(!t.parent)return[];if(t.parent.leftChild==t){if(!t.parent.rightChild)throw new Error("Expected right child to exist");return[t.parent.rightChild.hash,...F(t.parent)]}if(!t.parent.leftChild)throw new Error("Expected left child to exist");return[t.parent.leftChild.hash,...F(t.parent)]}var W=r(74248).Buffer;class V{constructor(t,e){this.descriptorTemplate=t,this.keys=[e]}getWalletId(){return s.Et.sha256(this.serialize())}serialize(){const t=this.keys.map((t=>W.from(t,"ascii"))),e=new $(t.map((t=>G(t)))),r=new _;return r.writeUInt8(1),r.writeUInt8(0),r.writeVarSlice(W.from(this.descriptorTemplate,"ascii")),r.writeVarInt(this.keys.length),r.writeSlice(e.getRoot()),r.buffer()}}function q(t,e,r){const n=d(e);return`[${t.toString("hex")}${n.substring(1)}]${r}/**`}var j=r(74248).Buffer;var X,Y,z,Q=r(74248).Buffer;!function(t){t[t.TX_VERSION=2]="TX_VERSION",t[t.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",t[t.INPUT_COUNT=4]="INPUT_COUNT",t[t.OUTPUT_COUNT=5]="OUTPUT_COUNT",t[t.TX_MODIFIABLE=6]="TX_MODIFIABLE",t[t.VERSION=251]="VERSION"}(X||(X={})),function(t){t[t.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",t[t.WITNESS_UTXO=1]="WITNESS_UTXO",t[t.PARTIAL_SIG=2]="PARTIAL_SIG",t[t.SIGHASH_TYPE=3]="SIGHASH_TYPE",t[t.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",t[t.BIP32_DERIVATION=6]="BIP32_DERIVATION",t[t.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",t[t.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",t[t.PREVIOUS_TXID=14]="PREVIOUS_TXID",t[t.OUTPUT_INDEX=15]="OUTPUT_INDEX",t[t.SEQUENCE=16]="SEQUENCE",t[t.TAP_KEY_SIG=19]="TAP_KEY_SIG",t[t.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"}(Y||(Y={})),function(t){t[t.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",t[t.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",t[t.AMOUNT=3]="AMOUNT",t[t.SCRIPT=4]="SCRIPT",t[t.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"}(z||(z={}));const J=Q.from([112,115,98,116,255]);class Z extends Error{}class tt{constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}setGlobalTxVersion(t){this.setGlobal(X.TX_VERSION,at(t))}getGlobalTxVersion(){return this.getGlobal(X.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(t){this.setGlobal(X.FALLBACK_LOCKTIME,at(t))}getGlobalFallbackLocktime(){var t;return null===(t=this.getGlobalOptional(X.FALLBACK_LOCKTIME))||void 0===t?void 0:t.readUInt32LE(0)}setGlobalInputCount(t){this.setGlobal(X.INPUT_COUNT,ct(t))}getGlobalInputCount(){return pt(this.getGlobal(X.INPUT_COUNT))}setGlobalOutputCount(t){this.setGlobal(X.OUTPUT_COUNT,ct(t))}getGlobalOutputCount(){return pt(this.getGlobal(X.OUTPUT_COUNT))}setGlobalTxModifiable(t){this.setGlobal(X.TX_MODIFIABLE,t)}getGlobalTxModifiable(){return this.getGlobalOptional(X.TX_MODIFIABLE)}setGlobalPsbtVersion(t){this.setGlobal(X.VERSION,at(t))}getGlobalPsbtVersion(){return this.getGlobal(X.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(t,e){this.setInput(t,Y.NON_WITNESS_UTXO,ot(),e)}getInputNonWitnessUtxo(t){return this.getInputOptional(t,Y.NON_WITNESS_UTXO,ot())}setInputWitnessUtxo(t,e,r){const n=new _;n.writeSlice(e),n.writeVarSlice(r),this.setInput(t,Y.WITNESS_UTXO,ot(),n.buffer())}getInputWitnessUtxo(t){const e=this.getInputOptional(t,Y.WITNESS_UTXO,ot());if(!e)return;const r=new T(e);return{amount:r.readSlice(8),scriptPubKey:r.readVarSlice()}}setInputPartialSig(t,e,r){this.setInput(t,Y.PARTIAL_SIG,e,r)}getInputPartialSig(t,e){return this.getInputOptional(t,Y.PARTIAL_SIG,e)}setInputSighashType(t,e){this.setInput(t,Y.SIGHASH_TYPE,ot(),at(e))}getInputSighashType(t){const e=this.getInputOptional(t,Y.SIGHASH_TYPE,ot());if(e)return e.readUInt32LE(0)}setInputRedeemScript(t,e){this.setInput(t,Y.REDEEM_SCRIPT,ot(),e)}getInputRedeemScript(t){return this.getInputOptional(t,Y.REDEEM_SCRIPT,ot())}setInputBip32Derivation(t,e,r,n){if(33!=e.length)throw new Error("Invalid pubkey length: "+e.length);this.setInput(t,Y.BIP32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getInputBip32Derivation(t,e){const r=this.getInputOptional(t,Y.BIP32_DERIVATION,e);if(r)return this.decodeBip32Derivation(r)}setInputFinalScriptsig(t,e){this.setInput(t,Y.FINAL_SCRIPTSIG,ot(),e)}getInputFinalScriptsig(t){return this.getInputOptional(t,Y.FINAL_SCRIPTSIG,ot())}setInputFinalScriptwitness(t,e){this.setInput(t,Y.FINAL_SCRIPTWITNESS,ot(),e)}getInputFinalScriptwitness(t){return this.getInput(t,Y.FINAL_SCRIPTWITNESS,ot())}setInputPreviousTxId(t,e){this.setInput(t,Y.PREVIOUS_TXID,ot(),e)}getInputPreviousTxid(t){return this.getInput(t,Y.PREVIOUS_TXID,ot())}setInputOutputIndex(t,e){this.setInput(t,Y.OUTPUT_INDEX,ot(),at(e))}getInputOutputIndex(t){return this.getInput(t,Y.OUTPUT_INDEX,ot()).readUInt32LE(0)}setInputSequence(t,e){this.setInput(t,Y.SEQUENCE,ot(),at(e))}getInputSequence(t){var e,r;return null!==(r=null===(e=this.getInputOptional(t,Y.SEQUENCE,ot()))||void 0===e?void 0:e.readUInt32LE(0))&&void 0!==r?r:4294967295}setInputTapKeySig(t,e){this.setInput(t,Y.TAP_KEY_SIG,ot(),e)}getInputTapKeySig(t){return this.getInputOptional(t,Y.TAP_KEY_SIG,ot())}setInputTapBip32Derivation(t,e,r,n,i){if(32!=e.length)throw new Error("Invalid pubkey length: "+e.length);const s=this.encodeTapBip32Derivation(r,n,i);this.setInput(t,Y.TAP_BIP32_DERIVATION,e,s)}getInputTapBip32Derivation(t,e){const r=this.getInput(t,Y.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}getInputKeyDatas(t,e){return this.getKeyDatas(this.inputMaps[t],e)}setOutputRedeemScript(t,e){this.setOutput(t,z.REDEEM_SCRIPT,ot(),e)}getOutputRedeemScript(t){return this.getOutput(t,z.REDEEM_SCRIPT,ot())}setOutputBip32Derivation(t,e,r,n){this.setOutput(t,z.BIP_32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getOutputBip32Derivation(t,e){const r=this.getOutput(t,z.BIP_32_DERIVATION,e);return this.decodeBip32Derivation(r)}setOutputAmount(t,e){this.setOutput(t,z.AMOUNT,ot(),I(e))}getOutputAmount(t){return v(this.getOutput(t,z.AMOUNT,ot()))}setOutputScript(t,e){this.setOutput(t,z.SCRIPT,ot(),e)}getOutputScript(t){return this.getOutput(t,z.SCRIPT,ot())}setOutputTapBip32Derivation(t,e,r,n,i){const s=this.encodeTapBip32Derivation(r,n,i);this.setOutput(t,z.TAP_BIP32_DERIVATION,e,s)}getOutputTapBip32Derivation(t,e){const r=this.getOutput(t,z.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}deleteInputEntries(t,e){this.inputMaps[t].forEach(((t,r,n)=>{this.isKeyType(r,e)&&n.delete(r)}))}copy(t){this.copyMap(this.globalMap,t.globalMap),this.copyMaps(this.inputMaps,t.inputMaps),this.copyMaps(this.outputMaps,t.outputMaps)}copyMaps(t,e){t.forEach(((t,r)=>{const n=new Map;this.copyMap(t,n),e[r]=n}))}copyMap(t,e){t.forEach(((t,r)=>e.set(r,Q.from(t))))}serialize(){const t=new _;return t.writeSlice(Q.from([112,115,98,116,255])),st(t,this.globalMap),this.inputMaps.forEach((e=>{st(t,e)})),this.outputMaps.forEach((e=>{st(t,e)})),t.buffer()}deserialize(t){const e=new T(t);if(!e.readSlice(5).equals(J))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,e););for(let r=0;r<this.getGlobalInputCount();r++)for(this.inputMaps[r]=new Map;this.readKeyPair(this.inputMaps[r],e););for(let r=0;r<this.getGlobalOutputCount();r++)for(this.outputMaps[r]=new Map;this.readKeyPair(this.outputMaps[r],e););}readKeyPair(t,e){const r=e.readVarInt();if(0==r)return!1;return ut(t,e.readUInt8(),e.readSlice(r-1),e.readVarSlice()),!0}getKeyDatas(t,e){const r=[];return t.forEach(((t,n)=>{this.isKeyType(n,[e])&&r.push(Q.from(n.substring(2),"hex"))})),r}isKeyType(t,e){const r=Q.from(t.substring(0,2),"hex").readUInt8(0);return e.some((t=>t==r))}setGlobal(t,e){const r=new rt(t,Q.from([]));this.globalMap.set(r.toString(),e)}getGlobal(t){return et(this.globalMap,t,ot(),!1)}getGlobalOptional(t){return et(this.globalMap,t,ot(),!0)}setInput(t,e,r,n){ut(this.getMap(t,this.inputMaps),e,r,n)}getInput(t,e,r){return et(this.inputMaps[t],e,r,!1)}getInputOptional(t,e,r){return et(this.inputMaps[t],e,r,!0)}setOutput(t,e,r,n){ut(this.getMap(t,this.outputMaps),e,r,n)}getOutput(t,e,r){return et(this.outputMaps[t],e,r,!1)}getMap(t,e){return e[t]?e[t]:e[t]=new Map}encodeBip32Derivation(t,e){const r=new _;return this.writeBip32Derivation(r,t,e),r.buffer()}decodeBip32Derivation(t){const e=new T(t);return this.readBip32Derivation(e)}writeBip32Derivation(t,e,r){t.writeSlice(e),r.forEach((e=>{t.writeUInt32(e)}))}readBip32Derivation(t){const e=t.readSlice(4),r=[];for(;t.offset<t.buffer.length;)r.push(t.readUInt32());return{masterFingerprint:e,path:r}}encodeTapBip32Derivation(t,e,r){const n=new _;return n.writeVarInt(t.length),t.forEach((t=>{n.writeSlice(t)})),this.writeBip32Derivation(n,e,r),n.buffer()}decodeTapBip32Derivation(t){const e=new T(t),r=e.readVarInt(),n=[];for(let s=0;s<r;s++)n.push(e.readSlice(32));const i=this.readBip32Derivation(e);return Object.assign({hashes:n},i)}}function et(t,e,r,n){if(!t)throw Error("No such map");const i=new rt(e,r),s=t.get(i.toString());if(!s){if(n)return;throw new Z(i.toString())}return Q.from(s)}class rt{constructor(t,e){this.keyType=t,this.keyData=e}toString(){const t=new _;return this.toBuffer(t),t.buffer().toString("hex")}serialize(t){t.writeVarInt(1+this.keyData.length),this.toBuffer(t)}toBuffer(t){t.writeUInt8(this.keyType),t.writeSlice(this.keyData)}}class nt{constructor(t,e){this.key=t,this.value=e}serialize(t){this.key.serialize(t),t.writeVarSlice(this.value)}}function it(t){return new rt(t.readUInt8(0),t.slice(1))}function st(t,e){for(const r of e.keys()){const n=e.get(r);new nt(it(Q.from(r,"hex")),n).serialize(t)}t.writeUInt8(0)}function ot(){return Q.from([])}function ut(t,e,r,n){const i=new rt(e,r);t.set(i.toString(),n)}function at(t){const e=Q.alloc(4);return e.writeUInt32LE(t,0),e}function ct(t){const e=new _;return e.writeVarInt(t),e.buffer()}function pt(t){return new T(t).readVarInt()}var ht=r(74248).Buffer;function lt(t,e){const r=[Y.BIP32_DERIVATION,Y.PARTIAL_SIG,Y.TAP_BIP32_DERIVATION,Y.TAP_KEY_SIG],n=!!t.getInputWitnessUtxo(e),i=!!t.getInputNonWitnessUtxo(e);n&&i&&r.push(Y.NON_WITNESS_UTXO),t.deleteInputEntries(e,r)}function ft(t,e){if(e.length<=75)t.writeUInt8(e.length);else if(e.length<=256)t.writeUInt8(76),t.writeUInt8(e.length);else if(e.length<=65536){t.writeUInt8(77);const r=ht.alloc(2);r.writeUInt16LE(e.length,0),t.writeSlice(r)}t.writeSlice(e)}var dt=r(74248).Buffer;function wt(t,e){if(t[e]<253)return[t[e],1];if(253===t[e])return[(t[e+2]<<8)+t[e+1],3];if(254===t[e])return[(t[e+4]<<24)+(t[e+3]<<16)+(t[e+2]<<8)+t[e+1],5];throw new Error("getVarint called with unexpected parameters")}function gt(t){if(t<253){const e=dt.alloc(1);return e[0]=t,e}if(t<=65535){const e=dt.alloc(3);return e[0]=253,e[1]=255&t,e[2]=t>>8&255,e}const e=dt.alloc(5);return e[0]=254,e[1]=255&t,e[2]=t>>8&255,e[3]=t>>16&255,e[4]=t>>24&255,e}var mt=r(74248).Buffer;function Et({outputs:t}){let e=mt.alloc(0);return"undefined"!==typeof t&&(e=mt.concat([e,gt(t.length)]),t.forEach((t=>{e=mt.concat([e,t.amount,gt(t.script.length),t.script])}))),e}function yt(t,e,r,n=[]){const i=n.includes("decred"),s=n.includes("zcash"),o=n.includes("bech32");let u=mt.alloc(0);const a="undefined"!=typeof t.witness&&!e;t.inputs.forEach((t=>{u=i||o?mt.concat([u,t.prevout,mt.from([0]),t.sequence]):mt.concat([u,t.prevout,gt(t.script.length),t.script,t.sequence])}));let c=Et(t);return"undefined"!==typeof t.outputs&&"undefined"!==typeof t.locktime&&(c=mt.concat([c,a&&t.witness||mt.alloc(0),t.locktime,t.nExpiryHeight||mt.alloc(0),t.extraData||mt.alloc(0)])),s?mt.concat([t.version,t.nVersionGroupId||mt.alloc(0),mt.from([180,208,214,194]),t.locktime||mt.from([0,0,0,0]),t.nExpiryHeight||mt.from([0,0,0,0]),a?mt.from("0001","hex"):mt.alloc(0),gt(t.inputs.length),u,c]):mt.concat([t.version,r||mt.alloc(0),t.nVersionGroupId||mt.alloc(0),a?mt.from("0001","hex"):mt.alloc(0),gt(t.inputs.length),u,c])}var St=r(74248).Buffer,It=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class vt{constructor(t){this.client=t}getWalletXpub(t){return It(this,arguments,void 0,(function*({path:t,xpubVersion:e}){const r=w(t),n=yield this.client.getExtendedPubkey(!1,r),i=m(n);if(i.version!=e)throw new Error(`Expected xpub version ${e} doesn't match the xpub version from the device ${i.version}`);return n}))}getWalletPublicKey(t,e){return It(this,void 0,void 0,(function*(){var r,n;if(!function(t){const e=w(t);if(e.length>=3&&e.length<=5&&Nt.has(e[0])&&Pt.has(e[1])&&Tt(e[2])&&bt(e[3])&&Ot(e[4]))return!0;if(e.length>=4&&e.length<=6&&At.has(e[0])&&Pt.has(e[1])&&Tt(e[2])&&Tt(e[3])&&bt(e[4])&&Ot(e[5]))return!0;return!1}(t))throw Error(`non-standard path: ${t}`);const i=w(t),s=yield this.client.getExtendedPubkey(!1,i),u=null!==(r=null===e||void 0===e?void 0:e.verify)&&void 0!==r&&r,a=yield this.getWalletAddress(i,function(t){if("legacy"==t)return"pkh(@0)";if("p2sh"==t)return"sh(wpkh(@0))";if("bech32"==t)return"wpkh(@0)";if("bech32m"==t)return"tr(@0)";throw new Error("Unsupported address format "+t)}(null!==(n=null===e||void 0===e?void 0:e.format)&&void 0!==n?n:"legacy"),u),c=m(s);return{publicKey:St.from((0,o.pointCompress)(c.pubkey,!1)).toString("hex"),bitcoinAddress:a,chainCode:c.chaincode.toString("hex")}}))}getWalletAddress(t,e,r){return It(this,void 0,void 0,(function*(){const n=function(t){for(let e=t.length-1;e>=0;e--)if(t[e]>=2147483648)return t.slice(0,e+1);return[]}(t);if(n.length+2!=t.length)return"";const i=yield this.client.getExtendedPubkey(!1,n),s=yield this.client.getMasterFingerprint(),o=new V(e,q(s,n,i)),u=t.slice(-2,t.length);return this.client.getWalletAddress(o,St.alloc(32,0),u[0],u[1],r)}))}createPaymentTransaction(t){return It(this,void 0,void 0,(function*(){const e=t.inputs.length;if(0==e)throw Error("No inputs");const r=new tt,n=yield this.client.getMasterFingerprint(),i=function(t,e,r){return t.additionals.includes("bech32m")?new L(e,r):t.additionals.includes("bech32")?new M(e,r):t.segwit?new B(e,r):new H(e,r)}(t,r,n);void 0!=t.lockTime&&r.setGlobalFallbackLocktime(t.lockTime),r.setGlobalInputCount(e),r.setGlobalPsbtVersion(2),r.setGlobalTxVersion(2);let s=0;const o=()=>{t.onDeviceStreaming&&t.onDeviceStreaming({total:2*e,index:s,progress:++s/(2*e)})};let u="",a=[];for(let y=0;y<e;y++){o();const e=w(t.associatedKeysets[y]);""==u&&(a=e.slice(0,-2),u=yield this.client.getExtendedPubkey(!1,a)),yield this.setInput(r,y,t.inputs[y],e,i,n,t.sigHashType)}const c=St.from(t.outputScriptHex,"hex"),p=new T(c),h=p.readVarInt();r.setGlobalOutputCount(h);const l=yield this.outputScriptAt(a,i,t.changePath);let f=!l;for(let y=0;y<h;y++){const e=Number(p.readUInt64()),n=p.readVarSlice();r.setOutputAmount(y,e),r.setOutputScript(y,n);if(l&&n.equals(null===l||void 0===l?void 0:l.cond.scriptPubKey)){f=!0;const e=w(t.changePath),r=l.pubkey;i.setOwnOutput(y,l.cond,[r],[e])}}if(!f)throw new Error("Change script not found among outputs! "+(null===l||void 0===l?void 0:l.cond.scriptPubKey.toString("hex")));const d=q(n,a,u),g=new V(i.getDescriptorTemplate(),d);t.onDeviceSignatureRequested&&t.onDeviceSignatureRequested();let m=!1;yield this.signPsbt(r,g,(()=>{m||(m=!0,t.onDeviceSignatureGranted&&t.onDeviceSignatureGranted()),o()})),function(t){const e=t.getGlobalInputCount();for(let r=0;r<e;r++){const e=t.getInputKeyDatas(r,Y.PARTIAL_SIG),n=t.getInputTapKeySig(r);if(0==e.length&&!n)throw Error(`No signature for input ${r} present`);if(e.length>0){if(e.length>1)throw Error(`Expected exactly one signature, got ${e.length}`);if(n)throw Error("Both taproot and non-taproot signatures present.");const i=!!t.getInputWitnessUtxo(r),s=t.getInputRedeemScript(r),o=!!s,u=t.getInputPartialSig(r,e[0]);if(!u)throw new Error("Expected partial signature for input "+r);if(i){const n=new _;if(n.writeVarInt(2),n.writeVarInt(u.length),n.writeSlice(u),n.writeVarInt(e[0].length),n.writeSlice(e[0]),t.setInputFinalScriptwitness(r,n.buffer()),o){if(!s||0==s.length)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+r);const e=new _;e.writeUInt8(s.length),e.writeSlice(s),t.setInputFinalScriptsig(r,e.buffer())}}else{const n=new _;ft(n,u),ft(n,e[0]),t.setInputFinalScriptsig(r,n.buffer())}}else{const e=t.getInputTapKeySig(r);if(!e)throw Error("No taproot signature found");if(64!=e.length&&65!=e.length)throw Error("Unexpected length of schnorr signature.");const n=new _;n.writeVarInt(1),n.writeVarSlice(e),t.setInputFinalScriptwitness(r,n.buffer())}lt(t,r)}}(r);const E=function(t){var e,r;const n=new _;n.writeUInt32(t.getGlobalTxVersion());const i=!!t.getInputWitnessUtxo(0);i&&n.writeSlice(j.from([0,1]));const s=t.getGlobalInputCount();n.writeVarInt(s);const o=new _;for(let a=0;a<s;a++)n.writeSlice(t.getInputPreviousTxid(a)),n.writeUInt32(t.getInputOutputIndex(a)),n.writeVarSlice(null!==(e=t.getInputFinalScriptsig(a))&&void 0!==e?e:j.from([])),n.writeUInt32(t.getInputSequence(a)),i&&o.writeSlice(t.getInputFinalScriptwitness(a));const u=t.getGlobalOutputCount();n.writeVarInt(u);for(let a=0;a<u;a++)n.writeUInt64(t.getOutputAmount(a)),n.writeVarSlice(t.getOutputScript(a));return n.writeSlice(o.buffer()),n.writeUInt32(null!==(r=t.getGlobalFallbackLocktime())&&void 0!==r?r:0),n.buffer()}(r);return E.toString("hex")}))}signMessage(t){return It(this,arguments,void 0,(function*({path:t,messageHex:e}){const r=w(t),n=St.from(e,"hex"),i=yield this.client.signMessage(n,r),s=St.from(i,"base64");return{v:s.readUInt8()-27-4,r:s.slice(1,33).toString("hex"),s:s.slice(33,65).toString("hex")}}))}outputScriptAt(t,e,r){return It(this,void 0,void 0,(function*(){if(!r)return;const n=w(r);for(let e=0;e<t.length;e++)if(t[e]!=n[e])throw new Error(`Path ${r} not in account ${d(t)}`);const i=g(yield this.client.getExtendedPubkey(!1,n));return{cond:e.spendingCondition([i]),pubkey:i}}))}setInput(t,e,r,n,i,o,u){return It(this,void 0,void 0,(function*(){const o=r[0],a=r[1],c=r[2]?St.from(r[2],"hex"):void 0,p=r[3];void 0!=p&&t.setInputSequence(e,p),void 0!=u&&t.setInputSighashType(e,u);const h=yt(o,!0),l=s.Et.hash256(h),f=g(yield this.client.getExtendedPubkey(!1,n));if(!o.outputs)throw Error("Missing outputs array in transaction to sign");const d=o.outputs[a],w={cond:{scriptPubKey:d.script,redeemScript:c},amount:d.amount};i.setInput(e,h,w,[f],[n]),t.setInputPreviousTxId(e,l),t.setInputOutputIndex(e,a)}))}signPsbt(t,e,r){return It(this,void 0,void 0,(function*(){(yield this.client.signPsbt(t,e,St.alloc(32,0),r)).forEach(((e,r)=>{const n=t.getInputKeyDatas(r,Y.BIP32_DERIVATION);let i;if(1!=n.length){if(i=t.getInputKeyDatas(r,Y.TAP_BIP32_DERIVATION),0==i.length)throw Error(`Missing pubkey derivation for input ${r}`);t.setInputTapKeySig(r,e)}else i=n[0],t.setInputPartialSig(r,i,e)}))}))}}const _t=2147483648,Tt=t=>t>=_t,Ot=t=>void 0===t||t<_t,bt=t=>void 0===t||0===t||1===t,Pt=new Set([0,1,88].map((t=>t+_t))),Nt=new Set([44,49,84,86].map((t=>t+_t))),At=new Set([48].map((t=>t+_t)));var kt=r(59008),Rt=r.n(kt),Ut=r(34401),xt=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const Ct={legacy:0,p2sh:1,bech32:2,cashaddr:3};function Ht(t,e){return xt(this,void 0,void 0,(function*(){const{path:r,verify:n,format:i}=Object.assign({verify:!1,format:"legacy"},e);if(!(i in Ct))throw new Error("btc.getWalletPublicKey invalid format="+i);const s=f(r),o=n?1:0,u=Ct[i],a=yield t.send(224,64,o,u,s),c=a[0],p=a[1+c];return{publicKey:a.slice(1,1+c).toString("hex"),bitcoinAddress:a.slice(1+c+1,1+c+1+p).toString("ascii"),chainCode:a.slice(1+c+1+p,1+c+1+p+32).toString("hex")}}))}var Lt=r(91710),Bt=r.n(Lt),Mt=r(74248).Buffer,Dt=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function $t(t,e,r){return Dt(this,void 0,void 0,(function*(){let n,i=!1;if("number"===typeof r){i=!0;const t=Mt.alloc(4);t.writeUInt32BE(r,0),n=Mt.concat([t,e],e.length+4)}else n=e;const s=yield t.send(224,66,i?0:128,0,n);return s.slice(0,s.length-2).toString("hex")}))}function Gt(t,e,r){return Dt(this,arguments,void 0,(function*(t,e,r,n=[]){const{version:i,inputs:s,outputs:o,locktime:u,nExpiryHeight:a,extraData:c}=r;if(!o||!u)throw new Error("getTrustedInput: locktime & outputs is expected");const p=n.includes("decred"),h=n.includes("stealthcoin"),l=(e,r)=>Dt(this,void 0,void 0,(function*(){const n=r||Mt.alloc(0),i=[];let s,o=0;for(;o!==e.length;){const t=e.length-o>O?O:e.length-o;o+t!==e.length?i.push(e.slice(o,o+t)):i.push(Mt.concat([e.slice(o,o+t),n])),o+=t}0===e.length&&i.push(n);for(const e of i)s=yield $t(t,e);return s})),f=e=>$t(t,e);yield $t(t,Mt.concat([r.version,r.timestamp||Mt.alloc(0),r.nVersionGroupId||Mt.alloc(0),gt(s.length)]),e);for(const m of s){const e=h&&0===Mt.compare(i,Mt.from([2,0,0,0])),r=p?m.tree||Mt.from([0]):Mt.alloc(0),n=Mt.concat([m.prevout,r,e?Mt.from([0]):gt(m.script.length)]);yield $t(t,n),yield p?f(Mt.concat([m.script,m.sequence])):e?f(m.sequence):l(m.script,m.sequence)}yield $t(t,gt(o.length));for(const m of o){const e=Mt.concat([m.amount,p?Mt.from([0,0]):Mt.alloc(0),gt(m.script.length),m.script]);yield $t(t,e)}const d=[];let w;if(a&&a.length>0&&d.push(a),c&&c.length>0&&d.push(c),d.length){const t=Mt.concat(d);w=p?t:Mt.concat([gt(t.length),t])}const g=yield l(Mt.concat([u,w||Mt.alloc(0)]));return Bt()(g,"missing result in processScriptBlocks"),g}))}var Kt=r(74248).Buffer,Ft=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function Wt(t,e,r,n,i=!1,s=!1,o=[]){const u=o.includes("cashaddr")?3:i?o.includes("sapling")?5:s?4:2:0;return t.send(224,68,r?0:128,e?u:128,n)}function Vt(t,e,r,n){return Ft(this,arguments,void 0,(function*(t,e,r,n,i=!1,s=!1,o=[],u=!1){let a=Kt.concat([r.version,r.timestamp||Kt.alloc(0),r.nVersionGroupId||Kt.alloc(0),gt(r.inputs.length)]);yield Wt(t,e,!0,a,i,s,o);let c=0;const p=o.includes("decred");for(const h of r.inputs){let r;const l=n[c].value;r=i?u&&n[c].trustedInput?Kt.from([1,l.length]):Kt.from([2]):n[c].trustedInput?Kt.from([1,n[c].value.length]):Kt.from([0]),a=Kt.concat([r,l,p?Kt.from([0]):Kt.alloc(0),gt(h.script.length)]),yield Wt(t,e,!1,a,i,s,o);const f=[];let d=0;if(0===h.script.length)f.push(h.sequence);else for(;d!==h.script.length;){const t=h.script.length-d>O?O:h.script.length-d;d+t!==h.script.length?f.push(h.script.slice(d,d+t)):f.push(Kt.concat([h.script.slice(d,d+t),h.sequence])),d+=t}for(const n of f)yield Wt(t,e,!1,n,i,s,o);c++}}))}var qt=r(74248).Buffer;function jt(t,e,r,n=[]){if(!r)throw new Error("getTrustedInputBIP143: missing tx");if(n.includes("decred"))throw new Error("Decred does not implement BIP143");let i=k()("sha256").update(k()("sha256").update(yt(r,!0)).digest()).digest();const s=qt.alloc(4);s.writeUInt32LE(e,0);const{outputs:o,locktime:u}=r;if(!o||!u)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!o[e])throw new Error("getTrustedInputBIP143: wrong index");return i=qt.concat([i,s,o[e].amount]),i.toString("hex")}var Xt=r(74248).Buffer;function Yt(t){const e=0!==(1&t[64])?3:2,r=Xt.alloc(1);return r[0]=e,Xt.concat([r,t.slice(1,33)])}var zt=r(74248).Buffer;function Qt(t,e,r,n,i,s=[]){const o=s.includes("decred"),u=f(e),a=zt.alloc(4);a.writeUInt32BE(r,0);let c=o?zt.concat([u,a,i||zt.from([0,0,0,0]),zt.from([n])]):zt.concat([u,zt.from([0]),a,zt.from([n])]);return i&&!o&&(c=zt.concat([c,i])),t.send(224,72,0,0,c).then((t=>t.length>0?(t[0]=48,t.slice(0,t.length-2)):t))}var Jt=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function Zt(t,e){const r=f(e);return t.send(224,74,255,0,r)}function te(t,e){return Jt(this,arguments,void 0,(function*(t,e,r=[]){let n=0;const i=Number(128);if(r.includes("decred"))return t.send(224,74,i,0,e);for(;n<e.length;){const r=n+O>=e.length?e.length-n:O,i=n+r===e.length?128:0,s=e.slice(n,n+r);yield t.send(224,74,i,0,s),n+=r}}))}var ee=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const re=t=>ee(void 0,void 0,void 0,(function*(){const e=yield t.send(176,1,0,0);let r=0;const n=e[r++];Bt()(1===n,"getAppAndVersion: format not supported");const i=e[r++],s=e.slice(r,r+=i).toString("ascii"),o=e[r++],u=e.slice(r,r+=o).toString("ascii"),a=e[r++];return{name:s,version:u,flags:e.slice(r,r+=a)}}));var ne=r(74248).Buffer,ie=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const se={lockTime:0,sigHashType:1,segwit:!1,additionals:[],onDeviceStreaming:t=>{},onDeviceSignatureGranted:()=>{},onDeviceSignatureRequested:()=>{}};function oe(t,e){return ie(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},se),e),{inputs:n,associatedKeysets:s,changePath:o,outputScriptHex:u,lockTime:a,sigHashType:c,segwit:p,initialTimestamp:h,additionals:l,expiryHeight:f,onDeviceStreaming:d,onDeviceSignatureGranted:w,onDeviceSignatureRequested:g}=r;let m=r.useTrustedInputForSegwit;if(void 0===m)try{m=function({version:t,name:e}){return"Decred"!==e&&("Exchange"===e||i().gte(t,"1.4.0"))}(yield re(t))}catch(G){if(27904!==G.statusCode)throw G;m=!1}const E=(t,e)=>{const{length:r}=n;if(r<3)return;const i=r*t+e,s=2*r;d({progress:i/s,total:s,index:i})},y=l.includes("decred"),S=l.includes("zcash"),I=l.includes("stealthcoin"),v=Date.now(),_=l.includes("sapling"),T=p&&l.includes("bech32"),O=p||!!l&&(l.includes("abc")||l.includes("gold")||l.includes("bip143"))||!!f&&!y,P=ne.alloc(4);P.writeUInt32LE(a,0);const N=ne.alloc(0),A=ne.alloc(0),k=ne.alloc(4);f&&!y?k.writeUInt32LE(S?2147483653:_?2147483652:2147483651,0):I?k.writeUInt32LE(2,0):k.writeUInt32LE(1,0);const U=[],x=[],C=[],H=[];let L=!0;const B={inputs:[],version:k,timestamp:ne.alloc(0)},M=O&&!m?jt:Gt,D=ne.from(u,"hex");E(0,0);for(const e of n){{const r=yield M(t,e[1],e[0],l);(0,Ut.Rm)("hw","got trustedInput="+r);const n=ne.alloc(4);n.writeUInt32LE(e.length>=4&&"number"===typeof e[3]?e[3]:b,0),U.push({trustedInput:!0,value:ne.from(r,"hex"),sequence:n})}const{outputs:r}=e[0],n=e[1];r&&n<=r.length-1&&x.push(r[n]),f&&!y?(B.nVersionGroupId=ne.from(S?[10,39,167,38]:_?[133,32,47,137]:[112,130,196,3]),B.nExpiryHeight=f,B.extraData=ne.from(_?[0,0,0,0,0,0,0,0,0,0,0]:[0])):y&&(B.nExpiryHeight=f)}B.inputs=n.map(((t,e)=>{const r=ne.alloc(4);return r.writeUInt32LE(t.length>=4&&"number"===typeof t[3]?t[3]:b,0),{script:S?x[e].script:N,prevout:A,sequence:r}}));{const e=[];for(let r=0;r<n.length;r++){const n=yield Ht(t,{path:s[r]});E(0,r+1),e.push(n)}for(let t=0;t<e.length;t++)H.push(Yt(ne.from(e[t].publicKey,"hex")))}void 0!==h&&(B.timestamp=ne.alloc(4),B.timestamp.writeUInt32LE(Math.floor(h+(Date.now()-v)/1e3),0)),g(),O&&(yield Vt(t,!0,B,U,!0,!!f,l,m),o&&(yield Zt(t,o)),yield te(t,D)),f&&!y&&(yield Qt(t,"",a,1,f));for(let e=0;e<n.length;e++){const r=n[e],i=n[e].length>=3&&"string"===typeof r[2]?ne.from(r[2],"hex"):p?ne.concat([ne.from([118,169,20]),R(H[e]),ne.from([136,172])]):x[e].script,u=Object.assign({},B),h=O?[U[e]]:U;O?u.inputs=[Object.assign(Object.assign({},u.inputs[e]),{script:i})]:u.inputs[e].script=i,yield Vt(t,!O&&L,u,h,O,!!f&&!y,l,m),O||(o&&(yield Zt(t,o)),yield te(t,D,l)),L&&(w(),E(1,0));const d=yield Qt(t,s[e],a,c,f,l);E(1,e+1),C.push(d),B.inputs[e].script=N,L&&(L=!1)}for(let t=0;t<n.length;t++){if(p)B.witness=ne.alloc(0),T||(B.inputs[t].script=ne.concat([ne.from("160014","hex"),R(H[t])]));else{const e=ne.alloc(1),r=ne.alloc(1);e[0]=C[t].length,r[0]=H[t].length,B.inputs[t].script=ne.concat([e,C[t],r,H[t]])}const e=O&&!m?0:4;B.inputs[t].prevout=U[t].value.slice(e,e+36)}B.locktime=P;let $=ne.concat([yt(B,!1,B.timestamp,l),D]);if(p&&!y){let t=ne.alloc(0);for(let e=0;e<n.length;e++){const r=ne.concat([ne.from("02","hex"),ne.from([C[e].length]),C[e],ne.from([H[e].length]),H[e]]);t=ne.concat([t,r])}$=ne.concat([$,t])}if(S||($=ne.concat([$,P]),f&&($=ne.concat([$,B.nExpiryHeight||ne.alloc(0),B.extraData||ne.alloc(0)]))),y){let t=ne.from([B.inputs.length]);n.forEach(((e,r)=>{t=ne.concat([t,ne.from([0,0,0,0,0,0,0,0]),ne.from([0,0,0,0]),ne.from([255,255,255,255]),ne.from([B.inputs[r].script.length]),B.inputs[r].script])})),$=ne.concat([$,t])}return S&&($=ne.concat([$,ne.from([0,0,0])])),$.toString("hex")}))}var ue=r(74248).Buffer,ae=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};var ce=r(74248).Buffer,pe=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class he{constructor(t){this.transport=t,this.derivationsCache={}}derivatePath(t){return pe(this,void 0,void 0,(function*(){if(this.derivationsCache[t])return this.derivationsCache[t];const e=yield Ht(this.transport,{path:t});return this.derivationsCache[t]=e,e}))}getWalletXpub(t){return pe(this,arguments,void 0,(function*({path:t,xpubVersion:e}){const r=w(t),n=r.slice(0,-1),i=yield this.derivatePath(d(n)),s=yield this.derivatePath(t),o=function(t){return(e=t,function(t){return(new(N())).update(t).digest()}(de(e))).slice(0,4);var e}(fe(ce.from(i.publicKey,"hex")));return function(t,e,r,n,i,s){const o=le(n);o[0]|=128;const u=ce.concat([le(t),ce.from([e]),r,o,i,s]),a=(c=u,de(de(c))).slice(0,4);var c;return Rt().encode(ce.concat([u,a]))}(e,r.length,o,r[r.length-1],ce.from(s.chainCode,"hex"),fe(ce.from(s.publicKey,"hex")))}))}getWalletPublicKey(t,e){if("bech32m"===(null===e||void 0===e?void 0:e.format))throw new Error("Unsupported address format bech32m");return Ht(this.transport,Object.assign(Object.assign({},e),{path:t}))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return oe(this.transport,t)}signMessage(t){return pe(this,arguments,void 0,(function*({path:t,messageHex:e}){return function(t,e){return ae(this,arguments,void 0,(function*(t,{path:e,messageHex:r}){const n=a().fromString(e).toPathArray(),i=ue.from(r,"hex");let s=0;for(;s!==i.length;){const e=0===s?O-1-4*n.length-4:O,r=s+e>i.length?i.length-s:e,o=ue.alloc(0===s?1+4*n.length+2+r:r);0===s?(o[0]=n.length,n.forEach(((t,e)=>{o.writeUInt32BE(t,1+4*e)})),o.writeUInt16BE(i.length,1+4*n.length),i.copy(o,1+4*n.length+2,s,s+r)):i.copy(o,0,s,s+r),yield t.send(224,78,0,0===s?1:128,o),s+=r}const o=yield t.send(224,78,128,0,ue.from([0])),u=o[0]-48;let c=o.slice(4,4+o[3]);0===c[0]&&(c=c.slice(1)),c=c.toString("hex"),s=4+o[3]+2;let p=o.slice(s,s+o[s-1]);return 0===p[0]&&(p=p.slice(1)),p=p.toString("hex"),{v:u,r:c,s:p}}))}(this.transport,{path:t,messageHex:e})}))}}function le(t){const e=ce.allocUnsafe(4);return e.writeUInt32BE(t,0),e}const fe=t=>ce.concat([ce.from([2+(1&t[64])]),t.slice(1,33)]);function de(t){return k()("sha256").update(t).digest()}var we=r(74248).Buffer;class ge{constructor(t,e){if(t.length!=e.length)throw new Error("keys and values should have the same length");for(let r=0;r<t.length-1;r++)if(t[r].toString("hex")>=t[r+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=t,this.keysTree=new $(t.map((t=>G(t)))),this.values=e,this.valuesTree=new $(e.map((t=>G(t))))}commitment(){return we.concat([gt(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}}var me=r(74248).Buffer;class Ee extends tt{constructor(t){super(),this.inputMerkleMaps=[],this.outputMerkleMaps=[],t.copy(this),this.globalMerkleMap=Ee.createMerkleMap(this.globalMap);for(let e=0;e<this.getGlobalInputCount();e++)this.inputMerkleMaps.push(Ee.createMerkleMap(this.inputMaps[e]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map((t=>t.commitment()));for(let e=0;e<this.getGlobalOutputCount();e++)this.outputMerkleMaps.push(Ee.createMerkleMap(this.outputMaps[e]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map((t=>t.commitment()))}getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(t){const e=[...t.keys()].sort(),r=e.map((e=>{const r=t.get(e);if(!r)throw new Error("No value for key "+e);return r})),n=e.map((t=>me.from(t,"hex")));return new ge(n,r)}}var ye,Se=r(74248).Buffer;!function(t){t[t.YIELD=16]="YIELD",t[t.GET_PREIMAGE=64]="GET_PREIMAGE",t[t.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",t[t.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",t[t.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"}(ye||(ye={}));class Ie{}class ve extends Ie{constructor(t,e){super(),this.progressCallback=e,this.code=ye.YIELD,this.results=t}execute(t){return this.results.push(Se.from(t.subarray(1))),this.progressCallback(),Se.from("")}}class _e extends Ie{constructor(t,e){super(),this.code=ye.GET_PREIMAGE,this.known_preimages=t,this.queue=e}execute(t){const e=Se.from(t.subarray(1));if(33!=e.length)throw new Error("Invalid request, unexpected trailing data");if(0!=e[0])throw new Error("Unsupported request, the first byte should be 0");const r=Se.alloc(32);for(let s=0;s<32;s++)r[s]=e[1+s];const n=r.toString("hex"),i=this.known_preimages.get(n);if(void 0!=i){const t=gt(i.length),e=255-t.length-1,r=Math.min(e,i.length);if(r<i.length)for(let n=r;n<i.length;n++)this.queue.push(Se.from([i[n]]));return Se.concat([t,Se.from([r]),Se.from(i.subarray(0,r))])}throw Error(`Requested unknown preimage for: ${n}`)}}class Te extends Ie{constructor(t,e){super(),this.code=ye.GET_MERKLE_LEAF_PROOF,this.known_trees=t,this.queue=e}execute(t){const e=Se.from(t.subarray(1));if(e.length<34)throw new Error("Invalid request, expected at least 34 bytes");const r=new T(e),n=r.readSlice(32).toString("hex");let i,s;try{i=r.readVarInt(),s=r.readVarInt()}catch(p){throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}const o=this.known_trees.get(n);if(!o)throw Error(`Requested Merkle leaf proof for unknown tree: ${n}`);if(s>=i||o.size()!=i)throw Error("Invalid index or tree size.");if(0!=this.queue.length)throw Error("This command should not execute when the queue is not empty.");const u=o.getProof(s),a=Math.min(Math.floor(221/32),u.length),c=u.length-a;return c>0&&this.queue.push(...u.slice(-c)),Se.concat([o.getLeafHash(s),Se.from([u.length]),Se.from([a]),...u.slice(0,a)])}}class Oe extends Ie{constructor(t){super(),this.code=ye.GET_MERKLE_LEAF_INDEX,this.known_trees=t}execute(t){const e=Se.from(t.subarray(1));if(64!=e.length)throw new Error("Invalid request, unexpected trailing data");const r=Se.alloc(32);for(let c=0;c<32;c++)r[c]=e.readUInt8(c);const n=r.toString("hex"),i=Se.alloc(32);for(let c=0;c<32;c++)i[c]=e.readUInt8(32+c);const s=i.toString("hex"),o=this.known_trees.get(n);if(!o)throw Error(`Requested Merkle leaf index for unknown root: ${n}`);let u=0,a=0;for(let c=0;c<o.size();c++)if(o.getLeafHash(c).toString("hex")==s){a=1,u=c;break}return Se.concat([Se.from([a]),gt(u)])}}class be extends Ie{constructor(t){super(),this.code=ye.GET_MORE_ELEMENTS,this.queue=t}execute(t){if(1!=t.length)throw new Error("Invalid request, unexpected trailing data");if(0===this.queue.length)throw new Error("No elements to get");const e=this.queue[0].length;if(this.queue.some((t=>t.length!=e)))throw new Error("The queue contains elements with different byte length, which is not expected");const r=Math.floor(253/e),n=Math.min(r,this.queue.length),i=this.queue.splice(0,n);return Se.concat([Se.from([n]),Se.from([e]),...i])}}class Pe{constructor(t){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;const e=[new ve(this.yielded,t),new _e(this.preimages,this.queue),new Oe(this.roots),new Te(this.roots,this.queue),new be(this.queue)];for(const r of e){if(this.commands.has(r.code))throw new Error(`Multiple commands with code ${r.code}`);this.commands.set(r.code,r)}}getYielded(){return this.yielded}addKnownPreimage(t){this.preimages.set(s.Et.sha256(t).toString("hex"),t)}addKnownList(t){for(const r of t){const t=Se.concat([Se.from([0]),r]);this.addKnownPreimage(t)}const e=new $(t.map((t=>G(t))));this.roots.set(e.getRoot().toString("hex"),e)}addKnownMapping(t){this.addKnownList(t.keys),this.addKnownList(t.values)}execute(t){if(0==t.length)throw new Error("Unexpected empty command");const e=t[0],r=this.commands.get(e);if(!r)throw new Error(`Unexpected command code ${e}`);return r.execute(t)}}var Ne=r(74248).Buffer,Ae=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};var ke,Re;!function(t){t[t.GET_PUBKEY=0]="GET_PUBKEY",t[t.REGISTER_WALLET=2]="REGISTER_WALLET",t[t.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",t[t.SIGN_PSBT=4]="SIGN_PSBT",t[t.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",t[t.SIGN_MESSAGE=16]="SIGN_MESSAGE"}(ke||(ke={})),function(t){t[t.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"}(Re||(Re={}));class Ue{constructor(t){this.transport=t}makeRequest(t,e,r){return Ae(this,void 0,void 0,(function*(){let n=yield this.transport.send(225,t,0,0,e,[36864,57344]);for(;57344===n.readUInt16BE(n.length-2);){if(!r)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");const t=n.slice(0,-2),e=r.execute(t);n=yield this.transport.send(248,Re.CONTINUE_INTERRUPTED,0,0,e,[36864,57344])}return n.slice(0,-2)}))}getExtendedPubkey(t,e){return Ae(this,void 0,void 0,(function*(){if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(yield this.makeRequest(ke.GET_PUBKEY,Ne.concat([Ne.from(t?[1]:[0]),l(e)]))).toString("ascii")}))}getWalletAddress(t,e,r,n,i){return Ae(this,void 0,void 0,(function*(){if(0!==r&&1!==r)throw new Error("Change can only be 0 or 1");if(n<0||!Number.isInteger(n))throw new Error("Invalid address index");if(null!=e&&32!=e.length)throw new Error("Invalid HMAC length");const s=new Pe((()=>{}));s.addKnownList(t.keys.map((t=>Ne.from(t,"ascii")))),s.addKnownPreimage(t.serialize());const o=Ne.alloc(4);o.writeUInt32BE(n,0);return(yield this.makeRequest(ke.GET_WALLET_ADDRESS,Ne.concat([Ne.from(i?[1]:[0]),t.getWalletId(),e||Ne.alloc(32,0),Ne.from([r]),o]),s)).toString("ascii")}))}signPsbt(t,e,r,n){return Ae(this,void 0,void 0,(function*(){const i=new Ee(t);if(null!=r&&32!=r.length)throw new Error("Invalid HMAC length");const s=new Pe(n);s.addKnownList(e.keys.map((t=>Ne.from(t,"ascii")))),s.addKnownPreimage(e.serialize()),s.addKnownMapping(i.globalMerkleMap);for(const t of i.inputMerkleMaps)s.addKnownMapping(t);for(const t of i.outputMerkleMaps)s.addKnownMapping(t);s.addKnownList(i.inputMapCommitments);const o=new $(i.inputMapCommitments.map((t=>G(t)))).getRoot();s.addKnownList(i.outputMapCommitments);const u=new $(i.outputMapCommitments.map((t=>G(t)))).getRoot();yield this.makeRequest(ke.SIGN_PSBT,Ne.concat([i.getGlobalKeysValuesRoot(),gt(i.getGlobalInputCount()),o,gt(i.getGlobalOutputCount()),u,e.getWalletId(),r||Ne.alloc(32,0)]),s);const a=s.getYielded(),c=new Map;for(const t of a)c.set(t[0],t.slice(1));return c}))}getMasterFingerprint(){return Ae(this,void 0,void 0,(function*(){return this.makeRequest(ke.GET_MASTER_FINGERPRINT,Ne.from([]))}))}signMessage(t,e){return Ae(this,void 0,void 0,(function*(){if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");const r=new Pe((()=>{})),n=Math.ceil(t.length/64),i=[];for(let e=0;e<n;e++)i.push(t.subarray(64*e,64*e+64));r.addKnownList(i);const s=new $(i.map((t=>G(t)))).getRoot();return(yield this.makeRequest(ke.SIGN_MESSAGE,Ne.concat([l(e),gt(t.length),s]),r)).toString("base64")}))}}function xe(t){let e="TX";return e+=" version "+t.version.toString("hex"),t.locktime&&(e+=" locktime "+t.locktime.toString("hex")),t.witness&&(e+=" witness "+t.witness.toString("hex")),t.timestamp&&(e+=" timestamp "+t.timestamp.toString("hex")),t.nVersionGroupId&&(e+=" nVersionGroupId "+t.nVersionGroupId.toString("hex")),t.nExpiryHeight&&(e+=" nExpiryHeight "+t.nExpiryHeight.toString("hex")),t.extraData&&(e+=" extraData "+t.extraData.toString("hex")),t.inputs.forEach((({prevout:t,script:r,sequence:n},i)=>{e+=`\ninput ${i}:`,e+=` prevout ${t.toString("hex")}`,e+=` script ${r.toString("hex")}`,e+=` sequence ${n.toString("hex")}`})),(t.outputs||[]).forEach((({amount:t,script:r},n)=>{e+=`\noutput ${n}:`,e+=` amount ${t.toString("hex")}`,e+=` script ${r.toString("hex")}`})),e}var Ce=r(74248).Buffer;var He=r(74248).Buffer,Le=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const Be={lockTime:0,sigHashType:1,segwit:!1,transactionVersion:1};var Me=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(e){s(e)}}function u(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class De{constructor({transport:t,scrambleKey:e="BTC",currency:r="bitcoin"}){this._transport=t,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],e),this._impl=(()=>{switch(r){case"bitcoin":case"bitcoin_testnet":case"qtum":return new vt(new Ue(this._transport));default:return new he(this._transport)}})()}getWalletXpub(t){return this.changeImplIfNecessary().then((e=>e.getWalletXpub(t)))}getWalletPublicKey(t,e){let r;return arguments.length>2||"boolean"===typeof e?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),r={verify:!!e,format:arguments[2]?"p2sh":"legacy"}):r=e||{},this.changeImplIfNecessary().then((e=>e.getWalletPublicKey(t,r)))}signMessage(t,e){return this.changeImplIfNecessary().then((r=>r.signMessage({path:t,messageHex:e})))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then((e=>e.createPaymentTransaction(t)))}signP2SHTransaction(t){return function(t,e){return Le(this,void 0,void 0,(function*(){const{inputs:r,associatedKeysets:n,outputScriptHex:i,lockTime:s,sigHashType:o,segwit:u,transactionVersion:a}=Object.assign(Object.assign({},Be),e),c=He.alloc(0),p=He.alloc(0),h=He.alloc(4);h.writeUInt32LE(a,0);const l=[],f=[],d=[];let w=!0;const g={inputs:[],version:h},m=u?jt:Gt,E=He.from(i,"hex");for(const e of r){{const r=yield m(t,e[1],e[0]),n=He.alloc(4);n.writeUInt32LE(e.length>=4&&"number"===typeof e[3]?e[3]:b,0),l.push({trustedInput:!1,value:u?He.from(r,"hex"):He.from(r,"hex").slice(4,40),sequence:n})}const{outputs:r}=e[0],n=e[1];r&&n<=r.length-1&&f.push(r[n])}for(let t=0;t<r.length;t++){const e=He.alloc(4);e.writeUInt32LE(r[t].length>=4&&"number"===typeof r[t][3]?r[t][3]:b,0),g.inputs.push({script:c,prevout:p,sequence:e})}u&&(yield Vt(t,!0,g,l,!0),yield te(t,E));for(let e=0;e<r.length;e++){const i=r[e],a=r[e].length>=3&&"string"===typeof i[2]?He.from(i[2],"hex"):f[e].script,p=Object.assign({},g),h=u?[l[e]]:l;u?p.inputs=[Object.assign(Object.assign({},p.inputs[e]),{script:a})]:p.inputs[e].script=a,yield Vt(t,!u&&w,p,h,u),u||(yield te(t,E));const m=yield Qt(t,n[e],s,o);d.push(u?m.toString("hex"):m.slice(0,m.length-1).toString("hex")),g.inputs[e].script=c,w&&(w=!1)}return d}))}(this._transport,t)}splitTransaction(t,e=!1,r=!1,n=!1,i=[]){return function(t,e=!1,r=!1,n=!1,i=[]){const s=[],o=[];let u,a,c=!1,p=0,h=Ce.alloc(0),l=Ce.alloc(0),f=Ce.alloc(0),d=Ce.alloc(0);const w=i.includes("decred"),g=i.includes("zencash"),m=i.includes("zcash"),E=Ce.from(t,"hex"),y=E.slice(p,p+4),S=y.equals(Ce.from([3,0,0,128]))||y.equals(Ce.from([4,0,0,128]))||y.equals(Ce.from([5,0,0,128])),I=m&&y.equals(Ce.from([5,0,0,128]));p+=4,r||!e||0!==E[p]||0===E[p+1]||g||(p+=2,c=!0),r&&(h=E.slice(p,4+p),p+=4),S&&(f=E.slice(p,4+p),p+=4),I&&(a=E.slice(p+4,p+8),l=E.slice(p+8,p+12),p+=12);let v=wt(E,p);const _=v[0];p+=v[1];for(let b=0;b<_;b++){const t=E.slice(p,p+36);p+=36;let e=Ce.alloc(0),r=Ce.alloc(0);w?(r=E.slice(p,p+1),p+=1):(v=wt(E,p),p+=v[1],e=E.slice(p,p+v[0]),p+=v[0]);const n=E.slice(p,p+4);p+=4,s.push({prevout:t,script:e,sequence:n,tree:r})}v=wt(E,p);const T=v[0];p+=v[1];for(let b=0;b<T;b++){const t=E.slice(p,p+8);p+=8,w&&(p+=2),v=wt(E,p),p+=v[1];const e=E.slice(p,p+v[0]);p+=v[0],o.push({amount:t,script:e})}if(c?(u=E.slice(p,-4),a=E.slice(E.length-4)):I||(a=E.slice(p,p+4)),p+=4,!S&&!w||I||(l=E.slice(p,p+4),p+=4),n&&(d=E.slice(p)),w){if(v=wt(E,p),p+=v[1],v[0]!==_)throw new Error("splitTransaction: incoherent number of witnesses");for(let t=0;t<_;t++){p+=8,p+=4,p+=4,v=wt(E,p),p+=v[1];const e=E.slice(p,p+v[0]);p+=v[0],s[t].script=e}}const O={version:y,inputs:s,outputs:o,locktime:a,witness:u,timestamp:h,nVersionGroupId:f,nExpiryHeight:l,extraData:d};return(0,Ut.Rm)("btc",`splitTransaction ${t}:\n${xe(O)}`),O}(t,e,r,n,i)}serializeTransactionOutputs(t){return Et(t)}getTrustedInput(t,e,r=[]){return Gt(this._transport,t,e,r)}getTrustedInputBIP143(t,e,r=[]){return jt(this._transport,t,e,r)}changeImplIfNecessary(){return Me(this,void 0,void 0,(function*(){if(this._impl instanceof he)return this._impl;const{name:t,version:e}=yield re(this._transport);return(yield(()=>Me(this,void 0,void 0,(function*(){switch(t){case"Bitcoin":case"Bitcoin Test":return i().lt(e,"2.1.0");case"Bitcoin Legacy":case"Bitcoin Test Legacy":default:return!0;case"Exchange":return yield(r=this._transport,ee(void 0,void 0,void 0,(function*(){try{yield r.send(224,196,0,0)}catch(t){return!1}return!0})));case"Qtum":return i().lt(e,"3.0.0")}var r})))())&&(this._impl=new he(this._transport)),this._impl}))}}},16814:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(88475),s=r(31632),o=r(22415),u=r(46139),a=r(13585),c=r(2954),p=r(4317);function h(t){const e=c.decode(t);if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");return{version:e.readUInt8(0),hash:e.slice(1)}}function l(t){const e=a.decode(t),r=a.fromWords(e.words.slice(1));return{version:e.words[0],prefix:e.prefix,data:n.from(r)}}e.fromBase58Check=h,e.fromBech32=l,e.toBase58Check=function(t,e){p(u.tuple(u.Hash160bit,u.UInt8),arguments);const r=n.allocUnsafe(21);return r.writeUInt8(e,0),t.copy(r,1),c.encode(r)},e.toBech32=function(t,e,r){const n=a.toWords(t);return n.unshift(e),a.encode(r,n)},e.fromOutputScript=function(t,e){e=e||i.bitcoin;try{return s.p2pkh({output:t,network:e}).address}catch(r){}try{return s.p2sh({output:t,network:e}).address}catch(r){}try{return s.p2wpkh({output:t,network:e}).address}catch(r){}try{return s.p2wsh({output:t,network:e}).address}catch(r){}throw new Error(o.toASM(t)+" has no matching Address")},e.toOutputScript=function(t,e){let r,n;e=e||i.bitcoin;try{r=h(t)}catch(o){}if(r){if(r.version===e.pubKeyHash)return s.p2pkh({hash:r.hash}).output;if(r.version===e.scriptHash)return s.p2sh({hash:r.hash}).output}else{try{n=l(t)}catch(o){}if(n){if(n.prefix!==e.bech32)throw new Error(t+" has an invalid prefix");if(0===n.version){if(20===n.data.length)return s.p2wpkh({hash:n.data}).output;if(32===n.data.length)return s.p2wsh({hash:n.data}).output}}}throw new Error(t+" has no matching Script")}},94839:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(9017),s=r(2726),o=r(82362),u=r(46139),a=r(80910),c=r(4317),p=r(90316),h=new TypeError("Cannot compute merkle root for zero transactions"),l=new TypeError("Cannot compute witness commit for non-segwit block");class f{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");const e=new i.BufferReader(t),r=new f;if(r.version=e.readInt32(),r.prevHash=e.readSlice(32),r.merkleRoot=e.readSlice(32),r.timestamp=e.readUInt32(),r.bits=e.readUInt32(),r.nonce=e.readUInt32(),80===t.length)return r;const n=()=>{const t=o.Transaction.fromBuffer(e.buffer.slice(e.offset),!0);return e.offset+=t.byteLength(),t},s=e.readVarInt();r.transactions=[];for(let i=0;i<s;++i){const t=n();r.transactions.push(t)}const u=r.getWitnessCommit();return u&&(r.witnessCommit=u),r}static fromHex(t){return f.fromBuffer(n.from(t,"hex"))}static calculateTarget(t){const e=((4278190080&t)>>24)-3,r=8388607&t,i=n.alloc(32,0);return i.writeUIntBE(r,29-e,3),i}static calculateMerkleRoot(t,e){if(c([{getHash:u.Function}],t),0===t.length)throw h;if(e&&!d(t))throw l;const r=t.map((t=>t.getHash(e))),i=a(r,s.hash256);return e?s.hash256(n.concat([i,t[0].ins[0].witness[0]])):i}getWitnessCommit(){if(!d(this.transactions))return null;const t=this.transactions[0].outs.filter((t=>t.script.slice(0,6).equals(n.from("6a24aa21a9ed","hex")))).map((t=>t.script.slice(6,38)));if(0===t.length)return null;const e=t[t.length-1];return e instanceof n&&32===e.length?e:null}hasWitnessCommit(){return this.witnessCommit instanceof n&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(t=this.transactions)instanceof Array&&t.some((t=>"object"===typeof t&&t.ins instanceof Array&&t.ins.some((t=>"object"===typeof t&&t.witness instanceof Array&&t.witness.length>0))));var t}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(t,e=!0){return t||!this.transactions?80:80+p.encodingLength(this.transactions.length)+this.transactions.reduce(((t,r)=>t+r.byteLength(e)),0)}getHash(){return s.hash256(this.toBuffer(!0))}getId(){return i.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){const t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(t){const e=n.allocUnsafe(this.byteLength(t)),r=new i.BufferWriter(e);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),t||!this.transactions||(p.encode(this.transactions.length,e,r.offset),r.offset+=p.encode.bytes,this.transactions.forEach((t=>{const n=t.byteLength();t.toBuffer(e,r.offset),r.offset+=n}))),e}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){const t=this.hasWitnessCommit();return!(!t&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!t||this.__checkWitnessCommit()))}checkProofOfWork(){const t=i.reverseBuffer(this.getHash()),e=f.calculateTarget(this.bits);return t.compare(e)<=0}__checkMerkleRoot(){if(!this.transactions)throw h;const t=f.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(t)}__checkWitnessCommit(){if(!this.transactions)throw h;if(!this.hasWitnessCommit())throw l;const t=f.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(t)}}function d(t){return t instanceof Array&&t[0]&&t[0].ins&&t[0].ins instanceof Array&&t[0].ins[0]&&t[0].ins[0].witness&&t[0].ins[0].witness instanceof Array&&t[0].ins[0].witness.length>0}e.Block=f},9017:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(46139),s=r(4317),o=r(90316);function u(t,e){if("number"!==typeof t)throw new Error("cannot write a non-number as a number");if(t<0)throw new Error("specified a negative value for writing an unsigned value");if(t>e)throw new Error("RangeError: value out of range");if(Math.floor(t)!==t)throw new Error("value has a fractional component")}function a(t,e){const r=t.readUInt32LE(e);let n=t.readUInt32LE(e+4);return n*=4294967296,u(n+r,9007199254740991),n+r}function c(t,e,r){return u(e,9007199254740991),t.writeInt32LE(-1&e,r),t.writeUInt32LE(Math.floor(e/4294967296),r+4),r+8}e.readUInt64LE=a,e.writeUInt64LE=c,e.reverseBuffer=function(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t},e.cloneBuffer=function(t){const e=n.allocUnsafe(t.length);return t.copy(e),e};e.BufferWriter=class{constructor(t,e=0){this.buffer=t,this.offset=e,s(i.tuple(i.Buffer,i.UInt32),[t,e])}writeUInt8(t){this.offset=this.buffer.writeUInt8(t,this.offset)}writeInt32(t){this.offset=this.buffer.writeInt32LE(t,this.offset)}writeUInt32(t){this.offset=this.buffer.writeUInt32LE(t,this.offset)}writeUInt64(t){this.offset=c(this.buffer,t,this.offset)}writeVarInt(t){o.encode(t,this.buffer,this.offset),this.offset+=o.encode.bytes}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.offset+=t.copy(this.buffer,this.offset)}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach((t=>this.writeVarSlice(t)))}};e.BufferReader=class{constructor(t,e=0){this.buffer=t,this.offset=e,s(i.tuple(i.Buffer,i.UInt32),[t,e])}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){const t=a(this.buffer,this.offset);return this.offset+=8,t}readVarInt(){const t=o.decode(this.buffer,this.offset);return this.offset+=o.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}}},97186:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(59997),s=r(8973),o=r(52477),u=r(47841),a=r(59952),c=r(75975),p=r(3032),h=r(3765),l={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};e.types=l,e.output=function(t){if(p.output.check(t))return l.P2WPKH;if(h.output.check(t))return l.P2WSH;if(u.output.check(t))return l.P2PKH;if(a.output.check(t))return l.P2SH;const e=n.decompile(t);if(!e)throw new TypeError("Invalid script");return i.output.check(e)?l.P2MS:o.output.check(e)?l.P2PK:c.output.check(e)?l.WITNESS_COMMITMENT:s.output.check(e)?l.NULLDATA:l.NONSTANDARD},e.input=function(t,e){const r=n.decompile(t);if(!r)throw new TypeError("Invalid script");return u.input.check(r)?l.P2PKH:a.input.check(r,e)?l.P2SH:i.input.check(r,e)?l.P2MS:o.input.check(r)?l.P2PK:l.NONSTANDARD},e.witness=function(t,e){const r=n.decompile(t);if(!r)throw new TypeError("Invalid script");return p.input.check(r)?l.P2WPKH:h.input.check(r,e)?l.P2WSH:l.NONSTANDARD}},2726:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(76313);function i(t){try{return n("rmd160").update(t).digest()}catch(e){return n("ripemd160").update(t).digest()}}function s(t){return n("sha256").update(t).digest()}e.ripemd160=i,e.sha1=function(t){return n("sha1").update(t).digest()},e.sha256=s,e.hash160=function(t){return i(s(t))},e.hash256=function(t){return s(s(t))}},5052:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(88475),s=r(46139),o=r(56498),u=r(14756),a=r(4317),c=r(2008),p=a.maybe(a.compile({compressed:s.maybe(s.Boolean),network:s.maybe(s.Network)}));class h{constructor(t,e,r){this.__D=t,this.__Q=e,this.lowR=!1,void 0===r&&(r={}),this.compressed=void 0===r.compressed||r.compressed,this.network=r.network||i.bitcoin,void 0!==e&&(this.__Q=o.pointCompress(e,this.compressed))}get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=o.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return c.encode(this.network.wif,this.__D,this.compressed)}sign(t,e){if(!this.__D)throw new Error("Missing private key");if(void 0===e&&(e=this.lowR),!1===e)return o.sign(t,this.__D);{let e=o.sign(t,this.__D);const r=n.alloc(32,0);let i=0;for(;e[0]>127;)i++,r.writeUIntLE(i,0,6),e=o.signWithEntropy(t,this.__D,r);return e}}verify(t,e){return o.verify(t,this.publicKey,e)}}function l(t,e){if(a(s.Buffer256bit,t),!o.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return a(p,e),new h(t,void 0,e)}e.fromPrivateKey=l,e.fromPublicKey=function(t,e){return a(o.isPoint,t),a(p,e),new h(void 0,t,e)},e.fromWIF=function(t,e){const r=c.decode(t),n=r.version;if(s.Array(e)){if(!(e=e.filter((t=>n===t.wif)).pop()))throw new Error("Unknown network version")}else if(e=e||i.bitcoin,n!==e.wif)throw new Error("Invalid network version");return l(r.privateKey,{compressed:r.compressed,network:e})},e.makeRandom=function(t){a(p,t),void 0===t&&(t={});const e=t.rng||u;let r;do{r=e(32),a(s.Buffer256bit,r)}while(!o.isPrivate(r));return l(r,t)}},30566:(t,e,r)=>{"use strict";r(53953);r(16814);const n=r(2726);e.Et=n;r(5052);r(88475);r(31632);r(22415),r(94839).Block,r(81939).Psbt,r(22415).OPS,r(82362).Transaction,r(82398).TransactionBuilder},88475:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bitcoin={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},e.regtest={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},e.testnet={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}},74113:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(88475),i=r(22415),s=r(20308),o=r(4317),u=i.OPS;e.p2data=function(t,e){if(!t.data&&!t.output)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),data:o.maybe(o.arrayOf(o.Buffer))},t);const r={name:"embed",network:t.network||n.bitcoin};if(s.prop(r,"output",(()=>{if(t.data)return i.compile([u.OP_RETURN].concat(t.data))})),s.prop(r,"data",(()=>{if(t.output)return i.decompile(t.output).slice(1)})),e.validate&&t.output){const e=i.decompile(t.output);if(e[0]!==u.OP_RETURN)throw new TypeError("Output is invalid");if(!e.slice(1).every(o.Buffer))throw new TypeError("Output is invalid");if(t.data&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,t)}},31632:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(74113);e.embed=n.p2data;const i=r(31180);e.p2ms=i.p2ms;const s=r(30253);e.p2pk=s.p2pk;const o=r(81257);e.p2pkh=o.p2pkh;const u=r(73971);e.p2sh=u.p2sh;const a=r(51144);e.p2wpkh=a.p2wpkh;const c=r(22632);e.p2wsh=c.p2wsh},20308:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.prop=function(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const t=r.call(this);return this[e]=t,t},set(t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})}})},e.value=function(t){let e;return()=>(void 0!==e||(e=t()),e)}},31180:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(88475),i=r(22415),s=r(20308),o=i.OPS,u=r(4317),a=r(56498),c=o.OP_RESERVED;function p(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}e.p2ms=function(t,e){if(!t.input&&!t.output&&(!t.pubkeys||void 0===t.m)&&!t.signatures)throw new TypeError("Not enough data");function r(t){return i.isCanonicalScriptSignature(t)||void 0!==(e.allowIncomplete&&t===o.OP_0)}e=Object.assign({validate:!0},e||{}),u({network:u.maybe(u.Object),m:u.maybe(u.Number),n:u.maybe(u.Number),output:u.maybe(u.Buffer),pubkeys:u.maybe(u.arrayOf(a.isPoint)),signatures:u.maybe(u.arrayOf(r)),input:u.maybe(u.Buffer)},t);const h={network:t.network||n.bitcoin};let l=[],f=!1;function d(t){f||(f=!0,l=i.decompile(t),h.m=l[0]-c,h.n=l[l.length-2]-c,h.pubkeys=l.slice(1,-2))}if(s.prop(h,"output",(()=>{if(t.m&&h.n&&t.pubkeys)return i.compile([].concat(c+t.m,t.pubkeys,c+h.n,o.OP_CHECKMULTISIG))})),s.prop(h,"m",(()=>{if(h.output)return d(h.output),h.m})),s.prop(h,"n",(()=>{if(h.pubkeys)return h.pubkeys.length})),s.prop(h,"pubkeys",(()=>{if(t.output)return d(t.output),h.pubkeys})),s.prop(h,"signatures",(()=>{if(t.input)return i.decompile(t.input).slice(1)})),s.prop(h,"input",(()=>{if(t.signatures)return i.compile([o.OP_0].concat(t.signatures))})),s.prop(h,"witness",(()=>{if(h.input)return[]})),s.prop(h,"name",(()=>{if(h.m&&h.n)return`p2ms(${h.m} of ${h.n})`})),e.validate){if(t.output){if(d(t.output),!u.Number(l[0]))throw new TypeError("Output is invalid");if(!u.Number(l[l.length-2]))throw new TypeError("Output is invalid");if(l[l.length-1]!==o.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(h.m<=0||h.n>16||h.m>h.n||h.n!==l.length-3)throw new TypeError("Output is invalid");if(!h.pubkeys.every((t=>a.isPoint(t))))throw new TypeError("Output is invalid");if(void 0!==t.m&&t.m!==h.m)throw new TypeError("m mismatch");if(void 0!==t.n&&t.n!==h.n)throw new TypeError("n mismatch");if(t.pubkeys&&!p(t.pubkeys,h.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(void 0!==t.n&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(h.n=t.pubkeys.length,h.n<h.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<h.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>h.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==o.OP_0)throw new TypeError("Input is invalid");if(0===h.signatures.length||!h.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!p(t.signatures,h.signatures))throw new TypeError("Signature mismatch");if(void 0!==t.m&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(h,t)}},30253:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(88475),i=r(22415),s=r(20308),o=r(4317),u=i.OPS,a=r(56498);e.p2pk=function(t,e){if(!t.input&&!t.output&&!t.pubkey&&!t.input&&!t.signature)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),pubkey:o.maybe(a.isPoint),signature:o.maybe(i.isCanonicalScriptSignature),input:o.maybe(o.Buffer)},t);const r=s.value((()=>i.decompile(t.input))),c={name:"p2pk",network:t.network||n.bitcoin};if(s.prop(c,"output",(()=>{if(t.pubkey)return i.compile([t.pubkey,u.OP_CHECKSIG])})),s.prop(c,"pubkey",(()=>{if(t.output)return t.output.slice(1,-1)})),s.prop(c,"signature",(()=>{if(t.input)return r()[0]})),s.prop(c,"input",(()=>{if(t.signature)return i.compile([t.signature])})),s.prop(c,"witness",(()=>{if(c.input)return[]})),e.validate){if(t.output){if(t.output[t.output.length-1]!==u.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!a.isPoint(c.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&!t.pubkey.equals(c.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&!t.input.equals(c.input))throw new TypeError("Signature mismatch");if(t.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!i.isCanonicalScriptSignature(c.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(c,t)}},81257:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(2726),s=r(88475),o=r(22415),u=r(20308),a=r(4317),c=o.OPS,p=r(56498),h=r(2954);e.p2pkh=function(t,e){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),output:a.maybe(a.BufferN(25)),pubkey:a.maybe(p.isPoint),signature:a.maybe(o.isCanonicalScriptSignature),input:a.maybe(a.Buffer)},t);const r=u.value((()=>{const e=h.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}})),l=u.value((()=>o.decompile(t.input))),f=t.network||s.bitcoin,d={name:"p2pkh",network:f};if(u.prop(d,"address",(()=>{if(!d.hash)return;const t=n.allocUnsafe(21);return t.writeUInt8(f.pubKeyHash,0),d.hash.copy(t,1),h.encode(t)})),u.prop(d,"hash",(()=>t.output?t.output.slice(3,23):t.address?r().hash:t.pubkey||d.pubkey?i.hash160(t.pubkey||d.pubkey):void 0)),u.prop(d,"output",(()=>{if(d.hash)return o.compile([c.OP_DUP,c.OP_HASH160,d.hash,c.OP_EQUALVERIFY,c.OP_CHECKSIG])})),u.prop(d,"pubkey",(()=>{if(t.input)return l()[1]})),u.prop(d,"signature",(()=>{if(t.input)return l()[0]})),u.prop(d,"input",(()=>{if(t.pubkey&&t.signature)return o.compile([t.signature,t.pubkey])})),u.prop(d,"witness",(()=>{if(d.input)return[]})),e.validate){let e=n.from([]);if(t.address){if(r().version!==f.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");e=r().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(25!==t.output.length||t.output[0]!==c.OP_DUP||t.output[1]!==c.OP_HASH160||20!==t.output[2]||t.output[23]!==c.OP_EQUALVERIFY||t.output[24]!==c.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=t.output.slice(3,23);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.pubkey){const r=i.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.input){const r=l();if(2!==r.length)throw new TypeError("Input is invalid");if(!o.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!p.isPoint(r[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&!t.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const n=i.hash160(r[1]);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch")}}return Object.assign(d,t)}},73971:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(2726),s=r(88475),o=r(22415),u=r(20308),a=r(4317),c=o.OPS,p=r(2954);e.p2sh=function(t,e){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),output:a.maybe(a.BufferN(23)),redeem:a.maybe({network:a.maybe(a.Object),output:a.maybe(a.Buffer),input:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))}),input:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))},t);let r=t.network;r||(r=t.redeem&&t.redeem.network||s.bitcoin);const h={network:r},l=u.value((()=>{const e=p.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}})),f=u.value((()=>o.decompile(t.input))),d=u.value((()=>{const e=f();return{network:r,output:e[e.length-1],input:o.compile(e.slice(0,-1)),witness:t.witness||[]}}));if(u.prop(h,"address",(()=>{if(!h.hash)return;const t=n.allocUnsafe(21);return t.writeUInt8(h.network.scriptHash,0),h.hash.copy(t,1),p.encode(t)})),u.prop(h,"hash",(()=>t.output?t.output.slice(2,22):t.address?l().hash:h.redeem&&h.redeem.output?i.hash160(h.redeem.output):void 0)),u.prop(h,"output",(()=>{if(h.hash)return o.compile([c.OP_HASH160,h.hash,c.OP_EQUAL])})),u.prop(h,"redeem",(()=>{if(t.input)return d()})),u.prop(h,"input",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.output)return o.compile([].concat(o.decompile(t.redeem.input),t.redeem.output))})),u.prop(h,"witness",(()=>h.redeem&&h.redeem.witness?h.redeem.witness:h.input?[]:void 0)),u.prop(h,"name",(()=>{const t=["p2sh"];return void 0!==h.redeem&&t.push(h.redeem.name),t.join("-")})),e.validate){let e=n.from([]);if(t.address){if(l().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==l().hash.length)throw new TypeError("Invalid address");e=l().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(23!==t.output.length||t.output[0]!==c.OP_HASH160||20!==t.output[1]||t.output[22]!==c.OP_EQUAL)throw new TypeError("Output is invalid");const r=t.output.slice(2,22);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}const s=t=>{if(t.output){const r=o.decompile(t.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");const n=i.hash160(t.output);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch");e=n}if(t.input){const e=t.input.length>0,r=t.witness&&t.witness.length>0;if(!e&&!r)throw new TypeError("Empty input");if(e&&r)throw new TypeError("Input and witness provided");if(e){const e=o.decompile(t.input);if(!o.isPushOnly(e))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const t=f();if(!t||t.length<1)throw new TypeError("Input too short");if(!n.isBuffer(d().output))throw new TypeError("Input is invalid");s(d())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==r)throw new TypeError("Network mismatch");if(t.input){const e=d();if(t.redeem.output&&!t.redeem.output.equals(e.output))throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&!t.redeem.input.equals(e.input))throw new TypeError("Redeem.input mismatch")}s(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(h,t)}},51144:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(2726),s=r(88475),o=r(22415),u=r(20308),a=r(4317),c=o.OPS,p=r(56498),h=r(13585),l=n.alloc(0);e.p2wpkh=function(t,e){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),input:a.maybe(a.BufferN(0)),network:a.maybe(a.Object),output:a.maybe(a.BufferN(22)),pubkey:a.maybe(p.isPoint),signature:a.maybe(o.isCanonicalScriptSignature),witness:a.maybe(a.arrayOf(a.Buffer))},t);const r=u.value((()=>{const e=h.decode(t.address),r=e.words.shift(),i=h.fromWords(e.words);return{version:r,prefix:e.prefix,data:n.from(i)}})),f=t.network||s.bitcoin,d={name:"p2wpkh",network:f};if(u.prop(d,"address",(()=>{if(!d.hash)return;const t=h.toWords(d.hash);return t.unshift(0),h.encode(f.bech32,t)})),u.prop(d,"hash",(()=>t.output?t.output.slice(2,22):t.address?r().data:t.pubkey||d.pubkey?i.hash160(t.pubkey||d.pubkey):void 0)),u.prop(d,"output",(()=>{if(d.hash)return o.compile([c.OP_0,d.hash])})),u.prop(d,"pubkey",(()=>t.pubkey?t.pubkey:t.witness?t.witness[1]:void 0)),u.prop(d,"signature",(()=>{if(t.witness)return t.witness[0]})),u.prop(d,"input",(()=>{if(d.witness)return l})),u.prop(d,"witness",(()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]})),e.validate){let e=n.from([]);if(t.address){if(f&&f.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(22!==t.output.length||t.output[0]!==c.OP_0||20!==t.output[1])throw new TypeError("Output is invalid");if(e.length>0&&!e.equals(t.output.slice(2)))throw new TypeError("Hash mismatch");e=t.output.slice(2)}if(t.pubkey){const r=i.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");if(e=r,!p.isPoint(t.pubkey)||33!==t.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(2!==t.witness.length)throw new TypeError("Witness is invalid");if(!o.isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!p.isPoint(t.witness[1])||33!==t.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(t.signature&&!t.signature.equals(t.witness[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(t.witness[1]))throw new TypeError("Pubkey mismatch");const r=i.hash160(t.witness[1]);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(d,t)}},22632:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(2726),s=r(88475),o=r(22415),u=r(20308),a=r(4317),c=o.OPS,p=r(56498),h=r(13585),l=n.alloc(0);function f(t){return!(!n.isBuffer(t)||65!==t.length||4!==t[0]||!p.isPoint(t))}e.p2wsh=function(t,e){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(32)),output:a.maybe(a.BufferN(34)),redeem:a.maybe({input:a.maybe(a.Buffer),network:a.maybe(a.Object),output:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))}),input:a.maybe(a.BufferN(0)),witness:a.maybe(a.arrayOf(a.Buffer))},t);const r=u.value((()=>{const e=h.decode(t.address),r=e.words.shift(),i=h.fromWords(e.words);return{version:r,prefix:e.prefix,data:n.from(i)}})),p=u.value((()=>o.decompile(t.redeem.input)));let d=t.network;d||(d=t.redeem&&t.redeem.network||s.bitcoin);const w={network:d};if(u.prop(w,"address",(()=>{if(!w.hash)return;const t=h.toWords(w.hash);return t.unshift(0),h.encode(d.bech32,t)})),u.prop(w,"hash",(()=>t.output?t.output.slice(2):t.address?r().data:w.redeem&&w.redeem.output?i.sha256(w.redeem.output):void 0)),u.prop(w,"output",(()=>{if(w.hash)return o.compile([c.OP_0,w.hash])})),u.prop(w,"redeem",(()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:l,witness:t.witness.slice(0,-1)}})),u.prop(w,"input",(()=>{if(w.witness)return l})),u.prop(w,"witness",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const e=o.toStack(p());return w.redeem=Object.assign({witness:e},t.redeem),w.redeem.input=l,[].concat(e,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)})),u.prop(w,"name",(()=>{const t=["p2wsh"];return void 0!==w.redeem&&t.push(w.redeem.name),t.join("-")})),e.validate){let e=n.from([]);if(t.address){if(r().prefix!==d.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(34!==t.output.length||t.output[0]!==c.OP_0||32!==t.output[1])throw new TypeError("Output is invalid");const r=t.output.slice(2);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.redeem){if(t.redeem.network&&t.redeem.network!==d)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){if(0===o.decompile(t.redeem.output).length)throw new TypeError("Redeem.output is invalid");const r=i.sha256(t.redeem.output);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.redeem.input&&!o.isPushOnly(p()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&p().some(f)||t.redeem.output&&(o.decompile(t.redeem.output)||[]).some(f))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const e=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&!t.redeem.output.equals(e))throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(f)||(o.decompile(e)||[]).some(f))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(w,t)}},81939:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(90043),s=r(38683),o=r(34783),u=r(16814),a=r(9017),c=r(2726),p=r(5052),h=r(88475),l=r(31632),f=r(22415),d=r(82362),w={network:h.bitcoin,maximumFeeRate:5e3};class g{constructor(t={},e=new i.Psbt(new E)){this.data=e,this.opts=Object.assign({},w,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(t,e,r,n)=>Object.defineProperty(t,e,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}static fromBase64(t,e={}){const r=n.from(t,"base64");return this.fromBuffer(r,e)}static fromHex(t,e={}){const r=n.from(t,"hex");return this.fromBuffer(r,e)}static fromBuffer(t,e={}){const r=i.Psbt.fromBuffer(t,m),n=new g(e,r);var s,o;return s=n.__CACHE.__TX,o=n.__CACHE,s.ins.forEach((t=>{x(o,t)})),n}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map((t=>({hash:a.cloneBuffer(t.hash),index:t.index,sequence:t.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((t=>{let e;try{e=u.fromOutputScript(t.script,this.opts.network)}catch(r){}return{script:a.cloneBuffer(t.script),value:t.value,address:e}}))}combine(...t){return this.data.combine(...t.map((t=>t.data))),this}clone(){const t=g.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){k(t),this.opts.maximumFeeRate=t}setVersion(t){k(t),R(this.data.inputs,"setVersion");const e=this.__CACHE;return e.__TX.version=t,e.__EXTRACTED_TX=void 0,this}setLocktime(t){k(t),R(this.data.inputs,"setLocktime");const e=this.__CACHE;return e.__TX.locktime=t,e.__EXTRACTED_TX=void 0,this}setInputSequence(t,e){k(e),R(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=t)throw new Error("Input index too high");return r.__TX.ins[t].sequence=e,r.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach((t=>this.addInput(t))),this}addInput(t){if(arguments.length>1||!t||void 0===t.hash||void 0===t.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");R(this.data.inputs,"addInput"),t.witnessScript&&z(t.witnessScript);const e=this.__CACHE;this.data.addInput(t);x(e,e.__TX.ins[e.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&W(this.__CACHE,n,r),e.__FEE=void 0,e.__FEE_RATE=void 0,e.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach((t=>this.addOutput(t))),this}addOutput(t){if(arguments.length>1||!t||void 0===t.value||void 0===t.address&&void 0===t.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");R(this.data.inputs,"addOutput");const{address:e}=t;if("string"===typeof e){const{network:r}=this.opts,n=u.toOutputScript(e,r);t=Object.assign(t,{script:n})}const r=this.__CACHE;return this.data.addOutput(t),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(I))throw new Error("Not finalized");const e=this.__CACHE;if(t||function(t,e,r){const n=e.__FEE_RATE||t.getFeeRate(),i=e.__EXTRACTED_TX.virtualSize(),s=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(s/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,e,this.opts),e.__EXTRACTED_TX)return e.__EXTRACTED_TX;const r=e.__TX.clone();return V(this.data.inputs,r,e,!0),r}getFeeRate(){return B("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return B("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return o.checkForInput(this.data.inputs,0),Z(this.data.inputs.length).forEach((t=>this.finalizeInput(t))),this}finalizeInput(t,e=M){const r=o.checkForInput(this.data.inputs,t),{script:n,isP2SH:i,isP2WSH:s,isSegwit:u}=function(t,e,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!e.redeemScript,i.isP2WSH=!!e.witnessScript,e.witnessScript)i.script=e.witnessScript;else if(e.redeemScript)i.script=e.redeemScript;else if(e.nonWitnessUtxo){const s=q(r,e,t),o=n.ins[t].index;i.script=s.outs[o].script}else e.witnessUtxo&&(i.script=e.witnessUtxo.script);(e.witnessScript||b(i.script))&&(i.isSegwit=!0);return i}(t,r,this.__CACHE);if(!n)throw new Error(`No script found for input #${t}`);!function(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:r}=t;e.forEach((t=>{const{hashType:e}=f.signature.decode(t.signature);if(r!==e)throw new Error("Signature sighash does not match input sighash type")}))}(r);const{finalScriptSig:a,finalScriptWitness:c}=e(t,r,n,u,i,s);if(a&&this.data.updateInput(t,{finalScriptSig:a}),c&&this.data.updateInput(t,{finalScriptWitness:c}),!a&&!c)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}getInputType(t){const e=o.checkForInput(this.data.inputs,t),r=Y(j(t,e,this.__CACHE),t,"input",e.redeemScript||function(t){if(!t)return;const e=f.decompile(t);if(!e)return;const r=e[e.length-1];if(!n.isBuffer(r)||X(r)||(i=r,f.isCanonicalScriptSignature(i)))return;var i;if(!f.decompile(r))return;return r}(e.finalScriptSig),e.witnessScript||function(t){if(!t)return;const e=K(t),r=e[e.length-1];if(X(r))return;if(!f.decompile(r))return;return r}(e.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+J(r.meaningfulScript)}inputHasPubkey(t,e){return function(t,e,r,n){const i=j(r,e,n),{meaningfulScript:s}=Y(i,r,"input",e.redeemScript,e.witnessScript);return Q(t,s)}(e,o.checkForInput(this.data.inputs,t),t,this.__CACHE)}inputHasHDKey(t,e){const r=o.checkForInput(this.data.inputs,t),n=A(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(t,e){return function(t,e,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:s}=Y(i,r,"output",e.redeemScript,e.witnessScript);return Q(t,s)}(e,o.checkForOutput(this.data.outputs,t),t,this.__CACHE)}outputHasHDKey(t,e){const r=o.checkForOutput(this.data.outputs,t),n=A(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(){o.checkForInput(this.data.inputs,0);return Z(this.data.inputs.length).map((t=>this.validateSignaturesOfInput(t))).reduce(((t,e)=>!0===e&&t),!0)}validateSignaturesOfInput(t,e){const r=this.data.inputs[t],n=(r||{}).partialSig;if(!r||!n||n.length<1)throw new Error("No signatures to validate");const i=e?n.filter((t=>t.pubkey.equals(e))):n;if(i.length<1)throw new Error("No signatures for this pubkey");const s=[];let o,u,a;for(const c of i){const e=f.signature.decode(c.signature),{hash:n,script:i}=a!==e.hashType?$(t,Object.assign({},r,{sighashType:e.hashType}),this.__CACHE,!0):{hash:o,script:u};a=e.hashType,o=n,u=i,U(c.pubkey,i,"verify");const h=p.fromPublicKey(c.pubkey);s.push(h.verify(n,e.signature))}return s.every((t=>!0===t))}signAllInputsHD(t,e=[d.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const i of Z(this.data.inputs.length))try{this.signInputHD(i,t,e),r.push(!0)}catch(n){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,e=[d.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!t||!t.publicKey||!t.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],s=[];for(const o of Z(this.data.inputs.length))s.push(this.signInputHDAsync(o,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(t,e,r=[d.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");return G(t,this.data.inputs,e).forEach((e=>this.signInput(t,e,r))),this}signInputHDAsync(t,e,r=[d.Transaction.SIGHASH_ALL]){return new Promise(((n,i)=>{if(!e||!e.publicKey||!e.fingerprint)return i(new Error("Need HDSigner to sign input"));const s=G(t,this.data.inputs,e).map((e=>this.signInputAsync(t,e,r)));return Promise.all(s).then((()=>{n()})).catch(i)}))}signAllInputs(t,e=[d.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const i of Z(this.data.inputs.length))try{this.signInput(i,t,e),r.push(!0)}catch(n){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,e=[d.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!t||!t.publicKey)return n(new Error("Need Signer to sign input"));const i=[],s=[];for(const[o]of this.data.inputs.entries())s.push(this.signInputAsync(o,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInput(t,e,r=[d.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=D(this.data.inputs,t,e.publicKey,this.__CACHE,r),s=[{pubkey:e.publicKey,signature:f.signature.encode(e.sign(n),i)}];return this.data.updateInput(t,{partialSig:s}),this}signInputAsync(t,e,r=[d.Transaction.SIGHASH_ALL]){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=D(this.data.inputs,t,e.publicKey,this.__CACHE,r);return Promise.resolve(e.sign(n)).then((r=>{const n=[{pubkey:e.publicKey,signature:f.signature.encode(r,i)}];this.data.updateInput(t,{partialSig:n})}))}))}toBuffer(){return y(this.__CACHE),this.data.toBuffer()}toHex(){return y(this.__CACHE),this.data.toHex()}toBase64(){return y(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,e){return e.witnessScript&&z(e.witnessScript),this.data.updateInput(t,e),e.nonWitnessUtxo&&W(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,e){return this.data.updateOutput(t,e),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,e){return this.data.addUnknownKeyValToInput(t,e),this}addUnknownKeyValToOutput(t,e){return this.data.addUnknownKeyValToOutput(t,e),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}}e.Psbt=g;const m=t=>new E(t);class E{constructor(t=n.from([2,0,0,0,0,0,0,0,0,0])){this.tx=d.Transaction.fromBuffer(t),function(t){if(!t.ins.every((t=>t.script&&0===t.script.length&&t.witness&&0===t.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(void 0===t.hash||void 0===t.index||!n.isBuffer(t.hash)&&"string"!==typeof t.hash||"number"!==typeof t.index)throw new Error("Error adding input.");const e="string"===typeof t.hash?a.reverseBuffer(n.from(t.hash,"hex")):t.hash;this.tx.addInput(e,t.index,t.sequence)}addOutput(t){if(void 0===t.script||void 0===t.value||!n.isBuffer(t.script)||"number"!==typeof t.value)throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}}function y(t){if(!1!==t.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function S(t,e,r){if(!e)return!1;let n;if(n=r?r.map((t=>{const r=p.fromPublicKey(t,{compressed:!0}).publicKey;return e.find((t=>t.pubkey.equals(r)))})).filter((t=>!!t)):e,n.length>t)throw new Error("Too many signatures");return n.length===t}function I(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function v(t){return e=>{try{return t({output:e}),!0}catch(r){return!1}}}const _=v(l.p2ms),T=v(l.p2pk),O=v(l.p2pkh),b=v(l.p2wpkh),P=v(l.p2wsh),N=v(l.p2sh);function A(t){return e=>!!e.masterFingerprint.equals(t.fingerprint)&&!!t.derivePath(e.path).publicKey.equals(e.pubkey)}function k(t){if("number"!==typeof t||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function R(t,e){t.forEach((t=>{let r=!1,i=[];if(0===(t.partialSig||[]).length){if(!t.finalScriptSig&&!t.finalScriptWitness)return;i=function(t){const e=t.finalScriptSig&&f.decompile(t.finalScriptSig)||[],r=t.finalScriptWitness&&f.decompile(t.finalScriptWitness)||[];return e.concat(r).filter((t=>n.isBuffer(t)&&f.isCanonicalScriptSignature(t))).map((t=>({signature:t})))}(t)}else i=t.partialSig;if(i.forEach((t=>{const{hashType:n}=f.signature.decode(t.signature),i=[];n&d.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput");switch(31&n){case d.Transaction.SIGHASH_ALL:break;case d.Transaction.SIGHASH_SINGLE:case d.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}-1===i.indexOf(e)&&(r=!0)})),r)throw new Error("Can not modify transaction, signatures exist.")}))}function U(t,e,r){if(!Q(t,e))throw new Error(`Can not ${r} for this input with the key ${t.toString("hex")}`)}function x(t,e){const r=a.reverseBuffer(n.from(e.hash)).toString("hex")+":"+e.index;if(t.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[r]=1}function C(t,e){return(r,n,i,s)=>{const o=t({redeem:{output:i}}).output;if(!n.equals(o))throw new Error(`${e} for ${s} #${r} doesn't match the scriptPubKey in the prevout`)}}const H=C(l.p2sh,"Redeem script"),L=C(l.p2wsh,"Witness script");function B(t,e,r,n){if(!r.every(I))throw new Error(`PSBT must be finalized to calculate ${e}`);if("__FEE_RATE"===t&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===t&&n.__FEE)return n.__FEE;let i,s=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,s=!1):i=n.__TX.clone(),V(r,i,n,s),"__FEE_RATE"===t?n.__FEE_RATE:"__FEE"===t?n.__FEE:void 0}function M(t,e,r,n,i,s){const o=J(r);if(!function(t,e,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return S(1,t.partialSig);case"multisig":const r=l.p2ms({output:e});return S(r.m,t.partialSig,r.pubkeys);default:return!1}}(e,r,o))throw new Error(`Can not finalize input #${t}`);return function(t,e,r,n,i,s){let o,u;const a=function(t,e,r){let n;switch(e){case"multisig":const e=function(t,e){const r=l.p2ms({output:t});return r.pubkeys.map((t=>(e.filter((e=>e.pubkey.equals(t)))[0]||{}).signature)).filter((t=>!!t))}(t,r);n=l.p2ms({output:t,signatures:e});break;case"pubkey":n=l.p2pk({output:t,signature:r[0].signature});break;case"pubkeyhash":n=l.p2pkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=l.p2wpkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(t,e,r),c=s?l.p2wsh({redeem:a}):null,p=i?l.p2sh({redeem:c||a}):null;n?(u=F(c?c.witness:a.witness),p&&(o=p.input)):o=p?p.input:a.input;return{finalScriptSig:o,finalScriptWitness:u}}(r,o,e.partialSig,n,i,s)}function D(t,e,r,n,i){const s=o.checkForInput(t,e),{hash:u,sighashType:a,script:c}=$(e,s,n,!1,i);return U(r,c,"sign"),{hash:u,sighashType:a}}function $(t,e,r,n,i){const s=r.__TX,o=e.sighashType||d.Transaction.SIGHASH_ALL;if(i&&i.indexOf(o)<0){const t=function(t){let e=t&d.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&t){case d.Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case d.Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case d.Transaction.SIGHASH_NONE:e+="SIGHASH_NONE"}return e}(o);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${t}`)}let u,a;if(e.nonWitnessUtxo){const n=q(r,e,t),i=s.ins[t].hash,o=n.getHash();if(!i.equals(o))throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const u=s.ins[t].index;a=n.outs[u]}else{if(!e.witnessUtxo)throw new Error("Need a Utxo input item for signing");a=e.witnessUtxo}const{meaningfulScript:c,type:p}=Y(a.script,t,"input",e.redeemScript,e.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(p)>=0)u=s.hashForWitnessV0(t,c,a.value,o);else if(b(c)){const e=l.p2pkh({hash:c.slice(2)}).output;u=s.hashForWitnessV0(t,e,a.value,o)}else{if(void 0===e.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${t} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);n||!1===r.__UNSAFE_SIGN_NONSEGWIT||console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),u=s.hashForSignature(t,c,o)}return{script:c,sighashType:o,hash:u}}function G(t,e,r){const n=o.checkForInput(e,t);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map((t=>t.masterFingerprint.equals(r.fingerprint)?t:void 0)).filter((t=>!!t));if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map((t=>{const e=r.derivePath(t.path);if(!t.pubkey.equals(e.publicKey))throw new Error("pubkey did not match bip32Derivation");return e}))}function K(t){let e=0;function r(){const r=s.decode(t,e);return e+=s.decode.bytes,r}function n(){return n=r(),e+=n,t.slice(e-n,e);var n}return function(){const t=r(),e=[];for(let r=0;r<t;r++)e.push(n());return e}()}function F(t){let e=n.allocUnsafe(0);function r(t){const r=e.length,i=s.encodingLength(t);e=n.concat([e,n.allocUnsafe(i)]),s.encode(t,e,r)}function i(t){r(t.length),function(t){e=n.concat([e,n.from(t)])}(t)}var o;return r((o=t).length),o.forEach(i),e}function W(t,e,r){t.__NON_WITNESS_UTXO_BUF_CACHE[r]=e.nonWitnessUtxo;const n=d.Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=t,s=r;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const t=i.__NON_WITNESS_UTXO_BUF_CACHE[s],e=i.__NON_WITNESS_UTXO_TX_CACHE[s];if(void 0!==t)return t;{const t=e.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t,t}},set(t){i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t}})}function V(t,e,r,n){let i=0;t.forEach(((t,s)=>{if(n&&t.finalScriptSig&&(e.ins[s].script=t.finalScriptSig),n&&t.finalScriptWitness&&(e.ins[s].witness=K(t.finalScriptWitness)),t.witnessUtxo)i+=t.witnessUtxo.value;else if(t.nonWitnessUtxo){const n=q(r,t,s),o=e.ins[s].index,u=n.outs[o];i+=u.value}}));const s=e.outs.reduce(((t,e)=>t+e.value),0),o=i-s;if(o<0)throw new Error("Outputs are spending more than Inputs");const u=e.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=e,r.__FEE_RATE=Math.floor(o/u)}function q(t,e,r){const n=t.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||W(t,e,r),n[r]}function j(t,e,r){if(void 0!==e.witnessUtxo)return e.witnessUtxo.script;if(void 0!==e.nonWitnessUtxo){return q(r,e,t).outs[r.__TX.ins[t].index].script}throw new Error("Can't find pubkey in input without Utxo data")}function X(t){return 33===t.length&&f.isCanonicalPubKey(t)}function Y(t,e,r,n,i){const s=N(t),o=s&&n&&P(n),u=P(t);if(s&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||o)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let a;return o?(a=i,H(e,t,n,r),L(e,n,i,r),z(a)):u?(a=i,L(e,t,i,r),z(a)):s?(a=n,H(e,t,n,r)):a=t,{meaningfulScript:a,type:o?"p2sh-p2wsh":s?"p2sh":u?"p2wsh":"raw"}}function z(t){if(b(t)||N(t))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Q(t,e){const r=c.hash160(t),n=f.decompile(e);if(null===n)throw new Error("Unknown script error");return n.some((e=>"number"!==typeof e&&(e.equals(t)||e.equals(r))))}function J(t){return b(t)?"witnesspubkeyhash":O(t)?"pubkeyhash":_(t)?"multisig":T(t)?"pubkey":"nonstandard"}function Z(t){return[...Array(t).keys()]}},22415:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(45079),s=r(45366),o=r(46139),u=r(25085),a=r(56498),c=r(52241),p=r(4317);e.OPS=r(28119);const h=r(64835),l=e.OPS.OP_RESERVED;function f(t){return o.Buffer(t)||function(t){return o.Number(t)&&(t===e.OPS.OP_0||t>=e.OPS.OP_1&&t<=e.OPS.OP_16||t===e.OPS.OP_1NEGATE)}(t)}function d(t){return o.Array(t)&&t.every(f)}function w(t){return 0===t.length?e.OPS.OP_0:1===t.length?t[0]>=1&&t[0]<=16?l+t[0]:129===t[0]?e.OPS.OP_1NEGATE:void 0:void 0}function g(t){return n.isBuffer(t)}function m(t){return n.isBuffer(t)}function E(t){if(g(t))return t;p(o.Array,t);const e=t.reduce(((t,e)=>m(e)?1===e.length&&void 0!==w(e)?t+1:t+c.encodingLength(e.length)+e.length:t+1),0),r=n.allocUnsafe(e);let i=0;if(t.forEach((t=>{if(m(t)){const e=w(t);if(void 0!==e)return r.writeUInt8(e,i),void(i+=1);i+=c.encode(r,t.length,i),t.copy(r,i),i+=t.length}else r.writeUInt8(t,i),i+=1})),i!==r.length)throw new Error("Could not decode chunks");return r}function y(t){if(r=t,o.Array(r))return t;var r;p(o.Buffer,t);const n=[];let i=0;for(;i<t.length;){const r=t[i];if(r>e.OPS.OP_0&&r<=e.OPS.OP_PUSHDATA4){const e=c.decode(t,i);if(null===e)return null;if(i+=e.size,i+e.number>t.length)return null;const r=t.slice(i,i+e.number);i+=e.number;const s=w(r);void 0!==s?n.push(s):n.push(r)}else n.push(r),i+=1}return n}function S(t){const e=-129&t;return e>0&&e<4}e.isPushOnly=d,e.compile=E,e.decompile=y,e.toASM=function(t){return g(t)&&(t=y(t)),t.map((t=>{if(m(t)){const e=w(t);if(void 0===e)return t.toString("hex");t=e}return h[t]})).join(" ")},e.fromASM=function(t){return p(o.String,t),E(t.split(" ").map((t=>void 0!==e.OPS[t]?e.OPS[t]:(p(o.Hex,t),n.from(t,"hex")))))},e.toStack=function(t){return t=y(t),p(d,t),t.map((t=>m(t)?t:t===e.OPS.OP_0?n.allocUnsafe(0):i.encode(t-l)))},e.isCanonicalPubKey=function(t){return a.isPoint(t)},e.isDefinedHashType=S,e.isCanonicalScriptSignature=function(t){return!!n.isBuffer(t)&&(!!S(t[t.length-1])&&u.check(t.slice(0,-1)))},e.number=i,e.signature=s},45079:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0}),e.decode=function(t,e,r){e=e||4,r=void 0===r||r;const n=t.length;if(0===n)return 0;if(n>e)throw new TypeError("Script number overflow");if(r&&0===(127&t[n-1])&&(n<=1||0===(128&t[n-2])))throw new Error("Non-minimally encoded script number");if(5===n){const e=t.readUInt32LE(0),r=t.readUInt8(4);return 128&r?-(4294967296*(-129&r)+e):4294967296*r+e}let i=0;for(let s=0;s<n;++s)i|=t[s]<<8*s;return 128&t[n-1]?-(i&~(128<<8*(n-1))):i},e.encode=function(t){let e=Math.abs(t);const r=(i=e)>2147483647?5:i>8388607?4:i>32767?3:i>127?2:i>0?1:0;var i;const s=n.allocUnsafe(r),o=t<0;for(let n=0;n<r;++n)s.writeUInt8(255&e,n),e>>=8;return 128&s[r-1]?s.writeUInt8(o?128:0,r-1):o&&(s[r-1]|=128),s}},45366:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(46139),s=r(25085),o=r(4317),u=n.alloc(1,0);function a(t){let e=0;for(;0===t[e];)++e;return e===t.length?u:128&(t=t.slice(e))[0]?n.concat([u,t],1+t.length):t}function c(t){0===t[0]&&(t=t.slice(1));const e=n.alloc(32,0),r=Math.max(0,32-t.length);return t.copy(e,r),e}e.decode=function(t){const e=t.readUInt8(t.length-1),r=-129&e;if(r<=0||r>=4)throw new Error("Invalid hashType "+e);const i=s.decode(t.slice(0,-1)),o=c(i.r),u=c(i.s);return{signature:n.concat([o,u],64),hashType:e}},e.encode=function(t,e){o({signature:i.BufferN(64),hashType:i.UInt8},{signature:t,hashType:e});const r=-129&e;if(r<=0||r>=4)throw new Error("Invalid hashType "+e);const u=n.allocUnsafe(1);u.writeUInt8(e,0);const c=a(t.slice(0,32)),p=a(t.slice(32,64));return n.concat([s.encode(c,p),u])}},59997:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(10989);e.input=n;const i=r(42356);e.output=i},10989:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){return t===i.OPS.OP_0||n.isCanonicalScriptSignature(t)}function o(t,e){const r=n.decompile(t);return!(r.length<2)&&(r[0]===i.OPS.OP_0&&(e?r.slice(1).every(s):r.slice(1).every(n.isCanonicalScriptSignature)))}e.check=o,o.toJSON=()=>"multisig input"},42356:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415),s=r(46139),o=i.OPS.OP_RESERVED;function u(t,e){const r=n.decompile(t);if(r.length<4)return!1;if(r[r.length-1]!==i.OPS.OP_CHECKMULTISIG)return!1;if(!s.Number(r[0]))return!1;if(!s.Number(r[r.length-2]))return!1;const u=r[0]-o,a=r[r.length-2]-o;if(u<=0)return!1;if(a>16)return!1;if(u>a)return!1;if(a!==r.length-3)return!1;if(e)return!0;return r.slice(1,-2).every(n.isCanonicalPubKey)}e.check=u,u.toJSON=()=>"multi-sig output"},8973:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=n.OPS;function s(t){const e=n.compile(t);return e.length>1&&e[0]===i.OP_RETURN}e.check=s,s.toJSON=()=>"null data output";const o={check:s};e.output=o},52477:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(24205);e.input=n;const i=r(53364);e.output=i},24205:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415);function i(t){const e=n.decompile(t);return 1===e.length&&n.isCanonicalScriptSignature(e[0])}e.check=i,i.toJSON=()=>"pubKey input"},53364:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalPubKey(e[0])&&e[1]===i.OPS.OP_CHECKSIG}e.check=s,s.toJSON=()=>"pubKey output"},47841:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(86145);e.input=n;const i=r(30320);e.output=i},86145:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415);function i(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalScriptSignature(e[0])&&n.isCanonicalPubKey(e[1])}e.check=i,i.toJSON=()=>"pubKeyHash input"},30320:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){const e=n.compile(t);return 25===e.length&&e[0]===i.OPS.OP_DUP&&e[1]===i.OPS.OP_HASH160&&20===e[2]&&e[23]===i.OPS.OP_EQUALVERIFY&&e[24]===i.OPS.OP_CHECKSIG}e.check=s,s.toJSON=()=>"pubKeyHash output"},59952:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(87280);e.input=n;const i=r(20115);e.output=i},87280:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(22415),s=r(59997),o=r(52477),u=r(47841),a=r(10443),c=r(52220);function p(t,e){const r=i.decompile(t);if(r.length<1)return!1;const p=r[r.length-1];if(!n.isBuffer(p))return!1;const h=i.decompile(i.compile(r.slice(0,-1))),l=i.decompile(p);return!!l&&(!!i.isPushOnly(h)&&(1===r.length?c.check(l)||a.check(l):!(!u.input.check(h)||!u.output.check(l))||(!(!s.input.check(h,e)||!s.output.check(l))||!(!o.input.check(h)||!o.output.check(l)))))}e.check=p,p.toJSON=()=>"scriptHash input"},20115:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){const e=n.compile(t);return 23===e.length&&e[0]===i.OPS.OP_HASH160&&20===e[1]&&e[22]===i.OPS.OP_EQUAL}e.check=s,s.toJSON=()=>"scriptHash output"},75975:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(50146);e.output=n},50146:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(22415),s=r(22415),o=r(46139),u=r(4317),a=n.from("aa21a9ed","hex");function c(t){const e=i.compile(t);return e.length>37&&e[0]===s.OPS.OP_RETURN&&36===e[1]&&e.slice(2,6).equals(a)}e.check=c,c.toJSON=()=>"Witness commitment output",e.encode=function(t){u(o.Hash256bit,t);const e=n.allocUnsafe(36);return a.copy(e,0),t.copy(e,4),i.compile([s.OPS.OP_RETURN,e])},e.decode=function(t){return u(c,t),i.decompile(t)[1].slice(4,36)}},3032:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(1768);e.input=n;const i=r(10443);e.output=i},1768:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415);function i(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalScriptSignature(e[0])&&(r=e[1],n.isCanonicalPubKey(r)&&33===r.length);var r}e.check=i,i.toJSON=()=>"witnessPubKeyHash input"},10443:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){const e=n.compile(t);return 22===e.length&&e[0]===i.OPS.OP_0&&20===e[1]}e.check=s,s.toJSON=()=>"Witness pubKeyHash output"},3765:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(99061);e.input=n;const i=r(52220);e.output=i},99061:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(22415),s=r(4317),o=r(59997),u=r(52477),a=r(47841);function c(t,e){if(s(s.Array,t),t.length<1)return!1;const r=t[t.length-1];if(!n.isBuffer(r))return!1;const c=i.decompile(r);if(!c||0===c.length)return!1;const p=i.compile(t.slice(0,-1));return!(!a.input.check(p)||!a.output.check(c))||(!(!o.input.check(p,e)||!o.output.check(c))||!(!u.input.check(p)||!u.output.check(c)))}e.check=c,c.toJSON=()=>"witnessScriptHash input"},52220:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(22415),i=r(22415);function s(t){const e=n.compile(t);return 34===e.length&&e[0]===i.OPS.OP_0&&32===e[1]}e.check=s,s.toJSON=()=>"Witness scriptHash output"},82362:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(9017),s=r(2726),o=r(22415),u=r(22415),a=r(46139),c=r(4317),p=r(90316);function h(t){const e=t.length;return p.encodingLength(e)+e}const l=n.allocUnsafe(0),f=[],d=n.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),w=n.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),g=n.from("ffffffffffffffff","hex"),m={script:l,valueBuffer:g};class E{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,e){const r=new i.BufferReader(t),n=new E;n.version=r.readInt32();const s=r.readUInt8(),o=r.readUInt8();let u=!1;s===E.ADVANCED_TRANSACTION_MARKER&&o===E.ADVANCED_TRANSACTION_FLAG?u=!0:r.offset-=2;const a=r.readVarInt();for(let i=0;i<a;++i)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:f});const c=r.readVarInt();for(let i=0;i<c;++i)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(u){for(let t=0;t<a;++t)n.ins[t].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),e)return n;if(r.offset!==t.length)throw new Error("Transaction has unexpected data");return n}static fromHex(t){return E.fromBuffer(n.from(t,"hex"),!1)}static isCoinbaseHash(t){c(a.Hash256bit,t);for(let e=0;e<32;++e)if(0!==t[e])return!1;return!0}isCoinbase(){return 1===this.ins.length&&E.isCoinbaseHash(this.ins[0].hash)}addInput(t,e,r,n){return c(a.tuple(a.Hash256bit,a.UInt32,a.maybe(a.UInt32),a.maybe(a.Buffer)),arguments),a.Null(r)&&(r=E.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:e,script:n||l,sequence:r,witness:f})-1}addOutput(t,e){return c(a.tuple(a.Buffer,a.Satoshi),arguments),this.outs.push({script:t,value:e})-1}hasWitnesses(){return this.ins.some((t=>0!==t.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){const e=t&&this.hasWitnesses();return(e?10:8)+p.encodingLength(this.ins.length)+p.encodingLength(this.outs.length)+this.ins.reduce(((t,e)=>t+40+h(e.script)),0)+this.outs.reduce(((t,e)=>t+8+h(e.script)),0)+(e?this.ins.reduce(((t,e)=>t+function(t){const e=t.length;return p.encodingLength(e)+t.reduce(((t,e)=>t+h(e)),0)}(e.witness)),0):0)}clone(){const t=new E;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map((t=>({hash:t.hash,index:t.index,script:t.script,sequence:t.sequence,witness:t.witness}))),t.outs=this.outs.map((t=>({script:t.script,value:t.value}))),t}hashForSignature(t,e,r){if(c(a.tuple(a.UInt32,a.Buffer,a.Number),arguments),t>=this.ins.length)return w;const i=o.compile(o.decompile(e).filter((t=>t!==u.OPS.OP_CODESEPARATOR))),p=this.clone();if((31&r)===E.SIGHASH_NONE)p.outs=[],p.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}));else if((31&r)===E.SIGHASH_SINGLE){if(t>=this.outs.length)return w;p.outs.length=t+1;for(let e=0;e<t;e++)p.outs[e]=m;p.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}))}r&E.SIGHASH_ANYONECANPAY?(p.ins=[p.ins[t]],p.ins[0].script=i):(p.ins.forEach((t=>{t.script=l})),p.ins[t].script=i);const h=n.allocUnsafe(p.byteLength(!1)+4);return h.writeInt32LE(r,h.length-4),p.__toBuffer(h,0,!1),s.hash256(h)}hashForWitnessV0(t,e,r,o){c(a.tuple(a.UInt32,a.Buffer,a.Satoshi,a.UInt32),arguments);let u,p=n.from([]),l=d,f=d,w=d;if(o&E.SIGHASH_ANYONECANPAY||(p=n.allocUnsafe(36*this.ins.length),u=new i.BufferWriter(p,0),this.ins.forEach((t=>{u.writeSlice(t.hash),u.writeUInt32(t.index)})),f=s.hash256(p)),o&E.SIGHASH_ANYONECANPAY||(31&o)===E.SIGHASH_SINGLE||(31&o)===E.SIGHASH_NONE||(p=n.allocUnsafe(4*this.ins.length),u=new i.BufferWriter(p,0),this.ins.forEach((t=>{u.writeUInt32(t.sequence)})),w=s.hash256(p)),(31&o)!==E.SIGHASH_SINGLE&&(31&o)!==E.SIGHASH_NONE){const t=this.outs.reduce(((t,e)=>t+8+h(e.script)),0);p=n.allocUnsafe(t),u=new i.BufferWriter(p,0),this.outs.forEach((t=>{u.writeUInt64(t.value),u.writeVarSlice(t.script)})),l=s.hash256(p)}else if((31&o)===E.SIGHASH_SINGLE&&t<this.outs.length){const e=this.outs[t];p=n.allocUnsafe(8+h(e.script)),u=new i.BufferWriter(p,0),u.writeUInt64(e.value),u.writeVarSlice(e.script),l=s.hash256(p)}p=n.allocUnsafe(156+h(e)),u=new i.BufferWriter(p,0);const g=this.ins[t];return u.writeUInt32(this.version),u.writeSlice(f),u.writeSlice(w),u.writeSlice(g.hash),u.writeUInt32(g.index),u.writeVarSlice(e),u.writeUInt64(r),u.writeUInt32(g.sequence),u.writeSlice(l),u.writeUInt32(this.locktime),u.writeUInt32(o),s.hash256(p)}getHash(t){return t&&this.isCoinbase()?n.alloc(32,0):s.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return i.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(t,e){return this.__toBuffer(t,e,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,e){c(a.tuple(a.Number,a.Buffer),arguments),this.ins[t].script=e}setWitness(t,e){c(a.tuple(a.Number,[a.Buffer]),arguments),this.ins[t].witness=e}__toBuffer(t,e,r=!1){t||(t=n.allocUnsafe(this.byteLength(r)));const s=new i.BufferWriter(t,e||0);s.writeInt32(this.version);const o=r&&this.hasWitnesses();return o&&(s.writeUInt8(E.ADVANCED_TRANSACTION_MARKER),s.writeUInt8(E.ADVANCED_TRANSACTION_FLAG)),s.writeVarInt(this.ins.length),this.ins.forEach((t=>{s.writeSlice(t.hash),s.writeUInt32(t.index),s.writeVarSlice(t.script),s.writeUInt32(t.sequence)})),s.writeVarInt(this.outs.length),this.outs.forEach((t=>{void 0!==t.value?s.writeUInt64(t.value):s.writeSlice(t.valueBuffer),s.writeVarSlice(t.script)})),o&&this.ins.forEach((t=>{s.writeVector(t.witness)})),s.writeUInt32(this.locktime),void 0!==e?t.slice(e,s.offset):t}}E.DEFAULT_SEQUENCE=4294967295,E.SIGHASH_ALL=1,E.SIGHASH_NONE=2,E.SIGHASH_SINGLE=3,E.SIGHASH_ANYONECANPAY=128,E.ADVANCED_TRANSACTION_MARKER=0,E.ADVANCED_TRANSACTION_FLAG=1,e.Transaction=E},82398:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(16814),s=r(9017),o=r(97186),u=r(2726),a=r(5052),c=r(88475),p=r(31632),h=r(22415),l=r(22415),f=r(82362),d=r(46139),w=r(4317),g=o.types,m=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function E(t,e,r){try{w(t,e)}catch(n){throw new Error(r)}}class y{constructor(t=c.bitcoin,e=2500){this.network=t,this.maximumFeeRate=e,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new f.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(t,e){const r=new y(e);return r.setVersion(t.version),r.setLockTime(t.locktime),t.outs.forEach((t=>{r.addOutput(t.script,t.value)})),t.ins.forEach((t=>{r.__addInputUnsafe(t.hash,t.index,{sequence:t.sequence,script:t.script,witness:t.witness})})),r.__INPUTS.forEach(((e,r)=>{!function(t,e,r){if(t.redeemScriptType!==g.P2MS||!t.redeemScript)return;if(t.pubkeys.length===t.signatures.length)return;const n=t.signatures.concat();t.signatures=t.pubkeys.map((i=>{const s=a.fromPublicKey(i);let o;return n.some(((i,u)=>{if(!i)return!1;const a=h.signature.decode(i),c=e.hashForSignature(r,t.redeemScript,a.hashType);return!!s.verify(c,a.signature)&&(n[u]=void 0,o=i,!0)})),o}))}(e,t,r)})),r}setLowR(t){return w(w.maybe(w.Boolean),t),void 0===t&&(t=!0),this.__USE_LOW_R=t,t}setLockTime(t){if(w(d.UInt32,t),this.__INPUTS.some((t=>!!t.signatures&&t.signatures.some((t=>void 0!==t)))))throw new Error("No, this would invalidate signatures");this.__TX.locktime=t}setVersion(t){w(d.UInt32,t),this.__TX.version=t}addInput(t,e,r,i){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let o;if("string"===typeof(u=t)||u instanceof String)t=s.reverseBuffer(n.from(t,"hex"));else if(function(t){return t instanceof f.Transaction}(t)){const r=t.outs[e];i=r.script,o=r.value,t=t.getHash(!1)}var u;return this.__addInputUnsafe(t,e,{sequence:r,prevOutScript:i,value:o})}addOutput(t,e){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return"string"===typeof t&&(t=i.toOutputScript(t,this.network)),this.__TX.addOutput(t,e)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(t,e,r,n,i,s){!function({input:t,ourPubKey:e,keyPair:r,signatureHash:n,hashType:i,useLowR:s}){let o=!1;for(const[u,a]of t.pubkeys.entries()){if(!e.equals(a))continue;if(t.signatures[u])throw new Error("Signature already exists");if(33!==e.length&&t.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");const c=r.sign(n,s);t.signatures[u]=h.signature.encode(c,i),o=!0}if(!o)throw new Error("Key pair cannot sign for this input")}(function(t,e,r,n,i,s,o,u,a,c,l){let y;if("number"===typeof i)console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),y=i;else{if("object"!==typeof i)throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");!function(t,e){if(!m.has(e.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${e.prevOutScriptType}"`);E(w.Number,e.vin,"sign must include vin parameter as Number (input index)"),E(d.Signer,e.keyPair,"sign must include keyPair parameter as Signer interface"),E(w.maybe(w.Number),e.hashType,"sign hashType parameter must be a number");const r=(t[e.vin]||[]).prevOutType,n=e.prevOutScriptType;switch(n){case"p2pkh":if(r&&"pubkeyhash"!==r)throw new TypeError(`input #${e.vin} is not of type p2pkh: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),E(w.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2pk":if(r&&"pubkey"!==r)throw new TypeError(`input #${e.vin} is not of type p2pk: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),E(w.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2wpkh":if(r&&"witnesspubkeyhash"!==r)throw new TypeError(`input #${e.vin} is not of type p2wpkh: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),E(d.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2ms":if(r&&"multisig"!==r)throw new TypeError(`input #${e.vin} is not of type p2ms: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),E(w.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type p2sh-p2wpkh: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.Buffer,e.redeemScript,`${n} requires redeemScript`),E(d.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);E(w.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),E(w.Buffer,e.redeemScript,`${n} requires redeemScript`),E(w.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(r&&"witnessscripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);E(w.Buffer,e.witnessScript,`${n} requires witnessScript`),E(w.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),E(d.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);E(w.Buffer,e.witnessScript,`${n} requires witnessScript`),E(w.Buffer,e.redeemScript,`${n} requires witnessScript`),E(d.Satoshi,e.witnessValue,`${n} requires witnessScript`)}}(e,i),({vin:y,keyPair:s,redeemScript:o,hashType:u,witnessValue:a,witnessScript:c}=i)}if(void 0===s)throw new Error("sign requires keypair");if(s.network&&s.network!==t)throw new TypeError("Inconsistent network");if(!e[y])throw new Error("No input at index: "+y);if(u=u||f.Transaction.SIGHASH_ALL,r(u))throw new Error("Transaction needs outputs");const S=e[y];if(void 0!==S.redeemScript&&o&&!S.redeemScript.equals(o))throw new Error("Inconsistent redeemScript");const v=s.publicKey||s.getPublicKey&&s.getPublicKey();if(!_(S)){if(void 0!==a){if(void 0!==S.value&&S.value!==a)throw new Error("Input did not match witnessValue");w(d.Satoshi,a),S.value=a}if(!_(S)){const t=function(t,e,r,n){if(r&&n){const i=p.p2wsh({redeem:{output:n}}),s=p.p2wsh({output:r}),o=p.p2sh({redeem:{output:r}}),u=p.p2sh({redeem:i});if(!i.hash.equals(s.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!o.hash.equals(u.hash))throw new Error("Redeem script inconsistent with prevOutScript");const a=I(i.redeem.output,e);if(!a.pubkeys)throw new Error(a.type+" not supported as witnessScript ("+h.toASM(n)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(a.signatures=t.signatures);const c=n;if(a.type===g.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:r,redeemScriptType:g.P2WSH,witnessScript:n,witnessScriptType:a.type,prevOutType:g.P2SH,prevOutScript:o.output,hasWitness:!0,signScript:c,signType:a.type,pubkeys:a.pubkeys,signatures:a.signatures,maxSignatures:a.maxSignatures}}if(r){const n=p.p2sh({redeem:{output:r}});if(t.prevOutScript){let e;try{e=p.p2sh({output:t.prevOutScript})}catch(s){throw new Error("PrevOutScript must be P2SH")}if(!n.hash.equals(e.hash))throw new Error("Redeem script inconsistent with prevOutScript")}const i=I(n.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as redeemScript ("+h.toASM(r)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(i.signatures=t.signatures);let o=r;return i.type===g.P2WPKH&&(o=p.p2pkh({pubkey:i.pubkeys[0]}).output),{redeemScript:r,redeemScriptType:i.type,prevOutType:g.P2SH,prevOutScript:n.output,hasWitness:i.type===g.P2WPKH,signScript:o,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(n){const r=p.p2wsh({redeem:{output:n}});if(t.prevOutScript){const e=p.p2wsh({output:t.prevOutScript});if(!r.hash.equals(e.hash))throw new Error("Witness script inconsistent with prevOutScript")}const i=I(r.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as witnessScript ("+h.toASM(n)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(i.signatures=t.signatures);const s=n;if(i.type===g.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:n,witnessScriptType:i.type,prevOutType:g.P2WSH,prevOutScript:r.output,hasWitness:!0,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(t.prevOutType&&t.prevOutScript){if(t.prevOutType===g.P2SH)throw new Error("PrevOutScript is "+t.prevOutType+", requires redeemScript");if(t.prevOutType===g.P2WSH)throw new Error("PrevOutScript is "+t.prevOutType+", requires witnessScript");if(!t.prevOutScript)throw new Error("PrevOutScript is missing");const r=I(t.prevOutScript,e);if(!r.pubkeys)throw new Error(r.type+" not supported ("+h.toASM(t.prevOutScript)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(r.signatures=t.signatures);let n=t.prevOutScript;return r.type===g.P2WPKH&&(n=p.p2pkh({pubkey:r.pubkeys[0]}).output),{prevOutType:r.type,prevOutScript:t.prevOutScript,hasWitness:r.type===g.P2WPKH,signScript:n,signType:r.type,pubkeys:r.pubkeys,signatures:r.signatures,maxSignatures:r.maxSignatures}}const i=p.p2pkh({pubkey:e}).output;return{prevOutType:g.P2PKH,prevOutScript:i,hasWitness:!1,signScript:i,signType:g.P2PKH,pubkeys:[e],signatures:[void 0]}}(S,v,o,c);Object.assign(S,t)}if(!_(S))throw Error(S.prevOutType+" not supported")}let T;T=S.hasWitness?n.hashForWitnessV0(y,S.signScript,S.value,u):n.hashForSignature(y,S.signScript,u);return{input:S,ourPubKey:v,keyPair:s,signatureHash:T,hashType:u,useLowR:!!l}}(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,t,e,r,n,i,s,this.__USE_LOW_R))}__addInputUnsafe(t,e,r){if(f.Transaction.isCoinbaseHash(t))throw new Error("coinbase inputs not supported");const n=t.toString("hex")+":"+e;if(void 0!==this.__PREV_TX_SET[n])throw new Error("Duplicate TxOut: "+n);let i={};if(void 0!==r.script&&(i=S(r.script,r.witness||[])),void 0!==r.value&&(i.value=r.value),!i.prevOutScript&&r.prevOutScript){let t;if(!i.pubkeys&&!i.signatures){const e=I(r.prevOutScript);e.pubkeys&&(i.pubkeys=e.pubkeys,i.signatures=e.signatures),t=e.type}i.prevOutScript=r.prevOutScript,i.prevOutType=t||o.output(r.prevOutScript)}const s=this.__TX.addInput(t,e,r.sequence,r.scriptSig);return this.__INPUTS[s]=i,this.__PREV_TX_SET[n]=!0,s}__build(t){if(!t){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}const e=this.__TX.clone();if(this.__INPUTS.forEach(((r,n)=>{if(!r.prevOutType&&!t)throw new Error("Transaction is not complete");const i=v(r.prevOutType,r,t);if(i)e.setInputScript(n,i.input),e.setWitness(n,i.witness);else{if(!t&&r.prevOutType===g.NONSTANDARD)throw new Error("Unknown input type");if(!t)throw new Error("Not enough information")}})),!t&&this.__overMaximumFees(e.virtualSize()))throw new Error("Transaction has absurd fees");return e}__canModifyInputs(){return this.__INPUTS.every((t=>!t.signatures||t.signatures.every((t=>{if(!t)return!0;return 0!==(T(t)&f.Transaction.SIGHASH_ANYONECANPAY)}))))}__needsOutputs(t){return t===f.Transaction.SIGHASH_ALL?0===this.__TX.outs.length:0===this.__TX.outs.length&&this.__INPUTS.some((t=>!!t.signatures&&t.signatures.some((t=>{if(!t)return!1;return!(T(t)&f.Transaction.SIGHASH_NONE)}))))}__canModifyOutputs(){const t=this.__TX.ins.length,e=this.__TX.outs.length;return this.__INPUTS.every((r=>void 0===r.signatures||r.signatures.every((r=>{if(!r)return!0;const n=31&T(r);return n===f.Transaction.SIGHASH_NONE||n===f.Transaction.SIGHASH_SINGLE&&t<=e}))))}__overMaximumFees(t){return(this.__INPUTS.reduce(((t,e)=>t+(e.value>>>0)),0)-this.__TX.outs.reduce(((t,e)=>t+e.value),0))/t>this.maximumFeeRate}}function S(t,e,r,n){if(0===t.length&&0===e.length)return{};if(!r){let n=o.input(t,!0),i=o.witness(e,!0);n===g.NONSTANDARD&&(n=void 0),i===g.NONSTANDARD&&(i=void 0),r=n||i}switch(r){case g.P2WPKH:{const{output:t,pubkey:r,signature:n}=p.p2wpkh({witness:e});return{prevOutScript:t,prevOutType:g.P2WPKH,pubkeys:[r],signatures:[n]}}case g.P2PKH:{const{output:e,pubkey:r,signature:n}=p.p2pkh({input:t});return{prevOutScript:e,prevOutType:g.P2PKH,pubkeys:[r],signatures:[n]}}case g.P2PK:{const{signature:e}=p.p2pk({input:t});return{prevOutType:g.P2PK,pubkeys:[void 0],signatures:[e]}}case g.P2MS:{const{m:e,pubkeys:r,signatures:i}=p.p2ms({input:t,output:n},{allowIncomplete:!0});return{prevOutType:g.P2MS,pubkeys:r,signatures:i,maxSignatures:e}}}if(r===g.P2SH){const{output:r,redeem:n}=p.p2sh({input:t,witness:e}),i=o.output(n.output),s=S(n.input,n.witness,i,n.output);return s.prevOutType?{prevOutScript:r,prevOutType:g.P2SH,redeemScript:n.output,redeemScriptType:s.prevOutType,witnessScript:s.witnessScript,witnessScriptType:s.witnessScriptType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}if(r===g.P2WSH){const{output:r,redeem:n}=p.p2wsh({input:t,witness:e}),i=o.output(n.output);let s;return s=i===g.P2WPKH?S(n.input,n.witness,i):S(h.compile(n.witness),[],i,n.output),s.prevOutType?{prevOutScript:r,prevOutType:g.P2WSH,witnessScript:n.output,witnessScriptType:s.prevOutType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}return{prevOutType:g.NONSTANDARD,prevOutScript:t}}function I(t,e){w(d.Buffer,t);const r=o.output(t);switch(r){case g.P2PKH:{if(!e)return{type:r};const n=p.p2pkh({output:t}).hash,i=u.hash160(e);return n.equals(i)?{type:r,pubkeys:[e],signatures:[void 0]}:{type:r}}case g.P2WPKH:{if(!e)return{type:r};const n=p.p2wpkh({output:t}).hash,i=u.hash160(e);return n.equals(i)?{type:r,pubkeys:[e],signatures:[void 0]}:{type:r}}case g.P2PK:return{type:r,pubkeys:[p.p2pk({output:t}).pubkey],signatures:[void 0]};case g.P2MS:{const e=p.p2ms({output:t});return{type:r,pubkeys:e.pubkeys,signatures:e.pubkeys.map((()=>{})),maxSignatures:e.m}}}return{type:r}}function v(t,e,r){const n=e.pubkeys||[];let i=e.signatures||[];switch(t){case g.P2PKH:if(0===n.length)break;if(0===i.length)break;return p.p2pkh({pubkey:n[0],signature:i[0]});case g.P2WPKH:if(0===n.length)break;if(0===i.length)break;return p.p2wpkh({pubkey:n[0],signature:i[0]});case g.P2PK:if(0===n.length)break;if(0===i.length)break;return p.p2pk({signature:i[0]});case g.P2MS:{const t=e.maxSignatures;i=r?i.map((t=>t||l.OPS.OP_0)):i.filter((t=>t));const s=!r||t===i.length;return p.p2ms({m:t,pubkeys:n,signatures:i},{allowIncomplete:r,validate:s})}case g.P2SH:{const t=v(e.redeemScriptType,e,r);if(!t)return;return p.p2sh({redeem:{output:t.output||e.redeemScript,input:t.input,witness:t.witness}})}case g.P2WSH:{const t=v(e.witnessScriptType,e,r);if(!t)return;return p.p2wsh({redeem:{output:e.witnessScript,input:t.input,witness:t.witness}})}}}function _(t){return void 0!==t.signScript&&void 0!==t.signType&&void 0!==t.pubkeys&&void 0!==t.signatures&&t.signatures.length===t.pubkeys.length&&t.pubkeys.length>0&&(!1===t.hasWitness||void 0!==t.value)}function T(t){return t.readUInt8(t.length-1)}e.TransactionBuilder=y},46139:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(4317),i=Math.pow(2,31)-1;function s(t){return n.String(t)&&!!t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}e.UInt31=function(t){return n.UInt32(t)&&t<=i},e.BIP32Path=s,s.toJSON=()=>"BIP32 derivation path",e.Signer=function(t){return(n.Buffer(t.publicKey)||"function"===typeof t.getPublicKey)&&"function"===typeof t.sign};e.Satoshi=function(t){return n.UInt53(t)&&t<=21e14},e.ECPoint=n.quacksLike("Point"),e.Network=n.compile({messagePrefix:n.oneOf(n.Buffer,n.String),bip32:{public:n.UInt32,private:n.UInt32},pubKeyHash:n.UInt8,scriptHash:n.UInt8,wif:n.UInt8}),e.Buffer256bit=n.BufferN(32),e.Hash160bit=n.BufferN(20),e.Hash256bit=n.BufferN(32),e.Number=n.Number,e.Array=n.Array,e.Boolean=n.Boolean,e.String=n.String,e.Buffer=n.Buffer,e.Hex=n.Hex,e.maybe=n.maybe,e.tuple=n.tuple,e.UInt8=n.UInt8,e.UInt32=n.UInt32,e.Function=n.Function,e.BufferN=n.BufferN,e.Null=n.Null,e.oneOf=n.oneOf},90345:(t,e,r)=>{"use strict";var n=r(59008),i=r(7412).Buffer;t.exports=function(t){function e(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(e){var r=t(e);return n.encode(i.concat([e,r],e.length+4))},decode:function(t){var r=e(n.decode(t));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(t){var r=n.decodeUnsafe(t);if(r)return e(r)}}}},2954:(t,e,r)=>{"use strict";var n=r(76313),i=r(90345);t.exports=i((function(t){var e=n("sha256").update(t).digest();return n("sha256").update(e).digest()}))},64867:(t,e,r)=>{const n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(t,e){if(e=s(e),t instanceof i){if(t.loose===!!e.loose)return t;t=t.value}t=t.trim().split(/\s+/).join(" "),c("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(t){const e=this.options.loose?o[u.COMPARATORLOOSE]:o[u.COMPARATOR],r=t.match(e);if(!r)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new p(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(t){if(c("Comparator.test",t,this.options.loose),this.semver===n||t===n)return!0;if("string"===typeof t)try{t=new p(t,this.options)}catch(e){return!1}return a(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new h(t.value,e).test(this.value):""===t.operator?""===t.value||new h(this.value,e).test(t.semver):(!(e=s(e)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==t.value)&&(!(!e.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!t.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!t.operator.startsWith("<"))||(!(this.semver.version!==t.semver.version||!this.operator.includes("=")||!t.operator.includes("="))||(!!(a(this.semver,"<",t.semver,e)&&this.operator.startsWith(">")&&t.operator.startsWith("<"))||!!(a(this.semver,">",t.semver,e)&&this.operator.startsWith("<")&&t.operator.startsWith(">")))))))}}t.exports=i;const s=r(59668),{safeRe:o,t:u}=r(79151),a=r(88102),c=r(25607),p=r(76379),h=r(44878)},44878:(t,e,r)=>{class n{constructor(t,e){if(e=s(e),t instanceof n)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new n(t.raw,e);if(t instanceof o)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((t=>this.parseRange(t.trim()))).filter((t=>t.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const t=this.set[0];if(this.set=this.set.filter((t=>!g(t[0]))),0===this.set.length)this.set=[t];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&m(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((t=>t.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(t){const e=((this.options.includePrerelease&&d)|(this.options.loose&&w))+":"+t,r=i.get(e);if(r)return r;const n=this.options.loose,s=n?c[p.HYPHENRANGELOOSE]:c[p.HYPHENRANGE];t=t.replace(s,A(this.options.includePrerelease)),u("hyphen replace",t),t=t.replace(c[p.COMPARATORTRIM],h),u("comparator trim",t),t=t.replace(c[p.TILDETRIM],l),u("tilde trim",t),t=t.replace(c[p.CARETTRIM],f),u("caret trim",t);let a=t.split(" ").map((t=>y(t,this.options))).join(" ").split(/\s+/).map((t=>N(t,this.options)));n&&(a=a.filter((t=>(u("loose invalid filter",t,this.options),!!t.match(c[p.COMPARATORLOOSE]))))),u("range list",a);const m=new Map,E=a.map((t=>new o(t,this.options)));for(const i of E){if(g(i))return[i];m.set(i.value,i)}m.size>1&&m.has("")&&m.delete("");const S=[...m.values()];return i.set(e,S),S}intersects(t,e){if(!(t instanceof n))throw new TypeError("a Range is required");return this.set.some((r=>E(r,e)&&t.set.some((t=>E(t,e)&&r.every((r=>t.every((t=>r.intersects(t,e)))))))))}test(t){if(!t)return!1;if("string"===typeof t)try{t=new a(t,this.options)}catch(e){return!1}for(let r=0;r<this.set.length;r++)if(k(this.set[r],t,this.options))return!0;return!1}}t.exports=n;const i=new(r(9735)),s=r(59668),o=r(64867),u=r(25607),a=r(76379),{safeRe:c,t:p,comparatorTrimReplace:h,tildeTrimReplace:l,caretTrimReplace:f}=r(79151),{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:w}=r(15021),g=t=>"<0.0.0-0"===t.value,m=t=>""===t.value,E=(t,e)=>{let r=!0;const n=t.slice();let i=n.pop();for(;r&&n.length;)r=n.every((t=>i.intersects(t,e))),i=n.pop();return r},y=(t,e)=>(u("comp",t,e),t=_(t,e),u("caret",t),t=I(t,e),u("tildes",t),t=O(t,e),u("xrange",t),t=P(t,e),u("stars",t),t),S=t=>!t||"x"===t.toLowerCase()||"*"===t,I=(t,e)=>t.trim().split(/\s+/).map((t=>v(t,e))).join(" "),v=(t,e)=>{const r=e.loose?c[p.TILDELOOSE]:c[p.TILDE];return t.replace(r,((e,r,n,i,s)=>{let o;return u("tilde",t,e,r,n,i,s),S(r)?o="":S(n)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:S(i)?o=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:s?(u("replaceTilde pr",s),o=`>=${r}.${n}.${i}-${s} <${r}.${+n+1}.0-0`):o=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,u("tilde return",o),o}))},_=(t,e)=>t.trim().split(/\s+/).map((t=>T(t,e))).join(" "),T=(t,e)=>{u("caret",t,e);const r=e.loose?c[p.CARETLOOSE]:c[p.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,((e,r,i,s,o)=>{let a;return u("caret",t,e,r,i,s,o),S(r)?a="":S(i)?a=`>=${r}.0.0${n} <${+r+1}.0.0-0`:S(s)?a="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:o?(u("replaceCaret pr",o),a="0"===r?"0"===i?`>=${r}.${i}.${s}-${o} <${r}.${i}.${+s+1}-0`:`>=${r}.${i}.${s}-${o} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${s}-${o} <${+r+1}.0.0-0`):(u("no pr"),a="0"===r?"0"===i?`>=${r}.${i}.${s}${n} <${r}.${i}.${+s+1}-0`:`>=${r}.${i}.${s}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${s} <${+r+1}.0.0-0`),u("caret return",a),a}))},O=(t,e)=>(u("replaceXRanges",t,e),t.split(/\s+/).map((t=>b(t,e))).join(" ")),b=(t,e)=>{t=t.trim();const r=e.loose?c[p.XRANGELOOSE]:c[p.XRANGE];return t.replace(r,((r,n,i,s,o,a)=>{u("xRange",t,r,n,i,s,o,a);const c=S(i),p=c||S(s),h=p||S(o),l=h;return"="===n&&l&&(n=""),a=e.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&l?(p&&(s=0),o=0,">"===n?(n=">=",p?(i=+i+1,s=0,o=0):(s=+s+1,o=0)):"<="===n&&(n="<",p?i=+i+1:s=+s+1),"<"===n&&(a="-0"),r=`${n+i}.${s}.${o}${a}`):p?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:h&&(r=`>=${i}.${s}.0${a} <${i}.${+s+1}.0-0`),u("xRange return",r),r}))},P=(t,e)=>(u("replaceStars",t,e),t.trim().replace(c[p.STAR],"")),N=(t,e)=>(u("replaceGTE0",t,e),t.trim().replace(c[e.includePrerelease?p.GTE0PRE:p.GTE0],"")),A=t=>(e,r,n,i,s,o,u,a,c,p,h,l)=>`${r=S(n)?"":S(i)?`>=${n}.0.0${t?"-0":""}`:S(s)?`>=${n}.${i}.0${t?"-0":""}`:o?`>=${r}`:`>=${r}${t?"-0":""}`} ${a=S(c)?"":S(p)?`<${+c+1}.0.0-0`:S(h)?`<${c}.${+p+1}.0-0`:l?`<=${c}.${p}.${h}-${l}`:t?`<${c}.${p}.${+h+1}-0`:`<=${a}`}`.trim(),k=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let r=0;r<t.length;r++)if(u(t[r].semver),t[r].semver!==o.ANY&&t[r].semver.prerelease.length>0){const n=t[r].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}},76379:(t,e,r)=>{const n=r(25607),{MAX_LENGTH:i,MAX_SAFE_INTEGER:s}=r(15021),{safeRe:o,t:u}=r(79151),a=r(59668),{compareIdentifiers:c}=r(30180);class p{constructor(t,e){if(e=a(e),t instanceof p){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!==typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const r=t.trim().match(e.loose?o[u.LOOSE]:o[u.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<s)return e}return t})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(n("SemVer.compare",this.version,this.options,t),!(t instanceof p)){if("string"===typeof t&&t===this.version)return 0;t=new p(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof p||(t=new p(t,this.options)),c(this.major,t.major)||c(this.minor,t.minor)||c(this.patch,t.patch)}comparePre(t){if(t instanceof p||(t=new p(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const r=this.prerelease[e],i=t.prerelease[e];if(n("prerelease compare",e,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++e)}compareBuild(t){t instanceof p||(t=new p(t,this.options));let e=0;do{const r=this.build[e],i=t.build[e];if(n("build compare",e,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++e)}inc(t,e,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,r),this.inc("pre",e,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e,r),this.inc("pre",e,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const t=Number(r)?1:0;if(!e&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[t];else{let n=this.prerelease.length;for(;--n>=0;)"number"===typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(e===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(t)}}if(e){let n=[e,t];!1===r&&(n=[e]),0===c(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=p},50759:(t,e,r)=>{const n=r(3809);t.exports=(t,e)=>{const r=n(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}},88102:(t,e,r)=>{const n=r(63402),i=r(56878),s=r(76503),o=r(6868),u=r(29088),a=r(50093);t.exports=(t,e,r,c)=>{switch(e){case"===":return"object"===typeof t&&(t=t.version),"object"===typeof r&&(r=r.version),t===r;case"!==":return"object"===typeof t&&(t=t.version),"object"===typeof r&&(r=r.version),t!==r;case"":case"=":case"==":return n(t,r,c);case"!=":return i(t,r,c);case">":return s(t,r,c);case">=":return o(t,r,c);case"<":return u(t,r,c);case"<=":return a(t,r,c);default:throw new TypeError(`Invalid operator: ${e}`)}}},80345:(t,e,r)=>{const n=r(76379),i=r(3809),{safeRe:s,t:o}=r(79151);t.exports=(t,e)=>{if(t instanceof n)return t;if("number"===typeof t&&(t=String(t)),"string"!==typeof t)return null;let r=null;if((e=e||{}).rtl){const n=e.includePrerelease?s[o.COERCERTLFULL]:s[o.COERCERTL];let i;for(;(i=n.exec(t))&&(!r||r.index+r[0].length!==t.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=t.match(e.includePrerelease?s[o.COERCEFULL]:s[o.COERCE]);if(null===r)return null;const u=r[2],a=r[3]||"0",c=r[4]||"0",p=e.includePrerelease&&r[5]?`-${r[5]}`:"",h=e.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${u}.${a}.${c}${p}${h}`,e)}},37488:(t,e,r)=>{const n=r(76379);t.exports=(t,e,r)=>{const i=new n(t,r),s=new n(e,r);return i.compare(s)||i.compareBuild(s)}},39722:(t,e,r)=>{const n=r(45061);t.exports=(t,e)=>n(t,e,!0)},45061:(t,e,r)=>{const n=r(76379);t.exports=(t,e,r)=>new n(t,r).compare(new n(e,r))},46967:(t,e,r)=>{const n=r(3809);t.exports=(t,e)=>{const r=n(t,null,!0),i=n(e,null,!0),s=r.compare(i);if(0===s)return null;const o=s>0,u=o?r:i,a=o?i:r,c=!!u.prerelease.length;if(!!a.prerelease.length&&!c)return a.patch||a.minor?u.patch?"patch":u.minor?"minor":"major":"major";const p=c?"pre":"";return r.major!==i.major?p+"major":r.minor!==i.minor?p+"minor":r.patch!==i.patch?p+"patch":"prerelease"}},63402:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>0===n(t,e,r)},76503:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>n(t,e,r)>0},6868:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>n(t,e,r)>=0},93506:(t,e,r)=>{const n=r(76379);t.exports=(t,e,r,i,s)=>{"string"===typeof r&&(s=i,i=r,r=void 0);try{return new n(t instanceof n?t.version:t,r).inc(e,i,s).version}catch(o){return null}}},29088:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>n(t,e,r)<0},50093:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>n(t,e,r)<=0},7647:(t,e,r)=>{const n=r(76379);t.exports=(t,e)=>new n(t,e).major},33947:(t,e,r)=>{const n=r(76379);t.exports=(t,e)=>new n(t,e).minor},56878:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>0!==n(t,e,r)},3809:(t,e,r)=>{const n=r(76379);t.exports=(t,e,r=!1)=>{if(t instanceof n)return t;try{return new n(t,e)}catch(i){if(!r)return null;throw i}}},21812:(t,e,r)=>{const n=r(76379);t.exports=(t,e)=>new n(t,e).patch},25538:(t,e,r)=>{const n=r(3809);t.exports=(t,e)=>{const r=n(t,e);return r&&r.prerelease.length?r.prerelease:null}},84685:(t,e,r)=>{const n=r(45061);t.exports=(t,e,r)=>n(e,t,r)},43896:(t,e,r)=>{const n=r(37488);t.exports=(t,e)=>t.sort(((t,r)=>n(r,t,e)))},80715:(t,e,r)=>{const n=r(44878);t.exports=(t,e,r)=>{try{e=new n(e,r)}catch(i){return!1}return e.test(t)}},13968:(t,e,r)=>{const n=r(37488);t.exports=(t,e)=>t.sort(((t,r)=>n(t,r,e)))},92700:(t,e,r)=>{const n=r(3809);t.exports=(t,e)=>{const r=n(t,e);return r?r.version:null}},6280:(t,e,r)=>{const n=r(79151),i=r(15021),s=r(76379),o=r(30180),u=r(3809),a=r(92700),c=r(50759),p=r(93506),h=r(46967),l=r(7647),f=r(33947),d=r(21812),w=r(25538),g=r(45061),m=r(84685),E=r(39722),y=r(37488),S=r(13968),I=r(43896),v=r(76503),_=r(29088),T=r(63402),O=r(56878),b=r(6868),P=r(50093),N=r(88102),A=r(80345),k=r(64867),R=r(44878),U=r(80715),x=r(89278),C=r(49961),H=r(10899),L=r(78778),B=r(60289),M=r(50088),D=r(72180),$=r(67277),G=r(17353),K=r(89228),F=r(76433);t.exports={parse:u,valid:a,clean:c,inc:p,diff:h,major:l,minor:f,patch:d,prerelease:w,compare:g,rcompare:m,compareLoose:E,compareBuild:y,sort:S,rsort:I,gt:v,lt:_,eq:T,neq:O,gte:b,lte:P,cmp:N,coerce:A,Comparator:k,Range:R,satisfies:U,toComparators:x,maxSatisfying:C,minSatisfying:H,minVersion:L,validRange:B,outside:M,gtr:D,ltr:$,intersects:G,simplifyRange:K,subset:F,SemVer:s,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},15021:t=>{const e=Number.MAX_SAFE_INTEGER||9007199254740991;t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},25607:(t,e,r)=>{const n="object"===typeof r(28819)&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NODE_DEBUG&&/\bsemver\b/i.test({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};t.exports=n},30180:t=>{const e=/^[0-9]+$/,r=(t,r)=>{const n=e.test(t),i=e.test(r);return n&&i&&(t=+t,r=+r),t===r?0:n&&!i?-1:i&&!n?1:t<r?-1:1};t.exports={compareIdentifiers:r,rcompareIdentifiers:(t,e)=>r(e,t)}},9735:t=>{t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);return void 0===e?void 0:(this.map.delete(t),this.map.set(t,e),e)}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&void 0!==e){if(this.map.size>=this.max){const t=this.map.keys().next().value;this.delete(t)}this.map.set(t,e)}return this}}},59668:t=>{const e=Object.freeze({loose:!0}),r=Object.freeze({});t.exports=t=>t?"object"!==typeof t?e:t:r},79151:(t,e,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:s}=r(15021),o=r(25607),u=(e=t.exports={}).re=[],a=e.safeRe=[],c=e.src=[],p=e.t={};let h=0;const l="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[l,i]],d=(t,e,r)=>{const n=(t=>{for(const[e,r]of f)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t})(e),i=h++;o(t,i,e),p[t]=i,c[i]=e,u[i]=new RegExp(e,r?"g":void 0),a[i]=new RegExp(n,r?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${l}*`),d("MAINVERSION",`(${c[p.NUMERICIDENTIFIER]})\\.(${c[p.NUMERICIDENTIFIER]})\\.(${c[p.NUMERICIDENTIFIER]})`),d("MAINVERSIONLOOSE",`(${c[p.NUMERICIDENTIFIERLOOSE]})\\.(${c[p.NUMERICIDENTIFIERLOOSE]})\\.(${c[p.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASEIDENTIFIER",`(?:${c[p.NUMERICIDENTIFIER]}|${c[p.NONNUMERICIDENTIFIER]})`),d("PRERELEASEIDENTIFIERLOOSE",`(?:${c[p.NUMERICIDENTIFIERLOOSE]}|${c[p.NONNUMERICIDENTIFIER]})`),d("PRERELEASE",`(?:-(${c[p.PRERELEASEIDENTIFIER]}(?:\\.${c[p.PRERELEASEIDENTIFIER]})*))`),d("PRERELEASELOOSE",`(?:-?(${c[p.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[p.PRERELEASEIDENTIFIERLOOSE]})*))`),d("BUILDIDENTIFIER",`${l}+`),d("BUILD",`(?:\\+(${c[p.BUILDIDENTIFIER]}(?:\\.${c[p.BUILDIDENTIFIER]})*))`),d("FULLPLAIN",`v?${c[p.MAINVERSION]}${c[p.PRERELEASE]}?${c[p.BUILD]}?`),d("FULL",`^${c[p.FULLPLAIN]}$`),d("LOOSEPLAIN",`[v=\\s]*${c[p.MAINVERSIONLOOSE]}${c[p.PRERELEASELOOSE]}?${c[p.BUILD]}?`),d("LOOSE",`^${c[p.LOOSEPLAIN]}$`),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE",`${c[p.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),d("XRANGEIDENTIFIER",`${c[p.NUMERICIDENTIFIER]}|x|X|\\*`),d("XRANGEPLAIN",`[v=\\s]*(${c[p.XRANGEIDENTIFIER]})(?:\\.(${c[p.XRANGEIDENTIFIER]})(?:\\.(${c[p.XRANGEIDENTIFIER]})(?:${c[p.PRERELEASE]})?${c[p.BUILD]}?)?)?`),d("XRANGEPLAINLOOSE",`[v=\\s]*(${c[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[p.XRANGEIDENTIFIERLOOSE]})(?:${c[p.PRERELEASELOOSE]})?${c[p.BUILD]}?)?)?`),d("XRANGE",`^${c[p.GTLT]}\\s*${c[p.XRANGEPLAIN]}$`),d("XRANGELOOSE",`^${c[p.GTLT]}\\s*${c[p.XRANGEPLAINLOOSE]}$`),d("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),d("COERCE",`${c[p.COERCEPLAIN]}(?:$|[^\\d])`),d("COERCEFULL",c[p.COERCEPLAIN]+`(?:${c[p.PRERELEASE]})?`+`(?:${c[p.BUILD]})?(?:$|[^\\d])`),d("COERCERTL",c[p.COERCE],!0),d("COERCERTLFULL",c[p.COERCEFULL],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM",`(\\s*)${c[p.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",d("TILDE",`^${c[p.LONETILDE]}${c[p.XRANGEPLAIN]}$`),d("TILDELOOSE",`^${c[p.LONETILDE]}${c[p.XRANGEPLAINLOOSE]}$`),d("LONECARET","(?:\\^)"),d("CARETTRIM",`(\\s*)${c[p.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",d("CARET",`^${c[p.LONECARET]}${c[p.XRANGEPLAIN]}$`),d("CARETLOOSE",`^${c[p.LONECARET]}${c[p.XRANGEPLAINLOOSE]}$`),d("COMPARATORLOOSE",`^${c[p.GTLT]}\\s*(${c[p.LOOSEPLAIN]})$|^$`),d("COMPARATOR",`^${c[p.GTLT]}\\s*(${c[p.FULLPLAIN]})$|^$`),d("COMPARATORTRIM",`(\\s*)${c[p.GTLT]}\\s*(${c[p.LOOSEPLAIN]}|${c[p.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE",`^\\s*(${c[p.XRANGEPLAIN]})\\s+-\\s+(${c[p.XRANGEPLAIN]})\\s*$`),d("HYPHENRANGELOOSE",`^\\s*(${c[p.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[p.XRANGEPLAINLOOSE]})\\s*$`),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},72180:(t,e,r)=>{const n=r(50088);t.exports=(t,e,r)=>n(t,e,">",r)},17353:(t,e,r)=>{const n=r(44878);t.exports=(t,e,r)=>(t=new n(t,r),e=new n(e,r),t.intersects(e,r))},67277:(t,e,r)=>{const n=r(50088);t.exports=(t,e,r)=>n(t,e,"<",r)},49961:(t,e,r)=>{const n=r(76379),i=r(44878);t.exports=(t,e,r)=>{let s=null,o=null,u=null;try{u=new i(e,r)}catch(a){return null}return t.forEach((t=>{u.test(t)&&(s&&-1!==o.compare(t)||(s=t,o=new n(s,r)))})),s}},10899:(t,e,r)=>{const n=r(76379),i=r(44878);t.exports=(t,e,r)=>{let s=null,o=null,u=null;try{u=new i(e,r)}catch(a){return null}return t.forEach((t=>{u.test(t)&&(s&&1!==o.compare(t)||(s=t,o=new n(s,r)))})),s}},78778:(t,e,r)=>{const n=r(76379),i=r(44878),s=r(76503);t.exports=(t,e)=>{t=new i(t,e);let r=new n("0.0.0");if(t.test(r))return r;if(r=new n("0.0.0-0"),t.test(r))return r;r=null;for(let i=0;i<t.set.length;++i){const e=t.set[i];let o=null;e.forEach((t=>{const e=new n(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":o&&!s(e,o)||(o=e);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!o||r&&!s(r,o)||(r=o)}return r&&t.test(r)?r:null}},50088:(t,e,r)=>{const n=r(76379),i=r(64867),{ANY:s}=i,o=r(44878),u=r(80715),a=r(76503),c=r(29088),p=r(50093),h=r(6868);t.exports=(t,e,r,l)=>{let f,d,w,g,m;switch(t=new n(t,l),e=new o(e,l),r){case">":f=a,d=p,w=c,g=">",m=">=";break;case"<":f=c,d=h,w=a,g="<",m="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(u(t,e,l))return!1;for(let n=0;n<e.set.length;++n){const r=e.set[n];let o=null,u=null;if(r.forEach((t=>{t.semver===s&&(t=new i(">=0.0.0")),o=o||t,u=u||t,f(t.semver,o.semver,l)?o=t:w(t.semver,u.semver,l)&&(u=t)})),o.operator===g||o.operator===m)return!1;if((!u.operator||u.operator===g)&&d(t,u.semver))return!1;if(u.operator===m&&w(t,u.semver))return!1}return!0}},89228:(t,e,r)=>{const n=r(80715),i=r(45061);t.exports=(t,e,r)=>{const s=[];let o=null,u=null;const a=t.sort(((t,e)=>i(t,e,r)));for(const i of a){n(i,e,r)?(u=i,o||(o=i)):(u&&s.push([o,u]),u=null,o=null)}o&&s.push([o,null]);const c=[];for(const[n,i]of s)n===i?c.push(n):i||n!==a[0]?i?n===a[0]?c.push(`<=${i}`):c.push(`${n} - ${i}`):c.push(`>=${n}`):c.push("*");const p=c.join(" || "),h="string"===typeof e.raw?e.raw:String(e);return p.length<h.length?p:e}},76433:(t,e,r)=>{const n=r(44878),i=r(64867),{ANY:s}=i,o=r(80715),u=r(45061),a=[new i(">=0.0.0-0")],c=[new i(">=0.0.0")],p=(t,e,r)=>{if(t===e)return!0;if(1===t.length&&t[0].semver===s){if(1===e.length&&e[0].semver===s)return!0;t=r.includePrerelease?a:c}if(1===e.length&&e[0].semver===s){if(r.includePrerelease)return!0;e=c}const n=new Set;let i,p,f,d,w,g,m;for(const s of t)">"===s.operator||">="===s.operator?i=h(i,s,r):"<"===s.operator||"<="===s.operator?p=l(p,s,r):n.add(s.semver);if(n.size>1)return null;if(i&&p){if(f=u(i.semver,p.semver,r),f>0)return null;if(0===f&&(">="!==i.operator||"<="!==p.operator))return null}for(const s of n){if(i&&!o(s,String(i),r))return null;if(p&&!o(s,String(p),r))return null;for(const t of e)if(!o(s,String(t),r))return!1;return!0}let E=!(!p||r.includePrerelease||!p.semver.prerelease.length)&&p.semver,y=!(!i||r.includePrerelease||!i.semver.prerelease.length)&&i.semver;E&&1===E.prerelease.length&&"<"===p.operator&&0===E.prerelease[0]&&(E=!1);for(const s of e){if(m=m||">"===s.operator||">="===s.operator,g=g||"<"===s.operator||"<="===s.operator,i)if(y&&s.semver.prerelease&&s.semver.prerelease.length&&s.semver.major===y.major&&s.semver.minor===y.minor&&s.semver.patch===y.patch&&(y=!1),">"===s.operator||">="===s.operator){if(d=h(i,s,r),d===s&&d!==i)return!1}else if(">="===i.operator&&!o(i.semver,String(s),r))return!1;if(p)if(E&&s.semver.prerelease&&s.semver.prerelease.length&&s.semver.major===E.major&&s.semver.minor===E.minor&&s.semver.patch===E.patch&&(E=!1),"<"===s.operator||"<="===s.operator){if(w=l(p,s,r),w===s&&w!==p)return!1}else if("<="===p.operator&&!o(p.semver,String(s),r))return!1;if(!s.operator&&(p||i)&&0!==f)return!1}return!(i&&g&&!p&&0!==f)&&(!(p&&m&&!i&&0!==f)&&(!y&&!E))},h=(t,e,r)=>{if(!t)return e;const n=u(t.semver,e.semver,r);return n>0?t:n<0||">"===e.operator&&">="===t.operator?e:t},l=(t,e,r)=>{if(!t)return e;const n=u(t.semver,e.semver,r);return n<0?t:n>0||"<"===e.operator&&"<="===t.operator?e:t};t.exports=(t,e,r={})=>{if(t===e)return!0;t=new n(t,r),e=new n(e,r);let i=!1;t:for(const n of t.set){for(const t of e.set){const e=p(n,t,r);if(i=i||null!==e,e)continue t}if(i)return!1}return!0}},89278:(t,e,r)=>{const n=r(44878);t.exports=(t,e)=>new n(t,e).set.map((t=>t.map((t=>t.value)).join(" ").trim().split(" ")))},60289:(t,e,r)=>{const n=r(44878);t.exports=(t,e)=>{try{return new n(t,e).range||"*"}catch(r){return null}}},34401:(t,e,r)=>{"use strict";r.d(e,{PR:()=>o,Rm:()=>s});let n=0;const i=[],s=(t,e,r)=>{const i={type:t,id:String(++n),date:new Date};e&&(i.message=e),r&&(i.data=r),a(i)};class o{constructor(t,e){this.type=t,this.context=e}trace(t,e){(({type:t,message:e,data:r,context:i})=>{const s={type:t,id:String(++n),date:new Date};e&&(s.message=e),r&&(s.data=r),i&&(s.context=i),a(s)})({type:this.type,message:t,data:e,context:this.context})}getContext(){return this.context}setContext(t){this.context=t}updateContext(t){this.context=Object.assign(Object.assign({},this.context),t)}getType(){return this.type}setType(t){this.type=t}withType(t){return new o(t,this.context)}withContext(t){return new o(this.type,t)}withUpdatedContext(t){return new o(this.type,Object.assign(Object.assign({},this.context),t))}}const u=t=>(i.push(t),()=>{const e=i.indexOf(t);-1!==e&&(i[e]=i[i.length-1],i.pop())});function a(t){for(let r=0;r<i.length;r++)try{i[r](t)}catch(e){console.error(e)}}"undefined"!==typeof window&&(window.__ledgerLogsListen=u)},91760:t=>{const e=2147483648;var r=function(t){if(!Array.isArray(t))throw new Error("Input must be an Array");if(0===t.length)throw new Error("Path must contain at least one level");for(var e=0;e<t.length;e++)if("number"!==typeof t[e])throw new Error("Path element is not a number");this.path=t};r.validatePathArray=function(t){try{return r.fromPathArray(t),!0}catch(e){return!1}},r.validateString=function(t,e){try{return r.fromString(t,e),!0}catch(n){return!1}},r.fromPathArray=function(t){return new r(t)},r.fromString=function(t,n){if(/^m\//i.test(t))t=t.slice(2);else if(n)throw new Error("Root element is required");for(var i=t.split("/"),s=new Array(i.length),o=0;o<i.length;o++){var u=/(\d+)([hH\']?)/.exec(i[o]);if(null===u)throw new Error("Invalid input");if(s[o]=parseInt(u[1],10),s[o]>=e)throw new Error("Invalid child index");if("h"===u[2]||"H"===u[2]||"'"===u[2])s[o]+=e;else if(0!=u[2].length)throw new Error("Invalid modifier")}return new r(s)},r.prototype.toPathArray=function(){return this.path},r.prototype.toString=function(t,r){for(var n=new Array(this.path.length),i=0;i<this.path.length;i++){var s=this.path[i];n[i]=s&e?(s&~e)+(r?"h":"'"):s}return(t?"":"m/")+n.join("/")},r.prototype.inspect=function(){return"BIPPath <"+this.toString()+">"},t.exports=r},27161:(t,e,r)=>{"use strict";var n=r(59008),i=r(7412).Buffer;t.exports=function(t){function e(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(e){var r=t(e);return n.encode(i.concat([e,r],e.length+4))},decode:function(t){var r=e(n.decode(t));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(t){var r=n.decodeUnsafe(t);if(r)return e(r)}}}},78042:(t,e,r)=>{"use strict";var n=r(76313),i=r(27161);t.exports=i((function(t){var e=n("sha256").update(t).digest();return n("sha256").update(e).digest()}))},98187:(t,e,r)=>{"use strict";var n=r(74248).Buffer;Object.defineProperty(e,"__esModule",{value:!0});const i=r(70460),s=r(78042),o=r(56498),u=r(4317),a=r(2008),c=u.BufferN(32),p=u.compile({wif:u.UInt8,bip32:{public:u.UInt32,private:u.UInt32}}),h={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},l=2147483648,f=Math.pow(2,31)-1;function d(t){return u.String(t)&&null!==t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}function w(t){return u.UInt32(t)&&t<=f}class g{constructor(t,e,r,n,i=0,s=0,o=0){this.__D=t,this.__Q=e,this.chainCode=r,this.network=n,this.__DEPTH=i,this.__INDEX=s,this.__PARENT_FINGERPRINT=o,u(p,n),this.lowR=!1}get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){return void 0===this.__Q&&(this.__Q=o.pointFromScalar(this.__D,!0)),this.__Q}get privateKey(){return this.__D}get identifier(){return i.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}get compressed(){return!0}isNeutered(){return void 0===this.__D}neutered(){return y(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){const t=this.network,e=this.isNeutered()?t.bip32.public:t.bip32.private,r=n.allocUnsafe(78);return r.writeUInt32BE(e,0),r.writeUInt8(this.depth,4),r.writeUInt32BE(this.parentFingerprint,5),r.writeUInt32BE(this.index,9),this.chainCode.copy(r,13),this.isNeutered()?this.publicKey.copy(r,45):(r.writeUInt8(0,45),this.privateKey.copy(r,46)),s.encode(r)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return a.encode(this.network.wif,this.privateKey,!0)}derive(t){u(u.UInt32,t);const e=t>=l,r=n.allocUnsafe(37);if(e){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");r[0]=0,this.privateKey.copy(r,1),r.writeUInt32BE(t,33)}else this.publicKey.copy(r,0),r.writeUInt32BE(t,33);const s=i.hmacSHA512(this.chainCode,r),a=s.slice(0,32),c=s.slice(32);if(!o.isPrivate(a))return this.derive(t+1);let p;if(this.isNeutered()){const e=o.pointAddScalar(this.publicKey,a,!0);if(null===e)return this.derive(t+1);p=y(e,c,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}else{const e=o.privateAdd(this.privateKey,a);if(null==e)return this.derive(t+1);p=E(e,c,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}return p}deriveHardened(t){return u(w,t),this.derive(t+l)}derivePath(t){u(d,t);let e=t.split("/");if("m"===e[0]){if(this.parentFingerprint)throw new TypeError("Expected master, got child");e=e.slice(1)}return e.reduce(((t,e)=>{let r;return"'"===e.slice(-1)?(r=parseInt(e.slice(0,-1),10),t.deriveHardened(r)):(r=parseInt(e,10),t.derive(r))}),this)}sign(t,e){if(!this.privateKey)throw new Error("Missing private key");if(void 0===e&&(e=this.lowR),!1===e)return o.sign(t,this.privateKey);{let e=o.sign(t,this.privateKey);const r=n.alloc(32,0);let i=0;for(;e[0]>127;)i++,r.writeUIntLE(i,0,6),e=o.signWithEntropy(t,this.privateKey,r);return e}}verify(t,e){return o.verify(t,this.publicKey,e)}}function m(t,e,r){return E(t,e,r)}function E(t,e,r,n,i,s){if(u({privateKey:c,chainCode:c},{privateKey:t,chainCode:e}),r=r||h,!o.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return new g(t,void 0,e,r,n,i,s)}function y(t,e,r,n,i,s){if(u({publicKey:u.BufferN(33),chainCode:c},{publicKey:t,chainCode:e}),r=r||h,!o.isPoint(t))throw new TypeError("Point is not on the curve");return new g(void 0,t,e,r,n,i,s)}e.fromBase58=function(t,e){const r=s.decode(t);if(78!==r.length)throw new TypeError("Invalid buffer length");e=e||h;const n=r.readUInt32BE(0);if(n!==e.bip32.private&&n!==e.bip32.public)throw new TypeError("Invalid network version");const i=r[4],o=r.readUInt32BE(5);if(0===i&&0!==o)throw new TypeError("Invalid parent fingerprint");const u=r.readUInt32BE(9);if(0===i&&0!==u)throw new TypeError("Invalid index");const a=r.slice(13,45);let c;if(n===e.bip32.private){if(0!==r.readUInt8(45))throw new TypeError("Invalid private key");c=E(r.slice(46,78),a,e,i,u,o)}else{c=y(r.slice(45,78),a,e,i,u,o)}return c},e.fromPrivateKey=m,e.fromPublicKey=function(t,e,r){return y(t,e,r)},e.fromSeed=function(t,e){if(u(u.Buffer,t),t.length<16)throw new TypeError("Seed should be at least 128 bits");if(t.length>64)throw new TypeError("Seed should be at most 512 bits");e=e||h;const r=i.hmacSHA512(n.from("Bitcoin seed","utf8"),t);return m(r.slice(0,32),r.slice(32),e)}},70460:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(76313),i=r(82526);e.hash160=function(t){const e=n("sha256").update(t).digest();try{return n("rmd160").update(e).digest()}catch(r){return n("ripemd160").update(e).digest()}},e.hmacSHA512=function(t,e){return i("sha512",t).update(e).digest()}},53953:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(98187);e.fromSeed=n.fromSeed,e.fromBase58=n.fromBase58,e.fromPublicKey=n.fromPublicKey,e.fromPrivateKey=n.fromPrivateKey},64835:(t,e,r)=>{var n=r(28119),i={};for(var s in n){i[n[s]]=s}t.exports=i},91710:t=>{"use strict";t.exports=function(t,e,r,n,i,s,o,u){if(!t){var a;if(void 0===e)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,i,s,o,u],p=0;(a=new Error(e.replace(/%s/g,(function(){return c[p++]})))).name="Invariant Violation"}throw a.framesToPop=1,a}}},52241:(t,e,r)=>{var n=r(28119);function i(t){return t<n.OP_PUSHDATA1?1:t<=255?2:t<=65535?3:5}t.exports={encodingLength:i,encode:function(t,e,r){var s=i(e);return 1===s?t.writeUInt8(e,r):2===s?(t.writeUInt8(n.OP_PUSHDATA1,r),t.writeUInt8(e,r+1)):3===s?(t.writeUInt8(n.OP_PUSHDATA2,r),t.writeUInt16LE(e,r+1)):(t.writeUInt8(n.OP_PUSHDATA4,r),t.writeUInt32LE(e,r+1)),s},decode:function(t,e){var r,i,s=t.readUInt8(e);if(s<n.OP_PUSHDATA1)r=s,i=1;else if(s===n.OP_PUSHDATA1){if(e+2>t.length)return null;r=t.readUInt8(e+1),i=2}else if(s===n.OP_PUSHDATA2){if(e+3>t.length)return null;r=t.readUInt16LE(e+1),i=3}else{if(e+5>t.length)return null;if(s!==n.OP_PUSHDATA4)throw new Error("Unexpected opcode");r=t.readUInt32LE(e+1),i=5}return{opcode:s,number:r,size:i}}}},28119:t=>{"use strict";t.exports=JSON.parse('{"OP_FALSE":0,"OP_0":0,"OP_PUSHDATA1":76,"OP_PUSHDATA2":77,"OP_PUSHDATA4":78,"OP_1NEGATE":79,"OP_RESERVED":80,"OP_TRUE":81,"OP_1":81,"OP_2":82,"OP_3":83,"OP_4":84,"OP_5":85,"OP_6":86,"OP_7":87,"OP_8":88,"OP_9":89,"OP_10":90,"OP_11":91,"OP_12":92,"OP_13":93,"OP_14":94,"OP_15":95,"OP_16":96,"OP_NOP":97,"OP_VER":98,"OP_IF":99,"OP_NOTIF":100,"OP_VERIF":101,"OP_VERNOTIF":102,"OP_ELSE":103,"OP_ENDIF":104,"OP_VERIFY":105,"OP_RETURN":106,"OP_TOALTSTACK":107,"OP_FROMALTSTACK":108,"OP_2DROP":109,"OP_2DUP":110,"OP_3DUP":111,"OP_2OVER":112,"OP_2ROT":113,"OP_2SWAP":114,"OP_IFDUP":115,"OP_DEPTH":116,"OP_DROP":117,"OP_DUP":118,"OP_NIP":119,"OP_OVER":120,"OP_PICK":121,"OP_ROLL":122,"OP_ROT":123,"OP_SWAP":124,"OP_TUCK":125,"OP_CAT":126,"OP_SUBSTR":127,"OP_LEFT":128,"OP_RIGHT":129,"OP_SIZE":130,"OP_INVERT":131,"OP_AND":132,"OP_OR":133,"OP_XOR":134,"OP_EQUAL":135,"OP_EQUALVERIFY":136,"OP_RESERVED1":137,"OP_RESERVED2":138,"OP_1ADD":139,"OP_1SUB":140,"OP_2MUL":141,"OP_2DIV":142,"OP_NEGATE":143,"OP_ABS":144,"OP_NOT":145,"OP_0NOTEQUAL":146,"OP_ADD":147,"OP_SUB":148,"OP_MUL":149,"OP_DIV":150,"OP_MOD":151,"OP_LSHIFT":152,"OP_RSHIFT":153,"OP_BOOLAND":154,"OP_BOOLOR":155,"OP_NUMEQUAL":156,"OP_NUMEQUALVERIFY":157,"OP_NUMNOTEQUAL":158,"OP_LESSTHAN":159,"OP_GREATERTHAN":160,"OP_LESSTHANOREQUAL":161,"OP_GREATERTHANOREQUAL":162,"OP_MIN":163,"OP_MAX":164,"OP_WITHIN":165,"OP_RIPEMD160":166,"OP_SHA1":167,"OP_SHA256":168,"OP_HASH160":169,"OP_HASH256":170,"OP_CODESEPARATOR":171,"OP_CHECKSIG":172,"OP_CHECKSIGVERIFY":173,"OP_CHECKMULTISIG":174,"OP_CHECKMULTISIGVERIFY":175,"OP_NOP1":176,"OP_NOP2":177,"OP_CHECKLOCKTIMEVERIFY":177,"OP_NOP3":178,"OP_CHECKSEQUENCEVERIFY":178,"OP_NOP4":179,"OP_NOP5":180,"OP_NOP6":181,"OP_NOP7":182,"OP_NOP8":183,"OP_NOP9":184,"OP_NOP10":185,"OP_PUBKEYHASH":253,"OP_PUBKEY":254,"OP_INVALIDOPCODE":255}')}}]);
//# sourceMappingURL=435.d8699759.chunk.js.map