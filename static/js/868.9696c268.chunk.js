"use strict";(globalThis.webpackChunkwinbit32=globalThis.webpackChunkwinbit32||[]).push([[868],{52868:(e,t,r)=>{r.d(t,{default:()=>np});var n=r(52019),i=r(14806),s=r(24876),o=r(7460),u={},a={},c={},p={};Object.defineProperty(p,"__esModule",{value:!0});const f=i.a0,h=i.a1;p.hash160=function(e){const t=f("sha256").update(e).digest();try{return f("rmd160").update(t).digest()}catch{return f("ripemd160").update(t).digest()}},p.hmacSHA512=function(e,t){return h("sha512",e).update(t).digest()};const l=i.a1,d=i.d.Buffer.alloc(1,1),w=i.d.Buffer.alloc(1,0);var g=function(e,t,r,n,s){let o=i.d.Buffer.alloc(32,0),u=i.d.Buffer.alloc(32,1);o=l("sha256",o).update(u).update(w).update(t).update(e).update(s||"").digest(),u=l("sha256",o).update(u).digest(),o=l("sha256",o).update(u).update(d).update(t).update(e).update(s||"").digest(),u=l("sha256",o).update(u).digest(),u=l("sha256",o).update(u).digest();let a=u;for(;!n(a)||!r(a);)o=l("sha256",o).update(u).update(w).digest(),u=l("sha256",o).update(u).digest(),u=l("sha256",o).update(u).digest(),a=u;return a};const y=i.a3,m=new(0,(0,i.a2)().ec)("secp256k1"),E=g,S=i.d.Buffer.alloc(32,0),_=i.d.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),I=i.d.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),T=m.curve.n,b=T.shrn(1),v=m.curve.g,P="Expected Private",O="Expected Point",k="Expected Tweak",B="Expected Hash",A="Expected Extra Data (32 bytes)";function N(e){return i.d.Buffer.isBuffer(e)&&32===e.length}function x(e){return!!N(e)&&e.compare(_)<0}function U(e){if(!i.d.Buffer.isBuffer(e)||e.length<33)return!1;const t=e[0],r=e.slice(1,33);if(0===r.compare(S)||r.compare(I)>=0)return!1;if((2===t||3===t)&&33===e.length){try{D(e)}catch{return!1}return!0}const n=e.slice(33);return!(0===n.compare(S)||n.compare(I)>=0)&&(4===t&&65===e.length)}function R(e){return 4!==e[0]}function C(e){return!!N(e)&&(e.compare(S)>0&&e.compare(_)<0)}function H(e,t){return void 0===e&&void 0!==t?R(t):void 0===e||e}function M(e){return new y(e)}function K(e){return e.toArrayLike(i.d.Buffer,"be",32)}function D(e){return m.curve.decodePoint(e)}function L(e,t){return i.d.Buffer.from(e._encode(t))}function V(e,t,r){if(!N(e))throw new TypeError(B);if(!C(t))throw new TypeError(P);if(void 0!==r&&!N(r))throw new TypeError(A);const n=M(t),s=M(e);let o,u;E(e,t,(function(e){const t=M(e),r=v.mul(t);return!(r.isInfinity()||(o=r.x.umod(T),0===o.isZero())||(u=t.invm(T).mul(s.add(n.mul(o))).umod(T),0===u.isZero()))}),C,r),u.cmp(b)>0&&(u=T.sub(u));const a=i.d.Buffer.allocUnsafe(64);return K(o).copy(a,0),K(u).copy(a,32),a}var G={isPoint:U,isPointCompressed:function(e){return!!U(e)&&R(e)},isPrivate:C,pointAdd:function(e,t,r){if(!U(e))throw new TypeError(O);if(!U(t))throw new TypeError(O);const n=D(e),i=D(t),s=n.add(i);return s.isInfinity()?null:L(s,H(r,e))},pointAddScalar:function(e,t,r){if(!U(e))throw new TypeError(O);if(!x(t))throw new TypeError(k);const n=H(r,e),i=D(e);if(0===t.compare(S))return L(i,n);const s=M(t),o=v.mul(s),u=i.add(o);return u.isInfinity()?null:L(u,n)},pointCompress:function(e,t){if(!U(e))throw new TypeError(O);const r=D(e);if(r.isInfinity())throw new TypeError(O);return L(r,H(t,e))},pointFromScalar:function(e,t){if(!C(e))throw new TypeError(P);const r=M(e),n=v.mul(r);return n.isInfinity()?null:L(n,H(t))},pointMultiply:function(e,t,r){if(!U(e))throw new TypeError(O);if(!x(t))throw new TypeError(k);const n=H(r,e),i=D(e),s=M(t),o=i.mul(s);return o.isInfinity()?null:L(o,n)},privateAdd:function(e,t){if(!C(e))throw new TypeError(P);if(!x(t))throw new TypeError(k);const r=M(e),n=M(t),i=K(r.add(n).umod(T));return C(i)?i:null},privateSub:function(e,t){if(!C(e))throw new TypeError(P);if(!x(t))throw new TypeError(k);const r=M(e),n=M(t),i=K(r.sub(n).umod(T));return C(i)?i:null},sign:function(e,t){return V(e,t)},signWithEntropy:function(e,t,r){return V(e,t,r)},verify:function(e,t,r,n){if(!N(e))throw new TypeError(B);if(!U(t))throw new TypeError(O);if(!function(e){const t=e.slice(0,32),r=e.slice(32,64);return i.d.Buffer.isBuffer(e)&&64===e.length&&t.compare(_)<0&&r.compare(_)<0}(r))throw new TypeError("Expected Signature");const s=D(t),o=M(r.slice(0,32)),u=M(r.slice(32,64));if(n&&u.cmp(b)>0||o.gtn(0)<=0||u.gtn(0)<=0)return!1;const a=M(e),c=u.invm(T),p=a.mul(c).umod(T),f=o.mul(c).umod(T),h=v.mulAdd(p,s,f);return!h.isInfinity()&&h.x.umod(T).eq(o)}};Object.defineProperty(c,"__esModule",{value:!0});const W=p,F=i.a5,q=G,j=i.a4,X=i.a6,$=j.BufferN(32),Y=j.compile({wif:j.UInt8,bip32:{public:j.UInt32,private:j.UInt32}}),z={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},Q=2147483648,J=Math.pow(2,31)-1;function Z(e){return j.String(e)&&null!==e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}function ee(e){return j.UInt32(e)&&e<=J}class te{constructor(e,t,r,n,i=0,s=0,o=0){this.__D=e,this.__Q=t,this.chainCode=r,this.network=n,this.__DEPTH=i,this.__INDEX=s,this.__PARENT_FINGERPRINT=o,j(Y,n),this.lowR=!1}get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){return void 0===this.__Q&&(this.__Q=q.pointFromScalar(this.__D,!0)),this.__Q}get privateKey(){return this.__D}get identifier(){return W.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}get compressed(){return!0}isNeutered(){return void 0===this.__D}neutered(){return ie(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){const e=this.network,t=this.isNeutered()?e.bip32.public:e.bip32.private,r=i.d.Buffer.allocUnsafe(78);return r.writeUInt32BE(t,0),r.writeUInt8(this.depth,4),r.writeUInt32BE(this.parentFingerprint,5),r.writeUInt32BE(this.index,9),this.chainCode.copy(r,13),this.isNeutered()?this.publicKey.copy(r,45):(r.writeUInt8(0,45),this.privateKey.copy(r,46)),F.encode(r)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return X.encode(this.network.wif,this.privateKey,!0)}derive(e){j(j.UInt32,e);const t=e>=Q,r=i.d.Buffer.allocUnsafe(37);if(t){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");r[0]=0,this.privateKey.copy(r,1),r.writeUInt32BE(e,33)}else this.publicKey.copy(r,0),r.writeUInt32BE(e,33);const n=W.hmacSHA512(this.chainCode,r),s=n.slice(0,32),o=n.slice(32);if(!q.isPrivate(s))return this.derive(e+1);let u;if(this.isNeutered()){const t=q.pointAddScalar(this.publicKey,s,!0);if(null===t)return this.derive(e+1);u=ie(t,o,this.network,this.depth+1,e,this.fingerprint.readUInt32BE(0))}else{const t=q.privateAdd(this.privateKey,s);if(null==t)return this.derive(e+1);u=ne(t,o,this.network,this.depth+1,e,this.fingerprint.readUInt32BE(0))}return u}deriveHardened(e){return j(ee,e),this.derive(e+Q)}derivePath(e){j(Z,e);let t=e.split("/");if("m"===t[0]){if(this.parentFingerprint)throw new TypeError("Expected master, got child");t=t.slice(1)}return t.reduce(((e,t)=>{let r;return"'"===t.slice(-1)?(r=parseInt(t.slice(0,-1),10),e.deriveHardened(r)):(r=parseInt(t,10),e.derive(r))}),this)}sign(e,t){if(!this.privateKey)throw new Error("Missing private key");if(void 0===t&&(t=this.lowR),!1===t)return q.sign(e,this.privateKey);{let t=q.sign(e,this.privateKey);const r=i.d.Buffer.alloc(32,0);let n=0;for(;t[0]>127;)n++,r.writeUIntLE(n,0,6),t=q.signWithEntropy(e,this.privateKey,r);return t}}verify(e,t){return q.verify(e,this.publicKey,t)}}function re(e,t,r){return ne(e,t,r)}function ne(e,t,r,n,i,s){if(j({privateKey:$,chainCode:$},{privateKey:e,chainCode:t}),r=r||z,!q.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return new te(e,void 0,t,r,n,i,s)}function ie(e,t,r,n,i,s){if(j({publicKey:j.BufferN(33),chainCode:$},{publicKey:e,chainCode:t}),r=r||z,!q.isPoint(e))throw new TypeError("Point is not on the curve");return new te(void 0,e,t,r,n,i,s)}c.fromBase58=function(e,t){const r=F.decode(e);if(78!==r.length)throw new TypeError("Invalid buffer length");t=t||z;const n=r.readUInt32BE(0);if(n!==t.bip32.private&&n!==t.bip32.public)throw new TypeError("Invalid network version");const i=r[4],s=r.readUInt32BE(5);if(0===i&&0!==s)throw new TypeError("Invalid parent fingerprint");const o=r.readUInt32BE(9);if(0===i&&0!==o)throw new TypeError("Invalid index");const u=r.slice(13,45);let a;if(n===t.bip32.private){if(0!==r.readUInt8(45))throw new TypeError("Invalid private key");a=ne(r.slice(46,78),u,t,i,o,s)}else{a=ie(r.slice(45,78),u,t,i,o,s)}return a},c.fromPrivateKey=re,c.fromPublicKey=function(e,t,r){return ie(e,t,r)},c.fromSeed=function(e,t){if(j(j.Buffer,e),e.length<16)throw new TypeError("Seed should be at least 128 bits");if(e.length>64)throw new TypeError("Seed should be at most 512 bits");t=t||z;const r=W.hmacSHA512(i.d.Buffer.from("Bitcoin seed","utf8"),e);return re(r.slice(0,32),r.slice(32),t)},Object.defineProperty(a,"__esModule",{value:!0});var se=c;a.fromSeed=se.fromSeed,a.fromBase58=se.fromBase58,a.fromPublicKey=se.fromPublicKey,a.fromPrivateKey=se.fromPrivateKey;var oe={},ue={};Object.defineProperty(ue,"__esModule",{value:!0}),ue.bitcoin={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},ue.regtest={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},ue.testnet={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var ae={},ce={},pe={},fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.decode=function(e,t,r){t=t||4,r=void 0===r||r;const n=e.length;if(0===n)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&!(127&e[n-1])&&(n<=1||!(128&e[n-2])))throw new Error("Non-minimally encoded script number");if(5===n){const t=e.readUInt32LE(0),r=e.readUInt8(4);return 128&r?-(4294967296*(-129&r)+t):4294967296*r+t}let i=0;for(let s=0;s<n;++s)i|=e[s]<<8*s;return 128&e[n-1]?-(i&~(128<<8*(n-1))):i},fe.encode=function(e){let t=Math.abs(e);const r=function(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}(t),n=i.d.Buffer.allocUnsafe(r),s=e<0;for(let i=0;i<r;++i)n.writeUInt8(255&t,i),t>>=8;return 128&n[r-1]?n.writeUInt8(s?128:0,r-1):s&&(n[r-1]|=128),n};var he={},le={};Object.defineProperty(le,"__esModule",{value:!0});const de=i.a4,we=Math.pow(2,31)-1;function ge(e){return de.String(e)&&!!e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}le.UInt31=function(e){return de.UInt32(e)&&e<=we},le.BIP32Path=ge,ge.toJSON=()=>"BIP32 derivation path",le.Signer=function(e){return(de.Buffer(e.publicKey)||"function"==typeof e.getPublicKey)&&"function"==typeof e.sign};le.Satoshi=function(e){return de.UInt53(e)&&e<=21e14},le.ECPoint=de.quacksLike("Point"),le.Network=de.compile({messagePrefix:de.oneOf(de.Buffer,de.String),bip32:{public:de.UInt32,private:de.UInt32},pubKeyHash:de.UInt8,scriptHash:de.UInt8,wif:de.UInt8}),le.Buffer256bit=de.BufferN(32),le.Hash160bit=de.BufferN(20),le.Hash256bit=de.BufferN(32),le.Number=de.Number,le.Array=de.Array,le.Boolean=de.Boolean,le.String=de.String,le.Buffer=de.Buffer,le.Hex=de.Hex,le.maybe=de.maybe,le.tuple=de.tuple,le.UInt8=de.UInt8,le.UInt32=de.UInt32,le.Function=de.Function,le.BufferN=de.BufferN,le.Null=de.Null,le.oneOf=de.oneOf,Object.defineProperty(he,"__esModule",{value:!0});const ye=le,me=i.a7,Ee=i.a4,Se=i.d.Buffer.alloc(1,0);function _e(e){let t=0;for(;0===e[t];)++t;return t===e.length?Se:128&(e=e.slice(t))[0]?i.d.Buffer.concat([Se,e],1+e.length):e}function Ie(e){0===e[0]&&(e=e.slice(1));const t=i.d.Buffer.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}he.decode=function(e){const t=e.readUInt8(e.length-1),r=-129&t;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=me.decode(e.slice(0,-1)),s=Ie(n.r),o=Ie(n.s);return{signature:i.d.Buffer.concat([s,o],64),hashType:t}},he.encode=function(e,t){Ee({signature:ye.BufferN(64),hashType:ye.UInt8},{signature:e,hashType:t});const r=-129&t;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=i.d.Buffer.allocUnsafe(1);n.writeUInt8(t,0);const s=_e(e.slice(0,32)),o=_e(e.slice(32,64));return i.d.Buffer.concat([me.encode(s,o),n])};const Te={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};var be=Te;function ve(e){return e<be.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}var Pe={encodingLength:ve,encode:function(e,t,r){var n=ve(t);return 1===n?e.writeUInt8(t,r):2===n?(e.writeUInt8(be.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):3===n?(e.writeUInt8(be.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(be.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n},decode:function(e,t){var r,n,i=e.readUInt8(t);if(i<be.OP_PUSHDATA1)r=i,n=1;else if(i===be.OP_PUSHDATA1){if(t+2>e.length)return null;r=e.readUInt8(t+1),n=2}else if(i===be.OP_PUSHDATA2){if(t+3>e.length)return null;r=e.readUInt16LE(t+1),n=3}else{if(t+5>e.length)return null;if(i!==be.OP_PUSHDATA4)throw new Error("Unexpected opcode");r=e.readUInt32LE(t+1),n=5}return{opcode:i,number:r,size:n}}},Oe=Te,ke={};for(var Be in Oe){ke[Oe[Be]]=Be}var Ae=ke;!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=fe,r=he,n=le,s=i.a7,o=G,u=Pe,a=i.a4;e.OPS=Te;const c=Ae,p=e.OPS.OP_RESERVED;function f(t){return n.Buffer(t)||function(t){return n.Number(t)&&(t===e.OPS.OP_0||t>=e.OPS.OP_1&&t<=e.OPS.OP_16||t===e.OPS.OP_1NEGATE)}(t)}function h(e){return n.Array(e)&&e.every(f)}function l(t){if(0===t.length)return e.OPS.OP_0;if(1===t.length){if(t[0]>=1&&t[0]<=16)return p+t[0];if(129===t[0])return e.OPS.OP_1NEGATE}}function d(e){return i.d.Buffer.isBuffer(e)}function w(e){return i.d.Buffer.isBuffer(e)}function g(e){if(d(e))return e;a(n.Array,e);const t=e.reduce(((e,t)=>w(t)?1===t.length&&void 0!==l(t)?e+1:e+u.encodingLength(t.length)+t.length:e+1),0),r=i.d.Buffer.allocUnsafe(t);let s=0;if(e.forEach((e=>{if(w(e)){const t=l(e);if(void 0!==t)return r.writeUInt8(t,s),void(s+=1);s+=u.encode(r,e.length,s),e.copy(r,s),s+=e.length}else r.writeUInt8(e,s),s+=1})),s!==r.length)throw new Error("Could not decode chunks");return r}function y(t){if(function(e){return n.Array(e)}(t))return t;a(n.Buffer,t);const r=[];let i=0;for(;i<t.length;){const n=t[i];if(n>e.OPS.OP_0&&n<=e.OPS.OP_PUSHDATA4){const e=u.decode(t,i);if(null===e||(i+=e.size,i+e.number>t.length))return null;const n=t.slice(i,i+e.number);i+=e.number;const s=l(n);void 0!==s?r.push(s):r.push(n)}else r.push(n),i+=1}return r}function m(e){const t=-129&e;return t>0&&t<4}e.isPushOnly=h,e.compile=g,e.decompile=y,e.toASM=function(e){return d(e)&&(e=y(e)),e.map((e=>{if(w(e)){const t=l(e);if(void 0===t)return e.toString("hex");e=t}return c[e]})).join(" ")},e.fromASM=function(t){return a(n.String,t),g(t.split(" ").map((t=>void 0!==e.OPS[t]?e.OPS[t]:(a(n.Hex,t),i.d.Buffer.from(t,"hex")))))},e.toStack=function(r){return r=y(r),a(h,r),r.map((r=>w(r)?r:r===e.OPS.OP_0?i.d.Buffer.allocUnsafe(0):t.encode(r-p)))},e.isCanonicalPubKey=function(e){return o.isPoint(e)},e.isDefinedHashType=m,e.isCanonicalScriptSignature=function(e){return!(!i.d.Buffer.isBuffer(e)||!m(e[e.length-1]))&&s.check(e.slice(0,-1))},e.number=t,e.signature=r}(pe);var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.prop=function(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const e=r.call(this);return this[t]=e,e},set(e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})}})},Ne.value=function(e){let t;return()=>(void 0!==t||(t=e()),t)},Object.defineProperty(ce,"__esModule",{value:!0});const xe=ue,Ue=pe,Re=Ne,Ce=i.a4,He=Ue.OPS;ce.p2data=function(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),Ce({network:Ce.maybe(Ce.Object),output:Ce.maybe(Ce.Buffer),data:Ce.maybe(Ce.arrayOf(Ce.Buffer))},e);const r={name:"embed",network:e.network||xe.bitcoin};if(Re.prop(r,"output",(()=>{if(e.data)return Ue.compile([He.OP_RETURN].concat(e.data))})),Re.prop(r,"data",(()=>{if(e.output)return Ue.decompile(e.output).slice(1)})),t.validate&&e.output){const t=Ue.decompile(e.output);if(t[0]!==He.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(Ce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,e)};var Me={};Object.defineProperty(Me,"__esModule",{value:!0});const Ke=ue,De=pe,Le=Ne,Ve=De.OPS,Ge=i.a4,We=G,Fe=Ve.OP_RESERVED;function qe(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}Me.p2ms=function(e,t){if(!e.input&&!e.output&&(!e.pubkeys||void 0===e.m)&&!e.signatures)throw new TypeError("Not enough data");function r(e){return De.isCanonicalScriptSignature(e)||void 0!==(t.allowIncomplete&&e===Ve.OP_0)}t=Object.assign({validate:!0},t||{}),Ge({network:Ge.maybe(Ge.Object),m:Ge.maybe(Ge.Number),n:Ge.maybe(Ge.Number),output:Ge.maybe(Ge.Buffer),pubkeys:Ge.maybe(Ge.arrayOf(We.isPoint)),signatures:Ge.maybe(Ge.arrayOf(r)),input:Ge.maybe(Ge.Buffer)},e);const n={network:e.network||Ke.bitcoin};let i=[],s=!1;function o(e){s||(s=!0,i=De.decompile(e),n.m=i[0]-Fe,n.n=i[i.length-2]-Fe,n.pubkeys=i.slice(1,-2))}if(Le.prop(n,"output",(()=>{if(e.m&&n.n&&e.pubkeys)return De.compile([].concat(Fe+e.m,e.pubkeys,Fe+n.n,Ve.OP_CHECKMULTISIG))})),Le.prop(n,"m",(()=>{if(n.output)return o(n.output),n.m})),Le.prop(n,"n",(()=>{if(n.pubkeys)return n.pubkeys.length})),Le.prop(n,"pubkeys",(()=>{if(e.output)return o(e.output),n.pubkeys})),Le.prop(n,"signatures",(()=>{if(e.input)return De.decompile(e.input).slice(1)})),Le.prop(n,"input",(()=>{if(e.signatures)return De.compile([Ve.OP_0].concat(e.signatures))})),Le.prop(n,"witness",(()=>{if(n.input)return[]})),Le.prop(n,"name",(()=>{if(n.m&&n.n)return`p2ms(${n.m} of ${n.n})`})),t.validate){if(e.output){if(o(e.output),!Ge.Number(i[0]))throw new TypeError("Output is invalid");if(!Ge.Number(i[i.length-2]))throw new TypeError("Output is invalid");if(i[i.length-1]!==Ve.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==i.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every((e=>We.isPoint(e))))throw new TypeError("Output is invalid");if(void 0!==e.m&&e.m!==n.m)throw new TypeError("m mismatch");if(void 0!==e.n&&e.n!==n.n)throw new TypeError("n mismatch");if(e.pubkeys&&!qe(e.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(void 0!==e.n&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=e.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==Ve.OP_0)throw new TypeError("Input is invalid");if(0===n.signatures.length||!n.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!qe(e.signatures,n.signatures))throw new TypeError("Signature mismatch");if(void 0!==e.m&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,e)};var je={};Object.defineProperty(je,"__esModule",{value:!0});const Xe=ue,$e=pe,Ye=Ne,ze=i.a4,Qe=$e.OPS,Je=G;je.p2pk=function(e,t){if(!e.input&&!e.output&&!e.pubkey&&!e.input&&!e.signature)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),ze({network:ze.maybe(ze.Object),output:ze.maybe(ze.Buffer),pubkey:ze.maybe(Je.isPoint),signature:ze.maybe($e.isCanonicalScriptSignature),input:ze.maybe(ze.Buffer)},e);const r=Ye.value((()=>$e.decompile(e.input))),n={name:"p2pk",network:e.network||Xe.bitcoin};if(Ye.prop(n,"output",(()=>{if(e.pubkey)return $e.compile([e.pubkey,Qe.OP_CHECKSIG])})),Ye.prop(n,"pubkey",(()=>{if(e.output)return e.output.slice(1,-1)})),Ye.prop(n,"signature",(()=>{if(e.input)return r()[0]})),Ye.prop(n,"input",(()=>{if(e.signature)return $e.compile([e.signature])})),Ye.prop(n,"witness",(()=>{if(n.input)return[]})),t.validate){if(e.output){if(e.output[e.output.length-1]!==Qe.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!Je.isPoint(n.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(n.input))throw new TypeError("Signature mismatch");if(e.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!$e.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,e)};var Ze={},et={};Object.defineProperty(et,"__esModule",{value:!0});const tt=i.a0;function rt(e){try{return tt("rmd160").update(e).digest()}catch{return tt("ripemd160").update(e).digest()}}function nt(e){return tt("sha256").update(e).digest()}et.ripemd160=rt,et.sha1=function(e){return tt("sha1").update(e).digest()},et.sha256=nt,et.hash160=function(e){return rt(nt(e))},et.hash256=function(e){return nt(nt(e))},Object.defineProperty(Ze,"__esModule",{value:!0});const it=et,st=ue,ot=pe,ut=Ne,at=i.a4,ct=ot.OPS,pt=G,ft=i.a5;Ze.p2pkh=function(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),at({network:at.maybe(at.Object),address:at.maybe(at.String),hash:at.maybe(at.BufferN(20)),output:at.maybe(at.BufferN(25)),pubkey:at.maybe(pt.isPoint),signature:at.maybe(ot.isCanonicalScriptSignature),input:at.maybe(at.Buffer)},e);const r=ut.value((()=>{const t=ft.decode(e.address);return{version:t.readUInt8(0),hash:t.slice(1)}})),n=ut.value((()=>ot.decompile(e.input))),s=e.network||st.bitcoin,o={name:"p2pkh",network:s};if(ut.prop(o,"address",(()=>{if(!o.hash)return;const e=i.d.Buffer.allocUnsafe(21);return e.writeUInt8(s.pubKeyHash,0),o.hash.copy(e,1),ft.encode(e)})),ut.prop(o,"hash",(()=>e.output?e.output.slice(3,23):e.address?r().hash:e.pubkey||o.pubkey?it.hash160(e.pubkey||o.pubkey):void 0)),ut.prop(o,"output",(()=>{if(o.hash)return ot.compile([ct.OP_DUP,ct.OP_HASH160,o.hash,ct.OP_EQUALVERIFY,ct.OP_CHECKSIG])})),ut.prop(o,"pubkey",(()=>{if(e.input)return n()[1]})),ut.prop(o,"signature",(()=>{if(e.input)return n()[0]})),ut.prop(o,"input",(()=>{if(e.pubkey&&e.signature)return ot.compile([e.signature,e.pubkey])})),ut.prop(o,"witness",(()=>{if(o.input)return[]})),t.validate){let t=i.d.Buffer.from([]);if(e.address){if(r().version!==s.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");t=r().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(25!==e.output.length||e.output[0]!==ct.OP_DUP||e.output[1]!==ct.OP_HASH160||20!==e.output[2]||e.output[23]!==ct.OP_EQUALVERIFY||e.output[24]!==ct.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=e.output.slice(3,23);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.pubkey){const r=it.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.input){const r=n();if(2!==r.length)throw new TypeError("Input is invalid");if(!ot.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!pt.isPoint(r[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const i=it.hash160(r[1]);if(t.length>0&&!t.equals(i))throw new TypeError("Hash mismatch")}}return Object.assign(o,e)};var ht={};Object.defineProperty(ht,"__esModule",{value:!0});const lt=et,dt=ue,wt=pe,gt=Ne,yt=i.a4,mt=wt.OPS,Et=i.a5;ht.p2sh=function(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),yt({network:yt.maybe(yt.Object),address:yt.maybe(yt.String),hash:yt.maybe(yt.BufferN(20)),output:yt.maybe(yt.BufferN(23)),redeem:yt.maybe({network:yt.maybe(yt.Object),output:yt.maybe(yt.Buffer),input:yt.maybe(yt.Buffer),witness:yt.maybe(yt.arrayOf(yt.Buffer))}),input:yt.maybe(yt.Buffer),witness:yt.maybe(yt.arrayOf(yt.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||dt.bitcoin);const n={network:r},s=gt.value((()=>{const t=Et.decode(e.address);return{version:t.readUInt8(0),hash:t.slice(1)}})),o=gt.value((()=>wt.decompile(e.input))),u=gt.value((()=>{const t=o();return{network:r,output:t[t.length-1],input:wt.compile(t.slice(0,-1)),witness:e.witness||[]}}));if(gt.prop(n,"address",(()=>{if(!n.hash)return;const e=i.d.Buffer.allocUnsafe(21);return e.writeUInt8(n.network.scriptHash,0),n.hash.copy(e,1),Et.encode(e)})),gt.prop(n,"hash",(()=>e.output?e.output.slice(2,22):e.address?s().hash:n.redeem&&n.redeem.output?lt.hash160(n.redeem.output):void 0)),gt.prop(n,"output",(()=>{if(n.hash)return wt.compile([mt.OP_HASH160,n.hash,mt.OP_EQUAL])})),gt.prop(n,"redeem",(()=>{if(e.input)return u()})),gt.prop(n,"input",(()=>{if(e.redeem&&e.redeem.input&&e.redeem.output)return wt.compile([].concat(wt.decompile(e.redeem.input),e.redeem.output))})),gt.prop(n,"witness",(()=>n.redeem&&n.redeem.witness?n.redeem.witness:n.input?[]:void 0)),gt.prop(n,"name",(()=>{const e=["p2sh"];return void 0!==n.redeem&&e.push(n.redeem.name),e.join("-")})),t.validate){let t=i.d.Buffer.from([]);if(e.address){if(s().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==s().hash.length)throw new TypeError("Invalid address");t=s().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(23!==e.output.length||e.output[0]!==mt.OP_HASH160||20!==e.output[1]||e.output[22]!==mt.OP_EQUAL)throw new TypeError("Output is invalid");const r=e.output.slice(2,22);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}const n=e=>{if(e.output){const r=wt.decompile(e.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");const n=lt.hash160(e.output);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.input){const t=e.input.length>0,r=e.witness&&e.witness.length>0;if(!t&&!r)throw new TypeError("Empty input");if(t&&r)throw new TypeError("Input and witness provided");if(t){const t=wt.decompile(e.input);if(!wt.isPushOnly(t))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const e=o();if(!e||e.length<1)throw new TypeError("Input too short");if(!i.d.Buffer.isBuffer(u().output))throw new TypeError("Input is invalid");n(u())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){const t=u();if(e.redeem.output&&!e.redeem.output.equals(t.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(t.input))throw new TypeError("Redeem.input mismatch")}n(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)};var St={};Object.defineProperty(St,"__esModule",{value:!0});const _t=et,It=ue,Tt=pe,bt=Ne,vt=i.a4,Pt=Tt.OPS,Ot=G,kt=i.a8,Bt=i.d.Buffer.alloc(0);St.p2wpkh=function(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),vt({address:vt.maybe(vt.String),hash:vt.maybe(vt.BufferN(20)),input:vt.maybe(vt.BufferN(0)),network:vt.maybe(vt.Object),output:vt.maybe(vt.BufferN(22)),pubkey:vt.maybe(Ot.isPoint),signature:vt.maybe(Tt.isCanonicalScriptSignature),witness:vt.maybe(vt.arrayOf(vt.Buffer))},e);const r=bt.value((()=>{const t=kt.decode(e.address),r=t.words.shift(),n=kt.fromWords(t.words);return{version:r,prefix:t.prefix,data:i.d.Buffer.from(n)}})),n=e.network||It.bitcoin,s={name:"p2wpkh",network:n};if(bt.prop(s,"address",(()=>{if(!s.hash)return;const e=kt.toWords(s.hash);return e.unshift(0),kt.encode(n.bech32,e)})),bt.prop(s,"hash",(()=>e.output?e.output.slice(2,22):e.address?r().data:e.pubkey||s.pubkey?_t.hash160(e.pubkey||s.pubkey):void 0)),bt.prop(s,"output",(()=>{if(s.hash)return Tt.compile([Pt.OP_0,s.hash])})),bt.prop(s,"pubkey",(()=>e.pubkey?e.pubkey:e.witness?e.witness[1]:void 0)),bt.prop(s,"signature",(()=>{if(e.witness)return e.witness[0]})),bt.prop(s,"input",(()=>{if(s.witness)return Bt})),bt.prop(s,"witness",(()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]})),t.validate){let t=i.d.Buffer.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(22!==e.output.length||e.output[0]!==Pt.OP_0||20!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");t=e.output.slice(2)}if(e.pubkey){const r=_t.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");if(t=r,!Ot.isPoint(e.pubkey)||33!==e.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(2!==e.witness.length)throw new TypeError("Witness is invalid");if(!Tt.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!Ot.isPoint(e.witness[1])||33!==e.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const r=_t.hash160(e.witness[1]);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(s,e)};var At={};Object.defineProperty(At,"__esModule",{value:!0});const Nt=et,xt=ue,Ut=pe,Rt=Ne,Ct=i.a4,Ht=Ut.OPS,Mt=G,Kt=i.a8,Dt=i.d.Buffer.alloc(0);function Lt(e){return!(!i.d.Buffer.isBuffer(e)||65!==e.length||4!==e[0]||!Mt.isPoint(e))}At.p2wsh=function(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),Ct({network:Ct.maybe(Ct.Object),address:Ct.maybe(Ct.String),hash:Ct.maybe(Ct.BufferN(32)),output:Ct.maybe(Ct.BufferN(34)),redeem:Ct.maybe({input:Ct.maybe(Ct.Buffer),network:Ct.maybe(Ct.Object),output:Ct.maybe(Ct.Buffer),witness:Ct.maybe(Ct.arrayOf(Ct.Buffer))}),input:Ct.maybe(Ct.BufferN(0)),witness:Ct.maybe(Ct.arrayOf(Ct.Buffer))},e);const r=Rt.value((()=>{const t=Kt.decode(e.address),r=t.words.shift(),n=Kt.fromWords(t.words);return{version:r,prefix:t.prefix,data:i.d.Buffer.from(n)}})),n=Rt.value((()=>Ut.decompile(e.redeem.input)));let s=e.network;s||(s=e.redeem&&e.redeem.network||xt.bitcoin);const o={network:s};if(Rt.prop(o,"address",(()=>{if(!o.hash)return;const e=Kt.toWords(o.hash);return e.unshift(0),Kt.encode(s.bech32,e)})),Rt.prop(o,"hash",(()=>e.output?e.output.slice(2):e.address?r().data:o.redeem&&o.redeem.output?Nt.sha256(o.redeem.output):void 0)),Rt.prop(o,"output",(()=>{if(o.hash)return Ut.compile([Ht.OP_0,o.hash])})),Rt.prop(o,"redeem",(()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:Dt,witness:e.witness.slice(0,-1)}})),Rt.prop(o,"input",(()=>{if(o.witness)return Dt})),Rt.prop(o,"witness",(()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const t=Ut.toStack(n());return o.redeem=Object.assign({witness:t},e.redeem),o.redeem.input=Dt,[].concat(t,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)})),Rt.prop(o,"name",(()=>{const e=["p2wsh"];return void 0!==o.redeem&&e.push(o.redeem.name),e.join("-")})),t.validate){let t=i.d.Buffer.from([]);if(e.address){if(r().prefix!==s.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(34!==e.output.length||e.output[0]!==Ht.OP_0||32!==e.output[1])throw new TypeError("Output is invalid");const r=e.output.slice(2);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.redeem){if(e.redeem.network&&e.redeem.network!==s)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){if(0===Ut.decompile(e.redeem.output).length)throw new TypeError("Redeem.output is invalid");const r=Nt.sha256(e.redeem.output);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.redeem.input&&!Ut.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some(Lt)||e.redeem.output&&(Ut.decompile(e.redeem.output)||[]).some(Lt))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){const t=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(t))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(Lt)||(Ut.decompile(t)||[]).some(Lt))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(o,e)},Object.defineProperty(ae,"__esModule",{value:!0});const Vt=ce;ae.embed=Vt.p2data;const Gt=Me;ae.p2ms=Gt.p2ms;const Wt=je;ae.p2pk=Wt.p2pk;const Ft=Ze;ae.p2pkh=Ft.p2pkh;const qt=ht;ae.p2sh=qt.p2sh;const jt=St;ae.p2wpkh=jt.p2wpkh;const Xt=At;ae.p2wsh=Xt.p2wsh,Object.defineProperty(oe,"__esModule",{value:!0});const $t=ue,Yt=ae,zt=pe,Qt=le,Jt=i.a8,Zt=i.a5,er=i.a4;function tr(e){const t=Zt.decode(e);if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");return{version:t.readUInt8(0),hash:t.slice(1)}}function rr(e){const t=Jt.decode(e),r=Jt.fromWords(t.words.slice(1));return{version:t.words[0],prefix:t.prefix,data:i.d.Buffer.from(r)}}oe.fromBase58Check=tr,oe.fromBech32=rr,oe.toBase58Check=function(e,t){er(Qt.tuple(Qt.Hash160bit,Qt.UInt8),arguments);const r=i.d.Buffer.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),Zt.encode(r)},oe.toBech32=function(e,t,r){const n=Jt.toWords(e);return n.unshift(t),Jt.encode(r,n)},oe.fromOutputScript=function(e,t){t=t||$t.bitcoin;try{return Yt.p2pkh({output:e,network:t}).address}catch{}try{return Yt.p2sh({output:e,network:t}).address}catch{}try{return Yt.p2wpkh({output:e,network:t}).address}catch{}try{return Yt.p2wsh({output:e,network:t}).address}catch{}throw new Error(zt.toASM(e)+" has no matching Address")},oe.toOutputScript=function(e,t){let r,n;t=t||$t.bitcoin;try{r=tr(e)}catch{}if(r){if(r.version===t.pubKeyHash)return Yt.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return Yt.p2sh({hash:r.hash}).output}else{try{n=rr(e)}catch{}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(0===n.version){if(20===n.data.length)return Yt.p2wpkh({hash:n.data}).output;if(32===n.data.length)return Yt.p2wsh({hash:n.data}).output}}}throw new Error(e+" has no matching Script")};var nr={};Object.defineProperty(nr,"__esModule",{value:!0});const ir=ue,sr=le,or=G,ur=i.a9,ar=i.a4,cr=i.a6,pr=ar.maybe(ar.compile({compressed:sr.maybe(sr.Boolean),network:sr.maybe(sr.Network)}));let fr=class{constructor(e,t,r){this.__D=e,this.__Q=t,this.lowR=!1,void 0===r&&(r={}),this.compressed=void 0===r.compressed||r.compressed,this.network=r.network||ir.bitcoin,void 0!==t&&(this.__Q=or.pointCompress(t,this.compressed))}get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=or.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return cr.encode(this.network.wif,this.__D,this.compressed)}sign(e,t){if(!this.__D)throw new Error("Missing private key");if(void 0===t&&(t=this.lowR),!1===t)return or.sign(e,this.__D);{let t=or.sign(e,this.__D);const r=i.d.Buffer.alloc(32,0);let n=0;for(;t[0]>127;)n++,r.writeUIntLE(n,0,6),t=or.signWithEntropy(e,this.__D,r);return t}}verify(e,t){return or.verify(e,this.publicKey,t)}};function hr(e,t){if(ar(sr.Buffer256bit,e),!or.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return ar(pr,t),new fr(e,void 0,t)}nr.fromPrivateKey=hr,nr.fromPublicKey=function(e,t){return ar(or.isPoint,e),ar(pr,t),new fr(void 0,e,t)},nr.fromWIF=function(e,t){const r=cr.decode(e),n=r.version;if(sr.Array(t)){if(!(t=t.filter((e=>n===e.wif)).pop()))throw new Error("Unknown network version")}else if(t=t||ir.bitcoin,n!==t.wif)throw new Error("Invalid network version");return hr(r.privateKey,{compressed:r.compressed,network:t})},nr.makeRandom=function(e){ar(pr,e),void 0===e&&(e={});const t=e.rng||ur;let r;do{r=t(32),ar(sr.Buffer256bit,r)}while(!or.isPrivate(r));return hr(r,e)};var lr={},dr={};Object.defineProperty(dr,"__esModule",{value:!0});const wr=le,gr=i.a4,yr=i.aa;function mr(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function Er(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,mr(n+r,9007199254740991),n+r}function Sr(e,t,r){return mr(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}dr.readUInt64LE=Er,dr.writeUInt64LE=Sr,dr.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},dr.cloneBuffer=function(e){const t=i.d.Buffer.allocUnsafe(e.length);return e.copy(t),t};dr.BufferWriter=class{constructor(e,t=0){this.buffer=e,this.offset=t,gr(wr.tuple(wr.Buffer,wr.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=Sr(this.buffer,e,this.offset)}writeVarInt(e){yr.encode(e,this.buffer,this.offset),this.offset+=yr.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach((e=>this.writeVarSlice(e)))}};dr.BufferReader=class{constructor(e,t=0){this.buffer=e,this.offset=t,gr(wr.tuple(wr.Buffer,wr.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=Er(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=yr.decode(this.buffer,this.offset);return this.offset+=yr.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}};var _r={};Object.defineProperty(_r,"__esModule",{value:!0});const Ir=dr,Tr=et,br=pe,vr=pe,Pr=le,Or=i.a4,kr=i.aa;function Br(e){const t=e.length;return kr.encodingLength(t)+t}const Ar=i.d.Buffer.allocUnsafe(0),Nr=[],xr=i.d.Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),Ur=i.d.Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),Rr=i.d.Buffer.from("ffffffffffffffff","hex"),Cr={script:Ar,valueBuffer:Rr};class Hr{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(e,t){const r=new Ir.BufferReader(e),n=new Hr;n.version=r.readInt32();const i=r.readUInt8(),s=r.readUInt8();let o=!1;i===Hr.ADVANCED_TRANSACTION_MARKER&&s===Hr.ADVANCED_TRANSACTION_FLAG?o=!0:r.offset-=2;const u=r.readVarInt();for(let c=0;c<u;++c)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:Nr});const a=r.readVarInt();for(let c=0;c<a;++c)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(o){for(let e=0;e<u;++e)n.ins[e].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),t)return n;if(r.offset!==e.length)throw new Error("Transaction has unexpected data");return n}static fromHex(e){return Hr.fromBuffer(i.d.Buffer.from(e,"hex"),!1)}static isCoinbaseHash(e){Or(Pr.Hash256bit,e);for(let t=0;t<32;++t)if(0!==e[t])return!1;return!0}isCoinbase(){return 1===this.ins.length&&Hr.isCoinbaseHash(this.ins[0].hash)}addInput(e,t,r,n){return Or(Pr.tuple(Pr.Hash256bit,Pr.UInt32,Pr.maybe(Pr.UInt32),Pr.maybe(Pr.Buffer)),arguments),Pr.Null(r)&&(r=Hr.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:t,script:n||Ar,sequence:r,witness:Nr})-1}addOutput(e,t){return Or(Pr.tuple(Pr.Buffer,Pr.Satoshi),arguments),this.outs.push({script:e,value:t})-1}hasWitnesses(){return this.ins.some((e=>0!==e.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const t=e&&this.hasWitnesses();return(t?10:8)+kr.encodingLength(this.ins.length)+kr.encodingLength(this.outs.length)+this.ins.reduce(((e,t)=>e+40+Br(t.script)),0)+this.outs.reduce(((e,t)=>e+8+Br(t.script)),0)+(t?this.ins.reduce(((e,t)=>e+function(e){const t=e.length;return kr.encodingLength(t)+e.reduce(((e,t)=>e+Br(t)),0)}(t.witness)),0):0)}clone(){const e=new Hr;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map((e=>({hash:e.hash,index:e.index,script:e.script,sequence:e.sequence,witness:e.witness}))),e.outs=this.outs.map((e=>({script:e.script,value:e.value}))),e}hashForSignature(e,t,r){if(Or(Pr.tuple(Pr.UInt32,Pr.Buffer,Pr.Number),arguments),e>=this.ins.length)return Ur;const n=br.compile(br.decompile(t).filter((e=>e!==vr.OPS.OP_CODESEPARATOR))),s=this.clone();if((31&r)===Hr.SIGHASH_NONE)s.outs=[],s.ins.forEach(((t,r)=>{r!==e&&(t.sequence=0)}));else if((31&r)===Hr.SIGHASH_SINGLE){if(e>=this.outs.length)return Ur;s.outs.length=e+1;for(let t=0;t<e;t++)s.outs[t]=Cr;s.ins.forEach(((t,r)=>{r!==e&&(t.sequence=0)}))}r&Hr.SIGHASH_ANYONECANPAY?(s.ins=[s.ins[e]],s.ins[0].script=n):(s.ins.forEach((e=>{e.script=Ar})),s.ins[e].script=n);const o=i.d.Buffer.allocUnsafe(s.byteLength(!1)+4);return o.writeInt32LE(r,o.length-4),s.__toBuffer(o,0,!1),Tr.hash256(o)}hashForWitnessV0(e,t,r,n){Or(Pr.tuple(Pr.UInt32,Pr.Buffer,Pr.Satoshi,Pr.UInt32),arguments);let s,o=i.d.Buffer.from([]),u=xr,a=xr,c=xr;if(n&Hr.SIGHASH_ANYONECANPAY||(o=i.d.Buffer.allocUnsafe(36*this.ins.length),s=new Ir.BufferWriter(o,0),this.ins.forEach((e=>{s.writeSlice(e.hash),s.writeUInt32(e.index)})),a=Tr.hash256(o)),!(n&Hr.SIGHASH_ANYONECANPAY)&&(31&n)!==Hr.SIGHASH_SINGLE&&(31&n)!==Hr.SIGHASH_NONE&&(o=i.d.Buffer.allocUnsafe(4*this.ins.length),s=new Ir.BufferWriter(o,0),this.ins.forEach((e=>{s.writeUInt32(e.sequence)})),c=Tr.hash256(o)),(31&n)!==Hr.SIGHASH_SINGLE&&(31&n)!==Hr.SIGHASH_NONE){const e=this.outs.reduce(((e,t)=>e+8+Br(t.script)),0);o=i.d.Buffer.allocUnsafe(e),s=new Ir.BufferWriter(o,0),this.outs.forEach((e=>{s.writeUInt64(e.value),s.writeVarSlice(e.script)})),u=Tr.hash256(o)}else if((31&n)===Hr.SIGHASH_SINGLE&&e<this.outs.length){const t=this.outs[e];o=i.d.Buffer.allocUnsafe(8+Br(t.script)),s=new Ir.BufferWriter(o,0),s.writeUInt64(t.value),s.writeVarSlice(t.script),u=Tr.hash256(o)}o=i.d.Buffer.allocUnsafe(156+Br(t)),s=new Ir.BufferWriter(o,0);const p=this.ins[e];return s.writeUInt32(this.version),s.writeSlice(a),s.writeSlice(c),s.writeSlice(p.hash),s.writeUInt32(p.index),s.writeVarSlice(t),s.writeUInt64(r),s.writeUInt32(p.sequence),s.writeSlice(u),s.writeUInt32(this.locktime),s.writeUInt32(n),Tr.hash256(o)}getHash(e){return e&&this.isCoinbase()?i.d.Buffer.alloc(32,0):Tr.hash256(this.__toBuffer(void 0,void 0,e))}getId(){return Ir.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(e,t){return this.__toBuffer(e,t,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(e,t){Or(Pr.tuple(Pr.Number,Pr.Buffer),arguments),this.ins[e].script=t}setWitness(e,t){Or(Pr.tuple(Pr.Number,[Pr.Buffer]),arguments),this.ins[e].witness=t}__toBuffer(e,t,r=!1){e||(e=i.d.Buffer.allocUnsafe(this.byteLength(r)));const n=new Ir.BufferWriter(e,t||0);n.writeInt32(this.version);const s=r&&this.hasWitnesses();return s&&(n.writeUInt8(Hr.ADVANCED_TRANSACTION_MARKER),n.writeUInt8(Hr.ADVANCED_TRANSACTION_FLAG)),n.writeVarInt(this.ins.length),this.ins.forEach((e=>{n.writeSlice(e.hash),n.writeUInt32(e.index),n.writeVarSlice(e.script),n.writeUInt32(e.sequence)})),n.writeVarInt(this.outs.length),this.outs.forEach((e=>{void 0!==e.value?n.writeUInt64(e.value):n.writeSlice(e.valueBuffer),n.writeVarSlice(e.script)})),s&&this.ins.forEach((e=>{n.writeVector(e.witness)})),n.writeUInt32(this.locktime),void 0!==t?e.slice(t,n.offset):e}}Hr.DEFAULT_SEQUENCE=4294967295,Hr.SIGHASH_ALL=1,Hr.SIGHASH_NONE=2,Hr.SIGHASH_SINGLE=3,Hr.SIGHASH_ANYONECANPAY=128,Hr.ADVANCED_TRANSACTION_MARKER=0,Hr.ADVANCED_TRANSACTION_FLAG=1,_r.Transaction=Hr,Object.defineProperty(lr,"__esModule",{value:!0});const Mr=dr,Kr=et,Dr=_r,Lr=le,Vr=i.ab,Gr=i.a4,Wr=i.aa,Fr=new TypeError("Cannot compute merkle root for zero transactions"),qr=new TypeError("Cannot compute witness commit for non-segwit block");class jr{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(e){if(e.length<80)throw new Error("Buffer too small (< 80 bytes)");const t=new Mr.BufferReader(e),r=new jr;if(r.version=t.readInt32(),r.prevHash=t.readSlice(32),r.merkleRoot=t.readSlice(32),r.timestamp=t.readUInt32(),r.bits=t.readUInt32(),r.nonce=t.readUInt32(),80===e.length)return r;const n=()=>{const e=Dr.Transaction.fromBuffer(t.buffer.slice(t.offset),!0);return t.offset+=e.byteLength(),e},i=t.readVarInt();r.transactions=[];for(let o=0;o<i;++o){const e=n();r.transactions.push(e)}const s=r.getWitnessCommit();return s&&(r.witnessCommit=s),r}static fromHex(e){return jr.fromBuffer(i.d.Buffer.from(e,"hex"))}static calculateTarget(e){const t=((4278190080&e)>>24)-3,r=8388607&e,n=i.d.Buffer.alloc(32,0);return n.writeUIntBE(r,29-t,3),n}static calculateMerkleRoot(e,t){if(Gr([{getHash:Lr.Function}],e),0===e.length)throw Fr;if(t&&!Xr(e))throw qr;const r=e.map((e=>e.getHash(t))),n=Vr(r,Kr.hash256);return t?Kr.hash256(i.d.Buffer.concat([n,e[0].ins[0].witness[0]])):n}getWitnessCommit(){if(!Xr(this.transactions))return null;const e=this.transactions[0].outs.filter((e=>e.script.slice(0,6).equals(i.d.Buffer.from("6a24aa21a9ed","hex")))).map((e=>e.script.slice(6,38)));if(0===e.length)return null;const t=e[e.length-1];return t instanceof i.d.Buffer&&32===t.length?t:null}hasWitnessCommit(){return this.witnessCommit instanceof i.d.Buffer&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(e=this.transactions)instanceof Array&&e.some((e=>"object"==typeof e&&e.ins instanceof Array&&e.ins.some((e=>"object"==typeof e&&e.witness instanceof Array&&e.witness.length>0))));var e}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(e,t=!0){return e||!this.transactions?80:80+Wr.encodingLength(this.transactions.length)+this.transactions.reduce(((e,r)=>e+r.byteLength(t)),0)}getHash(){return Kr.hash256(this.toBuffer(!0))}getId(){return Mr.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){const e=new Date(0);return e.setUTCSeconds(this.timestamp),e}toBuffer(e){const t=i.d.Buffer.allocUnsafe(this.byteLength(e)),r=new Mr.BufferWriter(t);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),e||!this.transactions||(Wr.encode(this.transactions.length,t,r.offset),r.offset+=Wr.encode.bytes,this.transactions.forEach((e=>{const n=e.byteLength();e.toBuffer(t,r.offset),r.offset+=n}))),t}toHex(e){return this.toBuffer(e).toString("hex")}checkTxRoots(){const e=this.hasWitnessCommit();return!(!e&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!e||this.__checkWitnessCommit()))}checkProofOfWork(){const e=Mr.reverseBuffer(this.getHash()),t=jr.calculateTarget(this.bits);return e.compare(t)<=0}__checkMerkleRoot(){if(!this.transactions)throw Fr;const e=jr.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(e)}__checkWitnessCommit(){if(!this.transactions)throw Fr;if(!this.hasWitnessCommit())throw qr;const e=jr.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(e)}}function Xr(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}lr.Block=jr;var $r={},Yr={},zr={},Qr={},Jr={},Zr={},en={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),(t=e.GlobalTypes||(e.GlobalTypes={}))[t.UNSIGNED_TX=0]="UNSIGNED_TX",t[t.GLOBAL_XPUB=1]="GLOBAL_XPUB",e.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.POR_COMMITMENT=9]="POR_COMMITMENT",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",e[e.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",e[e.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"}(e.InputTypes||(e.InputTypes={})),e.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=2]="BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",e[e.TAP_TREE=6]="TAP_TREE",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"}(e.OutputTypes||(e.OutputTypes={})),e.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]}(en);var tn={};Object.defineProperty(tn,"__esModule",{value:!0});const rn=en;tn.decode=function(e){if(e.key[0]!==rn.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(79!==e.key.length||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!==0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(const n of(e=>[...Array(e).keys()])(e.value.length/4-1)){const t=e.value.readUInt32LE(4*n+4),i=!!(2147483648&t),s=2147483647&t;r.path+="/"+s.toString(10)+(i?"'":"")}return r},tn.encode=function(e){const t=i.d.Buffer.from([rn.GlobalTypes.GLOBAL_XPUB]),r=i.d.Buffer.concat([t,e.extendedPubkey]),n=e.path.split("/"),s=i.d.Buffer.allocUnsafe(4*n.length);e.masterFingerprint.copy(s,0);let o=4;return n.slice(1).forEach((e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),s.writeUInt32LE(r,o),o+=4})),{key:r,value:s}},tn.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",tn.check=function(e){const t=e.extendedPubkey,r=e.masterFingerprint,n=e.path;return i.d.Buffer.isBuffer(t)&&78===t.length&&[2,3].indexOf(t[45])>-1&&i.d.Buffer.isBuffer(r)&&4===r.length&&"string"==typeof n&&!!n.match(/^m(\/\d+'?)*$/)},tn.canAddToArray=function(e,t,r){const n=t.extendedPubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.extendedPubkey.equals(t.extendedPubkey))).length)};var nn={};Object.defineProperty(nn,"__esModule",{value:!0});const sn=en;nn.encode=function(e){return{key:i.d.Buffer.from([sn.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}};var on={};Object.defineProperty(on,"__esModule",{value:!0});const un=en;on.decode=function(e){if(e.key[0]!==un.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value},on.encode=function(e){return{key:i.d.Buffer.from([un.InputTypes.FINAL_SCRIPTSIG]),value:e}},on.expected="Buffer",on.check=function(e){return i.d.Buffer.isBuffer(e)},on.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptSig};var an={};Object.defineProperty(an,"__esModule",{value:!0});const cn=en;an.decode=function(e){if(e.key[0]!==cn.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value},an.encode=function(e){return{key:i.d.Buffer.from([cn.InputTypes.FINAL_SCRIPTWITNESS]),value:e}},an.expected="Buffer",an.check=function(e){return i.d.Buffer.isBuffer(e)},an.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptWitness};var pn={};Object.defineProperty(pn,"__esModule",{value:!0});const fn=en;pn.decode=function(e){if(e.key[0]!==fn.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value},pn.encode=function(e){return{key:i.d.Buffer.from([fn.InputTypes.NON_WITNESS_UTXO]),value:e}},pn.expected="Buffer",pn.check=function(e){return i.d.Buffer.isBuffer(e)},pn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.nonWitnessUtxo};var hn={};Object.defineProperty(hn,"__esModule",{value:!0});const ln=en;hn.decode=function(e){if(e.key[0]!==ln.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(34!==e.key.length&&66!==e.key.length||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}},hn.encode=function(e){const t=i.d.Buffer.from([ln.InputTypes.PARTIAL_SIG]);return{key:i.d.Buffer.concat([t,e.pubkey]),value:e.signature}},hn.expected="{ pubkey: Buffer; signature: Buffer; }",hn.check=function(e){return i.d.Buffer.isBuffer(e.pubkey)&&i.d.Buffer.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&function(e){if(!i.d.Buffer.isBuffer(e)||e.length<9||48!==e[0]||e.length!==e[1]+3||2!==e[2])return!1;const t=e[3];if(t>33||t<1||2!==e[3+t+1])return!1;const r=e[3+t+2];return!(r>33||r<1||e.length!==3+t+2+r+2)}(e.signature)},hn.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey))).length)};var dn={};Object.defineProperty(dn,"__esModule",{value:!0});const wn=en;dn.decode=function(e){if(e.key[0]!==wn.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")},dn.encode=function(e){return{key:i.d.Buffer.from([wn.InputTypes.POR_COMMITMENT]),value:i.d.Buffer.from(e,"utf8")}},dn.expected="string",dn.check=function(e){return"string"==typeof e},dn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.porCommitment};var gn={};Object.defineProperty(gn,"__esModule",{value:!0});const yn=en;gn.decode=function(e){if(e.key[0]!==yn.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)},gn.encode=function(e){const t=i.d.Buffer.from([yn.InputTypes.SIGHASH_TYPE]),r=i.d.Buffer.allocUnsafe(4);return r.writeUInt32LE(e,0),{key:t,value:r}},gn.expected="number",gn.check=function(e){return"number"==typeof e},gn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.sighashType};var mn={};Object.defineProperty(mn,"__esModule",{value:!0});const En=en;function Sn(e){return i.d.Buffer.isBuffer(e)&&(64===e.length||65===e.length)}mn.decode=function(e){if(e.key[0]!==En.InputTypes.TAP_KEY_SIG||1!==e.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!Sn(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value},mn.encode=function(e){return{key:i.d.Buffer.from([En.InputTypes.TAP_KEY_SIG]),value:e}},mn.expected="Buffer",mn.check=Sn,mn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapKeySig};var _n={};Object.defineProperty(_n,"__esModule",{value:!0});const In=en;_n.decode=function(e){if(e.key[0]!==In.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!==0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));const t=e.value[e.value.length-1];if((254&e.key[1])!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));const r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}},_n.encode=function(e){const t=i.d.Buffer.from([In.InputTypes.TAP_LEAF_SCRIPT]),r=i.d.Buffer.from([e.leafVersion]);return{key:i.d.Buffer.concat([t,e.controlBlock]),value:i.d.Buffer.concat([e.script,r])}},_n.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",_n.check=function(e){return i.d.Buffer.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32===0&&(254&e.controlBlock[0])===e.leafVersion&&i.d.Buffer.isBuffer(e.script)},_n.canAddToArray=function(e,t,r){const n=t.controlBlock.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.controlBlock.equals(t.controlBlock))).length)};var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0});const bn=en;function vn(e){return i.d.Buffer.isBuffer(e)&&32===e.length}Tn.decode=function(e){if(e.key[0]!==bn.InputTypes.TAP_MERKLE_ROOT||1!==e.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!vn(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value},Tn.encode=function(e){return{key:i.d.Buffer.from([bn.InputTypes.TAP_MERKLE_ROOT]),value:e}},Tn.expected="Buffer",Tn.check=vn,Tn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapMerkleRoot};var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});const On=en;Pn.decode=function(e){if(e.key[0]!==On.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(65!==e.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(64!==e.value.length&&65!==e.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1,33),leafHash:e.key.slice(33),signature:e.value}},Pn.encode=function(e){const t=i.d.Buffer.from([On.InputTypes.TAP_SCRIPT_SIG]);return{key:i.d.Buffer.concat([t,e.pubkey,e.leafHash]),value:e.signature}},Pn.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",Pn.check=function(e){return i.d.Buffer.isBuffer(e.pubkey)&&i.d.Buffer.isBuffer(e.leafHash)&&i.d.Buffer.isBuffer(e.signature)&&32===e.pubkey.length&&32===e.leafHash.length&&(64===e.signature.length||65===e.signature.length)},Pn.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey)&&e.leafHash.equals(t.leafHash))).length)};var kn={},Bn={},An={};Object.defineProperty(An,"__esModule",{value:!0});const Nn=9007199254740991;function xn(e){if(e<0||e>Nn||e%1!==0)throw new RangeError("value out of range")}function Un(e){return xn(e),e<253?1:e<=65535?3:e<=4294967295?5:9}An.encode=function e(t,r,n){if(xn(t),r||(r=i.d.Buffer.allocUnsafe(Un(t))),!i.d.Buffer.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),t<253?(r.writeUInt8(t,n),Object.assign(e,{bytes:1})):t<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(t,n+1),Object.assign(e,{bytes:3})):t<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(t,n+1),Object.assign(e,{bytes:5})):(r.writeUInt8(255,n),r.writeUInt32LE(t>>>0,n+1),r.writeUInt32LE(t/4294967296|0,n+5),Object.assign(e,{bytes:9})),r},An.decode=function e(t,r){if(!i.d.Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);const n=t.readUInt8(r);if(n<253)return Object.assign(e,{bytes:1}),n;if(253===n)return Object.assign(e,{bytes:3}),t.readUInt16LE(r+1);if(254===n)return Object.assign(e,{bytes:5}),t.readUInt32LE(r+1);{Object.assign(e,{bytes:9});const n=t.readUInt32LE(r+1),i=4294967296*t.readUInt32LE(r+5)+n;return xn(i),i}},An.encodingLength=Un,Object.defineProperty(Bn,"__esModule",{value:!0});const Rn=An;function Cn(e){const t=e.key.length,r=e.value.length,n=Rn.encodingLength(t),s=Rn.encodingLength(r),o=i.d.Buffer.allocUnsafe(n+t+s+r);return Rn.encode(t,o,0),e.key.copy(o,n),Rn.encode(r,o,n+t),e.value.copy(o,n+t+s),o}function Hn(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}Bn.range=e=>[...Array(e).keys()],Bn.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},Bn.keyValsToBuffer=function(e){const t=e.map(Cn);return t.push(i.d.Buffer.from([0])),i.d.Buffer.concat(t)},Bn.keyValToBuffer=Cn,Bn.readUInt64LE=function(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,Hn(n+r,9007199254740991),n+r},Bn.writeUInt64LE=function(e,t,r){return Hn(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8},Object.defineProperty(kn,"__esModule",{value:!0});const Mn=en,Kn=Bn,Dn=An;kn.decode=function(e){if(e.key[0]!==Mn.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));const t=Kn.readUInt64LE(e.value,0);let r=8;const n=Dn.decode(e.value,r);r+=Dn.encodingLength(n);const i=e.value.slice(r);if(i.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:i,value:t}},kn.encode=function(e){const{script:t,value:r}=e,n=Dn.encodingLength(t.length),s=i.d.Buffer.allocUnsafe(8+n+t.length);return Kn.writeUInt64LE(s,r,0),Dn.encode(t.length,s,8),t.copy(s,8+n),{key:i.d.Buffer.from([Mn.InputTypes.WITNESS_UTXO]),value:s}},kn.expected="{ script: Buffer; value: number; }",kn.check=function(e){return i.d.Buffer.isBuffer(e.script)&&"number"==typeof e.value},kn.canAdd=function(e,t){return!!e&&!!t&&void 0===e.witnessUtxo};var Ln={};Object.defineProperty(Ln,"__esModule",{value:!0});const Vn=en,Gn=An;Ln.decode=function(e){if(e.key[0]!==Vn.OutputTypes.TAP_TREE||1!==e.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0;const r=[];for(;t<e.value.length;){const n=e.value[t++],i=e.value[t++],s=Gn.decode(e.value,t);t+=Gn.encodingLength(s),r.push({depth:n,leafVersion:i,script:e.value.slice(t,t+s)}),t+=s}return{leaves:r}},Ln.encode=function(e){const t=i.d.Buffer.from([Vn.OutputTypes.TAP_TREE]),r=[].concat(...e.leaves.map((e=>[i.d.Buffer.of(e.depth,e.leafVersion),Gn.encode(e.script.length),e.script])));return{key:t,value:i.d.Buffer.concat(r)}},Ln.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",Ln.check=function(e){return Array.isArray(e.leaves)&&e.leaves.every((e=>e.depth>=0&&e.depth<=128&&(254&e.leafVersion)===e.leafVersion&&i.d.Buffer.isBuffer(e.script)))},Ln.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapTree};var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});const Fn=e=>33===e.length&&[2,3].includes(e[0])||65===e.length&&4===e[0];Wn.makeConverter=function(e,t=Fn){return{decode:function(r){if(r.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+r.key.toString("hex"));const n=r.key.slice(1);if(!t(n))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+r.key.toString("hex"));if(r.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const i={masterFingerprint:r.value.slice(0,4),pubkey:n,path:"m"};for(const e of(e=>[...Array(e).keys()])(r.value.length/4-1)){const t=r.value.readUInt32LE(4*e+4),n=!!(2147483648&t),s=2147483647&t;i.path+="/"+s.toString(10)+(n?"'":"")}return i},encode:function(t){const r=i.d.Buffer.from([e]),n=i.d.Buffer.concat([r,t.pubkey]),s=t.path.split("/"),o=i.d.Buffer.allocUnsafe(4*s.length);t.masterFingerprint.copy(o,0);let u=4;return s.slice(1).forEach((e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),o.writeUInt32LE(r,u),u+=4})),{key:n,value:o}},check:function(e){return i.d.Buffer.isBuffer(e.pubkey)&&i.d.Buffer.isBuffer(e.masterFingerprint)&&"string"==typeof e.path&&t(e.pubkey)&&4===e.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey))).length)}}};var qn={};Object.defineProperty(qn,"__esModule",{value:!0}),qn.makeChecker=function(e){return function(t){let r;if(e.includes(t.key[0])&&(r=t.key.slice(1),33!==r.length&&65!==r.length||![2,3,4].includes(r[0])))throw new Error("Format Error: invalid pubkey in key 0x"+t.key.toString("hex"));return r}};var jn={};Object.defineProperty(jn,"__esModule",{value:!0}),jn.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:i.d.Buffer.from([e]),value:t}},check:function(e){return i.d.Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.redeemScript}}};var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});const $n=An,Yn=Wn,zn=e=>32===e.length;Xn.makeConverter=function(e){const t=Yn.makeConverter(e,zn);return{decode:function(e){const r=$n.decode(e.value),n=$n.encodingLength(r),i=t.decode({key:e.key,value:e.value.slice(n+32*r)}),s=new Array(r);for(let t=0,o=n;t<r;t++,o+=32)s[t]=e.value.slice(o,o+32);return Object.assign({},i,{leafHashes:s})},encode:function(e){const r=t.encode(e),n=$n.encodingLength(e.leafHashes.length),s=i.d.Buffer.allocUnsafe(n);$n.encode(e.leafHashes.length,s);const o=i.d.Buffer.concat([s,...e.leafHashes,r.value]);return Object.assign({},r,{value:o})},check:function(e){return Array.isArray(e.leafHashes)&&e.leafHashes.every((e=>i.d.Buffer.isBuffer(e)&&32===e.length))&&t.check(e)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:t.canAddToArray}};var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e||1!==t.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+t.key.toString("hex"));if(32!==t.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return t.value},encode:function(t){return{key:i.d.Buffer.from([e]),value:t}},check:function(e){return i.d.Buffer.isBuffer(e)&&32===e.length},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.tapInternalKey}}};var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:i.d.Buffer.from([e]),value:t}},check:function(e){return i.d.Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.witnessScript}}},Object.defineProperty(Zr,"__esModule",{value:!0});const Zn=en,ei=on,ti=an,ri=pn,ni=hn,ii=dn,si=gn,oi=mn,ui=_n,ai=Tn,ci=Pn,pi=kn,fi=Ln,hi=Wn,li=qn,di=jn,wi=Xn,gi=Qn,yi=Jn,mi={unsignedTx:nn,globalXpub:tn,checkPubkey:li.makeChecker([])};Zr.globals=mi;const Ei={nonWitnessUtxo:ri,partialSig:ni,sighashType:si,finalScriptSig:ei,finalScriptWitness:ti,porCommitment:ii,witnessUtxo:pi,bip32Derivation:hi.makeConverter(Zn.InputTypes.BIP32_DERIVATION),redeemScript:di.makeConverter(Zn.InputTypes.REDEEM_SCRIPT),witnessScript:yi.makeConverter(Zn.InputTypes.WITNESS_SCRIPT),checkPubkey:li.makeChecker([Zn.InputTypes.PARTIAL_SIG,Zn.InputTypes.BIP32_DERIVATION]),tapKeySig:oi,tapScriptSig:ci,tapLeafScript:ui,tapBip32Derivation:wi.makeConverter(Zn.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:gi.makeConverter(Zn.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:ai};Zr.inputs=Ei;const Si={bip32Derivation:hi.makeConverter(Zn.OutputTypes.BIP32_DERIVATION),redeemScript:di.makeConverter(Zn.OutputTypes.REDEEM_SCRIPT),witnessScript:yi.makeConverter(Zn.OutputTypes.WITNESS_SCRIPT),checkPubkey:li.makeChecker([Zn.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:wi.makeConverter(Zn.OutputTypes.TAP_BIP32_DERIVATION),tapTree:fi,tapInternalKey:gi.makeConverter(Zn.OutputTypes.TAP_INTERNAL_KEY)};Zr.outputs=Si,Object.defineProperty(Jr,"__esModule",{value:!0});const _i=Zr,Ii=Bn,Ti=An,bi=en;function vi(e,t,r){if(!t.equals(i.d.Buffer.from([r])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}function Pi(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:n}){const i={unsignedTx:e};let s=0;for(const p of t)switch(p.key[0]){case bi.GlobalTypes.UNSIGNED_TX:if(vi("global",p.key,bi.GlobalTypes.UNSIGNED_TX),s>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");s++;break;case bi.GlobalTypes.GLOBAL_XPUB:void 0===i.globalXpub&&(i.globalXpub=[]),i.globalXpub.push(_i.globals.globalXpub.decode(p));break;default:i.unknownKeyVals||(i.unknownKeyVals=[]),i.unknownKeyVals.push(p)}const o=r.length,u=n.length,a=[],c=[];for(const p of Ii.range(o)){const e={};for(const t of r[p])switch(_i.inputs.checkPubkey(t),t.key[0]){case bi.InputTypes.NON_WITNESS_UTXO:if(vi("input",t.key,bi.InputTypes.NON_WITNESS_UTXO),void 0!==e.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");e.nonWitnessUtxo=_i.inputs.nonWitnessUtxo.decode(t);break;case bi.InputTypes.WITNESS_UTXO:if(vi("input",t.key,bi.InputTypes.WITNESS_UTXO),void 0!==e.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");e.witnessUtxo=_i.inputs.witnessUtxo.decode(t);break;case bi.InputTypes.PARTIAL_SIG:void 0===e.partialSig&&(e.partialSig=[]),e.partialSig.push(_i.inputs.partialSig.decode(t));break;case bi.InputTypes.SIGHASH_TYPE:if(vi("input",t.key,bi.InputTypes.SIGHASH_TYPE),void 0!==e.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");e.sighashType=_i.inputs.sighashType.decode(t);break;case bi.InputTypes.REDEEM_SCRIPT:if(vi("input",t.key,bi.InputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");e.redeemScript=_i.inputs.redeemScript.decode(t);break;case bi.InputTypes.WITNESS_SCRIPT:if(vi("input",t.key,bi.InputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");e.witnessScript=_i.inputs.witnessScript.decode(t);break;case bi.InputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(_i.inputs.bip32Derivation.decode(t));break;case bi.InputTypes.FINAL_SCRIPTSIG:vi("input",t.key,bi.InputTypes.FINAL_SCRIPTSIG),e.finalScriptSig=_i.inputs.finalScriptSig.decode(t);break;case bi.InputTypes.FINAL_SCRIPTWITNESS:vi("input",t.key,bi.InputTypes.FINAL_SCRIPTWITNESS),e.finalScriptWitness=_i.inputs.finalScriptWitness.decode(t);break;case bi.InputTypes.POR_COMMITMENT:vi("input",t.key,bi.InputTypes.POR_COMMITMENT),e.porCommitment=_i.inputs.porCommitment.decode(t);break;case bi.InputTypes.TAP_KEY_SIG:vi("input",t.key,bi.InputTypes.TAP_KEY_SIG),e.tapKeySig=_i.inputs.tapKeySig.decode(t);break;case bi.InputTypes.TAP_SCRIPT_SIG:void 0===e.tapScriptSig&&(e.tapScriptSig=[]),e.tapScriptSig.push(_i.inputs.tapScriptSig.decode(t));break;case bi.InputTypes.TAP_LEAF_SCRIPT:void 0===e.tapLeafScript&&(e.tapLeafScript=[]),e.tapLeafScript.push(_i.inputs.tapLeafScript.decode(t));break;case bi.InputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(_i.inputs.tapBip32Derivation.decode(t));break;case bi.InputTypes.TAP_INTERNAL_KEY:vi("input",t.key,bi.InputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=_i.inputs.tapInternalKey.decode(t);break;case bi.InputTypes.TAP_MERKLE_ROOT:vi("input",t.key,bi.InputTypes.TAP_MERKLE_ROOT),e.tapMerkleRoot=_i.inputs.tapMerkleRoot.decode(t);break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}a.push(e)}for(const p of Ii.range(u)){const e={};for(const t of n[p])switch(_i.outputs.checkPubkey(t),t.key[0]){case bi.OutputTypes.REDEEM_SCRIPT:if(vi("output",t.key,bi.OutputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");e.redeemScript=_i.outputs.redeemScript.decode(t);break;case bi.OutputTypes.WITNESS_SCRIPT:if(vi("output",t.key,bi.OutputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");e.witnessScript=_i.outputs.witnessScript.decode(t);break;case bi.OutputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(_i.outputs.bip32Derivation.decode(t));break;case bi.OutputTypes.TAP_INTERNAL_KEY:vi("output",t.key,bi.OutputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=_i.outputs.tapInternalKey.decode(t);break;case bi.OutputTypes.TAP_TREE:vi("output",t.key,bi.OutputTypes.TAP_TREE),e.tapTree=_i.outputs.tapTree.decode(t);break;case bi.OutputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(_i.outputs.tapBip32Derivation.decode(t));break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}c.push(e)}return{globalMap:i,inputs:a,outputs:c}}Jr.psbtFromBuffer=function(e,t){let r=0;function n(){const t=Ti.decode(e,r);r+=Ti.encodingLength(t);const n=e.slice(r,r+t);return r+=t,n}function i(){return{key:n(),value:n()}}function s(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");const t=0===e.readUInt8(r);return t&&r++,t}if(1886610036!==function(){const t=e.readUInt32BE(r);return r+=4,t}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const t=e.readUInt8(r);return r+=1,t}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const o=[],u={};for(;!s();){const e=i(),t=e.key.toString("hex");if(u[t])throw new Error("Format Error: Keys must be unique for global keymap: key "+t);u[t]=1,o.push(e)}const a=o.filter((e=>e.key[0]===bi.GlobalTypes.UNSIGNED_TX));if(1!==a.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const c=t(a[0].value),{inputCount:p,outputCount:f}=c.getInputOutputCounts(),h=[],l=[];for(const d of Ii.range(p)){const e={},t=[];for(;!s();){const r=i(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each input: input index "+d+" key "+n);e[n]=1,t.push(r)}h.push(t)}for(const d of Ii.range(f)){const e={},t=[];for(;!s();){const r=i(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each output: output index "+d+" key "+n);e[n]=1,t.push(r)}l.push(t)}return Pi(c,{globalMapKeyVals:o,inputKeyVals:h,outputKeyVals:l})},Jr.checkKeyBuffer=vi,Jr.psbtFromKeyVals=Pi;var Oi={};Object.defineProperty(Oi,"__esModule",{value:!0});const ki=Zr,Bi=Bn;Oi.psbtToBuffer=function({globalMap:e,inputs:t,outputs:r}){const{globalKeyVals:n,inputKeyVals:s,outputKeyVals:o}=xi({globalMap:e,inputs:t,outputs:r}),u=Bi.keyValsToBuffer(n),a=e=>0===e.length?[i.d.Buffer.from([0])]:e.map(Bi.keyValsToBuffer),c=a(s),p=a(o),f=i.d.Buffer.allocUnsafe(5);return f.writeUIntBE(482972169471,0,5),i.d.Buffer.concat([f,u].concat(c,p))};const Ai=(e,t)=>e.key.compare(t.key);function Ni(e,t){const r=new Set,n=Object.entries(e).reduce(((e,[n,i])=>{if("unknownKeyVals"===n)return e;const s=t[n];if(void 0===s)return e;const o=(Array.isArray(i)?i:[i]).map(s.encode);return o.map((e=>e.key.toString("hex"))).forEach((e=>{if(r.has(e))throw new Error("Serialize Error: Duplicate key: "+e);r.add(e)})),e.concat(o)}),[]),i=e.unknownKeyVals?e.unknownKeyVals.filter((e=>!r.has(e.key.toString("hex")))):[];return n.concat(i).sort(Ai)}function xi({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:Ni(e,ki.globals),inputKeyVals:t.map((e=>Ni(e,ki.inputs))),outputKeyVals:r.map((e=>Ni(e,ki.outputs)))}}Oi.psbtToKeyVals=xi,function(e){function t(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),t(Jr),t(Oi)}(Qr),Object.defineProperty(zr,"__esModule",{value:!0});const Ui=Qr;function Ri(e,t,r){return n=>{if(e.has(n))return;const i=r.filter((e=>e.key.toString("hex")===n))[0];t.push(i),e.add(n)}}function Ci(e){return e.globalMap.unsignedTx}function Hi(e){const t=new Set;return e.forEach((e=>{const r=e.key.toString("hex");if(t.has(r))throw new Error("Combine: KeyValue Map keys should be unique");t.add(r)})),t}zr.combine=function(e){const t=e[0],r=Ui.psbtToKeyVals(t),n=e.slice(1);if(0===n.length)throw new Error("Combine: Nothing to combine");const i=Ci(t);if(void 0===i)throw new Error("Combine: Self missing transaction");const s=Hi(r.globalKeyVals),o=r.inputKeyVals.map(Hi),u=r.outputKeyVals.map(Hi);for(const a of n){const e=Ci(a);if(void 0===e||!e.toBuffer().equals(i.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const t=Ui.psbtToKeyVals(a);Hi(t.globalKeyVals).forEach(Ri(s,r.globalKeyVals,t.globalKeyVals)),t.inputKeyVals.map(Hi).forEach(((e,n)=>e.forEach(Ri(o[n],r.inputKeyVals[n],t.inputKeyVals[n])))),t.outputKeyVals.map(Hi).forEach(((e,n)=>e.forEach(Ri(u[n],r.outputKeyVals[n],t.outputKeyVals[n]))))}return Ui.psbtFromKeyVals(i,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})};var Mi={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Zr;function r(e,t){const r=e[t];if(void 0===r)throw new Error(`No input #${t}`);return r}function n(e,t){const r=e[t];if(void 0===r)throw new Error(`No output #${t}`);return r}function s(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function o(e){return(r,n)=>{for(const i of Object.keys(r)){const o=r[i],{canAdd:u,canAddToArray:a,check:c,expected:p}=t[e+"s"][i]||{};if(c)if(!!a){if(!Array.isArray(o)||n[i]&&!Array.isArray(n[i]))throw new Error(`Key type ${i} must be an array`);o.every(c)||s(e,i,p,o);const t=n[i]||[],r=new Set;if(!o.every((e=>a(t,e,r))))throw new Error("Can not add duplicate data to array");n[i]=t.concat(o)}else{if(c(o)||s(e,i,p,o),!u(n,o))throw new Error(`Can not add duplicate data to ${e}`);n[i]=o}}}}e.checkForInput=r,e.checkForOutput=n,e.checkHasKey=function(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&0!==t.filter((t=>t.key.equals(e.key))).length)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)},e.getEnumLength=function(e){let t=0;return Object.keys(e).forEach((e=>{Number(isNaN(Number(e)))&&t++})),t},e.inputCheckUncleanFinalized=function(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){const e=!!t.redeemScript,n=!!t.witnessScript,i=!e||!!t.finalScriptSig,s=!n||!!t.finalScriptWitness,o=!!t.finalScriptSig||!!t.finalScriptWitness;r=i&&s&&o}if(!1===r)throw new Error(`Input #${e} has too much or too little data to clean`)},e.updateGlobal=o("global"),e.updateInput=o("input"),e.updateOutput=o("output"),e.addInputAttributes=function(t,n){const i=r(t,t.length-1);e.updateInput(n,i)},e.addOutputAttributes=function(t,r){const i=n(t,t.length-1);e.updateOutput(r,i)},e.defaultVersionSetter=function(e,t){if(!i.d.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t},e.defaultLocktimeSetter=function(e,t){if(!i.d.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}}(Mi),Object.defineProperty(Yr,"__esModule",{value:!0});const Ki=zr,Di=Qr,Li=en,Vi=Mi;Yr.Psbt=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(e,t){const r=i.d.Buffer.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t){const r=i.d.Buffer.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t){const r=Di.psbtFromBuffer(e,t),n=new this(r.globalMap.unsignedTx);return Object.assign(n,r),n}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return Di.psbtToBuffer(this)}updateGlobal(e){return Vi.updateGlobal(e,this.globalMap),this}updateInput(e,t){const r=Vi.checkForInput(this.inputs,e);return Vi.updateInput(t,r),this}updateOutput(e,t){const r=Vi.checkForOutput(this.outputs,e);return Vi.updateOutput(t,r),this}addUnknownKeyValToGlobal(e){return Vi.checkHasKey(e,this.globalMap.unknownKeyVals,Vi.getEnumLength(Li.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,t){const r=Vi.checkForInput(this.inputs,e);return Vi.checkHasKey(t,r.unknownKeyVals,Vi.getEnumLength(Li.InputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addUnknownKeyValToOutput(e,t){const r=Vi.checkForOutput(this.outputs,e);return Vi.checkHasKey(t,r.unknownKeyVals,Vi.getEnumLength(Li.OutputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.inputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach((e=>this.addUnknownKeyValToInput(r,e))),Vi.addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.outputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach((e=>this.addUnknownKeyValToInput(r,e))),Vi.addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const t=Vi.checkForInput(this.inputs,e);Vi.inputCheckUncleanFinalized(e,t);for(const r of Object.keys(t))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(r)||delete t[r];return this}combine(...e){const t=Ki.combine([this].concat(e));return Object.assign(this,t),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}},Object.defineProperty($r,"__esModule",{value:!0});const Gi=Yr,Wi=An,Fi=Mi,qi=oe,ji=dr,Xi=et,$i=nr,Yi=ae,zi=pe,Qi=_r,Ji={network:ue.bitcoin,maximumFeeRate:5e3};class Zi{constructor(e={},t=new Gi.Psbt(new ts)){this.data=t,this.opts=Object.assign({},Ji,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(e,t,r,n)=>Object.defineProperty(e,t,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}static fromBase64(e,t={}){const r=i.d.Buffer.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t={}){const r=i.d.Buffer.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t={}){const r=Gi.Psbt.fromBuffer(e,es),n=new Zi(t,r);return function(e,t){e.ins.forEach((e=>{gs(t,e)}))}(n.__CACHE.__TX,n.__CACHE),n}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map((e=>({hash:ji.cloneBuffer(e.hash),index:e.index,sequence:e.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((e=>{let t;try{t=qi.fromOutputScript(e.script,this.opts.network)}catch{}return{script:ji.cloneBuffer(e.script),value:e.value,address:t}}))}combine(...e){return this.data.combine(...e.map((e=>e.data))),this}clone(){const e=Zi.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){ls(e),this.opts.maximumFeeRate=e}setVersion(e){ls(e),ds(this.data.inputs,"setVersion");const t=this.__CACHE;return t.__TX.version=e,t.__EXTRACTED_TX=void 0,this}setLocktime(e){ls(e),ds(this.data.inputs,"setLocktime");const t=this.__CACHE;return t.__TX.locktime=e,t.__EXTRACTED_TX=void 0,this}setInputSequence(e,t){ls(t),ds(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=e)throw new Error("Input index too high");return r.__TX.ins[e].sequence=t,r.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach((e=>this.addInput(e))),this}addInput(e){if(arguments.length>1||!e||void 0===e.hash||void 0===e.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");ds(this.data.inputs,"addInput"),e.witnessScript&&Us(e.witnessScript);const t=this.__CACHE;this.data.addInput(e);gs(t,t.__TX.ins[t.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&Os(this.__CACHE,n,r),t.__FEE=void 0,t.__FEE_RATE=void 0,t.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach((e=>this.addOutput(e))),this}addOutput(e){if(arguments.length>1||!e||void 0===e.value||void 0===e.address&&void 0===e.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");ds(this.data.inputs,"addOutput");const{address:t}=e;if("string"==typeof t){const{network:r}=this.opts,n=qi.toOutputScript(t,r);e=Object.assign(e,{script:n})}const r=this.__CACHE;return this.data.addOutput(e),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(is))throw new Error("Not finalized");const t=this.__CACHE;if(e||function(e,t,r){const n=t.__FEE_RATE||e.getFeeRate(),i=t.__EXTRACTED_TX.virtualSize(),s=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(s/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,t,this.opts),t.__EXTRACTED_TX)return t.__EXTRACTED_TX;const r=t.__TX.clone();return ks(this.data.inputs,r,t,!0),r}getFeeRate(){return Ss("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return Ss("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return Fi.checkForInput(this.data.inputs,0),Hs(this.data.inputs.length).forEach((e=>this.finalizeInput(e))),this}finalizeInput(e,t=_s){const r=Fi.checkForInput(this.data.inputs,e),{script:n,isP2SH:i,isP2WSH:s,isSegwit:o}=function(e,t,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!t.redeemScript,i.isP2WSH=!!t.witnessScript,t.witnessScript)i.script=t.witnessScript;else if(t.redeemScript)i.script=t.redeemScript;else if(t.nonWitnessUtxo){const s=Bs(r,t,e),o=n.ins[e].index;i.script=s.outs[o].script}else t.witnessUtxo&&(i.script=t.witnessUtxo.script);return(t.witnessScript||cs(i.script))&&(i.isSegwit=!0),i}(e,r,this.__CACHE);if(!n)throw new Error(`No script found for input #${e}`);!function(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:r}=e;t.forEach((e=>{const{hashType:t}=zi.signature.decode(e.signature);if(r!==t)throw new Error("Signature sighash does not match input sighash type")}))}(r);const{finalScriptSig:u,finalScriptWitness:a}=t(e,r,n,o,i,s);if(u&&this.data.updateInput(e,{finalScriptSig:u}),a&&this.data.updateInput(e,{finalScriptWitness:a}),!u&&!a)throw new Error(`Unknown error finalizing input #${e}`);return this.data.clearFinalizedInput(e),this}getInputType(e){const t=Fi.checkForInput(this.data.inputs,e),r=xs(As(e,t,this.__CACHE),e,"input",t.redeemScript||function(e){if(!e)return;const t=zi.decompile(e);if(!t)return;const r=t[t.length-1];if(i.d.Buffer.isBuffer(r)&&!Ns(r)&&!function(e){return zi.isCanonicalScriptSignature(e)}(r)&&zi.decompile(r))return r}(t.finalScriptSig),t.witnessScript||function(e){if(!e)return;const t=vs(e),r=t[t.length-1];if(!Ns(r)&&zi.decompile(r))return r}(t.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+Cs(r.meaningfulScript)}inputHasPubkey(e,t){return function(e,t,r,n){const i=As(r,t,n),{meaningfulScript:s}=xs(i,r,"input",t.redeemScript,t.witnessScript);return Rs(e,s)}(t,Fi.checkForInput(this.data.inputs,e),e,this.__CACHE)}inputHasHDKey(e,t){const r=Fi.checkForInput(this.data.inputs,e),n=hs(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(e,t){return function(e,t,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:s}=xs(i,r,"output",t.redeemScript,t.witnessScript);return Rs(e,s)}(t,Fi.checkForOutput(this.data.outputs,e),e,this.__CACHE)}outputHasHDKey(e,t){const r=Fi.checkForOutput(this.data.outputs,e),n=hs(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(){return Fi.checkForInput(this.data.inputs,0),Hs(this.data.inputs.length).map((e=>this.validateSignaturesOfInput(e))).reduce(((e,t)=>!0===t&&e),!0)}validateSignaturesOfInput(e,t){const r=this.data.inputs[e],n=(r||{}).partialSig;if(!r||!n||n.length<1)throw new Error("No signatures to validate");const i=t?n.filter((e=>e.pubkey.equals(t))):n;if(i.length<1)throw new Error("No signatures for this pubkey");const s=[];let o,u,a;for(const c of i){const t=zi.signature.decode(c.signature),{hash:n,script:i}=a!==t.hashType?Ts(e,Object.assign({},r,{sighashType:t.hashType}),this.__CACHE,!0):{hash:o,script:u};a=t.hashType,o=n,u=i,ws(c.pubkey,i,"verify");const p=$i.fromPublicKey(c.pubkey);s.push(p.verify(n,t.signature))}return s.every((e=>!0===e))}signAllInputsHD(e,t=[Qi.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const n of Hs(this.data.inputs.length))try{this.signInputHD(n,e,t),r.push(!0)}catch{r.push(!1)}if(r.every((e=>!1===e)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,t=[Qi.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!e||!e.publicKey||!e.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],s=[];for(const o of Hs(this.data.inputs.length))s.push(this.signInputHDAsync(o,e,t).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((e=>!1===e)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(e,t,r=[Qi.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");return bs(e,this.data.inputs,t).forEach((t=>this.signInput(e,t,r))),this}signInputHDAsync(e,t,r=[Qi.Transaction.SIGHASH_ALL]){return new Promise(((n,i)=>{if(!t||!t.publicKey||!t.fingerprint)return i(new Error("Need HDSigner to sign input"));const s=bs(e,this.data.inputs,t).map((t=>this.signInputAsync(e,t,r)));return Promise.all(s).then((()=>{n()})).catch(i)}))}signAllInputs(e,t=[Qi.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const n of Hs(this.data.inputs.length))try{this.signInput(n,e,t),r.push(!0)}catch{r.push(!1)}if(r.every((e=>!1===e)))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,t=[Qi.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!e||!e.publicKey)return n(new Error("Need Signer to sign input"));const i=[],s=[];for(const[o]of this.data.inputs.entries())s.push(this.signInputAsync(o,e,t).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((e=>!1===e)))return n(new Error("No inputs were signed"));r()}))}))}signInput(e,t,r=[Qi.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=Is(this.data.inputs,e,t.publicKey,this.__CACHE,r),s=[{pubkey:t.publicKey,signature:zi.signature.encode(t.sign(n),i)}];return this.data.updateInput(e,{partialSig:s}),this}signInputAsync(e,t,r=[Qi.Transaction.SIGHASH_ALL]){return Promise.resolve().then((()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=Is(this.data.inputs,e,t.publicKey,this.__CACHE,r);return Promise.resolve(t.sign(n)).then((r=>{const n=[{pubkey:t.publicKey,signature:zi.signature.encode(r,i)}];this.data.updateInput(e,{partialSig:n})}))}))}toBuffer(){return rs(this.__CACHE),this.data.toBuffer()}toHex(){return rs(this.__CACHE),this.data.toHex()}toBase64(){return rs(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,t){return t.witnessScript&&Us(t.witnessScript),this.data.updateInput(e,t),t.nonWitnessUtxo&&Os(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,t){return this.data.updateOutput(e,t),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,t){return this.data.addUnknownKeyValToInput(e,t),this}addUnknownKeyValToOutput(e,t){return this.data.addUnknownKeyValToOutput(e,t),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}$r.Psbt=Zi;const es=e=>new ts(e);class ts{constructor(e=i.d.Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=Qi.Transaction.fromBuffer(e),function(e){if(!e.ins.every((e=>e.script&&0===e.script.length&&e.witness&&0===e.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(void 0===e.hash||void 0===e.index||!i.d.Buffer.isBuffer(e.hash)&&"string"!=typeof e.hash||"number"!=typeof e.index)throw new Error("Error adding input.");const t="string"==typeof e.hash?ji.reverseBuffer(i.d.Buffer.from(e.hash,"hex")):e.hash;this.tx.addInput(t,e.index,e.sequence)}addOutput(e){if(void 0===e.script||void 0===e.value||!i.d.Buffer.isBuffer(e.script)||"number"!=typeof e.value)throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function rs(e){if(!1!==e.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function ns(e,t,r){if(!t)return!1;let n;if(n=r?r.map((e=>{const r=$i.fromPublicKey(e,{compressed:!0}).publicKey;return t.find((e=>e.pubkey.equals(r)))})).filter((e=>!!e)):t,n.length>e)throw new Error("Too many signatures");return n.length===e}function is(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function ss(e){return t=>{try{return e({output:t}),!0}catch{return!1}}}const os=ss(Yi.p2ms),us=ss(Yi.p2pk),as=ss(Yi.p2pkh),cs=ss(Yi.p2wpkh),ps=ss(Yi.p2wsh),fs=ss(Yi.p2sh);function hs(e){return t=>!(!t.masterFingerprint.equals(e.fingerprint)||!e.derivePath(t.path).publicKey.equals(t.pubkey))}function ls(e){if("number"!=typeof e||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function ds(e,t){e.forEach((e=>{let r=!1,n=[];if(0===(e.partialSig||[]).length){if(!e.finalScriptSig&&!e.finalScriptWitness)return;n=function(e){const t=e.finalScriptSig&&zi.decompile(e.finalScriptSig)||[],r=e.finalScriptWitness&&zi.decompile(e.finalScriptWitness)||[];return t.concat(r).filter((e=>i.d.Buffer.isBuffer(e)&&zi.isCanonicalScriptSignature(e))).map((e=>({signature:e})))}(e)}else n=e.partialSig;if(n.forEach((e=>{const{hashType:n}=zi.signature.decode(e.signature),i=[];switch(n&Qi.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput"),31&n){case Qi.Transaction.SIGHASH_ALL:break;case Qi.Transaction.SIGHASH_SINGLE:case Qi.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}-1===i.indexOf(t)&&(r=!0)})),r)throw new Error("Can not modify transaction, signatures exist.")}))}function ws(e,t,r){if(!Rs(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function gs(e,t){const r=ji.reverseBuffer(i.d.Buffer.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function ys(e,t){return(r,n,i,s)=>{const o=e({redeem:{output:i}}).output;if(!n.equals(o))throw new Error(`${t} for ${s} #${r} doesn't match the scriptPubKey in the prevout`)}}const ms=ys(Yi.p2sh,"Redeem script"),Es=ys(Yi.p2wsh,"Witness script");function Ss(e,t,r,n){if(!r.every(is))throw new Error(`PSBT must be finalized to calculate ${t}`);if("__FEE_RATE"===e&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===e&&n.__FEE)return n.__FEE;let i,s=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,s=!1):i=n.__TX.clone(),ks(r,i,n,s),"__FEE_RATE"===e?n.__FEE_RATE:"__FEE"===e?n.__FEE:void 0}function _s(e,t,r,n,i,s){const o=Cs(r);if(!function(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return ns(1,e.partialSig);case"multisig":const r=Yi.p2ms({output:t});return ns(r.m,e.partialSig,r.pubkeys);default:return!1}}(t,r,o))throw new Error(`Can not finalize input #${e}`);return function(e,t,r,n,i,s){let o,u;const a=function(e,t,r){let n;switch(t){case"multisig":const t=function(e,t){return Yi.p2ms({output:e}).pubkeys.map((e=>(t.filter((t=>t.pubkey.equals(e)))[0]||{}).signature)).filter((e=>!!e))}(e,r);n=Yi.p2ms({output:e,signatures:t});break;case"pubkey":n=Yi.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=Yi.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=Yi.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(e,t,r),c=s?Yi.p2wsh({redeem:a}):null,p=i?Yi.p2sh({redeem:c||a}):null;return n?(u=Ps(c?c.witness:a.witness),p&&(o=p.input)):o=p?p.input:a.input,{finalScriptSig:o,finalScriptWitness:u}}(r,o,t.partialSig,n,i,s)}function Is(e,t,r,n,i){const s=Fi.checkForInput(e,t),{hash:o,sighashType:u,script:a}=Ts(t,s,n,!1,i);return ws(r,a,"sign"),{hash:o,sighashType:u}}function Ts(e,t,r,n,i){const s=r.__TX,o=t.sighashType||Qi.Transaction.SIGHASH_ALL;if(i&&i.indexOf(o)<0){const e=function(e){let t=e&Qi.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&e){case Qi.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case Qi.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case Qi.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE"}return t}(o);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${e}`)}let u,a;if(t.nonWitnessUtxo){const n=Bs(r,t,e),i=s.ins[e].hash,o=n.getHash();if(!i.equals(o))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const u=s.ins[e].index;a=n.outs[u]}else{if(!t.witnessUtxo)throw new Error("Need a Utxo input item for signing");a=t.witnessUtxo}const{meaningfulScript:c,type:p}=xs(a.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(p)>=0)u=s.hashForWitnessV0(e,c,a.value,o);else if(cs(c)){const t=Yi.p2pkh({hash:c.slice(2)}).output;u=s.hashForWitnessV0(e,t,a.value,o)}else{if(void 0===t.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);!n&&!1!==r.__UNSAFE_SIGN_NONSEGWIT&&console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),u=s.hashForSignature(e,c,o)}return{script:c,sighashType:o,hash:u}}function bs(e,t,r){const n=Fi.checkForInput(t,e);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map((e=>{if(e.masterFingerprint.equals(r.fingerprint))return e})).filter((e=>!!e));if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map((e=>{const t=r.derivePath(e.path);if(!e.pubkey.equals(t.publicKey))throw new Error("pubkey did not match bip32Derivation");return t}))}function vs(e){let t=0;function r(){const r=Wi.decode(e,t);return t+=Wi.decode.bytes,r}function n(){return n=r(),t+=n,e.slice(t-n,t);var n}return function(){const e=r(),t=[];for(let r=0;r<e;r++)t.push(n());return t}()}function Ps(e){let t=i.d.Buffer.allocUnsafe(0);function r(e){const r=t.length,n=Wi.encodingLength(e);t=i.d.Buffer.concat([t,i.d.Buffer.allocUnsafe(n)]),Wi.encode(e,t,r)}function n(e){r(e.length),function(e){t=i.d.Buffer.concat([t,i.d.Buffer.from(e)])}(e)}return r((s=e).length),s.forEach(n),t;var s}function Os(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;const n=Qi.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=e,s=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const e=i.__NON_WITNESS_UTXO_BUF_CACHE[s],t=i.__NON_WITNESS_UTXO_TX_CACHE[s];if(void 0!==e)return e;{const e=t.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[s]=e,e}},set(e){i.__NON_WITNESS_UTXO_BUF_CACHE[s]=e}})}function ks(e,t,r,n){let i=0;e.forEach(((e,s)=>{if(n&&e.finalScriptSig&&(t.ins[s].script=e.finalScriptSig),n&&e.finalScriptWitness&&(t.ins[s].witness=vs(e.finalScriptWitness)),e.witnessUtxo)i+=e.witnessUtxo.value;else if(e.nonWitnessUtxo){const n=Bs(r,e,s),o=t.ins[s].index,u=n.outs[o];i+=u.value}}));const s=t.outs.reduce(((e,t)=>e+t.value),0),o=i-s;if(o<0)throw new Error("Outputs are spending more than Inputs");const u=t.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(o/u)}function Bs(e,t,r){const n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Os(e,t,r),n[r]}function As(e,t,r){if(void 0!==t.witnessUtxo)return t.witnessUtxo.script;if(void 0!==t.nonWitnessUtxo)return Bs(r,t,e).outs[r.__TX.ins[e].index].script;throw new Error("Can't find pubkey in input without Utxo data")}function Ns(e){return 33===e.length&&zi.isCanonicalPubKey(e)}function xs(e,t,r,n,i){const s=fs(e),o=s&&n&&ps(n),u=ps(e);if(s&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||o)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let a;return o?(a=i,ms(t,e,n,r),Es(t,n,i,r),Us(a)):u?(a=i,Es(t,e,i,r),Us(a)):s?(a=n,ms(t,e,n,r)):a=e,{meaningfulScript:a,type:o?"p2sh-p2wsh":s?"p2sh":u?"p2wsh":"raw"}}function Us(e){if(cs(e)||fs(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Rs(e,t){const r=Xi.hash160(e),n=zi.decompile(t);if(null===n)throw new Error("Unknown script error");return n.some((t=>"number"!=typeof t&&(t.equals(e)||t.equals(r))))}function Cs(e){return cs(e)?"witnesspubkeyhash":as(e)?"pubkeyhash":os(e)?"multisig":us(e)?"pubkey":"nonstandard"}function Hs(e){return[...Array(e).keys()]}var Ms={},Ks={},Ds={},Ls={};Object.defineProperty(Ls,"__esModule",{value:!0});const Vs=pe,Gs=pe;function Ws(e){return e===Gs.OPS.OP_0||Vs.isCanonicalScriptSignature(e)}function Fs(e,t){const r=Vs.decompile(e);return!(r.length<2||r[0]!==Gs.OPS.OP_0)&&(t?r.slice(1).every(Ws):r.slice(1).every(Vs.isCanonicalScriptSignature))}Ls.check=Fs,Fs.toJSON=()=>"multisig input";var qs={};Object.defineProperty(qs,"__esModule",{value:!0});const js=pe,Xs=pe,$s=le,Ys=Xs.OPS.OP_RESERVED;function zs(e,t){const r=js.decompile(e);if(r.length<4||r[r.length-1]!==Xs.OPS.OP_CHECKMULTISIG||!$s.Number(r[0])||!$s.Number(r[r.length-2]))return!1;const n=r[0]-Ys,i=r[r.length-2]-Ys;return!(n<=0||i>16||n>i||i!==r.length-3)&&(!!t||r.slice(1,-2).every(js.isCanonicalPubKey))}qs.check=zs,zs.toJSON=()=>"multi-sig output",Object.defineProperty(Ds,"__esModule",{value:!0});const Qs=Ls;Ds.input=Qs;const Js=qs;Ds.output=Js;var Zs={};Object.defineProperty(Zs,"__esModule",{value:!0});const eo=pe,to=eo.OPS;function ro(e){const t=eo.compile(e);return t.length>1&&t[0]===to.OP_RETURN}Zs.check=ro,ro.toJSON=()=>"null data output";const no={check:ro};Zs.output=no;var io={},so={};Object.defineProperty(so,"__esModule",{value:!0});const oo=pe;function uo(e){const t=oo.decompile(e);return 1===t.length&&oo.isCanonicalScriptSignature(t[0])}so.check=uo,uo.toJSON=()=>"pubKey input";var ao={};Object.defineProperty(ao,"__esModule",{value:!0});const co=pe,po=pe;function fo(e){const t=co.decompile(e);return 2===t.length&&co.isCanonicalPubKey(t[0])&&t[1]===po.OPS.OP_CHECKSIG}ao.check=fo,fo.toJSON=()=>"pubKey output",Object.defineProperty(io,"__esModule",{value:!0});const ho=so;io.input=ho;const lo=ao;io.output=lo;var wo={},go={};Object.defineProperty(go,"__esModule",{value:!0});const yo=pe;function mo(e){const t=yo.decompile(e);return 2===t.length&&yo.isCanonicalScriptSignature(t[0])&&yo.isCanonicalPubKey(t[1])}go.check=mo,mo.toJSON=()=>"pubKeyHash input";var Eo={};Object.defineProperty(Eo,"__esModule",{value:!0});const So=pe,_o=pe;function Io(e){const t=So.compile(e);return 25===t.length&&t[0]===_o.OPS.OP_DUP&&t[1]===_o.OPS.OP_HASH160&&20===t[2]&&t[23]===_o.OPS.OP_EQUALVERIFY&&t[24]===_o.OPS.OP_CHECKSIG}Eo.check=Io,Io.toJSON=()=>"pubKeyHash output",Object.defineProperty(wo,"__esModule",{value:!0});const To=go;wo.input=To;const bo=Eo;wo.output=bo;var vo={},Po={},Oo={};Object.defineProperty(Oo,"__esModule",{value:!0});const ko=pe,Bo=pe;function Ao(e){const t=ko.compile(e);return 22===t.length&&t[0]===Bo.OPS.OP_0&&20===t[1]}Oo.check=Ao,Ao.toJSON=()=>"Witness pubKeyHash output";var No={};Object.defineProperty(No,"__esModule",{value:!0});const xo=pe,Uo=pe;function Ro(e){const t=xo.compile(e);return 34===t.length&&t[0]===Uo.OPS.OP_0&&32===t[1]}No.check=Ro,Ro.toJSON=()=>"Witness scriptHash output",Object.defineProperty(Po,"__esModule",{value:!0});const Co=pe,Ho=Ds,Mo=io,Ko=wo,Do=Oo,Lo=No;function Vo(e,t){const r=Co.decompile(e);if(r.length<1)return!1;const n=r[r.length-1];if(!i.d.Buffer.isBuffer(n))return!1;const s=Co.decompile(Co.compile(r.slice(0,-1))),o=Co.decompile(n);return!(!o||!Co.isPushOnly(s))&&(1===r.length?Lo.check(o)||Do.check(o):!!(Ko.input.check(s)&&Ko.output.check(o)||Ho.input.check(s,t)&&Ho.output.check(o)||Mo.input.check(s)&&Mo.output.check(o)))}Po.check=Vo,Vo.toJSON=()=>"scriptHash input";var Go={};Object.defineProperty(Go,"__esModule",{value:!0});const Wo=pe,Fo=pe;function qo(e){const t=Wo.compile(e);return 23===t.length&&t[0]===Fo.OPS.OP_HASH160&&20===t[1]&&t[22]===Fo.OPS.OP_EQUAL}Go.check=qo,qo.toJSON=()=>"scriptHash output",Object.defineProperty(vo,"__esModule",{value:!0});const jo=Po;vo.input=jo;const Xo=Go;vo.output=Xo;var $o={},Yo={};Object.defineProperty(Yo,"__esModule",{value:!0});const zo=pe,Qo=pe,Jo=le,Zo=i.a4,eu=i.d.Buffer.from("aa21a9ed","hex");function tu(e){const t=zo.compile(e);return t.length>37&&t[0]===Qo.OPS.OP_RETURN&&36===t[1]&&t.slice(2,6).equals(eu)}Yo.check=tu,tu.toJSON=()=>"Witness commitment output",Yo.encode=function(e){Zo(Jo.Hash256bit,e);const t=i.d.Buffer.allocUnsafe(36);return eu.copy(t,0),e.copy(t,4),zo.compile([Qo.OPS.OP_RETURN,t])},Yo.decode=function(e){return Zo(tu,e),zo.decompile(e)[1].slice(4,36)},Object.defineProperty($o,"__esModule",{value:!0});const ru=Yo;$o.output=ru;var nu={},iu={};Object.defineProperty(iu,"__esModule",{value:!0});const su=pe;function ou(e){const t=su.decompile(e);return 2===t.length&&su.isCanonicalScriptSignature(t[0])&&function(e){return su.isCanonicalPubKey(e)&&33===e.length}(t[1])}iu.check=ou,ou.toJSON=()=>"witnessPubKeyHash input",Object.defineProperty(nu,"__esModule",{value:!0});const uu=iu;nu.input=uu;const au=Oo;nu.output=au;var cu={},pu={};Object.defineProperty(pu,"__esModule",{value:!0});const fu=pe,hu=i.a4,lu=Ds,du=io,wu=wo;function gu(e,t){if(hu(hu.Array,e),e.length<1)return!1;const r=e[e.length-1];if(!i.d.Buffer.isBuffer(r))return!1;const n=fu.decompile(r);if(!n||0===n.length)return!1;const s=fu.compile(e.slice(0,-1));return!!(wu.input.check(s)&&wu.output.check(n)||lu.input.check(s,t)&&lu.output.check(n)||du.input.check(s)&&du.output.check(n))}pu.check=gu,gu.toJSON=()=>"witnessScriptHash input",Object.defineProperty(cu,"__esModule",{value:!0});const yu=pu;cu.input=yu;const mu=No;cu.output=mu,Object.defineProperty(Ks,"__esModule",{value:!0});const Eu=pe,Su=Ds,_u=Zs,Iu=io,Tu=wo,bu=vo,vu=$o,Pu=nu,Ou=cu,ku={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};Ks.types=ku,Ks.output=function(e){if(Pu.output.check(e))return ku.P2WPKH;if(Ou.output.check(e))return ku.P2WSH;if(Tu.output.check(e))return ku.P2PKH;if(bu.output.check(e))return ku.P2SH;const t=Eu.decompile(e);if(!t)throw new TypeError("Invalid script");return Su.output.check(t)?ku.P2MS:Iu.output.check(t)?ku.P2PK:vu.output.check(t)?ku.WITNESS_COMMITMENT:_u.output.check(t)?ku.NULLDATA:ku.NONSTANDARD},Ks.input=function(e,t){const r=Eu.decompile(e);if(!r)throw new TypeError("Invalid script");return Tu.input.check(r)?ku.P2PKH:bu.input.check(r,t)?ku.P2SH:Su.input.check(r,t)?ku.P2MS:Iu.input.check(r)?ku.P2PK:ku.NONSTANDARD},Ks.witness=function(e,t){const r=Eu.decompile(e);if(!r)throw new TypeError("Invalid script");return Pu.input.check(r)?ku.P2WPKH:Ou.input.check(r,t)?ku.P2WSH:ku.NONSTANDARD},Object.defineProperty(Ms,"__esModule",{value:!0});const Bu=oe,Au=dr,Nu=Ks,xu=et,Uu=nr,Ru=ue,Cu=ae,Hu=pe,Mu=pe,Ku=_r,Du=le,Lu=i.a4,Vu=Nu.types,Gu=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function Wu(e,t,r){try{Lu(e,t)}catch{throw new Error(r)}}class Fu{constructor(e=Ru.bitcoin,t=2500){this.network=e,this.maximumFeeRate=t,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new Ku.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(e,t){const r=new Fu(t);return r.setVersion(e.version),r.setLockTime(e.locktime),e.outs.forEach((e=>{r.addOutput(e.script,e.value)})),e.ins.forEach((e=>{r.__addInputUnsafe(e.hash,e.index,{sequence:e.sequence,script:e.script,witness:e.witness})})),r.__INPUTS.forEach(((t,r)=>{!function(e,t,r){if(e.redeemScriptType!==Vu.P2MS||!e.redeemScript||e.pubkeys.length===e.signatures.length)return;const n=e.signatures.concat();e.signatures=e.pubkeys.map((i=>{const s=Uu.fromPublicKey(i);let o;return n.some(((i,u)=>{if(!i)return!1;const a=Hu.signature.decode(i),c=t.hashForSignature(r,e.redeemScript,a.hashType);return!!s.verify(c,a.signature)&&(n[u]=void 0,o=i,!0)})),o}))}(t,e,r)})),r}setLowR(e){return Lu(Lu.maybe(Lu.Boolean),e),void 0===e&&(e=!0),this.__USE_LOW_R=e,e}setLockTime(e){if(Lu(Du.UInt32,e),this.__INPUTS.some((e=>!!e.signatures&&e.signatures.some((e=>void 0!==e)))))throw new Error("No, this would invalidate signatures");this.__TX.locktime=e}setVersion(e){Lu(Du.UInt32,e),this.__TX.version=e}addInput(e,t,r,n){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let s;if("string"==typeof(o=e)||o instanceof String)e=Au.reverseBuffer(i.d.Buffer.from(e,"hex"));else if(function(e){return e instanceof Ku.Transaction}(e)){const r=e.outs[t];n=r.script,s=r.value,e=e.getHash(!1)}var o;return this.__addInputUnsafe(e,t,{sequence:r,prevOutScript:n,value:s})}addOutput(e,t){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return"string"==typeof e&&(e=Bu.toOutputScript(e,this.network)),this.__TX.addOutput(e,t)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(e,t,r,n,i,s){!function({input:e,ourPubKey:t,keyPair:r,signatureHash:n,hashType:i,useLowR:s}){let o=!1;for(const[u,a]of e.pubkeys.entries()){if(!t.equals(a))continue;if(e.signatures[u])throw new Error("Signature already exists");if(33!==t.length&&e.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");const c=r.sign(n,s);e.signatures[u]=Hu.signature.encode(c,i),o=!0}if(!o)throw new Error("Key pair cannot sign for this input")}(function(e,t,r,n,i,s,o,u,a,c,p){let f;if("number"==typeof i)console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),f=i;else{if("object"!=typeof i)throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");(function(e,t){if(!Gu.has(t.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${t.prevOutScriptType}"`);Wu(Lu.Number,t.vin,"sign must include vin parameter as Number (input index)"),Wu(Du.Signer,t.keyPair,"sign must include keyPair parameter as Signer interface"),Wu(Lu.maybe(Lu.Number),t.hashType,"sign hashType parameter must be a number");const r=(e[t.vin]||[]).prevOutType,n=t.prevOutScriptType;switch(n){case"p2pkh":if(r&&"pubkeyhash"!==r)throw new TypeError(`input #${t.vin} is not of type p2pkh: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),Wu(Lu.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2pk":if(r&&"pubkey"!==r)throw new TypeError(`input #${t.vin} is not of type p2pk: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),Wu(Lu.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wpkh":if(r&&"witnesspubkeyhash"!==r)throw new TypeError(`input #${t.vin} is not of type p2wpkh: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),Wu(Du.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2ms":if(r&&"multisig"!==r)throw new TypeError(`input #${t.vin} is not of type p2ms: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),Wu(Lu.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${t.vin} is not of type p2sh-p2wpkh: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.Buffer,t.redeemScript,`${n} requires redeemScript`),Wu(Du.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);Wu(Lu.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),Wu(Lu.Buffer,t.redeemScript,`${n} requires redeemScript`),Wu(Lu.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(r&&"witnessscripthash"!==r)throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);Wu(Lu.Buffer,t.witnessScript,`${n} requires witnessScript`),Wu(Lu.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),Wu(Du.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);Wu(Lu.Buffer,t.witnessScript,`${n} requires witnessScript`),Wu(Lu.Buffer,t.redeemScript,`${n} requires witnessScript`),Wu(Du.Satoshi,t.witnessValue,`${n} requires witnessScript`)}})(t,i),({vin:f,keyPair:s,redeemScript:o,hashType:u,witnessValue:a,witnessScript:c}=i)}if(void 0===s)throw new Error("sign requires keypair");if(s.network&&s.network!==e)throw new TypeError("Inconsistent network");if(!t[f])throw new Error("No input at index: "+f);if(u=u||Ku.Transaction.SIGHASH_ALL,r(u))throw new Error("Transaction needs outputs");const h=t[f];if(void 0!==h.redeemScript&&o&&!h.redeemScript.equals(o))throw new Error("Inconsistent redeemScript");const l=s.publicKey||s.getPublicKey&&s.getPublicKey();if(!$u(h)){if(void 0!==a){if(void 0!==h.value&&h.value!==a)throw new Error("Input did not match witnessValue");Lu(Du.Satoshi,a),h.value=a}if(!$u(h)){const e=function(e,t,r,n){if(r&&n){const i=Cu.p2wsh({redeem:{output:n}}),s=Cu.p2wsh({output:r}),o=Cu.p2sh({redeem:{output:r}}),u=Cu.p2sh({redeem:i});if(!i.hash.equals(s.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!o.hash.equals(u.hash))throw new Error("Redeem script inconsistent with prevOutScript");const a=ju(i.redeem.output,t);if(!a.pubkeys)throw new Error(a.type+" not supported as witnessScript ("+Hu.toASM(n)+")");e.signatures&&e.signatures.some((e=>void 0!==e))&&(a.signatures=e.signatures);const c=n;if(a.type===Vu.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:r,redeemScriptType:Vu.P2WSH,witnessScript:n,witnessScriptType:a.type,prevOutType:Vu.P2SH,prevOutScript:o.output,hasWitness:!0,signScript:c,signType:a.type,pubkeys:a.pubkeys,signatures:a.signatures,maxSignatures:a.maxSignatures}}if(r){const n=Cu.p2sh({redeem:{output:r}});if(e.prevOutScript){let t;try{t=Cu.p2sh({output:e.prevOutScript})}catch{throw new Error("PrevOutScript must be P2SH")}if(!n.hash.equals(t.hash))throw new Error("Redeem script inconsistent with prevOutScript")}const i=ju(n.redeem.output,t);if(!i.pubkeys)throw new Error(i.type+" not supported as redeemScript ("+Hu.toASM(r)+")");e.signatures&&e.signatures.some((e=>void 0!==e))&&(i.signatures=e.signatures);let s=r;return i.type===Vu.P2WPKH&&(s=Cu.p2pkh({pubkey:i.pubkeys[0]}).output),{redeemScript:r,redeemScriptType:i.type,prevOutType:Vu.P2SH,prevOutScript:n.output,hasWitness:i.type===Vu.P2WPKH,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(n){const r=Cu.p2wsh({redeem:{output:n}});if(e.prevOutScript){const t=Cu.p2wsh({output:e.prevOutScript});if(!r.hash.equals(t.hash))throw new Error("Witness script inconsistent with prevOutScript")}const i=ju(r.redeem.output,t);if(!i.pubkeys)throw new Error(i.type+" not supported as witnessScript ("+Hu.toASM(n)+")");e.signatures&&e.signatures.some((e=>void 0!==e))&&(i.signatures=e.signatures);const s=n;if(i.type===Vu.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:n,witnessScriptType:i.type,prevOutType:Vu.P2WSH,prevOutScript:r.output,hasWitness:!0,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(e.prevOutType&&e.prevOutScript){if(e.prevOutType===Vu.P2SH)throw new Error("PrevOutScript is "+e.prevOutType+", requires redeemScript");if(e.prevOutType===Vu.P2WSH)throw new Error("PrevOutScript is "+e.prevOutType+", requires witnessScript");if(!e.prevOutScript)throw new Error("PrevOutScript is missing");const r=ju(e.prevOutScript,t);if(!r.pubkeys)throw new Error(r.type+" not supported ("+Hu.toASM(e.prevOutScript)+")");e.signatures&&e.signatures.some((e=>void 0!==e))&&(r.signatures=e.signatures);let n=e.prevOutScript;return r.type===Vu.P2WPKH&&(n=Cu.p2pkh({pubkey:r.pubkeys[0]}).output),{prevOutType:r.type,prevOutScript:e.prevOutScript,hasWitness:r.type===Vu.P2WPKH,signScript:n,signType:r.type,pubkeys:r.pubkeys,signatures:r.signatures,maxSignatures:r.maxSignatures}}const i=Cu.p2pkh({pubkey:t}).output;return{prevOutType:Vu.P2PKH,prevOutScript:i,hasWitness:!1,signScript:i,signType:Vu.P2PKH,pubkeys:[t],signatures:[void 0]}}(h,l,o,c);Object.assign(h,e)}if(!$u(h))throw Error(h.prevOutType+" not supported")}let d;return d=h.hasWitness?n.hashForWitnessV0(f,h.signScript,h.value,u):n.hashForSignature(f,h.signScript,u),{input:h,ourPubKey:l,keyPair:s,signatureHash:d,hashType:u,useLowR:!!p}}(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,e,t,r,n,i,s,this.__USE_LOW_R))}__addInputUnsafe(e,t,r){if(Ku.Transaction.isCoinbaseHash(e))throw new Error("coinbase inputs not supported");const n=e.toString("hex")+":"+t;if(void 0!==this.__PREV_TX_SET[n])throw new Error("Duplicate TxOut: "+n);let i={};if(void 0!==r.script&&(i=qu(r.script,r.witness||[])),void 0!==r.value&&(i.value=r.value),!i.prevOutScript&&r.prevOutScript){let e;if(!i.pubkeys&&!i.signatures){const t=ju(r.prevOutScript);t.pubkeys&&(i.pubkeys=t.pubkeys,i.signatures=t.signatures),e=t.type}i.prevOutScript=r.prevOutScript,i.prevOutType=e||Nu.output(r.prevOutScript)}const s=this.__TX.addInput(e,t,r.sequence,r.scriptSig);return this.__INPUTS[s]=i,this.__PREV_TX_SET[n]=!0,s}__build(e){if(!e){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}const t=this.__TX.clone();if(this.__INPUTS.forEach(((r,n)=>{if(!r.prevOutType&&!e)throw new Error("Transaction is not complete");const i=Xu(r.prevOutType,r,e);if(i)t.setInputScript(n,i.input),t.setWitness(n,i.witness);else{if(!e&&r.prevOutType===Vu.NONSTANDARD)throw new Error("Unknown input type");if(!e)throw new Error("Not enough information")}})),!e&&this.__overMaximumFees(t.virtualSize()))throw new Error("Transaction has absurd fees");return t}__canModifyInputs(){return this.__INPUTS.every((e=>!e.signatures||e.signatures.every((e=>!e||0!==(Yu(e)&Ku.Transaction.SIGHASH_ANYONECANPAY)))))}__needsOutputs(e){return e===Ku.Transaction.SIGHASH_ALL?0===this.__TX.outs.length:0===this.__TX.outs.length&&this.__INPUTS.some((e=>!!e.signatures&&e.signatures.some((e=>!(!e||Yu(e)&Ku.Transaction.SIGHASH_NONE)))))}__canModifyOutputs(){const e=this.__TX.ins.length,t=this.__TX.outs.length;return this.__INPUTS.every((r=>void 0===r.signatures||r.signatures.every((r=>{if(!r)return!0;const n=31&Yu(r);return n===Ku.Transaction.SIGHASH_NONE||n===Ku.Transaction.SIGHASH_SINGLE&&e<=t}))))}__overMaximumFees(e){return(this.__INPUTS.reduce(((e,t)=>e+(t.value>>>0)),0)-this.__TX.outs.reduce(((e,t)=>e+t.value),0))/e>this.maximumFeeRate}}function qu(e,t,r,n){if(0===e.length&&0===t.length)return{};if(!r){let n=Nu.input(e,!0),i=Nu.witness(t,!0);n===Vu.NONSTANDARD&&(n=void 0),i===Vu.NONSTANDARD&&(i=void 0),r=n||i}switch(r){case Vu.P2WPKH:{const{output:e,pubkey:r,signature:n}=Cu.p2wpkh({witness:t});return{prevOutScript:e,prevOutType:Vu.P2WPKH,pubkeys:[r],signatures:[n]}}case Vu.P2PKH:{const{output:t,pubkey:r,signature:n}=Cu.p2pkh({input:e});return{prevOutScript:t,prevOutType:Vu.P2PKH,pubkeys:[r],signatures:[n]}}case Vu.P2PK:{const{signature:t}=Cu.p2pk({input:e});return{prevOutType:Vu.P2PK,pubkeys:[void 0],signatures:[t]}}case Vu.P2MS:{const{m:t,pubkeys:r,signatures:i}=Cu.p2ms({input:e,output:n},{allowIncomplete:!0});return{prevOutType:Vu.P2MS,pubkeys:r,signatures:i,maxSignatures:t}}}if(r===Vu.P2SH){const{output:r,redeem:n}=Cu.p2sh({input:e,witness:t}),i=Nu.output(n.output),s=qu(n.input,n.witness,i,n.output);return s.prevOutType?{prevOutScript:r,prevOutType:Vu.P2SH,redeemScript:n.output,redeemScriptType:s.prevOutType,witnessScript:s.witnessScript,witnessScriptType:s.witnessScriptType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}if(r===Vu.P2WSH){const{output:r,redeem:n}=Cu.p2wsh({input:e,witness:t}),i=Nu.output(n.output);let s;return s=i===Vu.P2WPKH?qu(n.input,n.witness,i):qu(Hu.compile(n.witness),[],i,n.output),s.prevOutType?{prevOutScript:r,prevOutType:Vu.P2WSH,witnessScript:n.output,witnessScriptType:s.prevOutType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}return{prevOutType:Vu.NONSTANDARD,prevOutScript:e}}function ju(e,t){Lu(Du.Buffer,e);const r=Nu.output(e);switch(r){case Vu.P2PKH:{if(!t)return{type:r};const n=Cu.p2pkh({output:e}).hash,i=xu.hash160(t);return n.equals(i)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case Vu.P2WPKH:{if(!t)return{type:r};const n=Cu.p2wpkh({output:e}).hash,i=xu.hash160(t);return n.equals(i)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case Vu.P2PK:return{type:r,pubkeys:[Cu.p2pk({output:e}).pubkey],signatures:[void 0]};case Vu.P2MS:{const t=Cu.p2ms({output:e});return{type:r,pubkeys:t.pubkeys,signatures:t.pubkeys.map((()=>{})),maxSignatures:t.m}}}return{type:r}}function Xu(e,t,r){const n=t.pubkeys||[];let i=t.signatures||[];switch(e){case Vu.P2PKH:if(0===n.length||0===i.length)break;return Cu.p2pkh({pubkey:n[0],signature:i[0]});case Vu.P2WPKH:if(0===n.length||0===i.length)break;return Cu.p2wpkh({pubkey:n[0],signature:i[0]});case Vu.P2PK:if(0===n.length||0===i.length)break;return Cu.p2pk({signature:i[0]});case Vu.P2MS:{const e=t.maxSignatures;i=r?i.map((e=>e||Mu.OPS.OP_0)):i.filter((e=>e));const s=!r||e===i.length;return Cu.p2ms({m:e,pubkeys:n,signatures:i},{allowIncomplete:r,validate:s})}case Vu.P2SH:{const e=Xu(t.redeemScriptType,t,r);return e?Cu.p2sh({redeem:{output:e.output||t.redeemScript,input:e.input,witness:e.witness}}):void 0}case Vu.P2WSH:{const e=Xu(t.witnessScriptType,t,r);return e?Cu.p2wsh({redeem:{output:t.witnessScript,input:e.input,witness:e.witness}}):void 0}}}function $u(e){return void 0!==e.signScript&&void 0!==e.signType&&void 0!==e.pubkeys&&void 0!==e.signatures&&e.signatures.length===e.pubkeys.length&&e.pubkeys.length>0&&(!1===e.hasWitness||void 0!==e.value)}function Yu(e){return e.readUInt8(e.length-1)}Ms.TransactionBuilder=Fu,Object.defineProperty(u,"__esModule",{value:!0});const zu=a;u.bip32=zu;const Qu=oe;u.address=Qu;const Ju=et;var Zu=u.crypto=Ju;const ea=nr;u.ECPair=ea;const ta=ue;u.networks=ta;const ra=ae;u.payments=ra;const na=pe;u.script=na;var ia=lr;u.Block=ia.Block;var sa=$r;u.Psbt=sa.Psbt;var oa=pe;u.opcodes=oa.OPS;var ua=_r;u.Transaction=ua.Transaction;var aa=Ms;function ca(e){const t=i.d.Buffer.alloc(1+4*e.length);return t[0]=e.length,e.forEach(((e,r)=>{t.writeUInt32BE(e,1+4*r)})),t}function pa(e){return ca(e?ha(e):[])}function fa(e){return s.b.fromPathArray(e).toString()}function ha(e){return s.b.fromString(e).toPathArray()}function la(e){const t=i.ac.decode(e);return t.slice(t.length-33)}function da(e){const t=i.ac.decode(e);return{chaincode:t.slice(13,45),pubkey:t.slice(t.length-33),version:t.readUInt32BE(0)}}function wa(e){if(e>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");const t=i.d.Buffer.alloc(8,0);for(let r=0;r<t.length;r++){const n=255&e;t[r]=n,e=(e-n)/256}return t}function ga(e){let t=0;if(8!=e.length)throw new Error("Expected Bufffer of lenght 8");if(0!=e[7])throw new Error("Can't encode numbers > MAX_SAFE_INT");if(e[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let r=e.length-1;r>=0;r--)t=256*t+e[r];return t}u.TransactionBuilder=aa.TransactionBuilder;class ya{constructor(){this.bufs=[]}write(e,t){const r=i.d.Buffer.alloc(e);t(r),this.bufs.push(r)}writeUInt8(e){this.write(1,(t=>t.writeUInt8(e,0)))}writeInt32(e){this.write(4,(t=>t.writeInt32LE(e,0)))}writeUInt32(e){this.write(4,(t=>t.writeUInt32LE(e,0)))}writeUInt64(e){const t=wa(e);this.writeSlice(t)}writeVarInt(e){this.bufs.push(i.ad.encode(e))}writeSlice(e){this.bufs.push(i.d.Buffer.from(e))}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}buffer(){return i.d.Buffer.concat(this.bufs)}}class ma{constructor(e,t=0){this.buffer=e,this.offset=t}available(){return this.buffer.length-this.offset}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){return ga(this.readSlice(8))}readVarInt(){const e=i.ad.decode(this.buffer,this.offset);return this.offset+=i.ad.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}}const Ea=50,Sa=4294967295;function _a(e){return(new i.ae).update((0,i.af)("sha256").update(e).digest()).digest()}class Ia{constructor(e,t){this.psbt=e,this.masterFp=t}}class Ta extends Ia{spendingCondition(e){if(1!=e.length)throw new Error("Expected single key, got "+e.length);return this.singleKeyCondition(e[0])}setInput(e,t,r,n,i){if(1!=n.length)throw new Error("Expected single key, got "+n.length);if(1!=i.length)throw new Error("Expected single path, got "+i.length);this.setSingleKeyInput(e,t,r,n[0],i[0])}setOwnOutput(e,t,r,n){if(1!=r.length)throw new Error("Expected single key, got "+r.length);if(1!=n.length)throw new Error("Expected single path, got "+n.length);this.setSingleKeyOutput(e,t,r[0],n[0])}}class ba extends Ta{singleKeyCondition(e){const t=new ya,r=_a(e);return t.writeSlice(i.d.Buffer.from([118,169,20])),t.writeSlice(r),t.writeSlice(i.d.Buffer.from([136,172])),{scriptPubKey:t.buffer()}}setSingleKeyInput(e,t,r,n,i){if(!t)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,t),this.psbt.setInputBip32Derivation(e,n,this.masterFp,i)}setSingleKeyOutput(e,t,r,n){this.psbt.setOutputBip32Derivation(e,r,this.masterFp,n)}getDescriptorTemplate(){return"pkh(@0)"}}class va extends Ta{singleKeyCondition(e){const t=e.slice(1),r=new ya,n=this.getTaprootOutputKey(t);return r.writeSlice(i.d.Buffer.from([81,32])),r.writeSlice(n),{scriptPubKey:r.buffer()}}setSingleKeyInput(e,t,r,n,i){const s=n.slice(1);this.psbt.setInputTapBip32Derivation(e,s,[],this.masterFp,i),this.psbt.setInputWitnessUtxo(e,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(e,t,r,n){const i=r.slice(1);this.psbt.setOutputTapBip32Derivation(e,i,[],this.masterFp,n)}getDescriptorTemplate(){return"tr(@0)"}hashTapTweak(e){const t=Zu.sha256(i.d.Buffer.from("TapTweak","utf-8"));return Zu.sha256(i.d.Buffer.concat([t,t,e]))}getTaprootOutputKey(e){if(32!=e.length)throw new Error("Expected 32 byte pubkey. Got "+e.length);const t=i.d.Buffer.concat([i.d.Buffer.from([2]),e]),r=this.hashTapTweak(e);return i.d.Buffer.from(G.pointAddScalar(t,r)).slice(1)}}class Pa extends Ta{singleKeyCondition(e){const t=new ya,r=this.createRedeemScript(e),n=_a(r);return t.writeSlice(i.d.Buffer.from([169,20])),t.writeSlice(n),t.writeUInt8(135),{scriptPubKey:t.buffer(),redeemScript:r}}setSingleKeyInput(e,t,r,n,i){if(!t)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,t),this.psbt.setInputBip32Derivation(e,n,this.masterFp,i);const s=r.cond.redeemScript,o=this.createRedeemScript(n);if(s&&!o.equals(s))throw new Error(`User-supplied redeemScript ${s.toString("hex")} doesn't\n       match expected ${o.toString("hex")} for input ${e}`);this.psbt.setInputRedeemScript(e,o),this.psbt.setInputWitnessUtxo(e,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(e,t,r,n){this.psbt.setOutputRedeemScript(e,t.redeemScript),this.psbt.setOutputBip32Derivation(e,r,this.masterFp,n)}getDescriptorTemplate(){return"sh(wpkh(@0))"}createRedeemScript(e){const t=_a(e);return i.d.Buffer.concat([i.d.Buffer.from("0014","hex"),t])}}class Oa extends Ta{singleKeyCondition(e){const t=new ya,r=_a(e);return t.writeSlice(i.d.Buffer.from([0,20])),t.writeSlice(r),{scriptPubKey:t.buffer()}}setSingleKeyInput(e,t,r,n,i){if(!t)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,t),this.psbt.setInputBip32Derivation(e,n,this.masterFp,i),this.psbt.setInputWitnessUtxo(e,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(e,t,r,n){this.psbt.setOutputBip32Derivation(e,r,this.masterFp,n)}getDescriptorTemplate(){return"wpkh(@0)"}}class ka{constructor(e,t=Zu.sha256){this.leaves=e,this.h=t;const r=this.calculateRoot(e);this.rootNode=r.root,this.leafNodes=r.leaves}getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(e){return this.leafNodes[e].hash}getProof(e){if(e>=this.leaves.length)throw Error("Index out of bounds");return Na(this.leafNodes[e])}calculateRoot(e){const t=e.length;if(0==t)return{root:new Aa(void 0,void 0,i.d.Buffer.alloc(32,0)),leaves:[]};if(1==t){const t=new Aa(void 0,void 0,e[0]);return{root:t,leaves:[t]}}const r=function(e){if(e<2)throw Error("Expected n >= 2");return function(e){return 0==(e&e-1)}(e)?e/2:1<<Math.floor(Math.log2(e))}(t),n=this.calculateRoot(e.slice(0,r)),s=this.calculateRoot(e.slice(r)),o=n.root,u=s.root,a=this.hashNode(o.hash,u.hash),c=new Aa(o,u,a);return o.parent=c,u.parent=c,{root:c,leaves:n.leaves.concat(s.leaves)}}hashNode(e,t){return this.h(i.d.Buffer.concat([i.d.Buffer.from([1]),e,t]))}}function Ba(e,t=Zu.sha256){return function(e,t,r){return r(i.d.Buffer.concat([e,t]))}(i.d.Buffer.from([0]),e,t)}class Aa{constructor(e,t,r){this.leftChild=e,this.rightChild=t,this.hash=r}isLeaf(){return null==this.leftChild}}function Na(e){if(!e.parent)return[];if(e.parent.leftChild==e){if(!e.parent.rightChild)throw new Error("Expected right child to exist");return[e.parent.rightChild.hash,...Na(e.parent)]}if(!e.parent.leftChild)throw new Error("Expected left child to exist");return[e.parent.leftChild.hash,...Na(e.parent)]}class xa{constructor(e,t){this.descriptorTemplate=e,this.keys=[t]}getWalletId(){return Zu.sha256(this.serialize())}serialize(){const e=this.keys.map((e=>i.d.Buffer.from(e,"ascii"))),t=new ka(e.map((e=>Ba(e)))),r=new ya;return r.writeUInt8(1),r.writeUInt8(0),r.writeVarSlice(i.d.Buffer.from(this.descriptorTemplate,"ascii")),r.writeVarInt(this.keys.length),r.writeSlice(t.getRoot()),r.buffer()}}function Ua(e,t,r){const n=fa(t);return`[${e.toString("hex")}${n.substring(1)}]${r}/**`}var Ra,Ca,Ha,Ma;(Ca=Ra||(Ra={}))[Ca.TX_VERSION=2]="TX_VERSION",Ca[Ca.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",Ca[Ca.INPUT_COUNT=4]="INPUT_COUNT",Ca[Ca.OUTPUT_COUNT=5]="OUTPUT_COUNT",Ca[Ca.TX_MODIFIABLE=6]="TX_MODIFIABLE",Ca[Ca.VERSION=251]="VERSION",function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.PREVIOUS_TXID=14]="PREVIOUS_TXID",e[e.OUTPUT_INDEX=15]="OUTPUT_INDEX",e[e.SEQUENCE=16]="SEQUENCE",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"}(Ha||(Ha={})),function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",e[e.AMOUNT=3]="AMOUNT",e[e.SCRIPT=4]="SCRIPT",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"}(Ma||(Ma={}));const Ka=i.d.Buffer.from([112,115,98,116,255]);class Da extends Error{}class La{constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}setGlobalTxVersion(e){this.setGlobal(Ra.TX_VERSION,$a(e))}getGlobalTxVersion(){return this.getGlobal(Ra.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(e){this.setGlobal(Ra.FALLBACK_LOCKTIME,$a(e))}getGlobalFallbackLocktime(){var e;return null===(e=this.getGlobalOptional(Ra.FALLBACK_LOCKTIME))||void 0===e?void 0:e.readUInt32LE(0)}setGlobalInputCount(e){this.setGlobal(Ra.INPUT_COUNT,Ya(e))}getGlobalInputCount(){return za(this.getGlobal(Ra.INPUT_COUNT))}setGlobalOutputCount(e){this.setGlobal(Ra.OUTPUT_COUNT,Ya(e))}getGlobalOutputCount(){return za(this.getGlobal(Ra.OUTPUT_COUNT))}setGlobalTxModifiable(e){this.setGlobal(Ra.TX_MODIFIABLE,e)}getGlobalTxModifiable(){return this.getGlobalOptional(Ra.TX_MODIFIABLE)}setGlobalPsbtVersion(e){this.setGlobal(Ra.VERSION,$a(e))}getGlobalPsbtVersion(){return this.getGlobal(Ra.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(e,t){this.setInput(e,Ha.NON_WITNESS_UTXO,ja(),t)}getInputNonWitnessUtxo(e){return this.getInputOptional(e,Ha.NON_WITNESS_UTXO,ja())}setInputWitnessUtxo(e,t,r){const n=new ya;n.writeSlice(t),n.writeVarSlice(r),this.setInput(e,Ha.WITNESS_UTXO,ja(),n.buffer())}getInputWitnessUtxo(e){const t=this.getInputOptional(e,Ha.WITNESS_UTXO,ja());if(!t)return;const r=new ma(t);return{amount:r.readSlice(8),scriptPubKey:r.readVarSlice()}}setInputPartialSig(e,t,r){this.setInput(e,Ha.PARTIAL_SIG,t,r)}getInputPartialSig(e,t){return this.getInputOptional(e,Ha.PARTIAL_SIG,t)}setInputSighashType(e,t){this.setInput(e,Ha.SIGHASH_TYPE,ja(),$a(t))}getInputSighashType(e){const t=this.getInputOptional(e,Ha.SIGHASH_TYPE,ja());if(t)return t.readUInt32LE(0)}setInputRedeemScript(e,t){this.setInput(e,Ha.REDEEM_SCRIPT,ja(),t)}getInputRedeemScript(e){return this.getInputOptional(e,Ha.REDEEM_SCRIPT,ja())}setInputBip32Derivation(e,t,r,n){if(33!=t.length)throw new Error("Invalid pubkey length: "+t.length);this.setInput(e,Ha.BIP32_DERIVATION,t,this.encodeBip32Derivation(r,n))}getInputBip32Derivation(e,t){const r=this.getInputOptional(e,Ha.BIP32_DERIVATION,t);if(r)return this.decodeBip32Derivation(r)}setInputFinalScriptsig(e,t){this.setInput(e,Ha.FINAL_SCRIPTSIG,ja(),t)}getInputFinalScriptsig(e){return this.getInputOptional(e,Ha.FINAL_SCRIPTSIG,ja())}setInputFinalScriptwitness(e,t){this.setInput(e,Ha.FINAL_SCRIPTWITNESS,ja(),t)}getInputFinalScriptwitness(e){return this.getInput(e,Ha.FINAL_SCRIPTWITNESS,ja())}setInputPreviousTxId(e,t){this.setInput(e,Ha.PREVIOUS_TXID,ja(),t)}getInputPreviousTxid(e){return this.getInput(e,Ha.PREVIOUS_TXID,ja())}setInputOutputIndex(e,t){this.setInput(e,Ha.OUTPUT_INDEX,ja(),$a(t))}getInputOutputIndex(e){return this.getInput(e,Ha.OUTPUT_INDEX,ja()).readUInt32LE(0)}setInputSequence(e,t){this.setInput(e,Ha.SEQUENCE,ja(),$a(t))}getInputSequence(e){var t,r;return null!==(r=null===(t=this.getInputOptional(e,Ha.SEQUENCE,ja()))||void 0===t?void 0:t.readUInt32LE(0))&&void 0!==r?r:4294967295}setInputTapKeySig(e,t){this.setInput(e,Ha.TAP_KEY_SIG,ja(),t)}getInputTapKeySig(e){return this.getInputOptional(e,Ha.TAP_KEY_SIG,ja())}setInputTapBip32Derivation(e,t,r,n,i){if(32!=t.length)throw new Error("Invalid pubkey length: "+t.length);const s=this.encodeTapBip32Derivation(r,n,i);this.setInput(e,Ha.TAP_BIP32_DERIVATION,t,s)}getInputTapBip32Derivation(e,t){const r=this.getInput(e,Ha.TAP_BIP32_DERIVATION,t);return this.decodeTapBip32Derivation(r)}getInputKeyDatas(e,t){return this.getKeyDatas(this.inputMaps[e],t)}setOutputRedeemScript(e,t){this.setOutput(e,Ma.REDEEM_SCRIPT,ja(),t)}getOutputRedeemScript(e){return this.getOutput(e,Ma.REDEEM_SCRIPT,ja())}setOutputBip32Derivation(e,t,r,n){this.setOutput(e,Ma.BIP_32_DERIVATION,t,this.encodeBip32Derivation(r,n))}getOutputBip32Derivation(e,t){const r=this.getOutput(e,Ma.BIP_32_DERIVATION,t);return this.decodeBip32Derivation(r)}setOutputAmount(e,t){this.setOutput(e,Ma.AMOUNT,ja(),function(e){return wa(e)}(t))}getOutputAmount(e){return ga(this.getOutput(e,Ma.AMOUNT,ja()))}setOutputScript(e,t){this.setOutput(e,Ma.SCRIPT,ja(),t)}getOutputScript(e){return this.getOutput(e,Ma.SCRIPT,ja())}setOutputTapBip32Derivation(e,t,r,n,i){const s=this.encodeTapBip32Derivation(r,n,i);this.setOutput(e,Ma.TAP_BIP32_DERIVATION,t,s)}getOutputTapBip32Derivation(e,t){const r=this.getOutput(e,Ma.TAP_BIP32_DERIVATION,t);return this.decodeTapBip32Derivation(r)}deleteInputEntries(e,t){this.inputMaps[e].forEach(((e,r,n)=>{this.isKeyType(r,t)&&n.delete(r)}))}copy(e){this.copyMap(this.globalMap,e.globalMap),this.copyMaps(this.inputMaps,e.inputMaps),this.copyMaps(this.outputMaps,e.outputMaps)}copyMaps(e,t){e.forEach(((e,r)=>{const n=new Map;this.copyMap(e,n),t[r]=n}))}copyMap(e,t){e.forEach(((e,r)=>t.set(r,i.d.Buffer.from(e))))}serialize(){const e=new ya;return e.writeSlice(i.d.Buffer.from([112,115,98,116,255])),qa(e,this.globalMap),this.inputMaps.forEach((t=>{qa(e,t)})),this.outputMaps.forEach((t=>{qa(e,t)})),e.buffer()}deserialize(e){const t=new ma(e);if(!t.readSlice(5).equals(Ka))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,t););for(let r=0;r<this.getGlobalInputCount();r++)for(this.inputMaps[r]=new Map;this.readKeyPair(this.inputMaps[r],t););for(let r=0;r<this.getGlobalOutputCount();r++)for(this.outputMaps[r]=new Map;this.readKeyPair(this.outputMaps[r],t););}readKeyPair(e,t){const r=t.readVarInt();if(0==r)return!1;return Xa(e,t.readUInt8(),t.readSlice(r-1),t.readVarSlice()),!0}getKeyDatas(e,t){const r=[];return e.forEach(((e,n)=>{this.isKeyType(n,[t])&&r.push(i.d.Buffer.from(n.substring(2),"hex"))})),r}isKeyType(e,t){const r=i.d.Buffer.from(e.substring(0,2),"hex").readUInt8(0);return t.some((e=>e==r))}setGlobal(e,t){const r=new Ga(e,i.d.Buffer.from([]));this.globalMap.set(r.toString(),t)}getGlobal(e){return Va(this.globalMap,e,ja(),!1)}getGlobalOptional(e){return Va(this.globalMap,e,ja(),!0)}setInput(e,t,r,n){Xa(this.getMap(e,this.inputMaps),t,r,n)}getInput(e,t,r){return Va(this.inputMaps[e],t,r,!1)}getInputOptional(e,t,r){return Va(this.inputMaps[e],t,r,!0)}setOutput(e,t,r,n){Xa(this.getMap(e,this.outputMaps),t,r,n)}getOutput(e,t,r){return Va(this.outputMaps[e],t,r,!1)}getMap(e,t){return t[e]?t[e]:t[e]=new Map}encodeBip32Derivation(e,t){const r=new ya;return this.writeBip32Derivation(r,e,t),r.buffer()}decodeBip32Derivation(e){const t=new ma(e);return this.readBip32Derivation(t)}writeBip32Derivation(e,t,r){e.writeSlice(t),r.forEach((t=>{e.writeUInt32(t)}))}readBip32Derivation(e){const t=e.readSlice(4),r=[];for(;e.offset<e.buffer.length;)r.push(e.readUInt32());return{masterFingerprint:t,path:r}}encodeTapBip32Derivation(e,t,r){const n=new ya;return n.writeVarInt(e.length),e.forEach((e=>{n.writeSlice(e)})),this.writeBip32Derivation(n,t,r),n.buffer()}decodeTapBip32Derivation(e){const t=new ma(e),r=t.readVarInt(),n=[];for(let s=0;s<r;s++)n.push(t.readSlice(32));const i=this.readBip32Derivation(t);return Object.assign({hashes:n},i)}}function Va(e,t,r,n){if(!e)throw Error("No such map");const s=new Ga(t,r),o=e.get(s.toString());if(!o){if(n)return;throw new Da(s.toString())}return i.d.Buffer.from(o)}class Ga{constructor(e,t){this.keyType=e,this.keyData=t}toString(){const e=new ya;return this.toBuffer(e),e.buffer().toString("hex")}serialize(e){e.writeVarInt(1+this.keyData.length),this.toBuffer(e)}toBuffer(e){e.writeUInt8(this.keyType),e.writeSlice(this.keyData)}}class Wa{constructor(e,t){this.key=e,this.value=t}serialize(e){this.key.serialize(e),e.writeVarSlice(this.value)}}function Fa(e){return new Ga(e.readUInt8(0),e.slice(1))}function qa(e,t){for(const r of t.keys()){const n=t.get(r);new Wa(Fa(i.d.Buffer.from(r,"hex")),n).serialize(e)}e.writeUInt8(0)}function ja(){return i.d.Buffer.from([])}function Xa(e,t,r,n){const i=new Ga(t,r);e.set(i.toString(),n)}function $a(e){const t=i.d.Buffer.alloc(4);return t.writeUInt32LE(e,0),t}function Ya(e){const t=new ya;return t.writeVarInt(e),t.buffer()}function za(e){return new ma(e).readVarInt()}function Qa(e,t){const r=[Ha.BIP32_DERIVATION,Ha.PARTIAL_SIG,Ha.TAP_BIP32_DERIVATION,Ha.TAP_KEY_SIG],n=!!e.getInputWitnessUtxo(t),i=!!e.getInputNonWitnessUtxo(t);n&&i&&r.push(Ha.NON_WITNESS_UTXO),e.deleteInputEntries(t,r)}function Ja(e,t){if(t.length<=75)e.writeUInt8(t.length);else if(t.length<=256)e.writeUInt8(76),e.writeUInt8(t.length);else if(t.length<=65536){e.writeUInt8(77);const r=i.d.Buffer.alloc(2);r.writeUInt16LE(t.length,0),e.writeSlice(r)}e.writeSlice(t)}function Za(e,t){if(e[t]<253)return[e[t],1];if(253===e[t])return[(e[t+2]<<8)+e[t+1],3];if(254===e[t])return[(e[t+4]<<24)+(e[t+3]<<16)+(e[t+2]<<8)+e[t+1],5];throw new Error("getVarint called with unexpected parameters")}function ec(e){if(e<253){const t=i.d.Buffer.alloc(1);return t[0]=e,t}if(e<=65535){const t=i.d.Buffer.alloc(3);return t[0]=253,t[1]=255&e,t[2]=e>>8&255,t}const t=i.d.Buffer.alloc(5);return t[0]=254,t[1]=255&e,t[2]=e>>8&255,t[3]=e>>16&255,t[4]=e>>24&255,t}function tc({outputs:e}){let t=i.d.Buffer.alloc(0);return typeof e<"u"&&(t=i.d.Buffer.concat([t,ec(e.length)]),e.forEach((e=>{t=i.d.Buffer.concat([t,e.amount,ec(e.script.length),e.script])}))),t}function rc(e,t,r,n=[]){const s=n.includes("decred"),o=n.includes("zcash"),u=n.includes("bech32");let a=i.d.Buffer.alloc(0);const c=typeof e.witness<"u"&&!t;e.inputs.forEach((e=>{a=s||u?i.d.Buffer.concat([a,e.prevout,i.d.Buffer.from([0]),e.sequence]):i.d.Buffer.concat([a,e.prevout,ec(e.script.length),e.script,e.sequence])}));let p=tc(e);return typeof e.outputs<"u"&&typeof e.locktime<"u"&&(p=i.d.Buffer.concat([p,c&&e.witness||i.d.Buffer.alloc(0),e.locktime,e.nExpiryHeight||i.d.Buffer.alloc(0),e.extraData||i.d.Buffer.alloc(0)])),o?i.d.Buffer.concat([e.version,e.nVersionGroupId||i.d.Buffer.alloc(0),i.d.Buffer.from([180,208,214,194]),e.locktime||i.d.Buffer.from([0,0,0,0]),e.nExpiryHeight||i.d.Buffer.from([0,0,0,0]),c?i.d.Buffer.from("0001","hex"):i.d.Buffer.alloc(0),ec(e.inputs.length),a,p]):i.d.Buffer.concat([e.version,r||i.d.Buffer.alloc(0),e.nVersionGroupId||i.d.Buffer.alloc(0),c?i.d.Buffer.from("0001","hex"):i.d.Buffer.alloc(0),ec(e.inputs.length),a,p])}var nc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};class ic{constructor(e){this.client=e}getWalletXpub({path:e,xpubVersion:t}){return nc(this,void 0,void 0,(function*(){const r=ha(e),n=yield this.client.getExtendedPubkey(!1,r),i=da(n);if(i.version!=t)throw new Error(`Expected xpub version ${t} doesn't match the xpub version from the device ${i.version}`);return n}))}getWalletPublicKey(e,t){var r,n;return nc(this,void 0,void 0,(function*(){if(!function(e){const t=ha(e);return!!(t.length>=3&&t.length<=5&&pc.has(t[0])&&cc.has(t[1])&&oc(t[2])&&ac(t[3])&&uc(t[4])||t.length>=4&&t.length<=6&&fc.has(t[0])&&cc.has(t[1])&&oc(t[2])&&oc(t[3])&&ac(t[4])&&uc(t[5]))}(e))throw Error(`non-standard path: ${e}`);const s=ha(e),o=yield this.client.getExtendedPubkey(!1,s),u=null!==(r=null==t?void 0:t.verify)&&void 0!==r&&r,a=yield this.getWalletAddress(s,function(e){if("legacy"==e)return"pkh(@0)";if("p2sh"==e)return"sh(wpkh(@0))";if("bech32"==e)return"wpkh(@0)";if("bech32m"==e)return"tr(@0)";throw new Error("Unsupported address format "+e)}(null!==(n=null==t?void 0:t.format)&&void 0!==n?n:"legacy"),u),c=da(o);return{publicKey:i.d.Buffer.from(G.pointCompress(c.pubkey,!1)).toString("hex"),bitcoinAddress:a,chainCode:c.chaincode.toString("hex")}}))}getWalletAddress(e,t,r){return nc(this,void 0,void 0,(function*(){const n=function(e){for(let t=e.length-1;t>=0;t--)if(e[t]>=2147483648)return e.slice(0,t+1);return[]}(e);if(n.length+2!=e.length)return"";const s=yield this.client.getExtendedPubkey(!1,n),o=yield this.client.getMasterFingerprint(),u=new xa(t,Ua(o,n,s)),a=e.slice(-2,e.length);return this.client.getWalletAddress(u,i.d.Buffer.alloc(32,0),a[0],a[1],r)}))}createPaymentTransaction(e){return nc(this,void 0,void 0,(function*(){const t=e.inputs.length;if(0==t)throw Error("No inputs");const r=new La,n=yield this.client.getMasterFingerprint(),s=function(e,t,r){return e.additionals.includes("bech32m")?new va(t,r):e.additionals.includes("bech32")?new Oa(t,r):e.segwit?new Pa(t,r):new ba(t,r)}(e,r,n);null!=e.lockTime&&r.setGlobalFallbackLocktime(e.lockTime),r.setGlobalInputCount(t),r.setGlobalPsbtVersion(2),r.setGlobalTxVersion(2);let o=0;const u=()=>{e.onDeviceStreaming&&e.onDeviceStreaming({total:2*t,index:o,progress:++o/(2*t)})};let a="",c=[];for(let i=0;i<t;i++){u();const t=ha(e.associatedKeysets[i]);""==a&&(c=t.slice(0,-2),a=yield this.client.getExtendedPubkey(!1,c)),yield this.setInput(r,i,e.inputs[i],t,s,n,e.sigHashType)}const p=i.d.Buffer.from(e.outputScriptHex,"hex"),f=new ma(p),h=f.readVarInt();r.setGlobalOutputCount(h);const l=yield this.outputScriptAt(c,s,e.changePath);let d=!l;for(let i=0;i<h;i++){const t=Number(f.readUInt64()),n=f.readVarSlice();if(r.setOutputAmount(i,t),r.setOutputScript(i,n),l&&n.equals(null==l?void 0:l.cond.scriptPubKey)){d=!0;const t=ha(e.changePath),r=l.pubkey;s.setOwnOutput(i,l.cond,[r],[t])}}if(!d)throw new Error("Change script not found among outputs! "+(null==l?void 0:l.cond.scriptPubKey.toString("hex")));const w=Ua(n,c,a),g=new xa(s.getDescriptorTemplate(),w);e.onDeviceSignatureRequested&&e.onDeviceSignatureRequested();let y=!1;return yield this.signPsbt(r,g,(()=>{y||(y=!0,e.onDeviceSignatureGranted&&e.onDeviceSignatureGranted()),u()})),function(e){const t=e.getGlobalInputCount();for(let r=0;r<t;r++){const t=e.getInputKeyDatas(r,Ha.PARTIAL_SIG),n=e.getInputTapKeySig(r);if(0==t.length&&!n)throw Error(`No signature for input ${r} present`);if(t.length>0){if(t.length>1)throw Error(`Expected exactly one signature, got ${t.length}`);if(n)throw Error("Both taproot and non-taproot signatures present.");const i=!!e.getInputWitnessUtxo(r),s=e.getInputRedeemScript(r),o=!!s,u=e.getInputPartialSig(r,t[0]);if(!u)throw new Error("Expected partial signature for input "+r);if(i){const n=new ya;if(n.writeVarInt(2),n.writeVarInt(u.length),n.writeSlice(u),n.writeVarInt(t[0].length),n.writeSlice(t[0]),e.setInputFinalScriptwitness(r,n.buffer()),o){if(!s||0==s.length)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+r);const t=new ya;t.writeUInt8(s.length),t.writeSlice(s),e.setInputFinalScriptsig(r,t.buffer())}}else{const n=new ya;Ja(n,u),Ja(n,t[0]),e.setInputFinalScriptsig(r,n.buffer())}}else{const t=e.getInputTapKeySig(r);if(!t)throw Error("No taproot signature found");if(64!=t.length&&65!=t.length)throw Error("Unexpected length of schnorr signature.");const n=new ya;n.writeVarInt(1),n.writeVarSlice(t),e.setInputFinalScriptwitness(r,n.buffer())}Qa(e,r)}}(r),function(e){var t,r;const n=new ya;n.writeUInt32(e.getGlobalTxVersion());const s=!!e.getInputWitnessUtxo(0);s&&n.writeSlice(i.d.Buffer.from([0,1]));const o=e.getGlobalInputCount();n.writeVarInt(o);const u=new ya;for(let c=0;c<o;c++)n.writeSlice(e.getInputPreviousTxid(c)),n.writeUInt32(e.getInputOutputIndex(c)),n.writeVarSlice(null!==(t=e.getInputFinalScriptsig(c))&&void 0!==t?t:i.d.Buffer.from([])),n.writeUInt32(e.getInputSequence(c)),s&&u.writeSlice(e.getInputFinalScriptwitness(c));const a=e.getGlobalOutputCount();n.writeVarInt(a);for(let i=0;i<a;i++)n.writeUInt64(e.getOutputAmount(i)),n.writeVarSlice(e.getOutputScript(i));return n.writeSlice(u.buffer()),n.writeUInt32(null!==(r=e.getGlobalFallbackLocktime())&&void 0!==r?r:0),n.buffer()}(r).toString("hex")}))}signMessage({path:e,messageHex:t}){return nc(this,void 0,void 0,(function*(){const r=ha(e),n=i.d.Buffer.from(t,"hex"),s=yield this.client.signMessage(n,r),o=i.d.Buffer.from(s,"base64");return{v:o.readUInt8()-27-4,r:o.slice(1,33).toString("hex"),s:o.slice(33,65).toString("hex")}}))}outputScriptAt(e,t,r){return nc(this,void 0,void 0,(function*(){if(!r)return;const n=ha(r);for(let t=0;t<e.length;t++)if(e[t]!=n[t])throw new Error(`Path ${r} not in account ${fa(e)}`);const i=la(yield this.client.getExtendedPubkey(!1,n));return{cond:t.spendingCondition([i]),pubkey:i}}))}setInput(e,t,r,n,s,o,u){return nc(this,void 0,void 0,(function*(){const o=r[0],a=r[1],c=r[2]?i.d.Buffer.from(r[2],"hex"):void 0,p=r[3];null!=p&&e.setInputSequence(t,p),null!=u&&e.setInputSighashType(t,u);const f=rc(o,!0),h=Zu.hash256(f),l=la(yield this.client.getExtendedPubkey(!1,n));if(!o.outputs)throw Error("Missing outputs array in transaction to sign");const d=o.outputs[a],w={cond:{scriptPubKey:d.script,redeemScript:c},amount:d.amount};s.setInput(t,f,w,[l],[n]),e.setInputPreviousTxId(t,h),e.setInputOutputIndex(t,a)}))}signPsbt(e,t,r){return nc(this,void 0,void 0,(function*(){(yield this.client.signPsbt(e,t,i.d.Buffer.alloc(32,0),r)).forEach(((t,r)=>{const n=e.getInputKeyDatas(r,Ha.BIP32_DERIVATION);let i;if(1!=n.length){if(i=e.getInputKeyDatas(r,Ha.TAP_BIP32_DERIVATION),0==i.length)throw Error(`Missing pubkey derivation for input ${r}`);e.setInputTapKeySig(r,t)}else i=n[0],e.setInputPartialSig(r,i,t)}))}))}}const sc=2147483648,oc=e=>e>=sc,uc=e=>void 0===e||e<sc,ac=e=>void 0===e||0===e||1===e,cc=new Set([0,1,88].map((e=>e+sc))),pc=new Set([44,49,84,86].map((e=>e+sc))),fc=new Set([48].map((e=>e+sc)));var hc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};const lc={legacy:0,p2sh:1,bech32:2,cashaddr:3};function dc(e,t){return hc(this,void 0,void 0,(function*(){const{path:r,verify:n,format:i}=Object.assign({verify:!1,format:"legacy"},t);if(!(i in lc))throw new Error("btc.getWalletPublicKey invalid format="+i);const s=pa(r),o=n?1:0,u=lc[i],a=yield e.send(224,64,o,u,s),c=a[0],p=a[1+c];return{publicKey:a.slice(1,1+c).toString("hex"),bitcoinAddress:a.slice(1+c+1,1+c+1+p).toString("ascii"),chainCode:a.slice(1+c+1+p,1+c+1+p+32).toString("hex")}}))}var wc=function(e,t,r,n,s,o,u,a){if("production"!==i.d.process.env.NODE_ENV&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var p=[r,n,s,o,u,a],f=0;(c=new Error(t.replace(/%s/g,(function(){return p[f++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}};const gc=(0,i.g)(wc);var yc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};function mc(e,t,r){return yc(this,void 0,void 0,(function*(){let n,s=!1;if("number"==typeof r){s=!0;const e=i.d.Buffer.alloc(4);e.writeUInt32BE(r,0),n=i.d.Buffer.concat([e,t],t.length+4)}else n=t;const o=yield e.send(224,66,s?0:128,0,n);return o.slice(0,o.length-2).toString("hex")}))}function Ec(e,t,r,n=[]){return yc(this,void 0,void 0,(function*(){const{version:s,inputs:o,outputs:u,locktime:a,nExpiryHeight:c,extraData:p}=r;if(!u||!a)throw new Error("getTrustedInput: locktime & outputs is expected");const f=n.includes("decred"),h=n.includes("stealthcoin"),l=(t,r)=>yc(this,void 0,void 0,(function*(){const n=r||i.d.Buffer.alloc(0),s=[];let o,u=0;for(;u!==t.length;){const e=t.length-u>Ea?Ea:t.length-u;u+e!==t.length?s.push(t.slice(u,u+e)):s.push(i.d.Buffer.concat([t.slice(u,u+e),n])),u+=e}0===t.length&&s.push(n);for(const t of s)o=yield mc(e,t);return o})),d=t=>mc(e,t);yield mc(e,i.d.Buffer.concat([r.version,r.timestamp||i.d.Buffer.alloc(0),r.nVersionGroupId||i.d.Buffer.alloc(0),ec(o.length)]),t);for(const t of o){const r=h&&0===i.d.Buffer.compare(s,i.d.Buffer.from([2,0,0,0])),n=f?t.tree||i.d.Buffer.from([0]):i.d.Buffer.alloc(0),o=i.d.Buffer.concat([t.prevout,n,r?i.d.Buffer.from([0]):ec(t.script.length)]);yield mc(e,o),yield f?d(i.d.Buffer.concat([t.script,t.sequence])):r?d(t.sequence):l(t.script,t.sequence)}yield mc(e,ec(u.length));for(const t of u){const r=i.d.Buffer.concat([t.amount,f?i.d.Buffer.from([0,0]):i.d.Buffer.alloc(0),ec(t.script.length),t.script]);yield mc(e,r)}const w=[];let g;if(c&&c.length>0&&w.push(c),p&&p.length>0&&w.push(p),w.length){const e=i.d.Buffer.concat(w);g=f?e:i.d.Buffer.concat([ec(e.length),e])}const y=yield l(i.d.Buffer.concat([a,g||i.d.Buffer.alloc(0)]));return gc(y,"missing result in processScriptBlocks"),y}))}var Sc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};function _c(e,t,r,n,i=!1,s=!1,o=[]){const u=o.includes("cashaddr")?3:i?o.includes("sapling")?5:s?4:2:0;return e.send(224,68,r?0:128,t?u:128,n)}function Ic(e,t,r,n,s=!1,o=!1,u=[],a=!1){return Sc(this,void 0,void 0,(function*(){let c=i.d.Buffer.concat([r.version,r.timestamp||i.d.Buffer.alloc(0),r.nVersionGroupId||i.d.Buffer.alloc(0),ec(r.inputs.length)]);yield _c(e,t,!0,c,s,o,u);let p=0;const f=u.includes("decred");for(const h of r.inputs){let r;const l=n[p].value;r=s?a&&n[p].trustedInput?i.d.Buffer.from([1,l.length]):i.d.Buffer.from([2]):n[p].trustedInput?i.d.Buffer.from([1,n[p].value.length]):i.d.Buffer.from([0]),c=i.d.Buffer.concat([r,l,f?i.d.Buffer.from([0]):i.d.Buffer.alloc(0),ec(h.script.length)]),yield _c(e,t,!1,c,s,o,u);const d=[];let w=0;if(0===h.script.length)d.push(h.sequence);else for(;w!==h.script.length;){const e=h.script.length-w>Ea?Ea:h.script.length-w;w+e!==h.script.length?d.push(h.script.slice(w,w+e)):d.push(i.d.Buffer.concat([h.script.slice(w,w+e),h.sequence])),w+=e}for(const n of d)yield _c(e,t,!1,n,s,o,u);p++}}))}function Tc(e,t,r,n=[]){if(!r)throw new Error("getTrustedInputBIP143: missing tx");if(n.includes("decred"))throw new Error("Decred does not implement BIP143");let s=(0,i.af)("sha256").update((0,i.af)("sha256").update(rc(r,!0)).digest()).digest();const o=i.d.Buffer.alloc(4);o.writeUInt32LE(t,0);const{outputs:u,locktime:a}=r;if(!u||!a)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!u[t])throw new Error("getTrustedInputBIP143: wrong index");return s=i.d.Buffer.concat([s,o,u[t].amount]),s.toString("hex")}function bc(e){const t=1&e[64]?3:2,r=i.d.Buffer.alloc(1);return r[0]=t,i.d.Buffer.concat([r,e.slice(1,33)])}function vc(e,t,r,n,s,o=[]){const u=o.includes("decred"),a=pa(t),c=i.d.Buffer.alloc(4);c.writeUInt32BE(r,0);let p=u?i.d.Buffer.concat([a,c,s||i.d.Buffer.from([0,0,0,0]),i.d.Buffer.from([n])]):i.d.Buffer.concat([a,i.d.Buffer.from([0]),c,i.d.Buffer.from([n])]);return s&&!u&&(p=i.d.Buffer.concat([p,s])),e.send(224,72,0,0,p).then((e=>e.length>0?(e[0]=48,e.slice(0,e.length-2)):e))}var Pc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};function Oc(e,t){const r=pa(t);return e.send(224,74,255,0,r)}function kc(e,t,r=[]){return Pc(this,void 0,void 0,(function*(){let n=0;if(r.includes("decred"))return e.send(224,74,128,0,t);for(;n<t.length;){const r=n+Ea>=t.length?t.length-n:Ea,i=n+r===t.length?128:0,s=t.slice(n,n+r);yield e.send(224,74,i,0,s),n+=r}}))}var Bc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};const Ac=e=>Bc(void 0,void 0,void 0,(function*(){const t=yield e.send(176,1,0,0);let r=0;const n=t[r++];gc(1===n,"getAppAndVersion: format not supported");const i=t[r++],s=t.slice(r,r+=i).toString("ascii"),o=t[r++],u=t.slice(r,r+=o).toString("ascii"),a=t[r++];return{name:s,version:u,flags:t.slice(r,r+=a)}}));var Nc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};const xc={lockTime:0,sigHashType:1,segwit:!1,additionals:[],onDeviceStreaming:e=>{},onDeviceSignatureGranted:()=>{},onDeviceSignatureRequested:()=>{}};function Uc(e,t){return Nc(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},xc),t),{inputs:s,associatedKeysets:u,changePath:a,outputScriptHex:c,lockTime:p,sigHashType:f,segwit:h,initialTimestamp:l,additionals:d,expiryHeight:w,onDeviceStreaming:g,onDeviceSignatureGranted:y,onDeviceSignatureRequested:m}=r;let E=r.useTrustedInputForSegwit;if(void 0===E)try{E=function({version:e,name:t}){return"Decred"!==t&&("Exchange"===t||n.s.gte(e,"1.4.0"))}(yield Ac(e))}catch(V){if(27904!==V.statusCode)throw V;E=!1}const S=(e,t)=>{const{length:r}=s;if(r<3)return;const n=r*e+t,i=2*r;g({progress:n/i,total:i,index:n})},_=d.includes("decred"),I=d.includes("zcash"),T=d.includes("stealthcoin"),b=Date.now(),v=d.includes("sapling"),P=h&&d.includes("bech32"),O=h||!!d&&(d.includes("abc")||d.includes("gold")||d.includes("bip143"))||!!w&&!_,k=i.d.Buffer.alloc(4);k.writeUInt32LE(p,0);const B=i.d.Buffer.alloc(0),A=i.d.Buffer.alloc(0),N=i.d.Buffer.alloc(4);w&&!_?N.writeUInt32LE(I?2147483653:v?2147483652:2147483651,0):T?N.writeUInt32LE(2,0):N.writeUInt32LE(1,0);const x=[],U=[],R=[],C=[];let H=!0;const M={inputs:[],version:N,timestamp:i.d.Buffer.alloc(0)},K=O&&!E?Tc:Ec,D=i.d.Buffer.from(c,"hex");S(0,0);for(const t of s){{const r=yield K(e,t[1],t[0],d);(0,o.l)("hw","got trustedInput="+r);const n=i.d.Buffer.alloc(4);n.writeUInt32LE(t.length>=4&&"number"==typeof t[3]?t[3]:Sa,0),x.push({trustedInput:!0,value:i.d.Buffer.from(r,"hex"),sequence:n})}const{outputs:r}=t[0],n=t[1];r&&n<=r.length-1&&U.push(r[n]),w&&!_?(M.nVersionGroupId=i.d.Buffer.from(I?[10,39,167,38]:v?[133,32,47,137]:[112,130,196,3]),M.nExpiryHeight=w,M.extraData=i.d.Buffer.from(v?[0,0,0,0,0,0,0,0,0,0,0]:[0])):_&&(M.nExpiryHeight=w)}M.inputs=s.map(((e,t)=>{const r=i.d.Buffer.alloc(4);return r.writeUInt32LE(e.length>=4&&"number"==typeof e[3]?e[3]:Sa,0),{script:I?U[t].script:B,prevout:A,sequence:r}}));{const t=[];for(let r=0;r<s.length;r++){const n=yield dc(e,{path:u[r]});S(0,r+1),t.push(n)}for(let e=0;e<t.length;e++)C.push(bc(i.d.Buffer.from(t[e].publicKey,"hex")))}void 0!==l&&(M.timestamp=i.d.Buffer.alloc(4),M.timestamp.writeUInt32LE(Math.floor(l+(Date.now()-b)/1e3),0)),m(),O&&(yield Ic(e,!0,M,x,!0,!!w,d,E),a&&(yield Oc(e,a)),yield kc(e,D)),w&&!_&&(yield vc(e,"",p,1,w));for(let t=0;t<s.length;t++){const r=s[t],n=s[t].length>=3&&"string"==typeof r[2]?i.d.Buffer.from(r[2],"hex"):h?i.d.Buffer.concat([i.d.Buffer.from([118,169,20]),_a(C[t]),i.d.Buffer.from([136,172])]):U[t].script,o=Object.assign({},M),c=O?[x[t]]:x;O?o.inputs=[Object.assign(Object.assign({},o.inputs[t]),{script:n})]:o.inputs[t].script=n,yield Ic(e,!O&&H,o,c,O,!!w&&!_,d,E),O||(a&&(yield Oc(e,a)),yield kc(e,D,d)),H&&(y(),S(1,0));const l=yield vc(e,u[t],p,f,w,d);S(1,t+1),R.push(l),M.inputs[t].script=B,H&&(H=!1)}for(let e=0;e<s.length;e++){if(h)M.witness=i.d.Buffer.alloc(0),P||(M.inputs[e].script=i.d.Buffer.concat([i.d.Buffer.from("160014","hex"),_a(C[e])]));else{const t=i.d.Buffer.alloc(1),r=i.d.Buffer.alloc(1);t[0]=R[e].length,r[0]=C[e].length,M.inputs[e].script=i.d.Buffer.concat([t,R[e],r,C[e]])}const t=O&&!E?0:4;M.inputs[e].prevout=x[e].value.slice(t,t+36)}M.locktime=k;let L=i.d.Buffer.concat([rc(M,!1,M.timestamp,d),D]);if(h&&!_){let e=i.d.Buffer.alloc(0);for(let t=0;t<s.length;t++){const r=i.d.Buffer.concat([i.d.Buffer.from("02","hex"),i.d.Buffer.from([R[t].length]),R[t],i.d.Buffer.from([C[t].length]),C[t]]);e=i.d.Buffer.concat([e,r])}L=i.d.Buffer.concat([L,e])}if(I||(L=i.d.Buffer.concat([L,k]),w&&(L=i.d.Buffer.concat([L,M.nExpiryHeight||i.d.Buffer.alloc(0),M.extraData||i.d.Buffer.alloc(0)]))),_){let e=i.d.Buffer.from([M.inputs.length]);s.forEach(((t,r)=>{e=i.d.Buffer.concat([e,i.d.Buffer.from([0,0,0,0,0,0,0,0]),i.d.Buffer.from([0,0,0,0]),i.d.Buffer.from([255,255,255,255]),i.d.Buffer.from([M.inputs[r].script.length]),M.inputs[r].script])})),L=i.d.Buffer.concat([L,e])}return I&&(L=i.d.Buffer.concat([L,i.d.Buffer.from([0,0,0])])),L.toString("hex")}))}var Rc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};var Cc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};class Hc{constructor(e){this.transport=e,this.derivationsCache={}}derivatePath(e){return Cc(this,void 0,void 0,(function*(){if(this.derivationsCache[e])return this.derivationsCache[e];const t=yield dc(this.transport,{path:e});return this.derivationsCache[e]=t,t}))}getWalletXpub({path:e,xpubVersion:t}){return Cc(this,void 0,void 0,(function*(){const r=ha(e),n=r.slice(0,-1),s=yield this.derivatePath(fa(n)),o=yield this.derivatePath(e),u=function(e){return function(e){return function(e){return(new i.ae).update(e).digest()}(Dc(e))}(e).slice(0,4)}(Kc(i.d.Buffer.from(s.publicKey,"hex")));return function(e,t,r,n,s,o){const u=Mc(n);u[0]|=128;const a=i.d.Buffer.concat([Mc(e),i.d.Buffer.from([t]),r,u,s,o]),c=function(e){return Dc(Dc(e))}(a).slice(0,4);return i.ag.encode(i.d.Buffer.concat([a,c]))}(t,r.length,u,r[r.length-1],i.d.Buffer.from(o.chainCode,"hex"),Kc(i.d.Buffer.from(o.publicKey,"hex")))}))}getWalletPublicKey(e,t){if("bech32m"===(null==t?void 0:t.format))throw new Error("Unsupported address format bech32m");return dc(this.transport,Object.assign(Object.assign({},t),{path:e}))}createPaymentTransaction(e){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return Uc(this.transport,e)}signMessage({path:e,messageHex:t}){return Cc(this,void 0,void 0,(function*(){return function(e,{path:t,messageHex:r}){return Rc(this,void 0,void 0,(function*(){const n=s.b.fromString(t).toPathArray(),o=i.d.Buffer.from(r,"hex");let u=0;for(;u!==o.length;){const t=0===u?Ea-1-4*n.length-4:Ea,r=u+t>o.length?o.length-u:t,s=i.d.Buffer.alloc(0===u?1+4*n.length+2+r:r);0===u?(s[0]=n.length,n.forEach(((e,t)=>{s.writeUInt32BE(e,1+4*t)})),s.writeUInt16BE(o.length,1+4*n.length),o.copy(s,1+4*n.length+2,u,u+r)):o.copy(s,0,u,u+r),yield e.send(224,78,0,0===u?1:128,s),u+=r}const a=yield e.send(224,78,128,0,i.d.Buffer.from([0])),c=a[0]-48;let p=a.slice(4,4+a[3]);0===p[0]&&(p=p.slice(1)),p=p.toString("hex"),u=4+a[3]+2;let f=a.slice(u,u+a[u-1]);return 0===f[0]&&(f=f.slice(1)),f=f.toString("hex"),{v:c,r:p,s:f}}))}(this.transport,{path:e,messageHex:t})}))}}function Mc(e){const t=i.d.Buffer.allocUnsafe(4);return t.writeUInt32BE(e,0),t}const Kc=e=>i.d.Buffer.concat([i.d.Buffer.from([2+(1&e[64])]),e.slice(1,33)]);function Dc(e){return(0,i.af)("sha256").update(e).digest()}class Lc{constructor(e,t){if(e.length!=t.length)throw new Error("keys and values should have the same length");for(let r=0;r<e.length-1;r++)if(e[r].toString("hex")>=e[r+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=e,this.keysTree=new ka(e.map((e=>Ba(e)))),this.values=t,this.valuesTree=new ka(t.map((e=>Ba(e))))}commitment(){return i.d.Buffer.concat([ec(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}}class Vc extends La{constructor(e){super(),this.inputMerkleMaps=[],this.outputMerkleMaps=[],e.copy(this),this.globalMerkleMap=Vc.createMerkleMap(this.globalMap);for(let t=0;t<this.getGlobalInputCount();t++)this.inputMerkleMaps.push(Vc.createMerkleMap(this.inputMaps[t]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map((e=>e.commitment()));for(let t=0;t<this.getGlobalOutputCount();t++)this.outputMerkleMaps.push(Vc.createMerkleMap(this.outputMaps[t]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map((e=>e.commitment()))}getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(e){const t=[...e.keys()].sort(),r=t.map((t=>{const r=e.get(t);if(!r)throw new Error("No value for key "+t);return r})),n=t.map((e=>i.d.Buffer.from(e,"hex")));return new Lc(n,r)}}var Gc;!function(e){e[e.YIELD=16]="YIELD",e[e.GET_PREIMAGE=64]="GET_PREIMAGE",e[e.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",e[e.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",e[e.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"}(Gc||(Gc={}));class Wc{}class Fc extends Wc{constructor(e,t){super(),this.progressCallback=t,this.code=Gc.YIELD,this.results=e}execute(e){return this.results.push(i.d.Buffer.from(e.subarray(1))),this.progressCallback(),i.d.Buffer.from("")}}class qc extends Wc{constructor(e,t){super(),this.code=Gc.GET_PREIMAGE,this.known_preimages=e,this.queue=t}execute(e){const t=i.d.Buffer.from(e.subarray(1));if(33!=t.length)throw new Error("Invalid request, unexpected trailing data");if(0!=t[0])throw new Error("Unsupported request, the first byte should be 0");const r=i.d.Buffer.alloc(32);for(let i=0;i<32;i++)r[i]=t[1+i];const n=r.toString("hex"),s=this.known_preimages.get(n);if(null!=s){const e=ec(s.length),t=255-e.length-1,r=Math.min(t,s.length);if(r<s.length)for(let n=r;n<s.length;n++)this.queue.push(i.d.Buffer.from([s[n]]));return i.d.Buffer.concat([e,i.d.Buffer.from([r]),i.d.Buffer.from(s.subarray(0,r))])}throw Error(`Requested unknown preimage for: ${n}`)}}class jc extends Wc{constructor(e,t){super(),this.code=Gc.GET_MERKLE_LEAF_PROOF,this.known_trees=e,this.queue=t}execute(e){const t=i.d.Buffer.from(e.subarray(1));if(t.length<34)throw new Error("Invalid request, expected at least 34 bytes");const r=new ma(t),n=r.readSlice(32).toString("hex");let s,o;try{s=r.readVarInt(),o=r.readVarInt()}catch{throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}const u=this.known_trees.get(n);if(!u)throw Error(`Requested Merkle leaf proof for unknown tree: ${n}`);if(o>=s||u.size()!=s)throw Error("Invalid index or tree size.");if(0!=this.queue.length)throw Error("This command should not execute when the queue is not empty.");const a=u.getProof(o),c=Math.min(Math.floor(221/32),a.length),p=a.length-c;return p>0&&this.queue.push(...a.slice(-p)),i.d.Buffer.concat([u.getLeafHash(o),i.d.Buffer.from([a.length]),i.d.Buffer.from([c]),...a.slice(0,c)])}}class Xc extends Wc{constructor(e){super(),this.code=Gc.GET_MERKLE_LEAF_INDEX,this.known_trees=e}execute(e){const t=i.d.Buffer.from(e.subarray(1));if(64!=t.length)throw new Error("Invalid request, unexpected trailing data");const r=i.d.Buffer.alloc(32);for(let i=0;i<32;i++)r[i]=t.readUInt8(i);const n=r.toString("hex"),s=i.d.Buffer.alloc(32);for(let i=0;i<32;i++)s[i]=t.readUInt8(32+i);const o=s.toString("hex"),u=this.known_trees.get(n);if(!u)throw Error(`Requested Merkle leaf index for unknown root: ${n}`);let a=0,c=0;for(let i=0;i<u.size();i++)if(u.getLeafHash(i).toString("hex")==o){c=1,a=i;break}return i.d.Buffer.concat([i.d.Buffer.from([c]),ec(a)])}}class $c extends Wc{constructor(e){super(),this.code=Gc.GET_MORE_ELEMENTS,this.queue=e}execute(e){if(1!=e.length)throw new Error("Invalid request, unexpected trailing data");if(0===this.queue.length)throw new Error("No elements to get");const t=this.queue[0].length;if(this.queue.some((e=>e.length!=t)))throw new Error("The queue contains elements with different byte length, which is not expected");const r=Math.floor(253/t),n=Math.min(r,this.queue.length),s=this.queue.splice(0,n);return i.d.Buffer.concat([i.d.Buffer.from([n]),i.d.Buffer.from([t]),...s])}}class Yc{constructor(e){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;const t=[new Fc(this.yielded,e),new qc(this.preimages,this.queue),new Xc(this.roots),new jc(this.roots,this.queue),new $c(this.queue)];for(const r of t){if(this.commands.has(r.code))throw new Error(`Multiple commands with code ${r.code}`);this.commands.set(r.code,r)}}getYielded(){return this.yielded}addKnownPreimage(e){this.preimages.set(Zu.sha256(e).toString("hex"),e)}addKnownList(e){for(const r of e){const e=i.d.Buffer.concat([i.d.Buffer.from([0]),r]);this.addKnownPreimage(e)}const t=new ka(e.map((e=>Ba(e))));this.roots.set(t.getRoot().toString("hex"),t)}addKnownMapping(e){this.addKnownList(e.keys),this.addKnownList(e.values)}execute(e){if(0==e.length)throw new Error("Unexpected empty command");const t=e[0],r=this.commands.get(t);if(!r)throw new Error(`Unexpected command code ${t}`);return r.execute(e)}}var zc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};var Qc,Jc;!function(e){e[e.GET_PUBKEY=0]="GET_PUBKEY",e[e.REGISTER_WALLET=2]="REGISTER_WALLET",e[e.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",e[e.SIGN_PSBT=4]="SIGN_PSBT",e[e.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",e[e.SIGN_MESSAGE=16]="SIGN_MESSAGE"}(Qc||(Qc={})),function(e){e[e.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"}(Jc||(Jc={}));class Zc{constructor(e){this.transport=e}makeRequest(e,t,r){return zc(this,void 0,void 0,(function*(){let n=yield this.transport.send(225,e,0,0,t,[36864,57344]);for(;57344===n.readUInt16BE(n.length-2);){if(!r)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");const e=n.slice(0,-2),t=r.execute(e);n=yield this.transport.send(248,Jc.CONTINUE_INTERRUPTED,0,0,t,[36864,57344])}return n.slice(0,-2)}))}getExtendedPubkey(e,t){return zc(this,void 0,void 0,(function*(){if(t.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(yield this.makeRequest(Qc.GET_PUBKEY,i.d.Buffer.concat([i.d.Buffer.from(e?[1]:[0]),ca(t)]))).toString("ascii")}))}getWalletAddress(e,t,r,n,s){return zc(this,void 0,void 0,(function*(){if(0!==r&&1!==r)throw new Error("Change can only be 0 or 1");if(n<0||!Number.isInteger(n))throw new Error("Invalid address index");if(null!=t&&32!=t.length)throw new Error("Invalid HMAC length");const o=new Yc((()=>{}));o.addKnownList(e.keys.map((e=>i.d.Buffer.from(e,"ascii")))),o.addKnownPreimage(e.serialize());const u=i.d.Buffer.alloc(4);return u.writeUInt32BE(n,0),(yield this.makeRequest(Qc.GET_WALLET_ADDRESS,i.d.Buffer.concat([i.d.Buffer.from(s?[1]:[0]),e.getWalletId(),t||i.d.Buffer.alloc(32,0),i.d.Buffer.from([r]),u]),o)).toString("ascii")}))}signPsbt(e,t,r,n){return zc(this,void 0,void 0,(function*(){const s=new Vc(e);if(null!=r&&32!=r.length)throw new Error("Invalid HMAC length");const o=new Yc(n);o.addKnownList(t.keys.map((e=>i.d.Buffer.from(e,"ascii")))),o.addKnownPreimage(t.serialize()),o.addKnownMapping(s.globalMerkleMap);for(const e of s.inputMerkleMaps)o.addKnownMapping(e);for(const e of s.outputMerkleMaps)o.addKnownMapping(e);o.addKnownList(s.inputMapCommitments);const u=new ka(s.inputMapCommitments.map((e=>Ba(e)))).getRoot();o.addKnownList(s.outputMapCommitments);const a=new ka(s.outputMapCommitments.map((e=>Ba(e)))).getRoot();yield this.makeRequest(Qc.SIGN_PSBT,i.d.Buffer.concat([s.getGlobalKeysValuesRoot(),ec(s.getGlobalInputCount()),u,ec(s.getGlobalOutputCount()),a,t.getWalletId(),r||i.d.Buffer.alloc(32,0)]),o);const c=o.getYielded(),p=new Map;for(const e of c)p.set(e[0],e.slice(1));return p}))}getMasterFingerprint(){return zc(this,void 0,void 0,(function*(){return this.makeRequest(Qc.GET_MASTER_FINGERPRINT,i.d.Buffer.from([]))}))}signMessage(e,t){return zc(this,void 0,void 0,(function*(){if(t.length>6)throw new Error("Path too long. At most 6 levels allowed.");const r=new Yc((()=>{})),n=Math.ceil(e.length/64),s=[];for(let t=0;t<n;t++)s.push(e.subarray(64*t,64*t+64));r.addKnownList(s);const o=new ka(s.map((e=>Ba(e)))).getRoot();return(yield this.makeRequest(Qc.SIGN_MESSAGE,i.d.Buffer.concat([ca(t),ec(e.length),o]),r)).toString("base64")}))}}var ep=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};const tp={lockTime:0,sigHashType:1,segwit:!1,transactionVersion:1};var rp=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(t){s(t)}}function u(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,u)}a((n=n.apply(e,t||[])).next())}))};class np{constructor({transport:e,scrambleKey:t="BTC",currency:r="bitcoin"}){this._transport=e,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],t),this._impl=(()=>{switch(r){case"bitcoin":case"bitcoin_testnet":case"qtum":return new ic(new Zc(this._transport));default:return new Hc(this._transport)}})()}getWalletXpub(e){return this.changeImplIfNecessary().then((t=>t.getWalletXpub(e)))}getWalletPublicKey(e,t){let r;return arguments.length>2||"boolean"==typeof t?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),r={verify:!!t,format:arguments[2]?"p2sh":"legacy"}):r=t||{},this.changeImplIfNecessary().then((t=>t.getWalletPublicKey(e,r)))}signMessage(e,t){return this.changeImplIfNecessary().then((r=>r.signMessage({path:e,messageHex:t})))}createPaymentTransaction(e){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then((t=>t.createPaymentTransaction(e)))}signP2SHTransaction(e){return function(e,t){return ep(this,void 0,void 0,(function*(){const{inputs:r,associatedKeysets:n,outputScriptHex:s,lockTime:o,sigHashType:u,segwit:a,transactionVersion:c}=Object.assign(Object.assign({},tp),t),p=i.d.Buffer.alloc(0),f=i.d.Buffer.alloc(0),h=i.d.Buffer.alloc(4);h.writeUInt32LE(c,0);const l=[],d=[],w=[];let g=!0;const y={inputs:[],version:h},m=a?Tc:Ec,E=i.d.Buffer.from(s,"hex");for(const t of r){{const r=yield m(e,t[1],t[0]),n=i.d.Buffer.alloc(4);n.writeUInt32LE(t.length>=4&&"number"==typeof t[3]?t[3]:Sa,0),l.push({trustedInput:!1,value:a?i.d.Buffer.from(r,"hex"):i.d.Buffer.from(r,"hex").slice(4,40),sequence:n})}const{outputs:r}=t[0],n=t[1];r&&n<=r.length-1&&d.push(r[n])}for(let e=0;e<r.length;e++){const t=i.d.Buffer.alloc(4);t.writeUInt32LE(r[e].length>=4&&"number"==typeof r[e][3]?r[e][3]:Sa,0),y.inputs.push({script:p,prevout:f,sequence:t})}a&&(yield Ic(e,!0,y,l,!0),yield kc(e,E));for(let t=0;t<r.length;t++){const s=r[t],c=r[t].length>=3&&"string"==typeof s[2]?i.d.Buffer.from(s[2],"hex"):d[t].script,f=Object.assign({},y),h=a?[l[t]]:l;a?f.inputs=[Object.assign(Object.assign({},f.inputs[t]),{script:c})]:f.inputs[t].script=c,yield Ic(e,!a&&g,f,h,a),a||(yield kc(e,E));const m=yield vc(e,n[t],o,u);w.push(a?m.toString("hex"):m.slice(0,m.length-1).toString("hex")),y.inputs[t].script=p,g&&(g=!1)}return w}))}(this._transport,e)}splitTransaction(e,t=!1,r=!1,n=!1,s=[]){return function(e,t=!1,r=!1,n=!1,s=[]){const u=[],a=[];let c,p,f=!1,h=0,l=i.d.Buffer.alloc(0),d=i.d.Buffer.alloc(0),w=i.d.Buffer.alloc(0),g=i.d.Buffer.alloc(0);const y=s.includes("decred"),m=s.includes("zencash"),E=s.includes("zcash"),S=i.d.Buffer.from(e,"hex"),_=S.slice(h,h+4),I=_.equals(i.d.Buffer.from([3,0,0,128]))||_.equals(i.d.Buffer.from([4,0,0,128]))||_.equals(i.d.Buffer.from([5,0,0,128])),T=E&&_.equals(i.d.Buffer.from([5,0,0,128]));h+=4,!r&&t&&0===S[h]&&0!==S[h+1]&&!m&&(h+=2,f=!0),r&&(l=S.slice(h,4+h),h+=4),I&&(w=S.slice(h,4+h),h+=4),T&&(p=S.slice(h+4,h+8),d=S.slice(h+8,h+12),h+=12);let b=Za(S,h);const v=b[0];h+=b[1];for(let o=0;o<v;o++){const e=S.slice(h,h+36);h+=36;let t=i.d.Buffer.alloc(0),r=i.d.Buffer.alloc(0);y?(r=S.slice(h,h+1),h+=1):(b=Za(S,h),h+=b[1],t=S.slice(h,h+b[0]),h+=b[0]);const n=S.slice(h,h+4);h+=4,u.push({prevout:e,script:t,sequence:n,tree:r})}b=Za(S,h);const P=b[0];h+=b[1];for(let i=0;i<P;i++){const e=S.slice(h,h+8);h+=8,y&&(h+=2),b=Za(S,h),h+=b[1];const t=S.slice(h,h+b[0]);h+=b[0],a.push({amount:e,script:t})}if(f?(c=S.slice(h,-4),p=S.slice(S.length-4)):T||(p=S.slice(h,h+4)),h+=4,(I||y)&&!T&&(d=S.slice(h,h+4),h+=4),n&&(g=S.slice(h)),y){if(b=Za(S,h),h+=b[1],b[0]!==v)throw new Error("splitTransaction: incoherent number of witnesses");for(let e=0;e<v;e++){h+=8,h+=4,h+=4,b=Za(S,h),h+=b[1];const t=S.slice(h,h+b[0]);h+=b[0],u[e].script=t}}const O={version:_,inputs:u,outputs:a,locktime:p,witness:c,timestamp:l,nVersionGroupId:w,nExpiryHeight:d,extraData:g};return(0,o.l)("btc",`splitTransaction ${e}:\n${function(e){let t="TX";return t+=" version "+e.version.toString("hex"),e.locktime&&(t+=" locktime "+e.locktime.toString("hex")),e.witness&&(t+=" witness "+e.witness.toString("hex")),e.timestamp&&(t+=" timestamp "+e.timestamp.toString("hex")),e.nVersionGroupId&&(t+=" nVersionGroupId "+e.nVersionGroupId.toString("hex")),e.nExpiryHeight&&(t+=" nExpiryHeight "+e.nExpiryHeight.toString("hex")),e.extraData&&(t+=" extraData "+e.extraData.toString("hex")),e.inputs.forEach((({prevout:e,script:r,sequence:n},i)=>{t+=`\ninput ${i}:`,t+=` prevout ${e.toString("hex")}`,t+=` script ${r.toString("hex")}`,t+=` sequence ${n.toString("hex")}`})),(e.outputs||[]).forEach((({amount:e,script:r},n)=>{t+=`\noutput ${n}:`,t+=` amount ${e.toString("hex")}`,t+=` script ${r.toString("hex")}`})),t}(O)}`),O}(e,t,r,n,s)}serializeTransactionOutputs(e){return tc(e)}getTrustedInput(e,t,r=[]){return Ec(this._transport,e,t,r)}getTrustedInputBIP143(e,t,r=[]){return Tc(this._transport,e,t,r)}changeImplIfNecessary(){return rp(this,void 0,void 0,(function*(){if(this._impl instanceof Hc)return this._impl;const{name:e,version:t}=yield Ac(this._transport);return(yield rp(this,void 0,void 0,(function*(){switch(e){case"Bitcoin":case"Bitcoin Test":return n.s.lt(t,"2.1.0");case"Bitcoin Legacy":case"Bitcoin Test Legacy":default:return!0;case"Exchange":return yield(e=>Bc(void 0,void 0,void 0,(function*(){try{yield e.send(224,196,0,0)}catch{return!1}return!0})))(this._transport);case"Qtum":return n.s.lt(t,"3.0.0")}})))&&(this._impl=new Hc(this._transport)),this._impl}))}}},7460:(e,t,r)=>{r.d(t,{L:()=>o,l:()=>s});let n=0;const i=[],s=(e,t,r)=>{const i={type:e,id:String(++n),date:new Date};t&&(i.message=t),r&&(i.data=r),u(i)};class o{constructor(e,t){this.type=e,this.context=t}trace(e,t){(({type:e,message:t,data:r,context:i})=>{const s={type:e,id:String(++n),date:new Date};t&&(s.message=t),r&&(s.data=r),i&&(s.context=i),u(s)})({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new o(e,this.context)}withContext(e){return new o(this.type,e)}withUpdatedContext(e){return new o(this.type,Object.assign(Object.assign({},this.context),e))}}function u(e){for(let r=0;r<i.length;r++)try{i[r](e)}catch(t){console.error(t)}}typeof window<"u"&&(window.__ledgerLogsListen=e=>(i.push(e),()=>{const t=i.indexOf(e);-1!==t&&(i[t]=i[i.length-1],i.pop())}))},24876:(e,t,r)=>{r.d(t,{b:()=>u});var n=r(14806);const i=2147483648;var s=function(e){if(!Array.isArray(e))throw new Error("Input must be an Array");if(0===e.length)throw new Error("Path must contain at least one level");for(var t=0;t<e.length;t++)if("number"!=typeof e[t])throw new Error("Path element is not a number");this.path=e};s.validatePathArray=function(e){try{return s.fromPathArray(e),!0}catch{return!1}},s.validateString=function(e,t){try{return s.fromString(e,t),!0}catch{return!1}},s.fromPathArray=function(e){return new s(e)},s.fromString=function(e,t){if(/^m\//i.test(e))e=e.slice(2);else if(t)throw new Error("Root element is required");for(var r=e.split("/"),n=new Array(r.length),o=0;o<r.length;o++){var u=/(\d+)([hH\']?)/.exec(r[o]);if(null===u)throw new Error("Invalid input");if(n[o]=parseInt(u[1],10),n[o]>=i)throw new Error("Invalid child index");if("h"===u[2]||"H"===u[2]||"'"===u[2])n[o]+=i;else if(0!=u[2].length)throw new Error("Invalid modifier")}return new s(n)},s.prototype.toPathArray=function(){return this.path},s.prototype.toString=function(e,t){for(var r=new Array(this.path.length),n=0;n<this.path.length;n++){var s=this.path[n];r[n]=s&i?(s&~i)+(t?"h":"'"):s}return(e?"":"m/")+r.join("/")},s.prototype.inspect=function(){return"BIPPath <"+this.toString()+">"};var o=s;const u=(0,n.g)(o)}}]);
//# sourceMappingURL=868.9696c268.chunk.js.map