"use strict";(globalThis.webpackChunkwinbit32=globalThis.webpackChunkwinbit32||[]).push([[17],{54017:(e,t,n)=>{n.d(t,{default:()=>I});var i=n(24430),o=n.n(i),s=n(78488),r=n(34401),c=n(74248).Buffer,a=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(t){s(t)}}function c(e){try{a(i.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((i=i.apply(e,t||[])).next())}))};class u{constructor({context:e,logType:t}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new(o()),this.send=(e,t,n,i,...o)=>a(this,[e,t,n,i,...o],void 0,(function*(e,t,n,i,o=c.alloc(0),r=[s.vi.OK],{abortTimeoutMs:a}={}){const u=this.tracer.withUpdatedContext({function:"send"});if(o.length>=256)throw u.trace("data.length exceeded 256 bytes limit",{dataLength:o.length}),new s.wX("data.length exceed 256 bytes limit. Got: "+o.length,"DataLengthTooBig");u.trace("Starting an exchange",{abortTimeoutMs:a});const d=yield this.exchange(c.concat([c.from([e,t,n,i]),c.from([o.length]),o]),{abortTimeoutMs:a});u.trace("Received response from exchange");const h=d.readUInt16BE(d.length-2);if(!r.some((e=>e===h)))throw new s._3(h);return d})),this._appAPIlock=null,this.tracer=new r.PR(null!==t&&void 0!==t?t:"transport",e)}exchange(e,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(e,t){let n=!1;return(()=>a(this,void 0,void 0,(function*(){if(!n)for(const i of e){const e=yield this.exchange(i);if(n)return;const o=e.readUInt16BE(e.length-2);if(o!==s.vi.OK)throw new s._3(o);t.next(e)}})))().then((()=>!n&&t.complete()),(e=>!n&&t.error(e))),{unsubscribe:()=>{n=!0}}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise(((n,i)=>{let o=!1;const r=this.listen({next:t=>{o=!0,r&&r.unsubscribe(),c&&clearTimeout(c),this.open(t.descriptor,e).then(n,i)},error:e=>{c&&clearTimeout(c),i(e)},complete:()=>{c&&clearTimeout(c),o||i(new s.wX(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),c=t?setTimeout((()=>{r.unsubscribe(),i(new s.wX(this.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))}exchangeAtomicImpl(e){return a(this,void 0,void 0,(function*(){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new s.ug("An action was already pending on the Ledger device. Please deny or reconnect.");let n;const i=new Promise((e=>{n=e}));this.exchangeBusyPromise=i;let o=!1;const r=setTimeout((()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),o=!0,this.emit("unresponsive")}),this.unresponsiveTimeout);try{const n=yield e();return o&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),n}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(r),n&&n(),this.exchangeBusyPromise=null}}))}decorateAppAPIMethods(e,t,n){for(const i of t)e[i]=this.decorateAppAPIMethod(i,e[i],e,n)}decorateAppAPIMethod(e,t,n,i){return(...o)=>a(this,void 0,void 0,(function*(){const{_appAPIlock:r}=this;if(r)return Promise.reject(new s.wX("Ledger Device is busy (lock "+r+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(i),yield t.apply(n,o)}finally{this._appAPIlock=null}}))}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}u.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",u.ErrorMessage_NoDeviceFound="No Ledger device found";const d=u;var h=n(74248).Buffer;function l(e){const t=h.alloc(2);return t.writeUInt16BE(e,0),t}const f={data:h.alloc(0),dataLength:0,sequence:0},g=(e,t)=>({makeBlocks(n){let i=h.concat([l(n.length),n]);const o=t-5,s=Math.ceil(i.length/o);i=h.concat([i,h.alloc(s*o-i.length+1).fill(0)]);const r=[];for(let t=0;t<s;t++){const n=h.alloc(5);n.writeUInt16BE(e,0),n.writeUInt8(5,2),n.writeUInt16BE(t,3);const s=i.slice(t*o,(t+1)*o);r.push(h.concat([n,s]))}return r},reduceResponse(t,n){let{data:i,dataLength:o,sequence:r}=t||f;if(n.readUInt16BE(0)!==e)throw new s.wX("Invalid channel","InvalidChannel");if(5!==n.readUInt8(2))throw new s.wX("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==r)throw new s.wX("Invalid sequence","InvalidSequence");t||(o=n.readUInt16BE(5)),r++;const c=n.slice(t?5:7);return i=h.concat([i,c]),i.length>o&&(i=i.slice(0,o)),{data:i,dataLength:o,sequence:r}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var v=n(98527),p=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(t){s(t)}}function c(e){try{a(i.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((i=i.apply(e,t||[])).next())}))};const m=[{vendorId:v.ledgerUSBVendorId}];function w(){return p(this,void 0,void 0,(function*(){return yield navigator.usb.requestDevice({filters:m})}))}function y(){return p(this,void 0,void 0,(function*(){return(yield navigator.usb.getDevices()).filter((e=>e.vendorId===v.ledgerUSBVendorId))}))}var x=n(74248).Buffer,b=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(t){s(t)}}function c(e){try{a(i.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((i=i.apply(e,t||[])).next())}))};class T extends d{constructor(e,t){super(),this.channel=Math.floor(65535*Math.random()),this.packetSize=64,this._disconnectEmitted=!1,this._emitDisconnect=e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))},this.device=e,this.interfaceNumber=t,this.deviceModel=(0,v.zH)(e.productId)}static request(){return b(this,void 0,void 0,(function*(){const e=yield w();return T.open(e)}))}static openConnected(){return b(this,void 0,void 0,(function*(){const e=yield y();return 0===e.length?null:T.open(e[0])}))}static open(e){return b(this,void 0,void 0,(function*(){yield e.open(),null===e.configuration&&(yield e.selectConfiguration(1)),yield P(e);const t=e.configurations[0].interfaces.find((({alternates:e})=>e.some((e=>255===e.interfaceClass))));if(!t)throw new s.pi("No WebUSB interface found for your Ledger device. Please upgrade firmware or contact techsupport.");const n=t.interfaceNumber;try{yield e.claimInterface(n)}catch(r){throw yield e.close(),new s.pi(r.message)}const i=new T(e,n),o=t=>{e===t.device&&(navigator.usb.removeEventListener("disconnect",o),i._emitDisconnect(new s.DisconnectedDevice))};return navigator.usb.addEventListener("disconnect",o),i}))}close(){return b(this,void 0,void 0,(function*(){yield this.exchangeBusyPromise,yield this.device.releaseInterface(this.interfaceNumber),yield P(this.device),yield this.device.close()}))}exchange(e){return b(this,void 0,void 0,(function*(){return yield this.exchangeAtomicImpl((()=>b(this,void 0,void 0,(function*(){const{channel:t,packetSize:n}=this;(0,r.Rm)("apdu","=> "+e.toString("hex"));const i=g(t,n),o=i.makeBlocks(e);for(let e=0;e<o.length;e++)yield this.device.transferOut(3,o[e]);let s,c;for(;!(s=i.getReducedResult(c));){const e=yield this.device.transferIn(3,n),t=x.from(e.data.buffer);c=i.reduceResponse(c,t)}return(0,r.Rm)("apdu","<= "+s.toString("hex")),s})))).catch((e=>{if(e&&e.message&&e.message.includes("disconnected"))throw this._emitDisconnect(e),new s.iX(e.message);throw e}))}))}setScrambleKey(){}}T.isSupported=()=>Promise.resolve(!!navigator&&!!navigator.usb&&"function"===typeof navigator.usb.getDevices),T.list=y,T.listen=e=>{let t=!1;return function(){return p(this,void 0,void 0,(function*(){const e=yield y();return e.length>0?e[0]:w()}))}().then((n=>{if(!t){const t=(0,v.zH)(n.productId);e.next({type:"add",descriptor:n,deviceModel:t}),e.complete()}}),(t=>{window.DOMException&&t instanceof window.DOMException&&18===t.code?e.error(new s.e0(t.message)):e.error(new s.kt(t.message))})),{unsubscribe:function(){t=!0}}};const I=T;function P(e){return b(this,void 0,void 0,(function*(){try{yield e.reset()}catch(t){console.warn(t)}}))}},34401:(e,t,n)=>{n.d(t,{PR:()=>r,Rm:()=>s});let i=0;const o=[],s=(e,t,n)=>{const o={type:e,id:String(++i),date:new Date};t&&(o.message=t),n&&(o.data=n),a(o)};class r{constructor(e,t){this.type=e,this.context=t}trace(e,t){(({type:e,message:t,data:n,context:o})=>{const s={type:e,id:String(++i),date:new Date};t&&(s.message=t),n&&(s.data=n),o&&(s.context=o),a(s)})({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new r(e,this.context)}withContext(e){return new r(this.type,e)}withUpdatedContext(e){return new r(this.type,Object.assign(Object.assign({},this.context),e))}}const c=e=>(o.push(e),()=>{const t=o.indexOf(e);-1!==t&&(o[t]=o[o.length-1],o.pop())});function a(e){for(let n=0;n<o.length;n++)try{o[n](e)}catch(t){console.error(t)}}"undefined"!==typeof window&&(window.__ledgerLogsListen=c)}}]);
//# sourceMappingURL=17.b609a83d.chunk.js.map